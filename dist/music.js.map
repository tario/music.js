{"version":3,"sources":["typecast.js","music.js","effects.js","instruments.js","lemonade.js","math.js","noteSequence.js","pattern.js","sequenceParser.js","song.js","utils.js","wave.js","serializer/CachedSerializer.js","serializer/HuffmanSerializerWrapper.js","serializer/JSONSerializer.js","serializer/MultiSerializer.js","serializer/PackedJSONSerializer.js","serializer/PackedJSONSerializerB.js"],"names":["TypeConversor","typeName","conversorArray","add","conversor","push","cast","obj","i","length","converted","TypeCast","typeConversors","register","typeConversor","window","MUSIC","Types","SoundLib","Effects","playablePipeExtend","during","duration","original","play","stopped","playable","wrapper","stop","setTimeout","stopDelay","delay","param","playing","bind","onError","fcn","e","console","error","onStop","EffectsPipeline","audio","audioDestination","_audio","_audioDestination","defaultWrapFcn","compose","f","g","prototype","_wrapFcn","wrap","ret","DummyNode","ret2","sfxBase","objects","dispose","sfxBaseWrapper","elem","removeElem","x","originalDispose","filter","call","sfxPrune","forEach","getOriginal","prune","constant","options","Constant","oscillator","Oscillator","soundfont","SoundfontInstrument","sound","path","request","XMLHttpRequest","open","responseType","audioBuffer","onerror","err","onload","decodeAudioData","response","buffer","send","bufferSource","createBufferSource","connect","_destination","start","currentTime","disconnect","formulaGenerator","FormulaGenerator","signal_and","value","gain","signal_nand","signal_not","signal_or","signal_nor","negateModl","modl","apply","audioParam","music","modulatorFactory","andNode","update","signal_scale","top","base","c1","gainUpdate","gainDispose","constantUpdate","constantDispose","a","b","T","arguments","noise","Noise","pink_noise","PinkNoise","red_noise","RedNoise","Object","create","args","api","context","gainNode","createGain","recv","Targuments","synth","output","disconnected","removeAll","cancel","unlisten","next","effectName","audioContext","AudioContext","webkitAudioContext","Context","nooutput","destination","resume","state","record","callback","recorder","WebAudioRecorder","workerDir","encoding","numChannels","onComplete","blob","startRecording","finishRecording","nextProvider","Formula","input","t","b0","b1","b2","b3","b4","b5","b6","noiseGenerator","white","Math","random","setValue","lastOut","bufferSize","sampleRate","noiseBuffer","createBuffer","getChannelData","whiteNoise","loop","Wave","period","sampleCount","floor","dataArray","recording","getBuffer","data","originalDataArray","value1","AudioDestinationWrapper","modulator","_f","combineFunc","audioParamModulation","len","constantArrayBuffer","Float32Array","buffer1","constantNode","createConstantSource","offset","set","noop","setParam","paramName","setParamTarget","target","timeConstant","cancelScheduledValues","setTargetAtTime","freq","newFreq","setFreq","reset","effects","detune","frequency","time_constant","isFinite","isNaN","osc","createOscillator","appliedAudioParam","type","real","terms","sin","imag","cos","periodicWave","createPeriodicWave","setPeriodicWave","schedule_freq","tc","fixed_frequency","noteOptions","setFreqOnTime","nextNode","disposeNode","wtPosition","ta","optionsFrequency","at","deltatime","lastTime","tb","wave","newOptions","Loop","times","lastPlay","startTime","performance","now","currentIteration","nextIteration","clearInterval","inter","setInterval","Silence","time","effectsObject","cb","sfx","WebAudioNodeWrapper","audioNode","onDispose","rec","Recorder","workerPath","scriptNode","createScriptProcessor","iteration","onaudioprocess","audioProcessingEvent","inputBuffer","outputBuffer","channel","numberOfChannels","inputData","outputData","sample","isFormula","BiQuad","biquadFilter","createBiquadFilter","gainModulation","nodispose","qModulation","frequencyModulation","detuneModulation","biquadType","assignParam","orig","Q","filterName","canMutate","updateFcn","volumeModulation","delayNode","createDelay","delayModulation","delayTime","Echo","att","gainNode2","WaveShaper","samples","makeDistortionCurve","array","waveShaperNode","createWaveShaper","curve","oversample","Curve","concat","time1","c2","time2","n","setValueCurveAtTime","Ramp","initValue","endValue","Periodic","attackTime","decayTime","sustainLevel","releaseTime","undefined","nextNodeFcn","node","attackCurve","decayCurve","startCurve","currentLevel","releaseCurve","stopCurve","notenum","pow","noteToNumMap","instrumentExtend","delayedPlaying","originalPlaying","ms","delayedNote","originalNote","note","noteNum","perNoteWrap","mapNote","eventPreprocessor","evt","schedule_note","noteToNoteNum","noteName","charAt","parseInt","PolyphonyInstrument","innerFactory","maxChannels","instrumentArray","onUse","queue","freeIdx","c","playingIdx","instrument","shift","event","events","MonoNoteInstrument","inner","noteInst","playingInst","count","setValueOnTime","Instrument","soundFactory","fr","soundInstance","MultiInstrument","Array","isArray","notePlay","noteStop","MultiNote","noteArray","notes","map","every","processedEvents","s","l","k","NOTES","noteNumToNoteName","octaveNum","PatchInstrument","sounds","noteAudio","_base64ToArrayBuffer","base64","binary_string","atob","bytes","Uint8Array","ascii","charCodeAt","index","xmlhttp","encoded","split","source","soundGenerator","nullPlay","plainObject","constructor","StopEvent","paramObject","onplay","onstop","LemonadePlayable","outputFcn","ops","_music","_ops","_output","opsLength","signalArray","phaseArray","lastT","deltay","phase","bpmToSecondTick","bpm","ticks_per_beat","makeEvaluableInverseFunctionFromParts","part","makeEvaluableFunction","inverse_f","makeEvaluableInverseFunction","init","end","y","find","p","makeEvaluableFunctionFromParts","sqrt","integrate","lastPointValue","integrateBpmEvents","cutBpmEvent","bpmEvent1","bpm_events","bpmEvent2","cutL","max","firstEventStart","parts","bpm_event","next_bpm_event","init_second_tick","end_second_tick","integratedParts","integral","ticksToTime","ticks","scale","timeToTicks","inverseScale","NoteSequence","funseq","clock","songCtx","Utils","Clock","FunctionSeq","clearTimeout","referenceInstrument","sequenceStartTime","externalSchedule","_time","_funseq","_totalduration","_noteid","_contextList","Playable","noteseq","contextList","_noteseq","_instrument","_duration","_runningFunSeq","Playing","runningFunSeq","ctx","_context","paddingTo","padding","pushCallback","baseCtx","mynoteid","indexOf","setPlaying","warn","unsetPlaying","makePlayable","subctx","playingNotes","noteid","playingStop","MultiPlayable","playableArray","_playableArray","playablePlay","playingArray","higher","getDuration","reduce","ChangeTimeWrapper","extensionTime","_extensionTime","Pattern","pulseTime","seq","code","SequenceParser","parse","isNoteStart","chr","noteSplit","str","lastNote","pipeReplace","RegExp","noteSeq","currentNote","currentCharacter","replace","currentNoteStr","noteDuration","equalIndex","slice","lastChar","octave","PlayingSong","patternContexts","_patternContexts","_funseqHandler","noPlay","defaultFromPatterns","patterns","patternOrName","hasScheduleMethod","pattern","schedule","hasNotScheduleMethod","Song","patternsOrOptions","self","getFromPatterns","measure","totalMeasures","byStart","j","patternArray","displacedBpmEvents","sort","timeFunc","baseTicks","schedulable","notSchedulable","multiPlayable","scheduleContexts","Scale","toneAdd","v","preciseTimer","interval","hndl","eventsArray","reject","parameter","e1","e2","dt","timeoutHandlers","eventCount","clockHandler","lastEvent","callingCriteria","element","pending","processPending","currentPending","timeoutHandler","addSchedule","nextElement","preciseTimeout","DelayedFunctionSeq","params","FunctionWave","twopi","PI","waveTransform","waveOps","reverse","factor","translate","disp","table","Table","combine","otherWave","otherFactor","thisWave","thisFactor","defaultInterpolation","interpolation","sine","square","dutyCycle","dutyLevel","offLevel","triangle","t2","sawtooth","Formats","CachedSerializer","innerSerializer","lastOutput","lastInput","lastType","serialize","jsonCurrentInput","JSON","stringify","deserialize","HuffmanSerializerWrapper","frequencies","text","huffman","Huffman","treeFromText","encode","decoded","decode","JSONSerializer","MultiSerializer","serializerArray","match","keys","key","wrapSerializer","serializer","recoveredInput","smallest","truthy","selector","Error","serialized","setSerializers","entry","PackedJSONSerializer","objToArrayPacker","pack","unpack","innerPacker","flatten","size","deflatted","patternPacker","patternIndexPacker","convertBlocks","block","id","convertTrack","track","blocks","newObject","tracks","substitution","idx","switchPacker","selectAttribute","packers","parent","booleanPacker","nullable","songPacker","recursiveInstrumentPacker","instrumentPacker","stackPacker","envelopePacker","oscillatorPacker","frequencyFilterPacker","noParametersPacker","multiInstrumentPacker","typeNames","monophonerPacker","polyphonerPacker","script","notesplit","rise","adsr","envelope","transpose","echo","lowpass","highpass","bandpass","lowshelf","highshelf","peaking","notch","allpass","reverb","arpeggiator","stack","multi_instrument","monophoner","polyphoner","packer","song","PackedJSONSerializerB","patternEventPacker","firstElement","notePaddingPacker","toModl","values","note_padding","note_condition","signal_monitor","signal_constant","note_delay","sample_rate_reduction","bit_crushing","note_frequency_generator","note_time_shift","wave_shaper"],"mappings":"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","file":"music.js","sourcesContent":["(function(){\r\n\r\nvar TypeConversor = function(typeName) {\r\n  var conversorArray = [];\r\n\r\n  this.add = function(conversor){\r\n    conversorArray.push(conversor);\r\n  };\r\n\r\n  this.cast = function(obj) {\r\n    for (var i=0; i<conversorArray.length;i++) {\r\n      var conversor = conversorArray[i];\r\n      var converted = conversor(obj);\r\n\r\n      if (converted) return converted;\r\n    }\r\n\r\n    throw \"Can't convert \" + obj + \" to \" + typeName;\r\n  };\r\n};\r\n\r\nvar TypeCast = function(){\r\n  var typeConversors = {};\r\n\r\n  this.register = function(typeName, conversor){\r\n    var typeConversor;\r\n    if (!typeConversors[typeName]) {\r\n      typeConversors[typeName] = new TypeConversor(typeName);\r\n    }\r\n\r\n    typeConversor = typeConversors[typeName];\r\n    typeConversor.add(conversor);\r\n  };\r\n\r\n  this.cast = function(typeName, obj) {\r\n    var typeConversor = typeConversors[typeName];\r\n    if (!typeConversor) throw \"unkown type \" + typeName;\r\n\r\n    return typeConversor.cast(obj);\r\n  };\r\n};\r\n\r\nwindow.MUSIC = window.MUSIC || {};\r\nwindow.MUSIC.Types = new TypeCast();\r\n\r\n})();","window.MUSIC = window.MUSIC || {};\r\n\r\n(function() {\r\nMUSIC.SoundLib = MUSIC.SoundLib || {};\r\nMUSIC.Effects = MUSIC.Effects || {};\r\n\r\nMUSIC.playablePipeExtend = function(obj) {\r\n  obj.during = function(duration) {\r\n    var original = this;\r\n    return MUSIC.playablePipeExtend({\r\n      play: function() {\r\n        var stopped = false;\r\n        var playable = original.play();\r\n        var wrapper = {\r\n          stop: function() {\r\n            if (!stopped) playable.stop();\r\n            stopped = true;\r\n          }\r\n        };\r\n        setTimeout(wrapper.stop, duration);\r\n        return wrapper;\r\n      },\r\n\r\n      duration: function() { return duration; }\r\n    });\r\n  };\r\n\r\n  obj.stopDelay = function(delay) {\r\n    var original = this;\r\n    return MUSIC.playablePipeExtend(\r\n      {\r\n        play: function(param) {\r\n          var playing = original.play(param);\r\n          return {\r\n            stop: function() {\r\n              setTimeout(playing.stop.bind(playing), delay);\r\n            }\r\n          };\r\n        }\r\n      }\r\n    );\r\n  };\r\n\r\n  obj.onError = function(fcn) {\r\n    var original = this;\r\n    return MUSIC.playablePipeExtend(\r\n      {\r\n        play: function(param) {\r\n          try {\r\n            var playing = original.play(param);\r\n            return {\r\n              stop: function() {\r\n                try {\r\n                  playing.stop();\r\n                } catch(e) {\r\n                  console.error(e);\r\n                  fcn(e);\r\n                }\r\n              }\r\n            };\r\n          } catch(e) {\r\n            console.error(e);\r\n            fcn(e);\r\n            throw e;\r\n          }\r\n        }\r\n      }\r\n    );\r\n  };\r\n\r\n  obj.onStop = function(fcn) {\r\n    var original = this;\r\n    return MUSIC.playablePipeExtend(\r\n      {\r\n        play: function(param) {\r\n          var playing = original.play(param);\r\n          return {\r\n            stop: function() {\r\n              playing.stop();\r\n              fcn(param);\r\n            }\r\n          };\r\n        }\r\n      }\r\n    );\r\n  };\r\n\r\n  return obj;\r\n};\r\n\r\nMUSIC.Types.register(\"playable\", function(playable) {\r\n  if (playable.play) {\r\n    return playable;\r\n  }\r\n});\r\n\r\nMUSIC.Types.register(\"playable\", function(fcn) {\r\n  if (typeof fcn === \"function\") {\r\n    return {\r\n      play: fcn\r\n    };\r\n  }\r\n});\r\n\r\nMUSIC.EffectsPipeline = function(audio, audioDestination) {\r\n  this._audio = audio;\r\n  this._audioDestination = audioDestination;\r\n};\r\n\r\nvar defaultWrapFcn = function(obj){\r\n  return obj;\r\n};\r\nvar compose = function(f,g) {\r\n  return function(obj) {\r\n    return g(f(obj));\r\n  };\r\n};\r\n\r\nMUSIC.EffectsPipeline.prototype = {\r\n\r\n  _wrapFcn: defaultWrapFcn,\r\n\r\n  wrap: function(f) {\r\n    var ret = new MUSIC.DummyNode(this)\r\n    if (this._wrapFcn !== defaultWrapFcn) {\r\n      f = compose(f, this._wrapFcn);\r\n    }\r\n    ret._wrapFcn = function(obj) {\r\n      var ret2 = f(obj);\r\n      ret2._wrapFcn = ret._wrapFcn;\r\n      return ret2;\r\n    };\r\n    return ret;\r\n  },\r\n\r\n  sfxBase: function() {\r\n    var objects = [];\r\n    var dispose = function(obj) {\r\n      obj.dispose();\r\n    };\r\n\r\n    var sfxBaseWrapper = function(elem) {\r\n      if (!elem.dispose) return elem;\r\n      \r\n      var removeElem = function(x) {\r\n        return x != elem;\r\n      };\r\n      var originalDispose = elem.dispose;\r\n      objects.push(elem);\r\n      elem.dispose = function() {\r\n        objects = objects.filter(removeElem);\r\n        originalDispose.call(elem);\r\n      };\r\n\r\n      return elem;\r\n    };\r\n\r\n    var sfxPrune = function() {\r\n      objects.forEach(dispose);\r\n    };\r\n\r\n    var ret = this.wrap(sfxBaseWrapper);\r\n    var original = this;\r\n    ret.getOriginal = function() {\r\n      if (original.getOriginal) return original.getOriginal();\r\n      return original;\r\n    };\r\n\r\n    ret.prune = sfxPrune;\r\n    return ret;\r\n  },\r\n\r\n  constant: function(options) {\r\n    return this._wrapFcn(new MUSIC.SoundLib.Constant(this._audio, this._audioDestination, options));\r\n  },\r\n\r\n  oscillator: function(options) {\r\n    return this._wrapFcn(new MUSIC.SoundLib.Oscillator(this._audio, this._audioDestination, options));\r\n  },\r\n\r\n  soundfont: function(param) {\r\n    return this._wrapFcn(new MUSIC.SoundfontInstrument(param, this._audio, this._audioDestination));\r\n  },\r\n\r\n  sound: function(path) {\r\n    var audio = this._audio;\r\n    var audioDestination = this._audioDestination;\r\n\r\n    var request = new XMLHttpRequest();\r\n    request.open(\"GET\", path, true);\r\n    request.responseType = \"arraybuffer\";\r\n    var audioBuffer;\r\n\r\n    request.onerror = function(err) {\r\n      console.error(err);\r\n    };\r\n\r\n    request.onload = function(e) {\r\n      audio.audio.decodeAudioData(request.response, function (buffer) {\r\n        audioBuffer = buffer;\r\n      });\r\n    };\r\n\r\n    request.send();\r\n    return MUSIC.playablePipeExtend({\r\n      play: function() {\r\n        var bufferSource = audio.audio.createBufferSource();\r\n        bufferSource.buffer = audioBuffer;\r\n        bufferSource.connect(audioDestination._destination);\r\n        bufferSource.start(audio.audio.currentTime);\r\n\r\n        return {\r\n          stop: function() {\r\n            bufferSource.stop();\r\n            bufferSource.disconnect(audioDestination._destination);\r\n          }\r\n        };\r\n      }\r\n    });\r\n  },\r\n  \r\n  formulaGenerator: function(fcn) {\r\n    return this._wrapFcn(new MUSIC.SoundLib.FormulaGenerator(this._audio, this._audioDestination, fcn));\r\n  },\r\n\r\n  signal_and: function(value) {\r\n    return this.gain(value||1);\r\n  },\r\n\r\n  signal_nand: function(value) {\r\n    return this.signal_not().signal_and(value||1);\r\n  },\r\n\r\n  signal_or: function(value) {\r\n    return this.signal_not().signal_nor(value||0);\r\n  },\r\n\r\n  signal_nor: function(value) {\r\n    var negateModl = function(modl) {\r\n      if (!modl.apply) return modl;\r\n\r\n      return {\r\n        apply: function(currentTime, audioParam, music) {\r\n          return modl.apply(currentTime, audioParam, music, function(modulatorFactory, f) {\r\n            return f(modulatorFactory.signal_not());\r\n          });\r\n        }\r\n      };\r\n    };\r\n\r\n    var andNode = this.signal_and(1);\r\n    var update = function(value) {\r\n      andNode.update(negateModl(value));\r\n    };\r\n    update(value);\r\n\r\n    var ret = andNode.signal_not();\r\n    ret.update = update;\r\n    return ret;\r\n  },\r\n\r\n  signal_not: function() {\r\n    return this.signal_scale({top: 0, base: 2});\r\n  },\r\n\r\n  signal_scale: function(options) {\r\n    var gain = this.gain(1.0);\r\n    var c1 = this.constant(0.0);\r\n\r\n    var gainUpdate = gain.update.bind(gain);\r\n    var gainDispose = gain.dispose.bind(gain);\r\n    var constantUpdate = c1.update.bind(c1);\r\n    var constantDispose = c1.dispose.bind(c1);\r\n\r\n    var dispose = function() {\r\n      gainDispose();\r\n      constantDispose();\r\n    };\r\n\r\n    var update = function(options) {\r\n      var a, b;\r\n      a = (options.top - options.base)/2;\r\n      b = options.base + a;\r\n\r\n      gainUpdate(a);\r\n      constantUpdate(b);\r\n    };\r\n\r\n    update(options);\r\n    gain.update = update;\r\n    gain.dispose = dispose;\r\n\r\n    return gain;\r\n  },\r\n\r\n\r\n  T: function() {\r\n    return this._wrapFcn(new MUSIC.T(arguments, this._audio, this._audioDestination));\r\n  },\r\n\r\n  noise: function() {\r\n    return this._wrapFcn(new MUSIC.SoundLib.Noise(this._audio, this._audioDestination));\r\n  },\r\n\r\n  pink_noise: function() {\r\n    return this._wrapFcn(new MUSIC.SoundLib.PinkNoise(this._audio, this._audioDestination));\r\n  },\r\n\r\n  red_noise: function() {\r\n    return this._wrapFcn(new MUSIC.SoundLib.RedNoise(this._audio, this._audioDestination));\r\n  }\r\n};\r\n\r\nMUSIC.DummyNode = function(music) {\r\n  MUSIC.EffectsPipeline.apply(this, [music._audio, music._audioDestination]);\r\n};\r\nMUSIC.DummyNode.prototype = Object.create(MUSIC.EffectsPipeline.prototype);\r\n\r\nMUSIC.T = function(args, music, audioDestination) {\r\n  var api = T(\"WebAudioAPI:recv\", music.audio /* audioContext */);\r\n  var context = api.context;\r\n  var gainNode = context.createGain(1.0);\r\n\r\n  api.recv(gainNode);\r\n  setTimeout(function() { // this hack prevents a bug in current version of chrome\r\n    gainNode.connect(audioDestination._destination);\r\n  });\r\n\r\n  var Targuments = [];\r\n  for (var i=0; i<args.length; i++) {\r\n    Targuments.push(args[i]);\r\n  };\r\n\r\n  Targuments.push(api);\r\n  var synth = T.apply(null, Targuments);// (\"reverb\", {room:0.95, damp:0.1, mix:0.75}, api);\r\n  var send = T(\"WebAudioAPI:send\", synth, music.audio /* audioContext */).send(audioDestination._destination);\r\n\r\n  this.output = function() {\r\n    return gainNode;\r\n  }; \r\n\r\n  var disconnected = false;\r\n  this.disconnect = function() {\r\n    if (disconnected) return;\r\n    disconnected = true;\r\n\r\n    gainNode.disconnect(audioDestination._destination);\r\n    send.removeAll();\r\n    api.cancel();\r\n    send.cancel();\r\n    synth.unlisten();\r\n  };\r\n\r\n  this.dispose = this.disconnect;\r\n\r\n  this._destination = gainNode;\r\n  this.next = function() {\r\n    return audioDestination;\r\n  };\r\n\r\n  MUSIC.EffectsPipeline.bind(this)(music, this);\r\n};\r\nMUSIC.T.prototype = Object.create(MUSIC.EffectsPipeline.prototype);\r\n\r\nMUSIC.Effects.register = function(effectName, fcn) {\r\n  MUSIC.EffectsPipeline.prototype[effectName] = function(value) {\r\n    return this._wrapFcn(fcn(this._audio, this._audioDestination, value));\r\n  };\r\n};\r\n\r\nvar audioContext = new (window.AudioContext || window.webkitAudioContext)();\r\n\r\nMUSIC.Context = function(options) {\r\n  var audio = audioContext;\r\n  var music = this;\r\n  var gainNode = audio.createGain();\r\n\r\n  options = options || {};\r\n  gainNode.gain.value = 1.0; \r\n  if (!options.nooutput) gainNode.connect(audio.destination);\r\n\r\n  music.audio = audio;\r\n  music._destination = gainNode;\r\n\r\n  this.resume = function() {\r\n    if (audioContext.state !== 'running') {\r\n      audioContext.resume();\r\n    }\r\n  };\r\n\r\n  this.record = function(options, callback) {\r\n    var recorder = new WebAudioRecorder(gainNode, {\r\n      workerDir: \"src/lib/recorder/worker/\",\r\n      encoding: options.encoding,\r\n      numChannels: options.numChannels\r\n    });\r\n    recorder.onComplete = function(recorder, blob) {\r\n      callback(blob);\r\n    };\r\n\r\n    recorder.startRecording();\r\n    //recorder.record();\r\n    return {\r\n      stop: function() {\r\n        recorder.finishRecording();\r\n      }\r\n    };\r\n  };\r\n\r\n  this.audio = audio;\r\n\r\n  MUSIC.EffectsPipeline.bind(this)(music, this);\r\n};\r\n\r\nMUSIC.Context.prototype = new MUSIC.EffectsPipeline();\r\n\r\nMUSIC.SoundLib.FormulaGenerator = function(audio, nextProvider, fcn) {\r\n  this.play = function(param) {\r\n    var audioDestination;\r\n    var formulaGenerator = new MUSIC.Effects.Formula(audio, nextProvider, function(input, t) {\r\n      return fcn(t);\r\n    });\r\n\r\n    return {\r\n      stop: function() {\r\n        formulaGenerator.disconnect(nextProvider._destination);\r\n      }\r\n    }\r\n  };\r\n\r\n  MUSIC.playablePipeExtend(this);\r\n};\r\n\r\nMUSIC.SoundLib.PinkNoise = function(audio, nextProvider) {\r\n  this.play = function(param) {\r\n    var audioDestination;\r\n    var b0, b1, b2, b3, b4, b5, b6;\r\n    b0 = b1 = b2 = b3 = b4 = b5 = b6 = 0.0;\r\n\r\n    var noiseGenerator = new MUSIC.Effects.Formula(audio, nextProvider, function() {\r\n      var white = Math.random() * 2 - 1;\r\n      b0 = 0.99886 * b0 + white * 0.0555179;\r\n      b1 = 0.99332 * b1 + white * 0.0750759;\r\n      b2 = 0.96900 * b2 + white * 0.1538520;\r\n      b3 = 0.86650 * b3 + white * 0.3104856;\r\n      b4 = 0.55000 * b4 + white * 0.5329522;\r\n      b5 = -0.7616 * b5 - white * 0.0168980;\r\n      var ret = b0 + b1 + b2 + b3 + b4 + b5 + b6 + white * 0.5362;\r\n      b6 = white * 0.115926;\r\n      return ret * 0.11;\r\n    });\r\n\r\n    return {\r\n      stop: function() {\r\n        noiseGenerator.disconnect(nextProvider._destination);\r\n      }\r\n    }\r\n  };\r\n\r\n  this.setValue = function() {\r\n  };\r\n\r\n  MUSIC.playablePipeExtend(this);\r\n};\r\n\r\nMUSIC.SoundLib.RedNoise = function(audio, nextProvider) {\r\n  this.play = function(param) {\r\n    var audioDestination;\r\n    var lastOut = 0.0;\r\n\r\n    var noiseGenerator = new MUSIC.Effects.Formula(audio, nextProvider, function() {\r\n      var white = Math.random() * 2 - 1;\r\n      var ret = (lastOut + (0.02 * white)) / 1.02;\r\n      lastOut = ret;\r\n      return ret * 3.5;\r\n    });\r\n\r\n    return {\r\n      stop: function() {\r\n        noiseGenerator.disconnect(nextProvider._destination);\r\n      }\r\n    }\r\n  };\r\n\r\n  this.setValue = function() {\r\n  };\r\n\r\n  MUSIC.playablePipeExtend(this);\r\n};\r\n\r\nMUSIC.SoundLib.Noise = function(audio, nextProvider) {\r\n  var audioContext = audio.audio;\r\n\r\n  var bufferSize = 2 * audioContext.sampleRate,\r\n      noiseBuffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate),\r\n      output = noiseBuffer.getChannelData(0);\r\n  for (var i = 0; i < bufferSize; i++) {\r\n      output[i] = Math.random() * 2 - 1;\r\n  }\r\n\r\n  this.play = function(param) {\r\n    var whiteNoise = audioContext.createBufferSource();\r\n    whiteNoise.buffer = noiseBuffer;\r\n    whiteNoise.loop = true;\r\n    whiteNoise.start(0);\r\n\r\n    whiteNoise.connect(nextProvider._destination);\r\n\r\n    return {\r\n      stop: function() {\r\n        whiteNoise.stop();\r\n        whiteNoise.disconnect(nextProvider._destination);\r\n      }\r\n    }\r\n  };\r\n\r\n  this.setValue = function() {\r\n  };\r\n\r\n  MUSIC.playablePipeExtend(this);\r\n};\r\n\r\nMUSIC.SoundLib.Wave = function(path, period) {\r\n\r\n  var music = new MUSIC.Context({nooutput: true});\r\n  var sound = music.sound(path);\r\n  var sampleCount = Math.floor(period * music.audio.sampleRate / 1000);\r\n  var dataArray = [];\r\n\r\n  // fix race condition using callbacks\r\n  setTimeout(function() {\r\n    var recording = music.record();\r\n    sound.play();\r\n\r\n    setTimeout(function(){\r\n      recording.stop();\r\n      recording.getBuffer(function(data) {\r\n        var originalDataArray = data[0];\r\n        for (var i=0; i<sampleCount; i++) {\r\n          dataArray.push(originalDataArray[i]);\r\n        }\r\n      });\r\n    }, period+100);\r\n  }, 500);\r\n\r\n  this.f = function(t) {\r\n    if (t<0)return 0;\r\n    var value1 = dataArray[Math.floor(t*sampleCount)];\r\n    return value1;\r\n  };  \r\n};\r\n\r\nMUSIC.AudioDestinationWrapper = function(music, audioDestination) {\r\n    this._destination = audioDestination;\r\n    MUSIC.EffectsPipeline.bind(this)(music, this)\r\n};\r\nMUSIC.AudioDestinationWrapper.prototype = Object.create(MUSIC.EffectsPipeline.prototype);\r\n\r\nMUSIC.modulator = function(f) {\r\n  var _f = function(modulatorFactory, f) {\r\n    return f(modulatorFactory);\r\n  };\r\n\r\n  return {\r\n    apply: function(currentTime, audioParam, music, combineFunc) {\r\n      var modulatorFactory, modulator;\r\n      modulatorFactory = (new MUSIC.AudioDestinationWrapper(music, audioParam)).sfxBase();\r\n      modulatorFactory.audioParamModulation = audioParam;\r\n      modulator = (combineFunc||_f)(modulatorFactory, f);\r\n\r\n      return {\r\n        dispose: function() {\r\n          modulatorFactory.prune();\r\n        }\r\n      };\r\n    }\r\n  };\r\n};\r\n\r\n(function() {\r\n\r\nvar len = 128;\r\nvar constantArrayBuffer = new Float32Array(len);\r\nfor (var i=0; i<len; i++) {\r\n  constantArrayBuffer[i]=1;\r\n};\r\nvar buffer1;\r\n\r\nMUSIC.SoundLib.Constant = function(music, destination, options) {\r\n\r\n  var constantNode;\r\n  var bufferSource;\r\n  var buffer;\r\n  var audioContext = music._audio.audio;\r\n\r\n  if (audioContext.createConstantSource) {\r\n    constantNode = audioContext.createConstantSource();\r\n    this._destination = constantNode;\r\n\r\n    constantNode.offset.value = options.offset || 0.0;\r\n    constantNode.connect(destination._destination);\r\n    constantNode.start();\r\n  } else {\r\n    constantNode = audioContext.createGain();\r\n    bufferSource = audioContext.createBufferSource();\r\n\r\n    constantNode.gain.value = options.offset || 0.0;\r\n    \r\n    if (!buffer1) {\r\n      buffer1 = audioContext.createBuffer(1, constantArrayBuffer.length, music._audio.audio.sampleRate);\r\n      buffer1.getChannelData(0).set(constantArrayBuffer);\r\n    }\r\n\r\n    bufferSource.loop = true;\r\n    bufferSource.buffer = buffer1;\r\n    bufferSource.connect(constantNode);\r\n\r\n    constantNode.connect(destination._destination);\r\n\r\n    bufferSource.start();\r\n  }\r\n\r\n  var noop = function() {};\r\n\r\n  this.setParam = function(paramName, value) {\r\n    if (paramName === 'offset' && !audioContext.createConstantSource) paramName = 'gain';\r\n    value.apply(music.audio.currentTime, constantNode[paramName]);\r\n  };\r\n\r\n  this.setParamTarget = function(paramName, target, timeConstant) {\r\n    if (paramName === 'offset' && !audioContext.createConstantSource) paramName = 'gain';\r\n    var audioParam = constantNode[paramName];\r\n    audioParam.cancelScheduledValues(0.0);\r\n    audioParam.setTargetAtTime(target, music.audio.currentTime, timeConstant);\r\n  };\r\n\r\n  this.dispose = function() {\r\n    if (audioContext.createConstantSource) {\r\n      constantNode.stop();\r\n    } else {\r\n      bufferSource.stop();\r\n      bufferSource.disconnect(constantNode);\r\n    }\r\n    constantNode.disconnect(destination._destination);\r\n\r\n    this.dispose = function() {};\r\n  };\r\n\r\n  this.update = function(value) {\r\n    if (audioContext.createConstantSource) {\r\n      constantNode.offset.value = value;\r\n    } else {\r\n      constantNode.gain.value = value;\r\n    }\r\n  };\r\n\r\n  this.freq = function(newFreq) {\r\n    var playable = {};\r\n\r\n    playable.setFreq = noop;\r\n    playable.reset = noop;\r\n    playable.play = function() {\r\n      return {stop: noop}\r\n    };\r\n\r\n    MUSIC.playablePipeExtend(playable);\r\n    return playable;\r\n  };\r\n};\r\n\r\n})();\r\n\r\nMUSIC.SoundLib.Oscillator = function(music, destination, options) {\r\n  options = options || {};\r\n  var effects = options.effects;\r\n  var detune = options.detune;\r\n  var frequency = options.frequency;\r\n  var time_constant = options.time_constant;\r\n  var audioDestination;\r\n\r\n  audioDestination = destination._destination;\r\n\r\n  if (!isFinite(time_constant) || isNaN(time_constant) || time_constant <= 0) time_constant = 0.01;\r\n\r\n  var osc;\r\n\r\n  osc = music.audio.createOscillator();\r\n  osc.connect(audioDestination);\r\n\r\n  var appliedAudioParam;\r\n\r\n  if (frequency) {\r\n    osc.frequency.value = frequency;\r\n  }    \r\n\r\n  if (detune) {\r\n    if (detune.apply) {\r\n      appliedAudioParam = detune.apply(music.audio.currentTime, osc.detune, music);\r\n    } else {\r\n      osc.detune.value = detune;\r\n    }\r\n  }\r\n\r\n  if (options.type === \"custom\") {\r\n    var real = new Float32Array(options.terms.sin || []);\r\n    var imag = new Float32Array(options.terms.cos || []);\r\n\r\n    var periodicWave = music.audio.createPeriodicWave(real, imag);\r\n    osc.setPeriodicWave(periodicWave);\r\n  } else {\r\n    osc.type = options.type;    \r\n  }\r\n\r\n  this.currentTime = function() {\r\n    return music.audio.currentTime;\r\n  };\r\n\r\n  this.schedule_freq = function(newFreq, start) {\r\n    var tc;\r\n    tc = time_constant||0.1;\r\n\r\n    var stop = function() {};\r\n    var play = function() {\r\n      osc.frequency.setTargetAtTime(newFreq, start, tc);\r\n      return {\r\n        stop: stop\r\n      };\r\n    };\r\n\r\n    return {\r\n      play: play\r\n    };\r\n  };\r\n\r\n  this.freq = function(newFreq) {\r\n    var frequency = options.fixed_frequency ? options.fixed_frequency : newFreq\r\n\r\n    if (frequency) {\r\n      osc.frequency.value = frequency;\r\n    }    \r\n\r\n    var playable = {};\r\n\r\n    playable.setFreq = function(frequency, noteOptions) {\r\n      playable.setFreqOnTime(frequency, noteOptions, music.audio.currentTime);\r\n    };\r\n\r\n    playable.cancelScheduledValues = function() {\r\n      osc.frequency.cancelScheduledValues(0.0);\r\n    };\r\n\r\n    playable.setFreqOnTime = function(frequency, noteOptions, start) {\r\n      if (options.fixed_frequency) return;\r\n\r\n      var tc;\r\n\r\n      if (noteOptions && noteOptions.tc) {\r\n        tc = noteOptions.tc;\r\n      } else {\r\n        tc = time_constant||0.1;\r\n      }\r\n\r\n      osc.frequency.setTargetAtTime(frequency, start, tc);\r\n    };\r\n\r\n    playable.reset = function() {\r\n    };\r\n\r\n    playable.play = function(param) {\r\n      var nextNode;\r\n      var disposeNode;\r\n\r\n      disposeNode = function() {\r\n        if (osc) osc.disconnect(audioDestination);\r\n        osc = null;\r\n      };\r\n\r\n      osc.start(0);\r\n\r\n      return {\r\n        stop : function() {\r\n          if (appliedAudioParam && appliedAudioParam.dispose) {\r\n            appliedAudioParam.dispose();\r\n          }\r\n\r\n          if (osc) osc.stop(0);\r\n          disposeNode();\r\n        }\r\n      };\r\n    };\r\n\r\n    MUSIC.playablePipeExtend(playable);\r\n    return playable;\r\n  };\r\n\r\n  if (options.f) {\r\n    this.play = function(param) {\r\n      var wtPosition = options.wtPosition || 0;\r\n      var fcn = options.f;\r\n      var ta = 0;\r\n      var frequency;\r\n      var optionsFrequency = options.frequency;\r\n\r\n      if (optionsFrequency.at) {\r\n        frequency = optionsFrequency.at.bind(optionsFrequency);\r\n      } else {\r\n        frequency = function(t){ return optionsFrequency };\r\n      }\r\n      var deltatime = 0;\r\n      var lastTime = 0;\r\n      var tb;\r\n\r\n      if (wtPosition.at) {\r\n        var formulaGenerator = new MUSIC.Effects.Formula(music, destination, function(input, t) {\r\n          deltatime = t - lastTime;\r\n          ta += deltatime * frequency(t);\r\n          ta = ta % 1;\r\n\r\n          tb = ta + wtPosition.at(t);\r\n          tb = tb % 1;\r\n\r\n          if (tb < 0) tb++;\r\n          lastTime = t;\r\n          return fcn(tb);\r\n        });\r\n      } else {\r\n        var formulaGenerator = new MUSIC.Effects.Formula(music, destination, function(input, t) {\r\n          deltatime = t - lastTime;\r\n          ta += deltatime * frequency(t);\r\n          ta = ta % 1;\r\n\r\n          tb = ta + wtPosition;\r\n          tb = tb % 1;\r\n\r\n          if (tb < 0) tb++;\r\n          lastTime = t;\r\n          return fcn(tb);\r\n        });\r\n      }\r\n\r\n      return {\r\n        stop: function() {\r\n          formulaGenerator.disconnect(destination._destination);\r\n        }\r\n      }\r\n    };    \r\n  } else if (options.wave) {\r\n    var newOptions = Object.create(options);\r\n    newOptions.f = options.wave.f;\r\n    MUSIC.SoundLib.Oscillator.bind(this)(music, destination, newOptions);\r\n  } else {\r\n\r\n  }\r\n\r\n};\r\n\r\nMUSIC.Loop = function(playable, times) {\r\n  var original = playable;\r\n  var duration = playable.duration();\r\n  return {\r\n    play: function() {\r\n      var lastPlay;\r\n      var startTime = window.performance.now();\r\n      var lastTime = startTime;\r\n      var currentIteration = 0;\r\n\r\n      lastPlay = playable.play();\r\n\r\n      var nextIteration = function() {\r\n        var now = window.performance.now();\r\n        if (now - startTime > currentIteration * duration) { // ms\r\n          setTimeout(function(){\r\n              lastPlay = playable.play();\r\n          }, (currentIteration+1) * duration - now)\r\n          currentIteration++;\r\n          if (currentIteration == times-1) {\r\n            clearInterval(inter);\r\n          }\r\n        }\r\n      };\r\n\r\n      var inter = setInterval(nextIteration, duration);\r\n      return {\r\n        stop: function() {\r\n          clearInterval(inter)\r\n          if (lastPlay) lastPlay.stop();\r\n        }\r\n      };\r\n    }\r\n  };\r\n};\r\n\r\nMUSIC.Silence = function(time) {\r\n  return {\r\n    play : function() {\r\n      return {\r\n        stop: function(){\r\n\r\n        }\r\n      }\r\n    },\r\n\r\n    duration: function(){return time}\r\n  };\r\n};\r\n\r\n})();","MUSIC.Effects = MUSIC.Effects || {};\r\n\r\nvar effectsObject = {};\r\nMUSIC.Effects.forEach = function(cb) {\r\n  for (var sfx in effectsObject) {\r\n    cb(sfx, effectsObject[sfx]);\r\n  }\r\n};\r\n\r\nMUSIC.Effects.WebAudioNodeWrapper = function (music, audioNode, next, onDispose) {\r\n\r\n  this._destination = audioNode;\r\n  setTimeout(function() { // this hack prevents a bug in current version of chrome\r\n    audioNode.connect(next._destination);\r\n  });\r\n\r\n  this.next = function() {\r\n    return next;\r\n  };\r\n\r\n  var disconnected = false;\r\n  this.disconnect = function() {\r\n    if (disconnected) return;\r\n    if (onDispose) onDispose();\r\n    disconnected = true;\r\n    audioNode.disconnect(next._destination);\r\n  };\r\n\r\n  this.dispose = this.disconnect;\r\n\r\n  this.output = function() {\r\n    return audioNode;\r\n  };\r\n\r\n  this.currentTime = function() {\r\n    return music.audio.currentTime;\r\n  };\r\n\r\n  this.setParam = function(paramName, value) {\r\n    value.apply(music.audio.currentTime, audioNode[paramName]);\r\n  };\r\n\r\n  this.setParamTarget = function(paramName, target, timeConstant) {\r\n    var audioParam = audioNode[paramName];\r\n    audioParam.cancelScheduledValues(0.0);\r\n    audioParam.setTargetAtTime(target, music.audio.currentTime, timeConstant);\r\n  };\r\n\r\n  this.record = function() {\r\n    var rec = new Recorder(audioNode, {workerPath: \"lib/recorder/recorderWorker.js\"});\r\n\r\n    rec.record();\r\n    return rec;\r\n  };\r\n\r\n  MUSIC.EffectsPipeline.bind(this)(music, this);\r\n};\r\nMUSIC.Effects.WebAudioNodeWrapper.prototype = Object.create(MUSIC.EffectsPipeline.prototype);\r\n\r\nMUSIC.Effects.Formula = function(music, next, fcn) {\r\n  var scriptNode = music.audio.createScriptProcessor(1024, 1, 1);\r\n  var iteration = 0;\r\n  var sampleRate = music.audio.sampleRate;\r\n\r\n  scriptNode.onaudioprocess = function(audioProcessingEvent) {\r\n    // The input buffer is the song we loaded earlier\r\n    var inputBuffer = audioProcessingEvent.inputBuffer;\r\n\r\n    // The output buffer contains the samples that will be modified and played\r\n    var outputBuffer = audioProcessingEvent.outputBuffer;\r\n\r\n    // Loop through the output channels (in this case there is only one)\r\n    for (var channel = 0; channel < outputBuffer.numberOfChannels; channel++) {\r\n      var inputData = inputBuffer.getChannelData(channel);\r\n      var outputData = outputBuffer.getChannelData(channel);\r\n\r\n      // Loop through the 4096 samples\r\n      for (var sample = 0; sample < inputBuffer.length; sample++) {\r\n        // make output equal to the same as the input\r\n        outputData[sample] = fcn(inputData[sample], (inputBuffer.length * iteration + sample) / sampleRate);\r\n      }\r\n    }\r\n\r\n    iteration++;\r\n  }\r\n\r\n  setTimeout(function() { // this hack prevents a bug in current version of chrome\r\n    scriptNode.connect(next._destination);\r\n  });\r\n\r\n  this._destination = scriptNode;\r\n  \r\n  MUSIC.EffectsPipeline.bind(this)(music, this);\r\n\r\n  this.next = function() {\r\n    return next;\r\n  };\r\n\r\n  var disconnected = false;\r\n  this.disconnect = function() {\r\n    if (disconnected) return;\r\n    disconnected = true;\r\n    \r\n    setTimeout(function() { // this hack prevents a bug in current version of chrome\r\n      scriptNode.disconnect(next._destination);\r\n    });\r\n  };\r\n\r\n  this.dispose = this.disconnect;\r\n\r\n  this.update = function(_f) {\r\n    fcn = _f;\r\n    this.fcn = fcn;\r\n  };\r\n\r\n  this.fcn = fcn;\r\n\r\n  this.output = function() {\r\n    return scriptNode;\r\n  };\r\n\r\n  this.isFormula = true;\r\n}\r\nMUSIC.Effects.Formula.prototype = Object.create(MUSIC.EffectsPipeline.prototype);\r\n\r\n\r\nMUSIC.Effects.register(\"formula\", function(music, next, fcn) {\r\n  return new MUSIC.Effects.Formula(music, next, fcn)\r\n});\r\n\r\n\r\nMUSIC.Effects.BiQuad = function(music, next, options) {\r\n  var biquadFilter = music.audio.createBiquadFilter();\r\n  var gainModulation = nodispose;\r\n  var qModulation = nodispose;\r\n  var frequencyModulation = nodispose;\r\n  var detuneModulation = nodispose;\r\n\r\n  var biquadType = options.type;\r\n\r\n  this.update = function(options) {\r\n    biquadFilter.type = biquadType;\r\n\r\n    var assignParam = function(orig, audioParam) {\r\n      if (orig) {\r\n        if (orig.apply) {\r\n          return orig.apply(music.audio.currentTime, audioParam, music);\r\n        } else {\r\n          audioParam.value = orig;\r\n        }\r\n      }\r\n\r\n      return nodispose;\r\n    };\r\n\r\n    gainModulation.dispose();\r\n    qModulation.dispose();\r\n    frequencyModulation.dispose();\r\n    detuneModulation.dispose();\r\n\r\n    gainModulation = assignParam(options.gain, biquadFilter.gain);\r\n    qModulation = assignParam(options.Q, biquadFilter.Q);\r\n    frequencyModulation = assignParam(options.frequency, biquadFilter.frequency);\r\n    detuneModulation = assignParam(options.detune, biquadFilter.detune);\r\n  };\r\n\r\n  this.update(options);\r\n\r\n  MUSIC.Effects.WebAudioNodeWrapper.bind(this)(music, biquadFilter, next, function() {\r\n    gainModulation.dispose();\r\n    qModulation.dispose();\r\n    frequencyModulation.dispose();\r\n    detuneModulation.dispose();\r\n  });\r\n};\r\nMUSIC.Effects.BiQuad.prototype = Object.create(MUSIC.Effects.WebAudioNodeWrapper.prototype);\r\n\r\nMUSIC.Effects.register(\"biquad\", MUSIC.Effects.BiQuad);\r\n[\"lowpass\", \"highpass\", \"bandpass\", \"lowshelf\", \"highshelf\", \"peaking\", \"notch\", \"allpass\"]\r\n  .forEach(function(filterName) {\r\n    MUSIC.Effects.register(filterName, function(music, next, options) {\r\n      return new MUSIC.Effects.BiQuad(music, next, {type: filterName, frequency: options.frequency, Q: options.Q, detune: options.detune});\r\n    });\r\n  });\r\n\r\nvar canMutate = function(obj, updateFcn) {\r\n  obj.update = function(value) {\r\n    updateFcn(value);\r\n    return obj;\r\n  };\r\n  return obj;\r\n};\r\n\r\nvar nodispose = {\r\n  dispose: function(){}\r\n};\r\n\r\nMUSIC.Effects.register(\"gain\", function(music, next, value) {\r\n  var gainNode = music.audio.createGain();\r\n  var volumeModulation = nodispose;\r\n\r\n  return canMutate(\r\n    new MUSIC.Effects.WebAudioNodeWrapper(music, gainNode, next, function() {\r\n      volumeModulation.dispose();\r\n    }),\r\n    function(value) {\r\n      volumeModulation.dispose();\r\n\r\n      if (value.apply) {\r\n        gainNode.gain.value = 0.0;\r\n        volumeModulation = value.apply(music.audio.currentTime, gainNode.gain, music);\r\n      } else {\r\n        volumeModulation = nodispose;\r\n        gainNode.gain.value = value;\r\n      }\r\n    }\r\n  ).update(value);\r\n});\r\n\r\nMUSIC.Effects.register(\"delay\", function(music, next, value) {\r\n  var delayNode = music.audio.createDelay(60);\r\n  var delayModulation = nodispose;\r\n\r\n  return canMutate(\r\n    new MUSIC.Effects.WebAudioNodeWrapper(music, delayNode, next, function() {\r\n      delayModulation.dispose();\r\n    }),\r\n    function(value) {\r\n      delayModulation.dispose();\r\n\r\n      if (value.apply) {\r\n        delayModulation = value.apply(music.audio.currentTime, delayNode.delayTime, music);\r\n      } else {\r\n        delayModulation = nodispose;\r\n        delayNode.delayTime.value = value;\r\n      }\r\n    }\r\n  ).update(value);\r\n});\r\n\r\nvar Echo = function(music, next, options) {\r\n  this.update = function(options) {\r\n    delayNode.delayTime.value = options.delay || 0.02;\r\n    att.gain.value = options.gain === 0  ? 0 : (options.gain||0.2);\r\n\r\n    if (delayNode.delayTime.value < 0.01) delayNode.delayTime.value = 0.01;\r\n    if (delayNode.delayTime.value > 1) delayNode.delayTime.value = 1;\r\n    if (att.gain.value > 0.99) att.gain.value = 0.99;\r\n    if (att.gain.value < 0) att.gain.value = 0;\r\n  };\r\n\r\n  var delayNode = music.audio.createDelay(60);\r\n\r\n  var gainNode = music.audio.createGain();\r\n  var gainNode2 = music.audio.createGain();\r\n  gainNode.gain.value = 1.0;\r\n  gainNode2.gain.value = 1.0;\r\n\r\n  var att = music.audio.createGain();\r\n\r\n  this.update(options);\r\n\r\n  setTimeout(function() {\r\n    gainNode.connect(gainNode2);\r\n    gainNode.connect(delayNode);\r\n    delayNode.connect(att);\r\n    gainNode2.connect(next._destination);\r\n    gainNode2.connect(delayNode);\r\n    att.connect(gainNode2);\r\n  });\r\n\r\n  this._destination = gainNode;\r\n\r\n\r\n  this.next = function() {\r\n    return next;\r\n  };\r\n\r\n  var disconnected = false;\r\n  this.disconnect = function() {\r\n    if (disconnected) return;\r\n    disconnected = true;\r\n    gainNode.disconnect(gainNode2);\r\n    gainNode.disconnect(delayNode);\r\n    delayNode.disconnect(att);\r\n    gainNode2.disconnect(next._destination);\r\n    gainNode2.disconnect(delayNode);\r\n    att.disconnect(gainNode2);\r\n  };\r\n\r\n  this.dispose = this.disconnect;\r\n\r\n  this.output = function() {\r\n    return audioNode;\r\n  };\r\n\r\n  this.setParam = function(paramName, value) {\r\n    value.apply(music.audio.currentTime, audioNode[paramName]);\r\n  };\r\n\r\n  MUSIC.EffectsPipeline.bind(this)(music, this);\r\n};\r\nEcho.prototype = Object.create(MUSIC.EffectsPipeline.prototype);\r\n\r\nvar WaveShaper = function(music, next, options) {\r\n  options = options ||{};\r\n  var samples = options.samples || 8192;\r\n  var f = options.f || function(t){return t; };\r\n\r\n  var makeDistortionCurve = function() {\r\n    var array = new Float32Array(samples);\r\n    for (var i=0; i<samples; i++) {\r\n      array[i] = f(i*2 / samples - 1);\r\n    }\r\n\r\n    return array;\r\n  };\r\n\r\n  this.next = function() {\r\n    return next;\r\n  };\r\n\r\n  var waveShaperNode = music.audio.createWaveShaper();\r\n  waveShaperNode.curve = makeDistortionCurve();\r\n  waveShaperNode.oversample = '4x';\r\n\r\n  setTimeout(function() {\r\n    waveShaperNode.connect(next._destination);\r\n  });\r\n  this._destination = waveShaperNode;\r\n  var disconnected = false;\r\n\r\n  this.disconnect = function() {\r\n    if (disconnected) return;\r\n    disconnected = true;\r\n    waveShaperNode.disconnect(next._destination);\r\n  };\r\n\r\n  MUSIC.EffectsPipeline.bind(this)(music, this);\r\n}\r\nWaveShaper.prototype = Object.create(MUSIC.EffectsPipeline.prototype);\r\n\r\nMUSIC.Effects.register(\"echo\", function(music, next, options) {\r\n  return new Echo(music, next, options);\r\n});\r\n\r\nMUSIC.Effects.register(\"wave_shaper\", function(music, next, options) {\r\n  return new WaveShaper(music, next, options);\r\n});\r\n\r\nMUSIC.Curve = function(array) {\r\n  this.during = during(array);\r\n};\r\n\r\nMUSIC.Curve.concat = function(c1, time1, c2, time2, n) {\r\n  var time = time1 + time2;\r\n  if (!n) {\r\n    n=Math.floor(time*100)+1;\r\n  }\r\n\r\n  var at = function(t) {\r\n    if (t < time1){\r\n      return c1.at(t); \r\n    } else {\r\n      return c2.at(t-time1);\r\n    }\r\n  };\r\n\r\n  var array = new Float32Array(n+1);\r\n  for (var i = 0; i < n+1; i++ ) {\r\n    array[i] = at(time * (i / n));\r\n  };\r\n\r\n  return {\r\n    apply: function(currentTime, audioParam) {\r\n      audioParam.cancelScheduledValues(0.0);\r\n      audioParam.setValueCurveAtTime(array, currentTime, time)\r\n    },\r\n\r\n    at: at\r\n  };\r\n};\r\n\r\nvar during = function(fcn, n) {\r\n  return function(time) {\r\n    if (!n) {\r\n      n=Math.floor(time*100)+1;\r\n    }\r\n\r\n    var array = new Float32Array(n+1);\r\n    for (var i = 0; i < n+1; i++ ) {\r\n      array[i] = fcn(i / n);\r\n    };\r\n\r\n    return { \r\n      apply: function(currentTime, audioParam) {\r\n        audioParam.cancelScheduledValues(0.0);\r\n        audioParam.setValueCurveAtTime(array, currentTime, time);\r\n      },\r\n\r\n      at: function(t) {\r\n        return fcn(t/time);\r\n      }\r\n    };\r\n  };\r\n};\r\n\r\n\r\nMUSIC.Curve.Formula = function(fcn, n) {\r\n  this.during = during(fcn, n);\r\n}\r\n\r\nMUSIC.Curve.Ramp = function(initValue, endValue, n) {\r\n  MUSIC.Curve.Formula.bind(this)(function(t){return initValue + (endValue - initValue)*t;}, n);\r\n};\r\n\r\nMUSIC.Curve.Periodic = function(fcn, frequency) {\r\n  var ta = 0;\r\n  var delayTime;\r\n  var lastTime = 0;\r\n  var deltatime;\r\n  var tb;\r\n  var period = 1.0 / frequency;\r\n  if (frequency.at) {\r\n    this.at = function(t) {\r\n      deltatime = t - lastTime;\r\n      ta += deltatime * frequency.at(t);\r\n      ta = ta % 1;\r\n\r\n      lastTime = t;\r\n      return fcn(ta);\r\n    };\r\n  } else {\r\n    this.at = function(t) {\r\n      ta = (t % period) / period;\r\n      if (ta < 0) ta++;\r\n      return fcn(ta);\r\n    };\r\n  }\r\n};\r\n\r\nMUSIC.Effects.register(\"ADSR\", function(music, next, options) {\r\n  options = options || {};\r\n  var samples = options.samples || 100;\r\n  var attackTime = options.attackTime;\r\n  var decayTime = options.decayTime;\r\n  var sustainLevel = options.sustainLevel;\r\n  var releaseTime = options.releaseTime;\r\n\r\n  if (attackTime === undefined) attackTime = 0.1;\r\n  if (decayTime === undefined) decayTime = 0.1;\r\n  if (sustainLevel === undefined) sustainLevel = 0.8;\r\n  if (releaseTime === undefined) releaseTime = 0.1;\r\n\r\n  var nextNodeFcn = options.node;\r\n  var attackCurve = new MUSIC.Curve.Ramp(0.0, 1.0, samples).during(attackTime);\r\n  var decayCurve = new MUSIC.Curve.Ramp(1.0, sustainLevel, samples).during(decayTime);\r\n  var startCurve = MUSIC.Curve.concat(attackCurve, attackTime, decayCurve, decayTime);\r\n\r\n  var gainNode = next\r\n              .gain(sustainLevel);\r\n\r\n  gainNode.setParam('gain', startCurve);\r\n  \r\n  return nextNodeFcn(gainNode)\r\n    .onStop(function(){ gainNode.dispose(); }) // dispose gain node\r\n    .stopDelay(releaseTime * 1000)\r\n    .onStop(function(){ \r\n      var currentLevel = gainNode._destination.gain.value;\r\n      var releaseCurve = new MUSIC.Curve.Ramp(currentLevel, 0.0, samples).during(releaseTime)\r\n      gainNode.setParam('gain', releaseCurve); \r\n    }); // set gain curve\r\n\r\n});\r\n\r\nMUSIC.Effects.register(\"stopCurve\", function(music, next, options) {\r\n  options = options || {};\r\n  var samples = options.samples || 100;\r\n  var duration = options.duration || 0.4;\r\n  var nextNodeFcn = options.node;\r\n  var stopCurve = new MUSIC.Curve.Ramp(1.0, 0.0, samples).during(duration);\r\n  var gainNode = next\r\n              .gain(1.0);\r\n  \r\n  return nextNodeFcn(gainNode)\r\n    .onStop(function(){ gainNode.dispose(); }) // dispose gain node\r\n    .stopDelay(duration * 1000)\r\n    .onStop(function(){ gainNode.setParam('gain', stopCurve); }); // set gain curve\r\n\r\n});\r\n\r\n","(function() {\r\n\r\nvar frequency = function(notenum) {\r\n    return 16.35 * Math.pow(2, notenum/12);\r\n};\r\nvar noteToNumMap = {\r\n  'C': 0, \r\n  'D': 2, \r\n  'E': 4, \r\n  'F': 5, \r\n  'G': 7, \r\n  'A': 9, \r\n  'B': 11\r\n};\r\n\r\nvar instrumentExtend = function(obj) {\r\n  var delayedPlaying = function(originalPlaying, ms) {\r\n    return {\r\n      stop: function() {\r\n        setTimeout(originalPlaying.stop.bind(originalPlaying), ms);\r\n      } \r\n    };\r\n  };\r\n\r\n  var delayedNote = function(originalNote, ms) {\r\n    return {\r\n      play: function(param) {\r\n        var originalPlaying = originalNote.play(param);\r\n        return delayedPlaying(originalPlaying, ms);\r\n      }\r\n    };\r\n  };\r\n\r\n  obj.stopDelay = function(ms) {\r\n    return instrumentExtend({\r\n      note: function(noteNum, options) {\r\n        return delayedNote(obj.note(noteNum, options), ms);\r\n      }\r\n    });\r\n  };\r\n\r\n  obj.perNoteWrap = function(wrapper) {\r\n    return instrumentExtend({\r\n      note: function(noteNum, options) {\r\n        return wrapper(obj.note(noteNum, options));\r\n      }\r\n    });\r\n  };\r\n\r\n  obj.mapNote = function(fcn) {\r\n    return instrumentExtend({\r\n      note: function(noteNum, options) {\r\n        return obj.note(fcn(noteNum), options);\r\n      }\r\n    });\r\n  };\r\n\r\n  if (!obj.eventPreprocessor) {\r\n    obj.eventPreprocessor = function(evt) {\r\n      return evt;\r\n    };\r\n  }\r\n\r\n  if (!obj.note) {\r\n    obj.note = function(n, options) {\r\n      return this.schedule_note(n, options, 0.0);\r\n    };\r\n  }\r\n\r\n  return obj;\r\n};\r\n\r\nMUSIC.noteToNoteNum = function(noteName) {\r\n  var notenum;\r\n\r\n  notenum = noteToNumMap[noteName.charAt(0)]\r\n  if (notenum === undefined) return undefined\r\n  if (noteName.charAt(1) === '#') notenum++;\r\n  if (noteName.charAt(1) === 'b') notenum--;\r\n  if (noteName.charAt(2) !== \"\") notenum += (12 * parseInt(noteName.charAt(2)));\r\n  return notenum;\r\n};\r\n\r\nMUSIC.PolyphonyInstrument = function(innerFactory, maxChannels) {\r\n  var instrumentArray = [];\r\n  var onUse = [];\r\n  var queue = [];\r\n\r\n  var freeIdx = function(maxChannels) {\r\n    for (var i=0; i<maxChannels; i++) {\r\n      if (!onUse[i]) return i;\r\n    }\r\n    return queue[0]||0;\r\n  };\r\n\r\n  this.note = function(notenum, options) {\r\n    var c = maxChannels();\r\n    var playingIdx = freeIdx(c);\r\n    var instrument = instrumentArray[playingIdx];\r\n\r\n    if (!instrument) {\r\n      instrument = innerFactory();\r\n      instrumentArray[playingIdx] = instrument;\r\n    }\r\n\r\n    queue.push(playingIdx);\r\n    if (queue.length > c) queue.shift();\r\n\r\n    onUse[playingIdx] = true;\r\n    return instrument.note(notenum, options)\r\n      .onStop(function() {\r\n        onUse[playingIdx] = false;\r\n      });\r\n  };\r\n\r\n  instrumentExtend(this);\r\n\r\n  this.eventPreprocessor = function(event, events) {\r\n    var instrument = instrumentArray[0]\r\n    if (!instrument) {\r\n      instrument = innerFactory();\r\n      instrumentArray[0] = instrument;\r\n    }\r\n\r\n    return (instrument.eventPreprocessor||function(x){return x; })(event, events);\r\n  };\r\n};\r\n\r\nMUSIC.MonoNoteInstrument = function(inner) {\r\n  var noteInst;\r\n  var playingInst;\r\n  var count = 0;\r\n\r\n  this.note = function(notenum, options) {\r\n    if (!noteInst) {\r\n      noteInst = inner.note(notenum, options);\r\n    }\r\n\r\n    return MUSIC.playablePipeExtend({\r\n      play: function(param) {\r\n        if (!playingInst) {\r\n          playingInst = noteInst.play(param);\r\n        }\r\n\r\n        noteInst.setValue(notenum, options);\r\n\r\n        count++;\r\n        return {stop: function() {\r\n          count--;\r\n          if (noteInst.reset && count === 0) noteInst.reset();\r\n        }};\r\n      } \r\n    });\r\n  };\r\n\r\n  this.currentTime = function() {\r\n    return inner.currentTime();\r\n  };\r\n\r\n  this.schedule_note = function(notenum, options, start) {\r\n    if (!noteInst) {\r\n      noteInst = inner.note(notenum, options);\r\n    }\r\n\r\n    return MUSIC.playablePipeExtend({\r\n      play: function(param) {\r\n        if (!playingInst) {\r\n          playingInst = noteInst.play(param);\r\n        }\r\n\r\n        noteInst.setValueOnTime(notenum, options, start);\r\n\r\n        return {stop: function() {\r\n          noteInst.cancelScheduledValues();\r\n        }};\r\n      } \r\n    });\r\n  };\r\n\r\n  this.dispose = function() {\r\n    if (playingInst) {\r\n      playingInst.stop();\r\n    }\r\n\r\n    if (inner.dispose) inner.dispose();\r\n  };\r\n\r\n  instrumentExtend(this);\r\n};\r\n\r\nMUSIC.Instrument = function(soundFactory) {\r\n  if (soundFactory.schedule_freq) {\r\n    this.currentTime = function() {\r\n      return soundFactory.currentTime();\r\n    };\r\n\r\n    this.schedule_note = function(notenum, options, startTime, duration) {\r\n      if (notenum === undefined) return undefined;\r\n      var freq = frequency(notenum);\r\n\r\n      return MUSIC.playablePipeExtend({\r\n        play: function(param) {\r\n          var fr = soundFactory.schedule_freq(freq, startTime);\r\n          var soundInstance = fr.play(param);\r\n          return {\r\n            stop: function() {\r\n              soundInstance.stop();\r\n            }\r\n          }\r\n        }\r\n      });\r\n    };\r\n  }\r\n\r\n  this.note = function(notenum) {\r\n    if (notenum === undefined) return undefined;\r\n\r\n    var freq = frequency(notenum);\r\n    return MUSIC.playablePipeExtend({\r\n      play: function(param) {\r\n        var fr = soundFactory.freq(freq);\r\n        var soundInstance = fr.play(param);\r\n\r\n        if (fr.setFreq) {\r\n          this.setValue = function(n, options) {\r\n            fr.setFreq(frequency(n), options);\r\n          };\r\n\r\n          this.reset = fr.reset.bind(fr);\r\n        }\r\n\r\n        if (fr.cancelScheduledValues) {\r\n          this.cancelScheduledValues = fr.cancelScheduledValues.bind(fr);\r\n        }\r\n\r\n        if (fr.setFreqOnTime) {\r\n          this.setValueOnTime = function(n, options, start) {\r\n            fr.setFreqOnTime(frequency(n), options, start);\r\n          };\r\n\r\n          this.reset = fr.reset.bind(fr);\r\n        }\r\n\r\n        return {\r\n          stop: function() {\r\n            soundInstance.stop();\r\n          }\r\n        }\r\n      }\r\n    });\r\n  };\r\n\r\n  instrumentExtend(this);\r\n};\r\n\r\nMUSIC.instrumentExtend = instrumentExtend;\r\nMUSIC.Instrument.frequency = frequency;\r\n\r\nMUSIC.MultiInstrument = function(instrumentArray) {\r\n  if (Array.isArray(instrumentArray)) return MUSIC.MultiInstrument.bind(this)(function() {\r\n    return instrumentArray;\r\n  });\r\n\r\n  var notePlay = function(note) { return note.play(); };\r\n  var noteStop = function(note) { return note.stop(); };\r\n\r\n  var MultiNote = function(noteArray) {\r\n    this.play = function() {\r\n      var notes = noteArray.map(notePlay);\r\n      return {\r\n        stop: function() {\r\n          notes.forEach(noteStop);\r\n        }\r\n      };\r\n    }\r\n  };\r\n\r\n  this.note = function(noteNum, options) {\r\n    return MUSIC.playablePipeExtend(new MultiNote(instrumentArray().map(function(instrument){ \r\n      return instrument.note(noteNum, options);\r\n    })));\r\n  };\r\n\r\n  this.dispose = function() {\r\n    instrumentArray().forEach(function(i) {\r\n      if (i.dispose) i.dispose();\r\n    });\r\n  };\r\n\r\n  if (instrumentArray().every(function(i) { return i.schedule_note; })) {\r\n    this.currentTime = function() {\r\n\r\n      var instrument = instrumentArray().filter(function(i) { return i.currentTime; })[0];\r\n      if (!instrument) return 0;\r\n\r\n      return instrument.currentTime();\r\n    };\r\n\r\n    this.schedule_note = function(noteNum, options, startTime, duration) {\r\n      return MUSIC.playablePipeExtend(new MultiNote(instrumentArray().map(function(instrument){ \r\n        return instrument.schedule_note(noteNum, options, startTime, duration);\r\n      })));\r\n    };\r\n  }\r\n\r\n  instrumentExtend(this);\r\n\r\n  this.eventPreprocessor = function(event, events) {\r\n    var array = instrumentArray();\r\n    if (!array.length) return event;\r\n\r\n    var processedEvents = array.map(function(instrument) {\r\n      if (instrument.eventPreprocessor) {\r\n        return instrument.eventPreprocessor(event, events);\r\n      } else {\r\n        return event;\r\n      }\r\n    });\r\n\r\n    if (processedEvents.length === 1) {\r\n      return processedEvents[0];\r\n    } else {\r\n      var n = 0, s = 0, l = 0;\r\n      var options = {};\r\n\r\n      for (var i=0; i<processedEvents.length; i++) {\r\n        var evt = processedEvents[i];\r\n        n = n + evt[0];\r\n        s = s + evt[1];\r\n        l = l + evt[2];\r\n\r\n        if (evt[3]) {\r\n          for (var k in evt[3]) {\r\n            options[k] = evt[3][k];\r\n          }\r\n        }\r\n      }\r\n\r\n      return [\r\n        Math.floor(n/processedEvents.length),\r\n        s/processedEvents.length,\r\n        l/processedEvents.length,\r\n        options\r\n      ];\r\n    }\r\n  };\r\n};\r\n\r\nvar NOTES = ['C', 'Db', 'D', 'Eb', 'E', 'F', 'Gb', 'G', 'Ab', 'A', 'Bb', 'B'];\r\nvar noteNumToNoteName = function(noteNum) {\r\n  var noteName = NOTES[noteNum % 12];\r\n  var octaveNum = (Math.floor(noteNum / 12 + 1));\r\n\r\n  return noteName + octaveNum;\r\n};\r\n\r\nMUSIC.PatchInstrument = function(notes) {\r\n  var noteNum;\r\n  var sounds = [];\r\n\r\n  for (var noteName in notes) {\r\n    var playable = MUSIC.Types.cast(\"playable\", notes[noteName]);\r\n    noteNum = MUSIC.noteToNoteNum(noteName);\r\n    sounds[noteNum] = playable;\r\n  };\r\n\r\n  this.note = function(noteNum) {\r\n    var s = sounds[noteNum];\r\n    if (!s) return s;\r\n    return MUSIC.playablePipeExtend({\r\n      play: s.play\r\n    });\r\n  };\r\n\r\n  instrumentExtend(this);\r\n};\r\n\r\nMUSIC.SoundfontInstrument = function(sounds, audio, audioDestination) {\r\n\r\n  var noteAudio = [];\r\n\r\nfunction _base64ToArrayBuffer(base64) {\r\n    var binary_string =  window.atob(base64);\r\n    var len = binary_string.length;\r\n    var bytes = new Uint8Array( len );\r\n    for (var i = 0; i < len; i++)        {\r\n        var ascii = binary_string.charCodeAt(i);\r\n        bytes[i] = ascii;\r\n    }\r\n    return bytes.buffer;\r\n};\r\n  audio = audio.audio\r\n  \r\n  for (var i = 0; i<72; i++) {\r\n    (function() {\r\n      var index = i;\r\n      var xmlhttp=new XMLHttpRequest();\r\n      var noteName = noteNumToNoteName(i);\r\n      var data = sounds[noteName];\r\n      var encoded = data.split(\",\")[1];\r\n\r\n      audio.decodeAudioData(_base64ToArrayBuffer(encoded), function(buffer) {\r\n        noteAudio[index] = buffer;\r\n      }, function(err) {\r\n        console.error(\"error \" + err + \" loading \" + index);\r\n      });\r\n\r\n    })();\r\n  };\r\n\r\n  this.note = function(notenum) {\r\n    var source = audio.createBufferSource();\r\n    return MUSIC.playablePipeExtend({\r\n      play: function() {\r\n        var source = audio.createBufferSource();\r\n        source.buffer = noteAudio[notenum];\r\n        source.connect(audioDestination._destination);\r\n        source.start(0);\r\n        return {\r\n          stop: function() {\r\n            source.stop(0);\r\n            source.disconnect(audioDestination._destination);\r\n          }\r\n        };\r\n      }\r\n    });\r\n  };\r\n\r\n  instrumentExtend(this);\r\n\r\n};\r\n\r\nMUSIC.Types.register(\"instrument\", function(instrument) {\r\n  if (instrument.note) return instrument;\r\n});\r\n\r\nMUSIC.Types.register(\"instrument\", function(soundGenerator) {\r\n  if (soundGenerator.freq) {\r\n    return new MUSIC.Instrument(soundGenerator);\r\n  }\r\n});\r\n\r\nMUSIC.Types.register(\"instrument\", function(playable) {\r\n  if (playable.play) {\r\n    return {\r\n      note: function(){\r\n        return playable;\r\n      }\r\n    };\r\n  }\r\n});\r\n\r\nvar nullPlay = {\r\n  play: function(){\r\n    return {stop: function(){}};\r\n  }\r\n};\r\n\r\nMUSIC.Types.register(\"instrument\", function(fcn) {\r\n  if (typeof fcn === \"function\") {\r\n    return {\r\n      note: function(n) {\r\n        return fcn(n) || nullPlay;\r\n      }\r\n    };\r\n  }\r\n});\r\n\r\nMUSIC.Types.register(\"instrument\", function(array) {\r\n  if (array instanceof Array) {\r\n    return new MUSIC.MultiInstrument(array);\r\n  }\r\n});\r\n\r\nMUSIC.Types.register(\"instrument\", function(plainObject) {\r\n  if (typeof plainObject === \"object\" && plainObject.constructor === Object) {\r\n    return new MUSIC.PatchInstrument(plainObject)\r\n  }\r\n});\r\n\r\nMUSIC.StopEvent = function() {\r\n  return function(note) {\r\n      return MUSIC.playablePipeExtend({\r\n          play: function() {\r\n              var paramObject = {\r\n                  onplay: function() {},\r\n                  onstop: function() {}\r\n              };\r\n\r\n              var originalNote = note.play(paramObject);\r\n              paramObject.onplay();\r\n              return {\r\n                  stop: function() {\r\n                      paramObject.onstop();\r\n                      originalNote.stop();\r\n                  }\r\n              };\r\n          }\r\n      });\r\n  };\r\n};\r\n\r\n})();","MUSIC.Effects = MUSIC.Effects || {};\r\n\r\nvar LemonadePlayable = function(music, destination, outputFcn, ops) {\r\n  this._destination = destination;\r\n  this._music = music;\r\n  this._ops = ops;\r\n  this._output = outputFcn;\r\n};\r\n\r\nLemonadePlayable.prototype.play = function() {\r\n  var destination = this._destination;\r\n  var ops = this._ops;\r\n  var opsLength = ops.length;\r\n  var signalArray = [];\r\n  var phaseArray = [];\r\n\r\n\r\n  for (var i=0; i<opsLength; i++) {\r\n    signalArray[i] = 0;\r\n    phaseArray[i] = 0;\r\n    ops[i].wave = MUSIC.Types.cast(\"function\", ops[i].wave)\r\n  }\r\n\r\n  var lastT = 0;\r\n  var outputFcn = this._output;\r\n  var formulaGenerator = new MUSIC.Effects.Formula(this._music, destination, function(input, t) {\r\n    var deltay = t-lastT;\r\n    for (var i=0; i<opsLength; i++) {\r\n      lastT = t;\r\n      // EULER\r\n      phaseArray[i] = phaseArray[i] + deltay * ops[i].frequency.apply(null, signalArray);\r\n\r\n      var phase = phaseArray[i] % 1;\r\n      if (phase < 0) phase++;\r\n      signalArray[i] = ops[i].wave(phase)\r\n    };\r\n\r\n    return outputFcn.apply(null, signalArray);\r\n  });\r\n  return {\r\n    stop: function() {\r\n      formulaGenerator.disconnect(destination._destination);\r\n    }\r\n  };\r\n};\r\n\r\nMUSIC.playablePipeExtend(LemonadePlayable.prototype);\r\n\r\nMUSIC.Effects.register(\"lemonade\", function(music, next, options) {\r\n  return new LemonadePlayable(music, next._audioDestination, options.output, options.ops);\r\n});","(function() {\r\nMUSIC.Math = MUSIC.Math || {};\r\n\r\nMUSIC.Math.bpmToSecondTick = function(options, bpm) {\r\n  return 60000 / bpm / options.ticks_per_beat;\r\n};\r\n\r\nvar makeEvaluableInverseFunctionFromParts = function(array) {\r\n  array = array.map(function(part) {\r\n    var f = makeEvaluableFunction(part.f);\r\n    var inverse_f = makeEvaluableInverseFunction(part.f);\r\n    return {\r\n      init: f(part.init),\r\n      end: f(part.end),\r\n      f: inverse_f\r\n    };\r\n  });\r\n\r\n  return function(y) {\r\n    var part = array.find(function(p) {\r\n      return y >= p.init && (!p.end || y <= p.end);\r\n    });\r\n\r\n    if (!part) return 0;\r\n    return part.f(y);\r\n  };  \r\n};\r\n\r\nvar makeEvaluableFunctionFromParts = function(array) {\r\n  array = array.map(function(part) {\r\n    return {\r\n      init: part.init,\r\n      end: part.end,\r\n      f: makeEvaluableFunction(part.f)\r\n    };\r\n  });\r\n\r\n  return function(x) {\r\n    var part = array.find(function(p) {\r\n      return x >= p.init && (!p.end || x <= p.end);\r\n    });\r\n\r\n    if (!part) return 0;\r\n    return part.f(x);\r\n  };\r\n};\r\n\r\nvar makeEvaluableInverseFunction = function(array) {\r\n  if (array.length == 2) {\r\n    var b = array[1];\r\n    var a = array[0];\r\n    return function(y) {\r\n      return (y - a)/b;  // y = b*x + a  ;   y - a = b*x; (y - a) / b = x;\r\n    };\r\n  } else if (array.length == 3) {\r\n    var a = array[2];\r\n    var b = array[1];\r\n    var c = array[0];      \r\n\r\n    if (a === 0) {\r\n      return makeEvaluableInverseFunction([c,b]);\r\n    } else {\r\n      return function(y) {\r\n        return 2*(c-y) / (-b - Math.sqrt(b*b - 4*a*(c-y)));\r\n      };\r\n    }\r\n  }\r\n};\r\n\r\n\r\nvar makeEvaluableFunction = function(array) {\r\n  if (array.length == 2) {\r\n    var b = array[1];\r\n    var a = array[0];\r\n    return function(x) {\r\n      return b*x + a;\r\n    };\r\n  } else if (array.length == 3) {\r\n    var a = array[2];\r\n    var b = array[1];\r\n    var c = array[0];\r\n    return function(x) {\r\n      return a*x*x + b*x + c;\r\n    };\r\n  }\r\n};\r\n\r\nvar integrate = function(array, lastPointValue) {\r\n  var x = lastPointValue[0];\r\n  var y = lastPointValue[1];\r\n\r\n  if (array.length == 1) {\r\n    var c = -array[0]*x + y;\r\n    return [c, array[0]];\r\n  } else if (array.length == 2) {\r\n    var c = y - x*array[0] - x*x*array[1]/2;\r\n    return [c, array[0], array[1]/2];\r\n  }\r\n};\r\n\r\nMUSIC.Math.integrateBpmEvents = function(options) {\r\n  var cutBpmEvent = function(bpmEvent1) {\r\n    var l = bpmEvent1.l;\r\n    options.bpm_events.forEach(function(bpmEvent2) {\r\n      if (bpmEvent2 !== bpmEvent1 && bpmEvent2.s >= bpmEvent1.s) {\r\n        if (bpmEvent2.s < bpmEvent1.s + l) {\r\n          var cutL = bpmEvent2.s - bpmEvent1.s;\r\n          if (cutL < l) l = cutL;\r\n        }\r\n      }\r\n    });\r\n\r\n    return {\r\n      s: bpmEvent1.s,\r\n      l: l,\r\n      n: Math.max(bpmEvent1.n, 1)\r\n    };\r\n  };\r\n\r\n  options.bpm_events = options.bpm_events.map(cutBpmEvent);\r\n\r\n  var firstEventStart = options.bpm_events[0].s;\r\n  var parts = [{\r\n    init: 0,\r\n    end: firstEventStart,\r\n    f: [MUSIC.Math.bpmToSecondTick(options, options.bpm)]\r\n  }];\r\n\r\n  for (var i=0; i<options.bpm_events.length; i++) {\r\n    var bpm_event = options.bpm_events[i];\r\n    var next_bpm_event = options.bpm_events[i+1];\r\n\r\n    var init_second_tick = MUSIC.Math.bpmToSecondTick(options, \r\n      i == 0 ? options.bpm : options.bpm_events[i-1].n);\r\n    var end_second_tick = MUSIC.Math.bpmToSecondTick(options, bpm_event.n);\r\n\r\n    var b = (end_second_tick - init_second_tick) / bpm_event.l;\r\n    var a = init_second_tick - b * bpm_event.s;\r\n\r\n    // f(bpm_event.s) =  init_second_tick\r\n    // f(bpm_event.s + bpm_event.l) =  init_second_tick - b * bpm_event.s + b * (bpm_event.s + bpm_event.l)\r\n    // f(bpm_event.s + bpm_event.l) =  init_second_tick + b * bpm_event.l\r\n    // f(bpm_event.s + bpm_event.l) =  end_second_tick\r\n\r\n    if (bpm_event.l === 0) {\r\n      parts.push({\r\n        init: bpm_event.s,\r\n        end: next_bpm_event && next_bpm_event.s,\r\n        f: [end_second_tick]\r\n      });\r\n    } else {\r\n      parts.push({\r\n        init: bpm_event.s,\r\n        end: bpm_event.s + bpm_event.l,\r\n        f: [a, b]\r\n      });\r\n\r\n      parts.push({\r\n        init: bpm_event.s + bpm_event.l,\r\n        end: next_bpm_event && next_bpm_event.s,\r\n        f: [end_second_tick]\r\n      });\r\n    }\r\n  };\r\n\r\n  var integratedParts = [];\r\n  var lastPointValue = [0,0];\r\n\r\n  for (var i=0; i<parts.length; i++) {\r\n    var part = parts[i];\r\n    var integral = integrate(part.f, lastPointValue);\r\n\r\n    integratedParts.push({\r\n      init: part.init,\r\n      end: part.end,\r\n      f: integrate(part.f, lastPointValue)\r\n    });\r\n\r\n    lastPointValue = [part.end, makeEvaluableFunction(integral)(part.end)];\r\n  };\r\n\r\n  return integratedParts;\r\n};\r\n\r\nMUSIC.Math.ticksToTime = function(options) {\r\n  if (options.start) {\r\n    var time = MUSIC.Math.ticksToTime({\r\n      bpm: options.bpm,\r\n      ticks_per_beat: options.ticks_per_beat,\r\n      bpm_events: options.bpm_events\r\n    });\r\n\r\n    var startTime = time(options.start);\r\n    return function(ticks) {\r\n      return time(ticks) - startTime;\r\n    };\r\n  }\r\n\r\n  var bpm = options.bpm;\r\n  var ticks_per_beat = options.ticks_per_beat;\r\n\r\n  if (options.bpm_events && options.bpm_events.length) {\r\n    var integral = MUSIC.Math.integrateBpmEvents(options);\r\n    return makeEvaluableFunctionFromParts(integral);\r\n  } else {\r\n    var scale = 60000 / bpm / ticks_per_beat;\r\n    return function(ticks) {\r\n      return ticks*scale;\r\n    };\r\n  }\r\n};\r\n\r\nMUSIC.Math.timeToTicks = function(options) {\r\n  if (options.start) {\r\n    var ret = MUSIC.Math.timeToTicks({\r\n      bpm: options.bpm,\r\n      ticks_per_beat: options.ticks_per_beat,\r\n      bpm_events: options.bpm_events\r\n    });\r\n\r\n    var time = MUSIC.Math.ticksToTime({\r\n      bpm: options.bpm,\r\n      ticks_per_beat: options.ticks_per_beat,\r\n      bpm_events: options.bpm_events\r\n    });\r\n\r\n    var startTime = time(options.start);\r\n    return function(time) {\r\n      return ret(time + startTime);\r\n    };\r\n  }\r\n\r\n  var bpm = options.bpm;\r\n  var ticks_per_beat = options.ticks_per_beat;\r\n\r\n  if (options.bpm_events && options.bpm_events.length) {\r\n    var integral = MUSIC.Math.integrateBpmEvents(options);\r\n    return makeEvaluableInverseFunctionFromParts(integral);\r\n  } else {\r\n    var inverseScale = ticks_per_beat * bpm / 60000;\r\n    return function(time) {\r\n      return time*inverseScale;\r\n    };\r\n  }\r\n};\r\n\r\n})();","(function() {\r\n\r\nMUSIC.NoteSequence = function(funseq, options) {\r\n  var clock;\r\n  var songCtx = options && options.songCtx;\r\n\r\n  if (!funseq){\r\n    clock = MUSIC.Utils.Clock(\r\n      window.performance.now.bind(window.performance),\r\n      setInterval,\r\n      clearInterval,\r\n      500);\r\n    funseq = MUSIC.Utils.FunctionSeq(clock, setTimeout, clearTimeout);\r\n    funseq.push({t: 0, f: function() {\r\n      if (songCtx.referenceInstrument) {\r\n        songCtx.sequenceStartTime = songCtx.referenceInstrument.currentTime();\r\n      }\r\n    }, externalSchedule: true});\r\n  }\r\n\r\n  this._time = options && options.time;\r\n  this._funseq = funseq;\r\n  this._totalduration = 0;\r\n  this._noteid = 0;\r\n  this._contextList = [];\r\n};\r\n\r\nMUSIC.NoteSequence.Playable = function(noteseq, instrument, duration, contextList) {\r\n  this._noteseq = noteseq;\r\n  this._instrument = instrument;\r\n  this._duration = duration;\r\n  this._contextList = contextList || [];\r\n};\r\n\r\nMUSIC.NoteSequence.Playable.prototype.loop = function(times) {\r\n  return MUSIC.Loop(this, times);\r\n};\r\n\r\nMUSIC.NoteSequence.Playable.prototype.duration = function() {\r\n  return this._duration;\r\n};\r\n\r\nMUSIC.NoteSequence.Playable.prototype.play = function(options) {\r\n  var context = MUSIC.NoteSequence.context(this._instrument, this._contextList);\r\n  this._runningFunSeq = this._noteseq._funseq.start(context);\r\n  return new MUSIC.NoteSequence.Playing(this._runningFunSeq, context);\r\n};\r\n\r\nMUSIC.NoteSequence.Playing = function(runningFunSeq, ctx) {\r\n  this._runningFunSeq = runningFunSeq;\r\n  this._context = ctx;\r\n};\r\n\r\nMUSIC.NoteSequence.Playing.prototype.stop = function() {\r\n  if (this._context.playing) this._context.playing.stop();\r\n  this._context.stop();\r\n  this._runningFunSeq.stop();\r\n};\r\n\r\nMUSIC.NoteSequence.prototype.paddingTo = function(ticks){\r\n  this._totalduration = this._time(ticks);\r\n};\r\n\r\nMUSIC.NoteSequence.prototype.padding = function(time){\r\n  this._totalduration = this._totalduration + time;\r\n};\r\n\r\nMUSIC.NoteSequence.prototype.pushCallback = function(array){\r\n  var startTime = this._time(array[0]);\r\n  if (startTime < 0) return;\r\n\r\n  var f = array[1];\r\n  this._funseq.push({t:startTime, f: f});\r\n};\r\n\r\nMUSIC.NoteSequence.prototype.push = function(array, baseCtx){\r\n  var noteNum = array[0];\r\n  var startTime = this._time(array[1]);\r\n  var duration = this._time(array[1]+array[2]) - startTime;\r\n\r\n  if (startTime < 0) {\r\n    if (startTime + duration < 0) {\r\n      return;\r\n    } else {\r\n      duration = duration + startTime;\r\n      startTime = 0;\r\n    }\r\n  }\r\n\r\n  var options = array[3];\r\n\r\n  this._noteid++;\r\n  var mynoteid = this._noteid;\r\n\r\n  if (baseCtx) {\r\n    if (this._contextList.indexOf(baseCtx)===-1) {\r\n      this._contextList.push(baseCtx);\r\n    }\r\n  }\r\n\r\n  if (baseCtx && baseCtx.instrument && baseCtx.instrument.schedule_note) {\r\n    if (baseCtx.instrument.currentTime) {\r\n      baseCtx.songCtx.referenceInstrument = baseCtx.instrument;\r\n    }\r\n\r\n    this._funseq.push({t:startTime, f: function(param) {\r\n      var playing = baseCtx.instrument.schedule_note(\r\n        noteNum,\r\n        options,\r\n        baseCtx.sequenceStartTime() + startTime/1000,\r\n        duration/1000);\r\n\r\n      baseCtx.setPlaying(mynoteid, playing);\r\n    }, externalSchedule: true});\r\n  } else {\r\n\r\n    console.warn(\"UNSUPPORTED WEBAUDIO SCHEDULE FOR note n=\" + noteNum + \" at \" + startTime + \" (fallback to setTimeout)\");\r\n\r\n    this._funseq.push({t:startTime, f: function(param){\r\n      var ctx = baseCtx || param;\r\n      if (!ctx.instrument.note) return;\r\n      var playing = ctx.instrument.note(noteNum, options);\r\n      ctx.setPlaying(mynoteid, playing);\r\n    }});\r\n    this._funseq.push({t:startTime + duration, f: function(param){\r\n      var ctx = baseCtx || param;\r\n      ctx.unsetPlaying(mynoteid);\r\n    }});\r\n  }\r\n\r\n  if (startTime + duration > this._totalduration) this._totalduration = startTime + duration;\r\n};\r\n\r\nMUSIC.NoteSequence.prototype.makePlayable = function(instrument) {\r\n  return new MUSIC.NoteSequence.Playable(this, instrument, this._totalduration, this._contextList);\r\n};\r\n\r\nMUSIC.NoteSequence.context = function(instrument, subctx, songCtx) {\r\n  var playingNotes = {};\r\n  var setPlaying = function(noteid, p) {\r\n    playingNotes[noteid] = p.play();\r\n  };\r\n  var unsetPlaying = function(noteid) {\r\n    var playing = playingNotes[noteid]; \r\n    if (playing) {\r\n      playing.stop();\r\n      delete playingNotes[noteid];\r\n    }\r\n  };\r\n\r\n  var stop = function() {\r\n    if (subctx) {\r\n      for (var i=0; i<subctx.length; i++) {\r\n        subctx[i].stop();\r\n      }\r\n    }\r\n\r\n    for (var noteid in playingNotes) {\r\n      playingNotes[noteid].stop();\r\n    }\r\n\r\n    playingNotes = {};\r\n  };\r\n\r\n  var sequenceStartTime = function() {\r\n    if (!songCtx.sequenceStartTime) {\r\n      songCtx.sequenceStartTime = this.instrument.currentTime();\r\n    }\r\n\r\n    return songCtx.sequenceStartTime;\r\n  };\r\n\r\n  return {\r\n    sequenceStartTime: sequenceStartTime,\r\n    setPlaying: setPlaying,\r\n    unsetPlaying: unsetPlaying,\r\n    instrument: instrument,\r\n    stop: stop,\r\n    songCtx: songCtx\r\n  };\r\n};\r\n\r\n})();","(function() {\r\nvar playingStop = function(playing) { playing.stop(); };\r\n\r\nMUSIC.MultiPlayable = function(playableArray) {\r\n  this._playableArray = playableArray;\r\n\r\n  MUSIC.playablePipeExtend(this);\r\n};\r\n\r\nMUSIC.MultiPlayable.prototype.play = function(options) {\r\n  var playablePlay = function(playable) { return playable.play(options); };\r\n  var playingArray = this._playableArray.map(playablePlay);\r\n\r\n  return {\r\n    stop: function() {\r\n      playingArray.forEach(playingStop);\r\n    }\r\n  };\r\n};\r\n\r\nvar higher = function(a,b){ return a > b ? a : b; };\r\nvar getDuration = function(playable) { return playable && playable.duration ? playable.duration() : 0; };\r\nMUSIC.MultiPlayable.prototype.duration = function() {\r\n  return this._playableArray.map(getDuration).reduce(higher, 0);\r\n};\r\n\r\nMUSIC.ChangeTimeWrapper = function(noteseq, extensionTime) {\r\n  this._noteseq=noteseq;\r\n  this._extensionTime=extensionTime;\r\n};\r\n\r\nMUSIC.ChangeTimeWrapper.prototype.push = function(input) {\r\n  this._noteseq.push([input[0], input[1]*this._extensionTime, input[2]*this._extensionTime]);\r\n};\r\n\r\nMUSIC.Pattern = function(input, options) {\r\n  var playableArray = [];\r\n  options = options || {};\r\n  options.pulseTime = options.pulseTime || 50;\r\n\r\n  playableArray = input.map(function(seq) {\r\n    var code = seq[0];\r\n    var instrument = MUSIC.Types.cast(\"instrument\", seq[1]);\r\n\r\n    var noteseq = new MUSIC.NoteSequence();\r\n    MUSIC.SequenceParser.parse(code, new MUSIC.ChangeTimeWrapper(noteseq,options.pulseTime));\r\n    return noteseq.makePlayable(instrument);\r\n  });\r\n\r\n  return new MUSIC.MultiPlayable(playableArray);\r\n\r\n};\r\n\r\n})();","(function() {\r\nMUSIC.SequenceParser = {};\r\nvar notes = {\r\n  \"Cb\": -1,\r\n  \"C\": 0,\r\n  \"C#\": 1,\r\n  \"Db\": 1,\r\n  \"D\": 2,\r\n  \"D#\": 3,\r\n  \"Eb\": 3,\r\n  \"E\": 4,\r\n  \"E#\": 5,\r\n  \"Fb\": 4,\r\n  \"F\": 5,\r\n  \"F#\": 6,\r\n  \"Gb\": 6,\r\n  \"G\": 7,\r\n  \"G#\": 8,\r\n  \"Ab\": 8,\r\n  \"A\": 9,\r\n  \"A#\": 10,\r\n  \"Bb\": 10,\r\n  \"B\": 11,\r\n  \"B#\": 12\r\n};\r\n\r\nvar isNoteStart = function(chr) {\r\n  return \"CDEFGAB\".indexOf(chr) !== -1;\r\n};\r\n\r\nvar noteSplit = function(str) {\r\n  var ret = [];\r\n  var lastNote = \"\";\r\n  for (var i = 0; i < str.length; i++) {\r\n    if (isNoteStart(str[i])) {\r\n      if (lastNote !== \"\") ret.push(lastNote);\r\n      lastNote = \"\";\r\n    }\r\n\r\n    if (str[i] === \" \" || str[i] === \".\") {\r\n      if (lastNote !== \"\") ret.push(lastNote);\r\n      lastNote = \"\";\r\n    }\r\n\r\n    lastNote += str[i];\r\n  }\r\n  if (lastNote !== \"\") ret.push(lastNote);\r\n  return ret;\r\n};\r\n\r\nvar pipeReplace = new RegExp(\"\\\\|\", \"g\");\r\nMUSIC.SequenceParser.parse = function(input, noteSeq) {\r\n  var currentNote;\r\n  var currentCharacter;\r\n  if (input === \"\") return;\r\n  input = input.replace(pipeReplace, \"\");\r\n\r\n  var noteArray = noteSplit(input);\r\n  var currentTime = 0;\r\n  for (var i=0; i<noteArray.length; i++) {\r\n    var currentNoteStr = noteArray[i];\r\n    var noteDuration = currentNoteStr.length;\r\n    var equalIndex = currentNoteStr.indexOf(\"=\");\r\n    if (equalIndex != -1) currentNoteStr = currentNoteStr.slice(0, equalIndex);\r\n\r\n    var lastChar = currentNoteStr.slice(-1);\r\n    var octave = parseInt(lastChar);\r\n    if (isNaN(octave)) {\r\n      octave = 0;\r\n    } else {\r\n      currentNoteStr = currentNoteStr.slice(0, currentNoteStr.length-1);\r\n    }\r\n\r\n    var currentNote = notes[currentNoteStr];\r\n    if (currentNote !== undefined){\r\n      noteSeq.push([currentNote + octave*12, currentTime, noteDuration])\r\n    };\r\n    currentTime += noteDuration;\r\n  }\r\n};\r\n\r\n})();","(function() {\r\n\r\nvar PlayingSong = function(funseq, patternContexts, options) {\r\n  this._context = {playing: [], onStop: options && options.onStop};\r\n  this._patternContexts = patternContexts;\r\n  this._funseqHandler = funseq.start(this._context);\r\n};\r\n\r\nPlayingSong.prototype.stop = function() {\r\n  if (this._patternContexts && this._patternContexts.length) {\r\n    this._patternContexts.forEach(function(ctx) {\r\n      ctx.stop();\r\n    });\r\n  }\r\n\r\n  this._context.playing.forEach(function(playing) {\r\n    playing.stop();\r\n  });\r\n\r\n  this._funseqHandler.stop();\r\n\r\n  if (this._context.onStop){\r\n    this._context.onStop();\r\n  }\r\n};\r\n\r\nvar noPlay = {\r\n  play: function() {\r\n    return {\r\n      stop: function() {}\r\n    };\r\n  }\r\n};\r\n\r\nvar defaultFromPatterns = function(patterns) {\r\n  return function(patternOrName) {\r\n    if (typeof patternOrName === 'string') return patterns[patternOrName];\r\n    return patternOrName || noPlay;\r\n  };\r\n};\r\n\r\nvar nullPlay = {stop: function(){}};\r\nvar hasScheduleMethod = function(pattern) {\r\n  return !!pattern.schedule;\r\n};\r\n\r\nvar hasNotScheduleMethod = function(pattern) {\r\n  return !pattern.schedule;\r\n};\r\n\r\nMUSIC.Song = function(input, patternsOrOptions, options){\r\n  var patterns;\r\n  var self = this;\r\n\r\n  if (arguments.length === 2) {\r\n    return MUSIC.Song.bind(this)(input, {}, patternsOrOptions);\r\n  } else {\r\n    patterns = patternsOrOptions;\r\n  }\r\n\r\n  options = options || {};\r\n  var getFromPatterns = options.pattern|| defaultFromPatterns(patterns);\r\n  var measure = (options.measure || 500) * options.ticks_per_beat;\r\n  var funseq;\r\n  if (!funseq){\r\n    var clock = MUSIC.Utils.Clock(\r\n      window.performance.now.bind(window.performance),\r\n      setInterval,\r\n      clearInterval,\r\n      500);\r\n    funseq = MUSIC.Utils.FunctionSeq(clock, setTimeout, clearTimeout);\r\n  }\r\n\r\n\r\n  var totalMeasures = input[0].length;\r\n\r\n  this._funseq = funseq;\r\n\r\n  var byStart = function(a, b) {\r\n    return a.s-b.s;\r\n  };\r\n\r\n  // tempo events \r\n  var bpm_events = [];\r\n  for (var j = 0; j < totalMeasures; j++) {\r\n    var patternArray = [];\r\n    for (var i = 0 ; i < input.length; i++) {\r\n      var pattern = getFromPatterns(input[i][j]);\r\n      if (pattern.bpm_events) {\r\n        var displacedBpmEvents = pattern.bpm_events.map(function(evt) {\r\n          return {n: evt.n, s: evt.s + j*measure, l: evt.l};\r\n        });\r\n        bpm_events = bpm_events.concat(displacedBpmEvents);\r\n      }\r\n    };\r\n  }\r\n\r\n  bpm_events = bpm_events.sort(byStart);\r\n\r\n  var time = MUSIC.Math.ticksToTime({\r\n    bpm: options.bpm,\r\n    ticks_per_beat: options.ticks_per_beat,\r\n    bpm_events: bpm_events,\r\n    start: options.start || 0\r\n  });\r\n\r\n  this.timeToTicks = function() {\r\n    return MUSIC.Math.timeToTicks({\r\n      bpm: options.bpm,\r\n      ticks_per_beat: options.ticks_per_beat,\r\n      bpm_events: bpm_events,\r\n      start: options.start || 0\r\n    });\r\n  };\r\n\r\n  var timeFunc = function(baseTicks) {\r\n    return function(ticks) {\r\n      return time(baseTicks+ticks);\r\n    };\r\n  };\r\n\r\n  this._duration = time(totalMeasures * measure);\r\n  this.songCtx = {};\r\n\r\n  funseq.push({t: 0, f: function() {\r\n    if (self.songCtx.referenceInstrument) {\r\n      self.songCtx.sequenceStartTime = self.songCtx.referenceInstrument.currentTime();\r\n    }\r\n  }, externalSchedule: true});\r\n\r\n  for (var j = 0; j < totalMeasures; j++) {\r\n    (function() {\r\n      var patternArray = [];\r\n      for (var i = 0 ; i < input.length; i++) {\r\n        patternArray.push(input[i][j]);\r\n      };\r\n      var playableArray = patternArray.map(getFromPatterns) \r\n\r\n      var schedulable = playableArray.filter(hasScheduleMethod);\r\n      var notSchedulable = playableArray.filter(hasNotScheduleMethod);\r\n\r\n      if (notSchedulable.length > 0) {\r\n        var multiPlayable = new MUSIC.MultiPlayable(notSchedulable);\r\n        var playing = nullPlay;\r\n        var duration = multiPlayable.duration();\r\n\r\n        funseq.push({t: j*measure, f: function(context) {\r\n          playing = multiPlayable.play();\r\n          context.playing.push(playing);\r\n        }});\r\n        funseq.push({t: j*measure+duration, f: function(context) {\r\n          playing.stop();\r\n          context.playing = context.playing.filter(function(x){ return x != playing; });\r\n        }});\r\n      }\r\n\r\n      schedulable.forEach(function(s) {\r\n        var scheduleContexts = s.schedule(new MUSIC.NoteSequence(funseq, {\r\n          time: timeFunc(j*measure)\r\n        }), self.songCtx);\r\n        self._patternContexts = (self._patternContexts||[]).concat(scheduleContexts);\r\n      });\r\n\r\n    })();\r\n  };\r\n\r\n  funseq.push({t: timeFunc(0)(totalMeasures*measure), f: function(context) {\r\n    if (context.onStop) {\r\n      context.onStop();\r\n    }\r\n  }});\r\n\r\n};\r\n\r\nMUSIC.Song.prototype.duration = function() {\r\n  return this._duration;\r\n};\r\n\r\nMUSIC.Song.prototype.play = function(options) {\r\n  return new PlayingSong(this._funseq,  this._patternContexts, options);\r\n};\r\n\r\n})();","(function() {\r\nMUSIC.Utils = MUSIC.Utils || {};\r\nMUSIC.Utils.Scale = function(base) {\r\n  var toneAdd;\r\n  var v;\r\n\r\n  toneAdd = {};\r\n  v = [0,2,5,7,9];\r\n  for (var i=0; i<v.length; i++) {\r\n    toneAdd[(base+v[i]) % 12 ] = true;\r\n  }\r\n\r\n  return {\r\n    add: function(notenum, notes) {\r\n      var ret = notenum;\r\n      while (notes > 0) {\r\n        ret+= toneAdd[ret % 12] ? 2 : 1;\r\n        notes--;\r\n      }\r\n      return ret;\r\n    }\r\n  };\r\n};\r\n\r\nMUSIC.Utils.Clock = function(preciseTimer, setInterval, clearInterval, interval) {\r\n  var start = function(fcn) {\r\n    var startTime = preciseTimer();\r\n    fcn(0);\r\n    var hndl = setInterval(function(){\r\n      var t = preciseTimer();\r\n      fcn(t - startTime);\r\n    }, interval);\r\n\r\n    return {\r\n      stop: function() {\r\n        clearInterval(hndl);\r\n      }\r\n    }\r\n  };\r\n\r\n  return {\r\n    start: start\r\n  };\r\n};\r\n\r\nMUSIC.Utils.FunctionSeq = function(clock, setTimeout, clearTimeout) {\r\n  var eventsArray = [];\r\n\r\n  var reject = function(x) {\r\n    return function(y) {\r\n      return x!=y;\r\n    };\r\n  };\r\n\r\n  var start = function(parameter) {\r\n    var array = eventsArray.slice(0).sort(function(e1, e2) {\r\n      var dt = e1.t - e2.t;\r\n      if (dt===0) {\r\n        return eventsArray.indexOf(e1) - eventsArray.indexOf(e2);\r\n      }\r\n\r\n      return dt;\r\n    });\r\n\r\n    var timeoutHandlers = [];\r\n    var eventCount = array.length;\r\n\r\n    var clockHandler = clock.start(function(t) {\r\n      var lastEvent;\r\n      var callingCriteria = function(element) {\r\n        return element.t - t < 1000 && element.t - t >= 0;\r\n      };\r\n\r\n      var pending = [];\r\n      var processPending = function() {\r\n        if (!pending.length) return;\r\n\r\n        var currentPending = pending;\r\n        pending = [];\r\n\r\n        for (var i=0; i<currentPending.length; i++) {\r\n          if (currentPending[i].externalSchedule) {\r\n            currentPending[i].f(parameter, currentPending[i].t - t);\r\n          }\r\n        }\r\n\r\n        var timeoutHandler = setTimeout(function() {\r\n          timeoutHandlers = timeoutHandlers.filter(reject(timeoutHandler))\r\n\r\n          for (var i=0; i<currentPending.length; i++) {\r\n            if (!currentPending[i].externalSchedule) {\r\n              currentPending[i].f(parameter, 0);\r\n              eventCount--;\r\n              if (eventCount === 0) clockHandler.stop();\r\n            }\r\n          }\r\n        }, currentPending[0].t - t);\r\n        timeoutHandlers.push(timeoutHandler);\r\n      };\r\n\r\n      var addSchedule = function(event) {\r\n        if (lastEvent && lastEvent.t - t !== event.t - t) {\r\n          processPending();\r\n        }\r\n\r\n        pending.push(event);\r\n        lastEvent = event;\r\n      };\r\n\r\n      var nextElement;\r\n\r\n      while(1) {\r\n        if (array.length > 0) {\r\n          nextElement = array[0];\r\n          if (callingCriteria(nextElement)) {\r\n            addSchedule(nextElement);\r\n            array.shift(); // remove first element\r\n          } else {\r\n            break;\r\n          }\r\n        } else {\r\n          break;\r\n        }\r\n      }\r\n\r\n      processPending();\r\n    });\r\n\r\n    return {\r\n      stop: function(){\r\n        for (var i=0; i<timeoutHandlers.length;i++){\r\n          clearTimeout(timeoutHandlers[i]);\r\n        };\r\n        clockHandler.stop();\r\n      }\r\n    };\r\n  };\r\n\r\n  var push = eventsArray.push.bind(eventsArray);\r\n\r\n  return {\r\n    start: start,\r\n    push: push\r\n  };\r\n};\r\n\r\nMUSIC.Utils.FunctionSeq.preciseTimeout = function(fcn, ms) {\r\n  var funseq;\r\n  clock = MUSIC.Utils.Clock(\r\n    window.performance.now.bind(window.performance),\r\n    setInterval,\r\n    clearInterval,\r\n    500);\r\n  funseq = MUSIC.Utils.FunctionSeq(clock, setTimeout, clearTimeout);\r\n\r\n  var runningFunSeq;\r\n\r\n  funseq.push({f: function() {\r\n    if (runningFunSeq) {\r\n      runningFunSeq.stop();\r\n    }\r\n    fcn();\r\n  }, t: ms});\r\n  runningFunSeq = funseq.start();\r\n};\r\n\r\nMUSIC.Utils.DelayedFunctionSeq = function(inner, delay) {\r\n  var start = function(params) {\r\n    return inner.start(params);\r\n  };\r\n\r\n  var push = function(params) {\r\n    return inner.push({\r\n      f: params.f,\r\n      t: params.t + delay,\r\n      externalSchedule: params.externalSchedule\r\n    });\r\n  };\r\n\r\n  return {\r\n    start: start,\r\n    push: push\r\n  };\r\n};\r\n\r\n\r\n})();","(function() {\r\n  MUSIC = MUSIC ||{};\r\n\r\n  MUSIC.Types.register(\"function\", function(wave) {\r\n    if (typeof wave.at === \"function\") {\r\n      return wave.at.bind(wave);\r\n    }\r\n  });\r\n\r\n  MUSIC.Types.register(\"function\", function(fcn) {\r\n    if (typeof fcn === \"function\") {\r\n      return fcn;\r\n    }\r\n  });\r\n\r\n  MUSIC.Types.register(\"wave\", function(fcn) {\r\n    if (typeof fcn === \"function\") {\r\n      return new MUSIC.Wave.FunctionWave(fcn);\r\n    }\r\n  });\r\n\r\n  MUSIC.Types.register(\"wave\", function(wave) {\r\n    if (typeof wave.at === \"function\") {\r\n      return wave;\r\n    }\r\n  });\r\n\r\n\r\n  var twopi = Math.PI*2;\r\n  MUSIC.Wave = {};\r\n\r\n  var waveTransform = function(fcn) {\r\n    return function() {\r\n      var wave = this;\r\n      return {\r\n        at: function(t) {\r\n          wave.at(fcn(t));\r\n        }\r\n      };\r\n    }\r\n  };\r\n  var waveOps = {\r\n    reverse: waveTransform(function(t){return t-1; }),\r\n    scale: function(factor) {\r\n      var wave = this;\r\n      return new MUSIC.Wave.FunctionWave(function(t) {\r\n        return wave.at(t*factor);\r\n      }); \r\n    },\r\n    translate: function(disp) {\r\n      var wave = this;\r\n      return new MUSIC.Wave.FunctionWave(function(t) {\r\n        return wave.at(t+disp);\r\n      });\r\n    },\r\n    table: function(options) {\r\n      return new MUSIC.Wave.Table(this, options);\r\n    },\r\n    combine: function(otherWave, otherFactor) {\r\n      var thisWave = this;\r\n      otherFactor = otherFactor || 0.5;\r\n      var thisFactor = 1-otherFactor;\r\n      otherWave = MUSIC.Types.cast(\"wave\", otherWave);\r\n      return new MUSIC.Wave.FunctionWave(function(t) {\r\n        return otherWave.at(t) * otherFactor + thisWave.at(t) * thisFactor;\r\n      });\r\n    }\r\n  };\r\n\r\n  var defaultInterpolation = function(table){\r\n    var length = table.length;\r\n    return function(t) {\r\n      var index = Math.floor(t*table.length)\r\n      return table[index];\r\n    };\r\n  };\r\n\r\n  MUSIC.Wave.Table = function(wave, options) {\r\n    options = options || {};\r\n    var sampleCount = options.samples || 100;\r\n    var interpolation = options.interpolation || defaultInterpolation;\r\n\r\n    var sample = [];\r\n    for (var i=0; i<sampleCount; i++) {\r\n      sample[i] = wave.at(i/sampleCount);\r\n    }\r\n\r\n    this.at = interpolation(sample);\r\n  };\r\n  MUSIC.Wave.Table.prototype = waveOps;\r\n\r\n  MUSIC.Wave.FunctionWave = function(fcn) {\r\n    this.at = fcn;\r\n  };\r\n  MUSIC.Wave.FunctionWave.prototype = waveOps;\r\n\r\n\r\n  MUSIC.Wave.sine = function() {\r\n    return new MUSIC.Wave.FunctionWave(function(t) {\r\n      return Math.sin(twopi*t);\r\n    });\r\n  };\r\n\r\n  MUSIC.Wave.square = function(options) {\r\n    options = options || {};\r\n    var dutyCycle = options.dutyCycle || 0.5;\r\n    var dutyLevel = options.dutyLevel || 1;\r\n    var offLevel = options.offLevel || -1;\r\n    return new MUSIC.Wave.FunctionWave(function(t) {\r\n      if (t<dutyCycle){\r\n        return dutyLevel\r\n      } else {\r\n        return offLevel;\r\n      }\r\n    });\r\n  };\r\n\r\n  MUSIC.Wave.triangle = function() {\r\n    return new MUSIC.Wave.FunctionWave(function(t) {\r\n      var t2 = t-0.25;\r\n      if (t2<0) t2++;\r\n      if (t2<0.5) {\r\n        return 1-t2*4;\r\n      } else {\r\n        return -1+(t2-0.5)*4;\r\n      }\r\n    });\r\n  };\r\n\r\n  MUSIC.Wave.sawtooth = function() {\r\n    return new MUSIC.Wave.FunctionWave(function(t) {\r\n      return t*2-1;\r\n    });\r\n  };\r\n\r\n})();\r\n\r\n","MUSIC = MUSIC ||{};\r\nMUSIC.Formats = MUSIC.Formats||{};\r\nMUSIC.Formats.CachedSerializer = function(innerSerializer) {\r\n  var lastOutput;\r\n  var lastInput;\r\n  var lastType;\r\n\r\n  return {\r\n    serialize: function(type, input) {\r\n      var jsonCurrentInput;\r\n      if (lastType && lastInput) {\r\n        jsonCurrentInput = JSON.stringify(input)\r\n        if (lastType === type && lastInput === jsonCurrentInput) return lastOutput;\r\n      }\r\n\r\n      lastType = type;\r\n      lastInput = jsonCurrentInput || JSON.stringify(input);\r\n      lastOutput = innerSerializer.serialize(type, input);\r\n      return lastOutput;\r\n    },\r\n\r\n    deserialize: innerSerializer.deserialize.bind(innerSerializer)\r\n  };\r\n};\r\n","MUSIC = MUSIC ||{};\r\nMUSIC.Formats = MUSIC.Formats||{};\r\n\r\n(function() {\r\n\r\nMUSIC.Formats.HuffmanSerializerWrapper = function(innerSerializer) {\r\n  var frequencies = [\r\n    [\",\", 100],\r\n    [\"[]\", 20],\r\n    [\"0123456789\", 10],\r\n    [\"abcdef.-{}\", 4],\r\n    [\"t+-*/()<>=? \", 1]\r\n  ];\r\n\r\n  var times = function(str, n) {\r\n    var ret = \"\";\r\n    for (var i =0;i<n; i++) ret = ret + str;\r\n    return ret;\r\n  };\r\n\r\n  var concat = function(a, b){ return a.concat(b); };\r\n  var text = frequencies.map(function(freq) {\r\n    return times(freq[0], freq[1]);\r\n  }).reduce(concat);\r\n\r\n  text = text + \"!\\\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\"\r\n  var huffman = Huffman.treeFromText(text);\r\n\r\n  var serialize = function(type, obj) {\r\n    var str = innerSerializer.serialize(type, obj);\r\n    return huffman.encode(str);\r\n  };\r\n\r\n  var deserialize = function(type, str) {\r\n    var decoded = huffman.decode(str);\r\n    return innerSerializer.deserialize(type, decoded);\r\n  };\r\n\r\n  return {\r\n    serialize: serialize,\r\n    deserialize: deserialize\r\n  };\r\n};\r\n\r\n\r\n})();\r\n","MUSIC = MUSIC ||{};\r\nMUSIC.Formats = MUSIC.Formats||{};\r\nMUSIC.Formats.JSONSerializer = {};\r\n\r\nMUSIC.Formats.JSONSerializer.serialize = function(type, obj) {\r\n  return JSON.stringify(obj);\r\n};\r\n\r\nMUSIC.Formats.JSONSerializer.deserialize = function(type, str) {\r\n  return JSON.parse(str);\r\n};\r\n","MUSIC = MUSIC ||{};\r\nMUSIC.Formats = MUSIC.Formats||{};\r\nMUSIC.Formats.MultiSerializer = {};\r\n(function() {\r\n\r\nvar serializerArray = [];\r\n\r\nvar match = function(a, b) {\r\n  if (typeof a !== typeof b) return false;\r\n\r\n  if (Array.isArray(a) && !Array.isArray(b)) return false;\r\n  if (Array.isArray(b) && !Array.isArray(a)) return false;\r\n\r\n  if (Array.isArray(a)) {\r\n    if (a.length !== b.length) return false;\r\n    for (var i=0; i<a.length; i++) {\r\n      if (!match(a[i], b[i])) return false;\r\n    }\r\n    return true;\r\n  } else if (typeof a === 'object') {\r\n    return Object.keys(a).every(function(key) {\r\n      return match(a[key], b[key]);\r\n    });\r\n  } else {\r\n    return a === b;\r\n  }\r\n};\r\n\r\nMUSIC.Formats.MultiSerializer.match = match;\r\n\r\nMUSIC.Formats.MultiSerializer.wrapSerializer = function(serializer) {\r\n  return {\r\n    serialize: function(type, obj) {\r\n      try {\r\n        var output = serializer.serialize(type, obj);\r\n        var recoveredInput = serializer.deserialize(type, output);\r\n        return MUSIC.Formats.MultiSerializer.match(obj, recoveredInput) ? output : null;\r\n      }catch(e) {\r\n        return null; // failed serializations are discarded\r\n      }\r\n    },\r\n    deserialize: serializer.deserialize\r\n  };\r\n};\r\n\r\nvar smallest = function(a, b) {\r\n  return a.length < b.length ? a : b;\r\n};\r\n\r\nvar truthy = function(a) { return !!a };\r\n\r\nMUSIC.Formats.MultiSerializer.selector = function(array) {\r\n  array = array.filter(truthy);\r\n  if (array.length) return array.filter(truthy).reduce(smallest);\r\n\r\n  throw new Error(\"serialization not found\");\r\n};\r\n\r\nMUSIC.Formats.MultiSerializer.serialize = function(type, obj) {\r\n  return MUSIC.Formats.MultiSerializer.selector(\r\n    serializerArray.map(function(s) {\r\n      var serialized = s.serializer.serialize(type, obj);\r\n      if (!serialized) return serialized;\r\n      return s.base.concat(serialized);\r\n    })\r\n  );\r\n};\r\n\r\nMUSIC.Formats.MultiSerializer.deserialize = function(type, obj) {\r\n  for (var i=0;i<serializerArray.length;i++) {\r\n    if (obj[0]===serializerArray[i].base) return serializerArray[i].serializer.deserialize(type, obj.slice(1));\r\n  }\r\n\r\n  throw new Error(\"Unsupported format\");\r\n};\r\n\r\nMUSIC.Formats.MultiSerializer.setSerializers = function(array) {\r\n  serializerArray = array.map(function(entry) {\r\n    return {\r\n      serializer: MUSIC.Formats.MultiSerializer.wrapSerializer(entry.serializer),\r\n      base: entry.base\r\n    };\r\n  });\r\n};\r\n\r\n})();\r\n","MUSIC = MUSIC ||{};\r\nMUSIC.Formats = MUSIC.Formats||{};\r\nMUSIC.Formats.PackedJSONSerializer = {};\r\n\r\n(function() {\r\n\r\nvar objToArrayPacker = function(keys) {\r\n  var pack = function(obj) {\r\n    var array = [];\r\n    for (var i=0; i<keys.length; i++) {\r\n      var key = keys[i];\r\n      if (Array.isArray(key)) {\r\n        array.push(key[1].pack(obj[key[0]], obj));\r\n      } else {\r\n        if (obj[key]!==null && obj[key]!==undefined) array.push(obj[key]);\r\n      }\r\n    }\r\n    return array;\r\n  };\r\n\r\n  var unpack = function(array) {\r\n    var obj = {};\r\n    for (var i=0; i<array.length; i++) {\r\n      var key = keys[i];\r\n      if (Array.isArray(key)) {\r\n        obj[key[0]] = key[1].unpack(array[i], obj);\r\n      } else {\r\n        if (array[i]!==null && array[i]!==undefined) obj[key] = array[i];\r\n      }\r\n    }\r\n    return obj;\r\n  };\r\n\r\n  return {pack: pack, unpack: unpack};\r\n};\r\n\r\nvar array = function(innerPacker) {\r\n  var pack = function(obj) {\r\n    return obj.map(innerPacker.pack);\r\n  };\r\n\r\n  var unpack = function(array) {\r\n    return array.map(innerPacker.unpack);\r\n  };\r\n\r\n  return {pack: pack, unpack: unpack};\r\n};\r\n\r\nvar concat = function(a, b){return a.concat(b); };\r\nvar flatten = function(innerPacker, size) {\r\n  var pack = function(obj) {\r\n    var ret = innerPacker.pack(obj);\r\n    return ret.reduce(concat, []);\r\n  };\r\n\r\n  var unpack = function(array) {\r\n    var deflatted = [];\r\n    for (var i=0; i<array.length; i+=size) {\r\n      deflatted.push(array.slice(i,i+size));\r\n    }\r\n    return innerPacker.unpack(deflatted);\r\n  };\r\n\r\n  return {pack: pack, unpack: unpack};\r\n};\r\n\r\nvar patternPacker = objToArrayPacker([\r\n  \"measure\",\r\n  \"measureCount\",\r\n  \"bpm\",\r\n  \"selectedTrack\",\r\n  \"scrollLeft\",\r\n  [\"tracks\", flatten(array(\r\n    objToArrayPacker([\"scroll\",[\"events\", flatten(array(objToArrayPacker([\"n\",\"s\",\"l\"])),3)], \"instrument\"])\r\n  ),3)]\r\n]);\r\n\r\nvar patternIndexPacker = function(inner) {\r\n  var pack = function(obj) {\r\n    var patterns = [];\r\n    var convertBlocks = function(block) {\r\n      if(block.id) {\r\n        if (patterns.indexOf(block.id)===-1) patterns.push(block.id);\r\n        return {id: patterns.indexOf(block.id)+1};\r\n      } else {\r\n        return {id: 0};\r\n      }\r\n    };\r\n\r\n    var convertTrack = function(track) {\r\n      return {\r\n        blocks: track.blocks.map(convertBlocks)\r\n      };\r\n    };\r\n\r\n    var newObject = {\r\n      patterns: patterns,\r\n      measure: obj.measure,\r\n      bpm: obj.bpm,\r\n      tracks: obj.tracks.map(convertTrack)\r\n    };\r\n\r\n    return inner.pack(newObject);\r\n  };\r\n\r\n  var unpack = function(obj) {\r\n    var ret = inner.unpack(obj);\r\n    ret.tracks.forEach(function(track) {\r\n      track.blocks.forEach(function(block) {\r\n        if (block.id === 0) {\r\n          delete block.id;\r\n        } else {\r\n          block.id = ret.patterns[block.id-1];\r\n        }\r\n      });\r\n    });\r\n\r\n    return {\r\n      measure: ret.measure,\r\n      bpm: ret.bpm,\r\n      tracks: ret.tracks\r\n    };\r\n  };\r\n\r\n  return {pack: pack, unpack: unpack};\r\n};\r\n\r\nvar substitution = function(keys) {\r\n  var pack = function(obj) {\r\n    var idx = keys.indexOf(obj);\r\n    if (idx === -1) return obj;\r\n    return idx;\r\n  };\r\n\r\n  var unpack = function(obj) {\r\n    if (isNaN(obj)) return obj;\r\n    return keys[obj];\r\n  };\r\n\r\n  return {pack: pack, unpack: unpack};\r\n};\r\n\r\nvar switchPacker = function(selectAttribute, packers) {\r\n\r\n  var pack = function(obj, parent) {\r\n    var innerPacker = packers[parent[selectAttribute]];\r\n    if (!innerPacker) {\r\n      return obj;\r\n    }\r\n\r\n    return innerPacker.pack(obj);\r\n  };\r\n\r\n  var unpack = function(obj, parent) {\r\n    var innerPacker = packers[parent[selectAttribute]];\r\n    if (!innerPacker) {\r\n      return obj;\r\n    }\r\n\r\n    return innerPacker.unpack(obj);\r\n  };\r\n\r\n  return {pack: pack, unpack: unpack};\r\n};\r\n\r\nvar booleanPacker = {\r\n  pack: function(obj) {\r\n    if (obj === undefined) return 3;\r\n    if (obj === null) return 4;\r\n\r\n    return !!obj ? 1 : 0;\r\n  },\r\n\r\n  unpack: function(obj) {\r\n    if (obj===3) return undefined;\r\n    if (obj===4) return null;\r\n\r\n    return obj === 1 ? true : false\r\n  }\r\n};\r\n\r\nvar nullable = function(innerPacker) {\r\n  var pack = function(obj) {\r\n    if (obj === undefined) return 0;\r\n    if (obj === null) return 1;\r\n\r\n    return innerPacker? innerPacker.pack(obj) : obj;\r\n  };\r\n\r\n  var unpack = function(obj) {\r\n    if (obj===0) return undefined;\r\n    if (obj===1) return null;\r\n\r\n    return innerPacker ? innerPacker.unpack(obj) : obj;\r\n  };\r\n\r\n  return {pack: pack, unpack: unpack};\r\n};\r\n\r\n\r\n\r\nvar songPacker = patternIndexPacker(objToArrayPacker([\r\n  \"patterns\",\r\n  \"measure\",\r\n  \"bpm\",\r\n  [\"tracks\", flatten(array(objToArrayPacker([\r\n    [\"blocks\", flatten(array(objToArrayPacker([\"id\"])),1)]\r\n  ])),1)]\r\n]));\r\n\r\nvar recursiveInstrumentPacker = {\r\n  pack: function(obj) {\r\n    return instrumentPacker.pack(obj);\r\n  },\r\n\r\n  unpack: function(obj) {\r\n    return instrumentPacker.unpack(obj);\r\n  }\r\n};\r\n\r\nvar stackPacker = objToArrayPacker([\r\n  [\"array\", array(recursiveInstrumentPacker)]\r\n]);\r\n\r\nvar envelopePacker = objToArrayPacker([\"attackTime\",\"decayTime\",\"sustainLevel\",\"releaseTime\", [\"reset_on_cut\", booleanPacker]]);\r\nvar oscillatorPacker = objToArrayPacker([\r\n  [\"oscillatorType\", substitution([\"sine\", \"square\", \"sawtooth\", \"triangle\", \"custom\"])],\r\n  [\"fixed_frequency\", booleanPacker],\r\n  [\"frequency\", nullable()],\r\n  [\"waveform\", nullable()],\r\n  [\"serie\", nullable(objToArrayPacker([\"sin\", \"cos\"]))],\r\n  [\"terms\", nullable(objToArrayPacker([\"sin\", \"cos\"]))],\r\n  [\"modulation\", nullable(objToArrayPacker([\r\n    [\"detune\", recursiveInstrumentPacker]\r\n  ]))],\r\n  \"time_constant\"\r\n]);\r\n\r\nvar frequencyFilterPacker = objToArrayPacker([\r\n  \"frequency\",\r\n  \"detune\",\r\n  \"Q\",\r\n  [\"modulation\", objToArrayPacker([\r\n    [\"frequency\", recursiveInstrumentPacker],\r\n    [\"detune\", recursiveInstrumentPacker],\r\n    [\"Q\", recursiveInstrumentPacker]\r\n  ])]\r\n]);\r\n\r\nvar noParametersPacker = objToArrayPacker([]);\r\n\r\nvar multiInstrumentPacker = objToArrayPacker([\r\n  [\"subobjects\", flatten(array(recursiveInstrumentPacker), 2)]\r\n]);\r\n\r\nvar typeNames = [\"script\",\"null\",\"oscillator\",\"notesplit\",\"rise\",\"adsr\",\r\n\"envelope\",\"transpose\",\"scale\",\"gain\",\"echo\",\"lowpass\",\r\n\"highpass\",\"bandpass\",\"lowshelf\",\"highshelf\",\"peaking\",\r\n\"notch\",\"allpass\",\"reverb\",\"noise\",\"pink_noise\",\"red_noise\",\r\n\"arpeggiator\",\"stack\", \"multi_instrument\", \"monophoner\", \"polyphoner\"];\r\n\r\nvar monophonerPacker = objToArrayPacker([\r\n  [\"force_note_cut\", booleanPacker]\r\n]);\r\nvar polyphonerPacker = objToArrayPacker([\"maxChannels\"]);\r\n\r\nvar instrumentPacker = objToArrayPacker([\r\n  [\"type\", substitution(typeNames)],\r\n  [\"data\", switchPacker('type', {\r\n      script: objToArrayPacker([\"code\"]),\r\n      'null': noParametersPacker,\r\n      oscillator: oscillatorPacker,\r\n      notesplit: objToArrayPacker([\"delay\"]),\r\n      rise: objToArrayPacker([\"time\", \"target\"]),\r\n      adsr: envelopePacker,\r\n      envelope: envelopePacker,\r\n      transpose: objToArrayPacker([\"amount\"]),\r\n      scale: objToArrayPacker([\"base\", \"top\"]),\r\n      gain: objToArrayPacker([\"gain\"]),\r\n      echo: objToArrayPacker([\"gain\", \"delay\"]),\r\n      lowpass: frequencyFilterPacker,\r\n      highpass: frequencyFilterPacker,\r\n      bandpass: frequencyFilterPacker,\r\n      lowshelf: frequencyFilterPacker,\r\n      highshelf: frequencyFilterPacker,\r\n      peaking: frequencyFilterPacker,\r\n      notch: frequencyFilterPacker,\r\n      allpass: frequencyFilterPacker,\r\n      reverb: objToArrayPacker([\"room\", \"damp\", \"mix\"]),\r\n      noise: noParametersPacker,\r\n      pink_noise: noParametersPacker,\r\n      red_noise: noParametersPacker,\r\n      arpeggiator: objToArrayPacker([\"scale\", \"interval\", \"duration\", \"gap\"]),\r\n      stack: stackPacker,\r\n      multi_instrument: multiInstrumentPacker,\r\n      monophoner: monophonerPacker,\r\n      polyphoner: polyphonerPacker\r\n    }\r\n  )],\r\n]);\r\n\r\nvar packer = {\r\n  pattern: patternPacker,\r\n  song: songPacker,\r\n  instrument: instrumentPacker\r\n};\r\n\r\nMUSIC.Formats.PackedJSONSerializer.serialize = function(type, obj) {\r\n  if (packer[type]) {\r\n    var str = JSON.stringify(packer[type].pack(obj));\r\n    str = str.slice(1, str.length-1);\r\n    return str\r\n  }\r\n\r\n  return JSON.stringify(obj);\r\n};\r\n\r\nMUSIC.Formats.PackedJSONSerializer.deserialize = function(type, str) {\r\n  if (packer[type]) {\r\n    return packer[type].unpack(JSON.parse('['+str+']'));\r\n  }\r\n\r\n  return JSON.parse(str);\r\n};\r\n\r\n})();\r\n","MUSIC = MUSIC ||{};\r\nMUSIC.Formats = MUSIC.Formats||{};\r\nMUSIC.Formats.PackedJSONSerializerB = {};\r\n\r\n(function() {\r\n\r\nvar objToArrayPacker = function(keys) {\r\n  var pack = function(obj) {\r\n    var array = [];\r\n    for (var i=0; i<keys.length; i++) {\r\n      var key = keys[i];\r\n      if (Array.isArray(key)) {\r\n        array.push(key[1].pack(obj[key[0]], obj));\r\n      } else {\r\n        if (obj[key]!==null && obj[key]!==undefined) array.push(obj[key]);\r\n      }\r\n    }\r\n    return array;\r\n  };\r\n\r\n  var unpack = function(array) {\r\n    var obj = {};\r\n    for (var i=0; i<array.length; i++) {\r\n      var key = keys[i];\r\n      if (Array.isArray(key)) {\r\n        obj[key[0]] = key[1].unpack(array[i], obj);\r\n      } else {\r\n        if (array[i]!==null && array[i]!==undefined) obj[key] = array[i];\r\n      }\r\n    }\r\n    return obj;\r\n  };\r\n\r\n  return {pack: pack, unpack: unpack};\r\n};\r\n\r\nvar array = function(innerPacker) {\r\n  var pack = function(obj) {\r\n    return obj.map(innerPacker.pack);\r\n  };\r\n\r\n  var unpack = function(array) {\r\n    return array.map(innerPacker.unpack);\r\n  };\r\n\r\n  return {pack: pack, unpack: unpack};\r\n};\r\n\r\nvar concat = function(a, b){return a.concat(b); };\r\nvar flatten = function(innerPacker, size) {\r\n  var pack = function(obj) {\r\n    var ret = innerPacker.pack(obj);\r\n    return ret.reduce(concat, []);\r\n  };\r\n\r\n  var unpack = function(array) {\r\n    var deflatted = [];\r\n    for (var i=0; i<array.length; i+=size) {\r\n      deflatted.push(array.slice(i,i+size));\r\n    }\r\n    return innerPacker.unpack(deflatted);\r\n  };\r\n\r\n  return {pack: pack, unpack: unpack};\r\n};\r\n\r\nvar booleanPacker = {\r\n  pack: function(obj) {\r\n    if (obj === undefined) return 3;\r\n    if (obj === null) return 4;\r\n\r\n    return !!obj ? 1 : 0;\r\n  },\r\n\r\n  unpack: function(obj) {\r\n    if (obj===3) return undefined;\r\n    if (obj===4) return null;\r\n\r\n    return obj === 1 ? true : false\r\n  }\r\n};\r\n\r\nvar patternEventPacker = {\r\n  pack: function(obj) {\r\n    var firstElement = obj.n;\r\n    for (var k in obj) {\r\n      if (k!=='n' && k!=='s' && k !== 'l') {\r\n        if (firstElement === obj.n) {\r\n          firstElement = {n: obj.n};\r\n        }\r\n        firstElement[k] = obj[k];\r\n      }\r\n    };\r\n\r\n    return [firstElement, obj.s, obj.l];\r\n  },\r\n  unpack: function(array) {\r\n    var firstElement = array[0];\r\n    if (typeof firstElement === 'number') {\r\n      return {\r\n        n: array[0],\r\n        s: array[1],\r\n        l: array[2]\r\n      };\r\n    } else {\r\n      var ret = {};\r\n      for (var k in firstElement) {\r\n        ret[k] = firstElement[k];\r\n      }\r\n      ret.s = array[1];\r\n      ret.l = array[2];\r\n      return ret;\r\n    }\r\n  }\r\n};\r\n\r\nvar patternPacker = objToArrayPacker([\r\n  \"measure\",\r\n  \"measureCount\",\r\n  \"bpm\",\r\n  \"selectedTrack\",\r\n  \"scrollLeft\",\r\n  [\"tracks\", array(\r\n    objToArrayPacker([[\"muted\", booleanPacker], [\"solo\", booleanPacker], \"scroll\",[\"events\", flatten(array(patternEventPacker),3)], \"instrument\"])\r\n  )]\r\n]);\r\n\r\nvar patternIndexPacker = function(inner) {\r\n  var pack = function(obj) {\r\n    var patterns = [];\r\n    var convertBlocks = function(block) {\r\n      if(block.id) {\r\n        if (patterns.indexOf(block.id)===-1) patterns.push(block.id);\r\n        return {id: patterns.indexOf(block.id)+1};\r\n      } else {\r\n        return {id: 0};\r\n      }\r\n    };\r\n\r\n    var convertTrack = function(track) {\r\n      return {\r\n        blocks: track.blocks.map(convertBlocks)\r\n      };\r\n    };\r\n\r\n    var newObject = {\r\n      patterns: patterns,\r\n      measure: obj.measure,\r\n      bpm: obj.bpm,\r\n      tracks: obj.tracks.map(convertTrack)\r\n    };\r\n\r\n    return inner.pack(newObject);\r\n  };\r\n\r\n  var unpack = function(obj) {\r\n    var ret = inner.unpack(obj);\r\n    ret.tracks.forEach(function(track) {\r\n      track.blocks.forEach(function(block) {\r\n        if (block.id === 0) {\r\n          delete block.id;\r\n        } else {\r\n          block.id = ret.patterns[block.id-1];\r\n        }\r\n      });\r\n    });\r\n\r\n    return {\r\n      measure: ret.measure,\r\n      bpm: ret.bpm,\r\n      tracks: ret.tracks\r\n    };\r\n  };\r\n\r\n  return {pack: pack, unpack: unpack};\r\n};\r\n\r\nvar substitution = function(keys) {\r\n  var pack = function(obj) {\r\n    var idx = keys.indexOf(obj);\r\n    if (idx === -1) return obj;\r\n    return idx;\r\n  };\r\n\r\n  var unpack = function(obj) {\r\n    if (isNaN(obj)) return obj;\r\n    return keys[obj];\r\n  };\r\n\r\n  return {pack: pack, unpack: unpack};\r\n};\r\n\r\nvar switchPacker = function(selectAttribute, packers) {\r\n\r\n  var pack = function(obj, parent) {\r\n    var innerPacker = packers[parent[selectAttribute]];\r\n    if (!innerPacker) {\r\n      return obj;\r\n    }\r\n\r\n    return innerPacker.pack(obj);\r\n  };\r\n\r\n  var unpack = function(obj, parent) {\r\n    var innerPacker = packers[parent[selectAttribute]];\r\n    if (!innerPacker) {\r\n      return obj;\r\n    }\r\n\r\n    return innerPacker.unpack(obj);\r\n  };\r\n\r\n  return {pack: pack, unpack: unpack};\r\n};\r\n\r\nvar nullable = function(innerPacker) {\r\n  var pack = function(obj) {\r\n    if (obj === undefined) return 0;\r\n    if (obj === null) return 1;\r\n\r\n    return innerPacker? innerPacker.pack(obj) : obj;\r\n  };\r\n\r\n  var unpack = function(obj) {\r\n    if (obj===0) return undefined;\r\n    if (obj===1) return null;\r\n\r\n    return innerPacker ? innerPacker.unpack(obj) : obj;\r\n  };\r\n\r\n  return {pack: pack, unpack: unpack};\r\n};\r\n\r\n\r\n\r\nvar songPacker = patternIndexPacker(objToArrayPacker([\r\n  \"patterns\",\r\n  \"measure\",\r\n  \"bpm\",\r\n  [\"tracks\", flatten(array(objToArrayPacker([\r\n    [\"blocks\", flatten(array(objToArrayPacker([\"id\"])),1)]\r\n  ])),1)]\r\n]));\r\n\r\nvar recursiveInstrumentPacker = {\r\n  pack: function(obj) {\r\n    return instrumentPacker.pack(obj);\r\n  },\r\n\r\n  unpack: function(obj) {\r\n    return instrumentPacker.unpack(obj);\r\n  }\r\n};\r\n\r\nvar stackPacker = objToArrayPacker([\r\n  [\"array\", array(recursiveInstrumentPacker)]\r\n]);\r\n\r\nvar envelopePacker = objToArrayPacker([\"attackTime\",\"decayTime\",\"sustainLevel\",\"releaseTime\", [\"reset_on_cut\", booleanPacker]]);\r\nvar oscillatorPacker = objToArrayPacker([\r\n  [\"oscillatorType\", substitution([\"sine\", \"square\", \"sawtooth\", \"triangle\", \"custom\"])],\r\n  [\"fixed_frequency\", booleanPacker],\r\n  [\"frequency\", nullable()],\r\n  [\"waveform\", nullable()],\r\n  [\"serie\", nullable(objToArrayPacker([\"sin\", \"cos\"]))],\r\n  [\"terms\", nullable(objToArrayPacker([\"sin\", \"cos\"]))],\r\n  [\"modulation\", nullable(objToArrayPacker([\r\n    [\"detune\", recursiveInstrumentPacker],\r\n    [\"pulse_width\", nullable(recursiveInstrumentPacker)]\r\n  ]))],\r\n  \"time_constant\",\r\n  \"pulse_width\"\r\n]);\r\n\r\nvar frequencyFilterPacker = objToArrayPacker([\r\n  \"frequency\",\r\n  \"detune\",\r\n  \"Q\",\r\n  [\"modulation\", objToArrayPacker([\r\n    [\"frequency\", recursiveInstrumentPacker],\r\n    [\"detune\", recursiveInstrumentPacker],\r\n    [\"Q\", recursiveInstrumentPacker]\r\n  ])]\r\n]);\r\n\r\nvar noParametersPacker = objToArrayPacker([]);\r\n\r\nvar multiInstrumentPacker = objToArrayPacker([\r\n  [\"subobjects\", flatten(array(recursiveInstrumentPacker), 2)]\r\n]);\r\n\r\nvar typeNames = [\"script\",\"null\",\"oscillator\",\"notesplit\",\"rise\",\"adsr\",\r\n\"envelope\",\"transpose\",\"scale\",\"gain\",\"echo\",\"lowpass\",\r\n\"highpass\",\"bandpass\",\"lowshelf\",\"highshelf\",\"peaking\",\r\n\"notch\",\"allpass\",\"reverb\",\"noise\",\"pink_noise\",\"red_noise\",\r\n\"arpeggiator\",\"stack\", \"multi_instrument\", \"monophoner\", \"polyphoner\", \"note_padding\",\r\n\"note_condition\", \"signal_monitor\", \"signal_constant\", \"note_delay\",\r\n\"sample_rate_reduction\", \"bit_crushing\",\r\n\"signal_scale\", \"signal_not\",\r\n\"signal_or\", \"signal_and\", \"signal_nor\", \"signal_nand\", \"delay\", \"note_frequency_generator\",\r\n\"note_time_shift\", \"wave_shaper\"];\r\n\r\nvar monophonerPacker = objToArrayPacker([\r\n  [\"force_note_cut\", booleanPacker]\r\n]);\r\nvar polyphonerPacker = objToArrayPacker([\"maxChannels\"]);\r\nvar notePaddingPacker = objToArrayPacker([\"time\"]);\r\n\r\nvar toModl = function(value) {\r\n  return [value, recursiveInstrumentPacker];\r\n};\r\n\r\nvar modl = function(values) {\r\n  return nullable(objToArrayPacker(values.map(toModl)));\r\n};\r\n\r\nvar instrumentPacker = objToArrayPacker([\r\n  [\"type\", substitution(typeNames)],\r\n  [\"data\", switchPacker('type', {\r\n      script: objToArrayPacker([\"code\"]),\r\n      'null': noParametersPacker,\r\n      oscillator: oscillatorPacker,\r\n      notesplit: objToArrayPacker([\"delay\"]),\r\n      rise: objToArrayPacker([\"time\", \"target\"]),\r\n      adsr: envelopePacker,\r\n      envelope: envelopePacker,\r\n      transpose: objToArrayPacker([\"amount\"]),\r\n      scale: objToArrayPacker([\"base\", \"top\"]),\r\n      gain: objToArrayPacker([\"gain\", [\"modulation\", modl([\"gain\"])]]),\r\n      echo: objToArrayPacker([\"gain\", \"delay\"]),\r\n      lowpass: frequencyFilterPacker,\r\n      highpass: frequencyFilterPacker,\r\n      bandpass: frequencyFilterPacker,\r\n      lowshelf: frequencyFilterPacker,\r\n      highshelf: frequencyFilterPacker,\r\n      peaking: frequencyFilterPacker,\r\n      notch: frequencyFilterPacker,\r\n      allpass: frequencyFilterPacker,\r\n      reverb: objToArrayPacker([\"room\", \"damp\", \"mix\"]),\r\n      noise: noParametersPacker,\r\n      pink_noise: noParametersPacker,\r\n      red_noise: noParametersPacker,\r\n      arpeggiator: objToArrayPacker([\"scale\", \"interval\", \"duration\", \"gap\"]),\r\n      stack: stackPacker,\r\n      multi_instrument: multiInstrumentPacker,\r\n      monophoner: monophonerPacker,\r\n      polyphoner: polyphonerPacker,\r\n      note_padding: notePaddingPacker,\r\n      note_condition: objToArrayPacker([\"note_on\", \"note_off\",\"enter_time_constant\", \"leave_time_constant\"]),\r\n      signal_monitor: noParametersPacker,\r\n      signal_constant: objToArrayPacker([\"offset\"]),\r\n      note_delay: objToArrayPacker([\"delay\"]),\r\n      delay: objToArrayPacker([\"delay\", [\"modulation\", modl([\"delay\"])]]),\r\n      sample_rate_reduction: objToArrayPacker([\"factor\"]),\r\n      bit_crushing: objToArrayPacker([\"bits\"]),\r\n      signal_scale: objToArrayPacker([\"base\", \"top\"]),\r\n      signal_not: noParametersPacker,\r\n      signal_or: objToArrayPacker([\"second_signal\", [\"modulation\", modl([\"second_signal\"])]]),\r\n      signal_and: objToArrayPacker([\"second_signal\", [\"modulation\", modl([\"second_signal\"])]]),\r\n      signal_nor: objToArrayPacker([\"second_signal\", [\"modulation\", modl([\"second_signal\"])]]),\r\n      signal_nand: objToArrayPacker([\"second_signal\", [\"modulation\", modl([\"second_signal\"])]]),\r\n      note_frequency_generator: objToArrayPacker([\"time_constant\"]),\r\n      note_time_shift: objToArrayPacker([\"time\"]),\r\n      wave_shaper: objToArrayPacker([\"samples\", \"f\"])\r\n    }\r\n  )],\r\n]);\r\n\r\nvar packer = {\r\n  pattern: patternPacker,\r\n  song: songPacker,\r\n  instrument: instrumentPacker\r\n};\r\n\r\nMUSIC.Formats.PackedJSONSerializerB.serialize = function(type, obj) {\r\n  if (packer[type]) {\r\n    var str = JSON.stringify(packer[type].pack(obj));\r\n    str = str.slice(1, str.length-1);\r\n    return str\r\n  }\r\n\r\n  return JSON.stringify(obj);\r\n};\r\n\r\nMUSIC.Formats.PackedJSONSerializerB.deserialize = function(type, str) {\r\n  if (packer[type]) {\r\n    return packer[type].unpack(JSON.parse('['+str+']'));\r\n  }\r\n\r\n  return JSON.parse(str);\r\n};\r\n\r\n})();\r\n"],"sourceRoot":"src"}