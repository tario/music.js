{"version":3,"sources":["app.js","en.js","es.js","langSettings.js","routes.js","directives.js","functionGraph.js","keyboard.js","musicEventEditor.js","ngfDrop.js","ngfLoader.js","patternTrackCompactView.js","playingLine.js","recipeBlink.js","recipeTooltip.js","recipeWizard.js","recycleBinCompactView.js","typeIcon.js","services.js","errMessage.js","export.js","index.js","midi.js","recipe.js","sync.js","translationsLoader.js","typeService.js","welcomeMessage.js","_localforage.js","controllers.js","errorModalCtrl.js","infoModalController.js","midiSettingsModalCtrl.js","openProjectModalCtrl.js","projectSettingsModalCtrl.js","recycleBinModalCtrl.js","welcomeModalCtrl.js"],"names":["musicShowCaseApp","angular","module","constant","MUSIC","localforage","enTranslations","midi","settings","inputs","connected","disconnected","events","octave","transpose","open_project","p1","title","array_editor","tooltip","remove_item","add_item","edit_item","index","not_implemented","filter","type","instrument","pattern","song","fx","type_p1","type_p2","project","basic_info","references","menu","new_instrument","new_pattern","new_song","new_project","file_import","tools","tools_preferences","help_view_help","help_recipes","help_recipes_intro","help_recipes_howto_create_song","help_recipes_howto_create_instrument","help_contextual_help","help_welcome","help_about","recycle_bin","preferences","help","project_settings","project_remove_project","project_export_project","contextual_help","enable","disable","recycle","p2","p3","compact_title","compact_hint_restore","compact_hint_open","EMPTY","welcome","nevershow","about","authors","i_am","credit","mohayonao","higuma","kristopolous","contribute","contact_me","common","yes","no","ok","dismiss","cancel","create","open","name","language","loader_error","cantremove_error","cantremove_project_error","error_title","HELP","more","remove","reset","play","pause","stop","record","bpm","bpm_lc","add","playing_speed","modulation","FLOW","RECIPES","p4","p5","p6","p7","p8","recipes","CONTEXTUAL_HELP","stack","drop_elements_here","you_can_drop_new_effects_here","up","down","expand","editor","keyboard_instructions","test_instrument_here","type_here_instrument","track_muted","track_solo","measure_beats","amount_beats","measure_count","zoom_level","total_measures","tracks","drop_instrument","change_name","remove_track","compact_view_p1","compact_view_p2","drop_zone","editor_notes_p1","editor_notes_p2","editor_notes_p3","editor_notes_p4","add_track","note_event_p1","note_event_p2","note_event_p3","muted","solo","instrument_edit","drop_pattern","download","remove_block","edit_block","BUTTON_LANG_EN","BUTTON_LANG_ES","esTranslations","config","$translateProvider","getBrowserLanguage","resolveClientLocale","langCode","split","translations","preferredLanguage","fallbackLanguage","useSanitizeValueStrategy","useLoader","$routeProvider","$locationProvider","when","templateUrl","controller","directive","$timeout","$http","TypeService","Recipe","MusicObjectFactory","scope","file","link","element","attrs","types","getTypes","output","parameters","recipe","start","termschanged","$broadcast","f_t","str","state","ret","eval","error","e","toString","oscTermsUpdateFromWaveForm","fn","debounce","waveform","terms","resolution","count","values","Array","i","isNaN","ft","DFT","length","forward","cos","real","sin","imag","f","t","a","b","Math","PI","maxvalue","value","invalidWaveform","err","oscTermsUpdate","serie","errVar","n","range","init","end","x","push","truthy","updateObject","newValue","changed","outputObserver","$on","destroy","updateTemplate","observeOutput","then","selectedType","getType","k","_default","data","map","parameter","components","modulations","component","array","changeType","$watch","forEach","$emit","subobjects","maxElements","maxelements","parseInt","Infinity","currentTab","addObject","newObject","setCurrentTab","idx","removeObject","object","o","initFile","dropzoneExtraName","swap","idx1","idx2","tmp","defaultStackAppend","concat","onDropComplete","event","stackAppend","oldCollection","newFile","template","termsChanged","scale","semitoneToNote","noteToSemitone","notation7","newVal","Utils","Scale","deltas","initTone","notes","d","semitone","tone","alt","$parse","restrict","scrollVarGetter","ngScrollTop","scrollVarSetter","assign","$","scrollTop","on","ngScrollLeft","scrollLeft","replace","t0","parseFloat","tf","samples","scaley","$parent","_f","redraw","canvas","context","getContext","width","clientWidth","height","clientHeight","drawLine","x0","y0","x1","y1","color","save","beginPath","moveTo","lineTo","strokeStyle","lineWidth","stroke","restore","drawFunc","translate","lineJoin","$uibModal","Midi","MusicContext","onMIDIMessage","command","velocity","octaveNumber","floor","oct","octaves","update","listener","registerEventListener","updateMidiStatus","getStatus","midiConnected","keyCodeToNote","stopAll","midiSetup","modalIns","result","base","mouse","key","note","undefined","gesture","resumeAudio","mouseOff","mouseLeave","mouseEnter","keyDownHandler","document","activeElement","tagName","toLowerCase","keyCode","noteName","noteToNoteNum","$digest","keyUpHandler","bind","pianoFirstRow","find","pianoSecondRow","unbind","TICKS_PER_BEAT","Pattern","track","zoomLevel","beatWidth","measure","measureCount","defaultL","clearShadow","shadowEvt","defaultMouseLeave","defaultMouseMove","clipDistance","target","classList","contains","upperLimit","offsetY","l","s","exactPosition","offsetX","clipS","findClipS","abs","cutEvent","raiseEventChanged","oldevt","evt","note7","isArray","updateGrid","mainGridStyle","addNewEvent","newEvt","copy","collision","selected","raise","mouseMove","moveEvent","mouseMoveEvent","moveEventFromEvent","cancelMove","mouseUpResizeEvent","mouseUpEvent","mouseUp","mouseMoveResizeEvent","shadowMouseMove","deltaS","addFromShadow","max","c1","c2","preventCollision","savedEvt","apply","arguments","oldN","dragevt","mouseDown","eventSplit","ticks","originalL","eventLeftSplit","eventCenterSplit","eventRightSplit","mouseDblClickEvent","elementWidth","mouseDownEvent","preventDefault","blur","_cancelMove","mouseDownResizeEvent","clipL","findClipL","exactL","refs","ngfDropGetter","ngfDrop","allowDrag","dataTransfer","dropEffect","onDrop","files","window","addEventListener","removeEventListener","ngfLoaderGetter","ngfLoader","onChange","val","off","moved","parentElement","timeToTicks","playing","getBpm","getZoomLevel","getBeatWidth","ticksToPX","callback","performance","now","displacement","css","requestAnimationFrame","playingLine","requestId","_timeToTicks","_t0","baseTicks","cancelAnimationFrame","recipeBlinkGetter","recipeBlink","blinkElementId","blink","addClass","noblink","removeClass","registerEvent","getBlinks","indexOf","args","rtIdGetter","rtId","tooltipElementId","tooltipEnabled","onClick","stopImmediatePropagation","windowWidth","documentElement","innerWidth","el","offset","getBoundingClientRect","left","capRight","text","FileRepository","ErrMessage","observer","observeRecycled","searchRecycled","limit","results","slice","openRecycleBin","restoreFromRecycleBin","id","location","moveToRecycleBin","catch","iconTypeName","typeIcon","factory","$q","pruneWrapper","fileOutputMap","WeakMap","options","nextId","_last_type","___cache","monitor","getConstructor","descriptor","channel","wrapped","music","buildComponents","componentName","createParametric","obj","all","objs","last_type","__cache","set","constructor","has","get","noid","createParametricFromStack","getObject","newArray","dataLink","notifyChangeFor","ee","emit","destroyAll","bases","prune","fcn","sfxBase","runFcn","EventEmitter","removeListener","service","Recordable","playable","_playable","_music","_name","prototype","recording","recordFileName","FunctionSeq","preciseTimeout","exportWAV","blob","createElement","body","appendChild","style","url","URL","createObjectURL","href","click","revokeObjectURL","duration","Context","resume","run","code","currentVersion","undo","redo","registerVersion","schedule","noteseq","eventPreprocessor","onStop","ctx","sort","e1","e2","scaledEvents","tc","paddingTo","pushCallback","totalBeats","NoteSequence","patternCompose","instruments","isTempoTrack","tempo","getEvents","byStart","songCtx","time","ticksToTime","ticks_per_beat","bpm_events","reduce","makePlayable","noteSequence","contexts","higher","computeMeasureCount","endTime","measureLength","getMutedState","someSolo","some","_not","self","nearest","allEvents","allOtherEvents","tr","clips","measureTicks","musicObjectFactory","trackControl","created","load","trackNo","_id","gain","getFile","contents","dispose","mute","muteState","Historial","Index","createdFilesIndex","createdFiles","builtIns","loadBuiltIn","uri","r","objectId","ref","builtIn","createDefault","content","noExportable","builtInLoaded","createId","random","join","genericStateEmmiter","recycledEmmiter","defaultFile","blocks","selectedTrack","scroll","hist","updateFile","localFile","storageIndex","getEntry","serialized","Formats","MultiSerializer","serialize","noHistory","JSON","stringify","setItem","recycleIndex","reload","destroyFile","removeItem","removeEntry","purgeFromRecycleBin","_restoreFromRecycleBin","createEntry","_moveToRecycleBin","getId","isProjectType","willRemove","getAll","getFreeItems","getOrphan","orphanFiles","console","getPatternSongs","byProject","byType","typeSong","loadFile","storage","builtin","fileIndexes","mode","maxcount","_m","getDefaultMeasure","getDefaultBPM","getItem","deserialize","getRefs","updated","parse","createFile","newid","defaultMeasure","defaultBPM","s0","JSONSerializer","s1","CachedSerializer","PackedJSONSerializer","s2","HuffmanSerializerWrapper","s3","s4","PackedJSONSerializerB","s5","setSerializers","serializer","blockId","getProjectFiles","projectId","oldVer","nextVer","updateIndex","attributes","updateEntry","getIndex","addListener","keyword","hasKeyword","filtered","reverse","total","search","updateSearch","notInRes","item","res","ids","convertType","observe","cb","close","_wrapper","modWrapper","originalDispose","_lastmusic","_lastinstance","nowrap","$translate","windowClass","resolve","exportContents","Blob","getRelatedIds","y","getFileWithRelated","relarray","rel","uniq","Object","keys","exportProject","exportFile","importFile","importItem","p","parsed","firstItem","Sync","CantRemove","Error","IndexFactory","indexName","entryChange","clearItem","c","sync","isolatedContext","ic","entry","extraIds","extraProjectIds","projectIds","isOrphan","referenced","musicJs","setupStore","midiSetupRequested","midiLoaded","storeInputEnabled","inputId","enabled","midiAccessRequested","navigator","requestMIDIAccess","sysex","wrapInput","input","onmidimessage","midiAccess","next","done","getInputs","retInputs","eventListeners","cfg","reloadConfig","getConfig","setConfig","$rootScope","recipeList","blinks","currentRecipe","steps","currentStep","handleEvent","step","eventHandler","runRecipeStep","blink_id","tooltip_id","next_step_on","eventName","delay","ms","getLocaleName","stepIndex","tooltipName","loadEventHandler","eventHandlerData","inner","loadStep","stepData","createFiles","switchProject","recipeData","Date","loadTranslations","loadRecipeTranslation","lang","langIndex","tp","localeName","actions","recipeId","recipeTranslationData","promise","_args","_self","defer","reject","baseTranslation","addTranslations","typeTranslations","recipeTranslations","ObjectCache","wm","strobj","elem","make_mutable","cacheData","cacheWrap","baseMusic","originalPrune","params","getOriginal","current","instances","reusableNode","newBase","lastCurrent","proxy","newr","lastObjData","newobject","_components","instance","plugins","translation","m","pluginName","translateData","typeName","composition","description","loadPlugin","runnerCode","export","pluginsLoaded","skip","setSkip","releaseWithIndex","bytes","nextEntry","shift","release","newIndex","isretry","instrumentId","instrumentMap","block","indexMap","$scope","$uibModalInstance","numChannels","encoding","$routeParams","InstrumentSet","Export","SONG_MAX_TRACKS","instSet","playingStartOffset","pxToTicks","px","seek","currentRec","replay","patternEdit","exportItem","fileIndex","reloadFromRepo","checkPayload","fileChanged","encodingOptions","patterns","createPattern","songTrackIdx","changedBpm","Song","indexChanged","maxblocks","maxTrackIndex","trackIndex","mCount","payload","$data","$event","fromBlock","swapId","block_ids","outputFile","ctrlKey","instrumentEdit","mutedState","updateMuted","removeTrack","trackIdx","addTrack","zoomIn","zoomOut","beep","lastPlaying","setTimeout","trackMuted","updateInstrument","musicObject","playButton","lastObj","playables","stopPlay","lazyLoadInstrument","callStop","callPlay","instrumentPromise","innerInstrument","innerNote","inst","instrumentExtend","stopDelay","createInstrumentFromFile","oldFile","notify","resetStack","startPlay","WelcomeMessage","pFilter","projectFilter","currentObserver","filesTotal","fileInputClick","fileImport","readTextFile","fileReader","FileReader","onload","onerror","readAsText","nextLocation","json","first","changeLanguage","langKey","use","currentLanguage","langLoaded","dontshowagain","activate","example","keywordUpdated","searchKeyword","removeProject","projectSettings","buttonText","newProject","projectName","openProject","moreImportant","file1","file2","better","newInstrument","newSong","newPattern","todo","updateConfig","immediateUpdateSearch","select","skipUpdated","updateSkip","tutorial"],"mappings":";;AAAA,IAAIA,gBAAgB,GAAGC,OAAO,CAACC,MAAR,CAAe,kBAAf,EAAmC,CAAC,eAAD,EAAkB,SAAlB,EAA6B,cAA7B,EAA6C,aAA7C,EAA4D,WAA5D,EAAyE,wBAAzE,CAAnC,CAAvB;AAEAF,gBAAgB,CAACG,QAAjB,CAA0B,OAA1B,EAAmCC,KAAnC;AACAJ,gBAAgB,CAACG,QAAjB,CAA0B,gBAA1B,EAA4C,EAA5C;AACAH,gBAAgB,CAACG,QAAjB,CAA0B,iBAA1B,EAA6C,EAA7C;AACAH,gBAAgB,CAACG,QAAjB,CAA0B,aAA1B,EAAyCE,WAAzC;;;ACLA,IAAIL,gBAAgB,GAAGC,OAAO,CAACC,MAAR,CAAe,kBAAf,CAAvB;AACA,IAAII,cAAc,GAAG;AACnBC,EAAAA,IAAI,EAAE;AACJC,IAAAA,QAAQ,EAAE,eADN;AAEJC,IAAAA,MAAM,EAAE,QAFJ;AAGJC,IAAAA,SAAS,EAAE,sBAHP;AAIJC,IAAAA,YAAY,EAAE,0CAJV;AAKJC,IAAAA,MAAM,EAAE,QALJ;AAMJC,IAAAA,MAAM,EAAE,aANJ;AAOJC,IAAAA,SAAS,EAAE;AAPP,GADa;AAUnBC,EAAAA,YAAY,EAAE;AACZC,IAAAA,EAAE,EAAE,qCADQ;AAEZC,IAAAA,KAAK,EAAE;AAFK,GAVK;AAcnBC,EAAAA,YAAY,EAAE;AACZC,IAAAA,OAAO,EAAE;AACPC,MAAAA,WAAW,EAAE,+BADN;AAEPC,MAAAA,QAAQ,EAAE,oCAFH;AAGPC,MAAAA,SAAS,EAAE;AAHJ;AADG,GAdK;AAqBnBC,EAAAA,KAAK,EAAE;AACLC,IAAAA,eAAe,EAAE,+BADZ;AAELC,IAAAA,MAAM,EAAE,sCAFH;AAGLN,IAAAA,OAAO,EAAE;AACPO,MAAAA,IAAI,EAAE;AACJC,QAAAA,UAAU,EAAE,8CADR;AAEJC,QAAAA,OAAO,EAAE,2CAFL;AAGJC,QAAAA,IAAI,EAAE,wCAHF;AAIJC,QAAAA,EAAE,EAAE;AAJA,OADC;AAOPC,MAAAA,OAAO,EAAE,0EAPF;AAQPC,MAAAA,OAAO,EAAE,kDARF;AASPT,MAAAA,KAAK,EAAE;AATA;AAHJ,GArBY;AAoCnBU,EAAAA,OAAO,EAAE;AACPC,IAAAA,UAAU,EAAE,YADL;AAEPC,IAAAA,UAAU,EAAE,YAFL;AAGP3B,IAAAA,QAAQ,EAAE,kBAHH;AAIP,WAAO;AAJA,GApCU;AA0CnB4B,EAAAA,IAAI,EAAE;AACJ,WAAO,MADH;AAEJC,IAAAA,cAAc,EAAE,gBAFZ;AAGJC,IAAAA,WAAW,EAAE,aAHT;AAIJC,IAAAA,QAAQ,EAAE,UAJN;AAKJC,IAAAA,WAAW,EAAE,gBALT;AAMJzB,IAAAA,YAAY,EAAE,iBANV;AAOJ0B,IAAAA,WAAW,EAAE,WAPT;AAQJC,IAAAA,KAAK,EAAE,OARH;AASJC,IAAAA,iBAAiB,EAAE,aATf;AAUJC,IAAAA,cAAc,EAAE,WAVZ;AAWJC,IAAAA,YAAY,EAAE,SAXV;AAYJC,IAAAA,kBAAkB,EAAE,kBAZhB;AAaJC,IAAAA,8BAA8B,EAAE,sBAb5B;AAcJC,IAAAA,oCAAoC,EAAE,sDAdlC;AAeJC,IAAAA,oBAAoB,EAAE,iBAflB;AAgBJC,IAAAA,YAAY,EAAE,UAhBV;AAiBJC,IAAAA,UAAU,EAAE,gBAjBR;AAkBJC,IAAAA,WAAW,EAAE,gBAlBT;AAmBJjC,IAAAA,OAAO,EAAE;AACP,aAAO,iDADA;AAEPkC,MAAAA,WAAW,EAAE,oCAFN;AAGPC,MAAAA,IAAI,EAAE;AAHC,KAnBL;AAwBJrB,IAAAA,OAAO,EAAE,SAxBL;AAyBJsB,IAAAA,gBAAgB,EAAE,aAzBd;AA0BJC,IAAAA,sBAAsB,EAAE,gBA1BpB;AA2BJC,IAAAA,sBAAsB,EAAE;AA3BpB,GA1Ca;AAuEnBC,EAAAA,eAAe,EAAE;AACfC,IAAAA,MAAM,EAAE,wBADO;AAEfC,IAAAA,OAAO,EAAE;AAFM,GAvEE;AA2EnBC,EAAAA,OAAO,EAAE;AACP7C,IAAAA,EAAE,EAAE,sFADG;AAEP8C,IAAAA,EAAE,EAAE,6GAFG;AAGPC,IAAAA,EAAE,EAAE,6CAHG;AAIP9C,IAAAA,KAAK,EAAE,aAJA;AAKP+C,IAAAA,aAAa,EAAE,aALR;AAMPC,IAAAA,oBAAoB,EAAE,6CANf;AAOPC,IAAAA,iBAAiB,EAAE,yCAPZ;AAQPC,IAAAA,KAAK,EAAE;AARA,GA3EU;AAqFnBC,EAAAA,OAAO,EAAE;AACPnD,IAAAA,KAAK,EAAE,mCADA;AAEPD,IAAAA,EAAE,EAAE,sHAFG;AAGP8C,IAAAA,EAAE,EAAE,yJAHG;AAIPC,IAAAA,EAAE,EAAE,2BAJG;AAKPM,IAAAA,SAAS,EAAE;AALJ,GArFU;AA4FnBC,EAAAA,KAAK,EAAE;AACLrD,IAAAA,KAAK,EAAE,8BADF;AAEL8C,IAAAA,EAAE,EAAE,+MAFC;AAGLQ,IAAAA,OAAO,EAAE,SAHJ;AAILC,IAAAA,IAAI,EAAE,iFAJD;AAKLC,IAAAA,MAAM,EAAE;AACNC,MAAAA,SAAS,EAAE,kCADL;AAENC,MAAAA,MAAM,EAAE,sCAFF;AAGNC,MAAAA,YAAY,EAAE;AAHR,KALH;AAULC,IAAAA,UAAU,EAAE,YAVP;AAWLC,IAAAA,UAAU,EAAE;AAXP,GA5FY;AAyGnBC,EAAAA,MAAM,EAAE;AACNC,IAAAA,GAAG,EAAE,KADC;AAENC,IAAAA,EAAE,EAAE,IAFE;AAGNC,IAAAA,EAAE,EAAE,IAHE;AAINC,IAAAA,OAAO,EAAE,SAJH;AAKNC,IAAAA,MAAM,EAAE,QALF;AAMNC,IAAAA,MAAM,EAAE,QANF;AAONC,IAAAA,IAAI,EAAE,MAPA;AAQNC,IAAAA,IAAI,EAAE,MARA;AASNC,IAAAA,QAAQ,EAAE,WATJ;AAUNC,IAAAA,YAAY,EAAE,gCAVR;AAWNC,IAAAA,gBAAgB,EAAE,6CAXZ;AAYNC,IAAAA,wBAAwB,EAAE,mEAZpB;AAaNC,IAAAA,WAAW,EAAE,OAbP;AAcNC,IAAAA,IAAI,EAAE,MAdA;AAeNC,IAAAA,IAAI,EAAE,MAfA;AAgBNC,IAAAA,MAAM,EAAE,QAhBF;AAiBN,cAAU,QAjBJ;AAkBNC,IAAAA,KAAK,EAAE,OAlBD;AAmBNC,IAAAA,IAAI,EAAE,MAnBA;AAoBNC,IAAAA,KAAK,EAAE,OApBD;AAqBNC,IAAAA,IAAI,EAAE,MArBA;AAsBNC,IAAAA,MAAM,EAAE,MAtBF;AAuBNC,IAAAA,GAAG,EAAE,KAvBC;AAwBNC,IAAAA,MAAM,EAAE,KAxBF;AAyBNC,IAAAA,GAAG,EAAE,KAzBC;AA0BNpF,IAAAA,OAAO,EAAE;AACPqF,MAAAA,aAAa,EAAE,2CADR;AAEPpF,MAAAA,WAAW,EAAE,mDAFN;AAGPqF,MAAAA,UAAU,EAAE;AAHL,KA1BH;AA+BNpE,IAAAA,cAAc,EAAE,gBA/BV;AAgCNC,IAAAA,WAAW,EAAE,aAhCP;AAiCNC,IAAAA,QAAQ,EAAE,UAjCJ;AAkCNkE,IAAAA,UAAU,EAAE;AAlCN,GAzGW;AA6InBnD,EAAAA,IAAI,EAAE;AACJoD,IAAAA,IAAI,EAAE,eADF;AAEJC,IAAAA,OAAO,EAAE,SAFL;AAGJ3F,IAAAA,EAAE,EAAE,2EAHA;AAIJ8C,IAAAA,EAAE,EAAE,yFAJA;AAKJC,IAAAA,EAAE,EAAE,oGALA;AAMJ6C,IAAAA,EAAE,EAAE,mFANA;AAOJC,IAAAA,EAAE,EAAE,4FAPA;AAQJC,IAAAA,EAAE,EAAE,+GARA;AASJC,IAAAA,EAAE,EAAE,gFATA;AAUJC,IAAAA,EAAE,EAAE,qGAVA;AAWJC,IAAAA,OAAO,EAAE;AACPjG,MAAAA,EAAE,EAAE,wFADG;AAEP8C,MAAAA,EAAE,EAAE,uFAFG;AAGPC,MAAAA,EAAE,EAAE;AAHG,KAXL;AAgBJmD,IAAAA,eAAe,EAAE,iBAhBb;AAiBJxD,IAAAA,eAAe,EAAE;AACf1C,MAAAA,EAAE,EAAE;AADW;AAjBb,GA7Ia;AAkKnBmG,EAAAA,KAAK,EAAE;AACLC,IAAAA,kBAAkB,EAAE,wBADf;AAELjG,IAAAA,OAAO,EAAE;AACPkG,MAAAA,6BAA6B,EAAE,qDADxB;AAEPtB,MAAAA,MAAM,EAAE,8CAFD;AAGPuB,MAAAA,EAAE,EAAE,uDAHG;AAIPC,MAAAA,IAAI,EAAE,wDAJC;AAKPC,MAAAA,MAAM,EAAE;AALD;AAFJ,GAlKY;AA4KnBC,EAAAA,MAAM,EAAE;AACNC,IAAAA,qBAAqB,EAAE,yEADjB;AAENvG,IAAAA,OAAO,EAAE;AACPwG,MAAAA,oBAAoB,EAAE,mDADf;AAEPC,MAAAA,oBAAoB,EAAE;AAFf;AAFH,GA5KW;AAmLnBhG,EAAAA,OAAO,EAAE;AACPiG,IAAAA,WAAW,EAAE,OADN;AAEPC,IAAAA,UAAU,EAAE,MAFL;AAGPC,IAAAA,aAAa,EAAE,eAHR;AAIPC,IAAAA,YAAY,EAAE,6BAJP;AAKPC,IAAAA,aAAa,EAAE,eALR;AAMPC,IAAAA,UAAU,EAAE,YANL;AAOPC,IAAAA,cAAc,EAAE,oCAPT;AAQPC,IAAAA,MAAM,EAAE,QARD;AASPC,IAAAA,eAAe,EAAE,sBATV;AAUPlH,IAAAA,OAAO,EAAE;AACPmH,MAAAA,WAAW,EAAE,yBADN;AAEPJ,MAAAA,UAAU,EAAE,2BAFL;AAGPjC,MAAAA,IAAI,EAAE,2BAHC;AAIPE,MAAAA,IAAI,EAAE,uBAJC;AAKPoC,MAAAA,YAAY,EAAE,uBALP;AAMPC,MAAAA,eAAe,EAAE,uEANV;AAOPC,MAAAA,eAAe,EAAE,gCAPV;AAQPC,MAAAA,SAAS,EAAE,mFARJ;AASPC,MAAAA,eAAe,EAAE,gCATV;AAUPC,MAAAA,eAAe,EAAE,uDAVV;AAWPC,MAAAA,eAAe,EAAE,wBAXV;AAYPC,MAAAA,eAAe,EAAE,wBAZV;AAaPC,MAAAA,SAAS,EAAE,2CAbJ;AAcPC,MAAAA,aAAa,EAAE,2FAdR;AAePC,MAAAA,aAAa,EAAE,+CAfR;AAgBPC,MAAAA,aAAa,EAAE,yCAhBR;AAiBPC,MAAAA,KAAK,EAAE,0CAjBA;AAkBPC,MAAAA,IAAI,EAAE,+EAlBC;AAmBPC,MAAAA,eAAe,EAAE;AAnBV;AAVF,GAnLU;AAmNnBxH,EAAAA,IAAI,EAAE;AACJyH,IAAAA,YAAY,EAAE,mBADV;AAEJnI,IAAAA,OAAO,EAAE;AACP4G,MAAAA,aAAa,EAAE,4FADR;AAEP9B,MAAAA,IAAI,EAAE,8BAFC;AAGPE,MAAAA,IAAI,EAAE,gCAHC;AAIPoD,MAAAA,QAAQ,EAAE,sDAJH;AAKPD,MAAAA,YAAY,EAAE,wEALP;AAMPE,MAAAA,YAAY,EAAE,4DANP;AAOPC,MAAAA,UAAU,EAAE;AAPL;AAFL,GAnNa;AA+NnBC,EAAAA,cAAc,EAAE,SA/NG;AAgOnBC,EAAAA,cAAc,EAAE;AAhOG,CAArB;AAoOA3J,gBAAgB,CAACG,QAAjB,CAA0B,gBAA1B,EAA4CG,cAA5C;;;ACrOA,IAAIN,gBAAgB,GAAGC,OAAO,CAACC,MAAR,CAAe,kBAAf,CAAvB;AACA,IAAI0J,cAAc,GAAG;AACnBrJ,EAAAA,IAAI,EAAE;AACJC,IAAAA,QAAQ,EAAE,kBADN;AAEJC,IAAAA,MAAM,EAAE,UAFJ;AAGJC,IAAAA,SAAS,EAAE,wBAHP;AAIJC,IAAAA,YAAY,EAAE,mDAJV;AAKJC,IAAAA,MAAM,EAAE,SALJ;AAMJC,IAAAA,MAAM,EAAE,aANJ;AAOJC,IAAAA,SAAS,EAAE;AAPP,GADa;AAUnBC,EAAAA,YAAY,EAAE;AACZC,IAAAA,EAAE,EAAE,0CADQ;AAEZC,IAAAA,KAAK,EAAE;AAFK,GAVK;AAcnBC,EAAAA,YAAY,EAAE;AACZC,IAAAA,OAAO,EAAE;AACPC,MAAAA,WAAW,EAAE,mCADN;AAEPC,MAAAA,QAAQ,EAAE,mDAFH;AAGPC,MAAAA,SAAS,EAAE;AAHJ;AADG,GAdK;AAqBnBC,EAAAA,KAAK,EAAE;AACLC,IAAAA,eAAe,EAAE,yCADZ;AAELC,IAAAA,MAAM,EAAE,wDAFH;AAGLN,IAAAA,OAAO,EAAE;AACPO,MAAAA,IAAI,EAAE;AACJC,QAAAA,UAAU,EAAE,yCADR;AAEJC,QAAAA,OAAO,EAAE,oCAFL;AAGJC,QAAAA,IAAI,EAAE,qCAHF;AAIJC,QAAAA,EAAE,EAAE;AAJA,OADC;AAOPC,MAAAA,OAAO,EAAE,iEAPF;AAQPC,MAAAA,OAAO,EAAE,wDARF;AASPT,MAAAA,KAAK,EAAE;AATA;AAHJ,GArBY;AAoCnBU,EAAAA,OAAO,EAAE;AACPC,IAAAA,UAAU,EAAE,0BADL;AAEPC,IAAAA,UAAU,EAAE,aAFL;AAGP3B,IAAAA,QAAQ,EAAE,4BAHH;AAIP,WAAO;AAJA,GApCU;AA0CnB4B,EAAAA,IAAI,EAAE;AACJ,WAAO,SADH;AAEJC,IAAAA,cAAc,EAAE,mBAFZ;AAGJC,IAAAA,WAAW,EAAE,cAHT;AAIJC,IAAAA,QAAQ,EAAE,eAJN;AAKJC,IAAAA,WAAW,EAAE,mBALT;AAMJzB,IAAAA,YAAY,EAAE,mBANV;AAOJ0B,IAAAA,WAAW,EAAE,aAPT;AAQJC,IAAAA,KAAK,EAAE,cARH;AASJC,IAAAA,iBAAiB,EAAE,cATf;AAUJC,IAAAA,cAAc,EAAE,qBAVZ;AAWJC,IAAAA,YAAY,EAAE,SAXV;AAYJC,IAAAA,kBAAkB,EAAE,yBAZhB;AAaJC,IAAAA,8BAA8B,EAAE,wBAb5B;AAcJC,IAAAA,oCAAoC,EAAE,wDAdlC;AAeJC,IAAAA,oBAAoB,EAAE,kBAflB;AAgBJC,IAAAA,YAAY,EAAE,cAhBV;AAiBJC,IAAAA,UAAU,EAAE,oBAjBR;AAkBJC,IAAAA,WAAW,EAAE,0BAlBT;AAmBJjC,IAAAA,OAAO,EAAE;AACP,aAAO,uDADA;AAEPkC,MAAAA,WAAW,EAAE,qCAFN;AAGPC,MAAAA,IAAI,EAAE;AAHC,KAnBL;AAwBJrB,IAAAA,OAAO,EAAE,UAxBL;AAyBJsB,IAAAA,gBAAgB,EAAE,kBAzBd;AA0BJC,IAAAA,sBAAsB,EAAE,mBA1BpB;AA2BJC,IAAAA,sBAAsB,EAAE;AA3BpB,GA1Ca;AAuEnBC,EAAAA,eAAe,EAAE;AACfC,IAAAA,MAAM,EAAE,0BADO;AAEfC,IAAAA,OAAO,EAAE;AAFM,GAvEE;AA2EnBC,EAAAA,OAAO,EAAE;AACP7C,IAAAA,EAAE,EAAE,qGADG;AAEP8C,IAAAA,EAAE,EAAE,+GAFG;AAGPC,IAAAA,EAAE,EAAE,wDAHG;AAIP9C,IAAAA,KAAK,EAAE,uBAJA;AAKP+C,IAAAA,aAAa,EAAE,gBALR;AAMPC,IAAAA,oBAAoB,EAAE,wDANf;AAOPC,IAAAA,iBAAiB,EAAE,sDAPZ;AAQPC,IAAAA,KAAK,EAAE;AARA,GA3EU;AAqFnBC,EAAAA,OAAO,EAAE;AACPnD,IAAAA,KAAK,EAAE,wCADA;AAEPD,IAAAA,EAAE,EAAE,kGAFG;AAGP8C,IAAAA,EAAE,EAAE,qJAHG;AAIPC,IAAAA,EAAE,EAAE,wCAJG;AAKPM,IAAAA,SAAS,EAAE;AALJ,GArFU;AA4FnBC,EAAAA,KAAK,EAAE;AACLrD,IAAAA,KAAK,EAAE,qCADF;AAEL8C,IAAAA,EAAE,EAAE,qOAFC;AAGLQ,IAAAA,OAAO,EAAE,SAHJ;AAILC,IAAAA,IAAI,EAAE,wGAJD;AAKLC,IAAAA,MAAM,EAAE;AACNC,MAAAA,SAAS,EAAE,iCADL;AAENC,MAAAA,MAAM,EAAE,qCAFF;AAGNC,MAAAA,YAAY,EAAE;AAHR,KALH;AAULC,IAAAA,UAAU,EAAE,iBAVP;AAWLC,IAAAA,UAAU,EAAE;AAXP,GA5FY;AAyGnBC,EAAAA,MAAM,EAAE;AACNC,IAAAA,GAAG,EAAE,IADC;AAENC,IAAAA,EAAE,EAAE,IAFE;AAGNC,IAAAA,EAAE,EAAE,SAHE;AAINC,IAAAA,OAAO,EAAE,QAJH;AAKNC,IAAAA,MAAM,EAAE,UALF;AAMNC,IAAAA,MAAM,EAAE,OANF;AAONC,IAAAA,IAAI,EAAE,OAPA;AAQNC,IAAAA,IAAI,EAAE,QARA;AASNE,IAAAA,YAAY,EAAE,qCATR;AAUNC,IAAAA,gBAAgB,EAAE,0DAVZ;AAWNC,IAAAA,wBAAwB,EAAE,2EAXpB;AAYNC,IAAAA,WAAW,EAAE,OAZP;AAaNJ,IAAAA,QAAQ,EAAE,SAbJ;AAcNK,IAAAA,IAAI,EAAE,OAdA;AAeNC,IAAAA,IAAI,EAAE,KAfA;AAgBNC,IAAAA,MAAM,EAAE,QAhBF;AAiBN,cAAU,UAjBJ;AAkBNC,IAAAA,KAAK,EAAE,OAlBD;AAmBNC,IAAAA,IAAI,EAAE,SAnBA;AAoBNC,IAAAA,KAAK,EAAE,QApBD;AAqBNC,IAAAA,IAAI,EAAE,SArBA;AAsBNC,IAAAA,MAAM,EAAE,MAtBF;AAuBNC,IAAAA,GAAG,EAAE,KAvBC;AAwBNC,IAAAA,MAAM,EAAE,KAxBF;AAyBNC,IAAAA,GAAG,EAAE,QAzBC;AA0BNpF,IAAAA,OAAO,EAAE;AACPqF,MAAAA,aAAa,EAAE,0DADR;AAEPpF,MAAAA,WAAW,EAAE,wEAFN;AAGPqF,MAAAA,UAAU,EAAE;AAHL,KA1BH;AA+BNpE,IAAAA,cAAc,EAAE,mBA/BV;AAgCNC,IAAAA,WAAW,EAAE,cAhCP;AAiCNC,IAAAA,QAAQ,EAAE,eAjCJ;AAkCNkE,IAAAA,UAAU,EAAE;AAlCN,GAzGW;AA6InBnD,EAAAA,IAAI,EAAE;AACJoD,IAAAA,IAAI,EAAE,mBADF;AAEJC,IAAAA,OAAO,EAAE,SAFL;AAGJ3F,IAAAA,EAAE,EAAE,0EAHA;AAIJ8C,IAAAA,EAAE,EAAE,oFAJA;AAKJC,IAAAA,EAAE,EAAE,qJALA;AAMJ6C,IAAAA,EAAE,EAAE,kEANA;AAOJC,IAAAA,EAAE,EAAE,mGAPA;AAQJC,IAAAA,EAAE,EAAE,mIARA;AASJC,IAAAA,EAAE,EAAE,2EATA;AAUJC,IAAAA,EAAE,EAAE,wIAVA;AAWJC,IAAAA,OAAO,EAAE;AACPjG,MAAAA,EAAE,EAAE,uGADG;AAEP8C,MAAAA,EAAE,EAAE,wHAFG;AAGPC,MAAAA,EAAE,EAAE;AAHG,KAXL;AAgBJmD,IAAAA,eAAe,EAAE,kBAhBb;AAiBJxD,IAAAA,eAAe,EAAE;AACf1C,MAAAA,EAAE,EAAE;AADW;AAjBb,GA7Ia;AAkKnByG,EAAAA,MAAM,EAAE;AACNC,IAAAA,qBAAqB,EAAE,wGADjB;AAENvG,IAAAA,OAAO,EAAE;AACPwG,MAAAA,oBAAoB,EAAE,0DADf;AAEPC,MAAAA,oBAAoB,EAAE;AAFf;AAFH,GAlKW;AAyKnBhG,EAAAA,OAAO,EAAE;AACPiG,IAAAA,WAAW,EAAE,SADN;AAEPC,IAAAA,UAAU,EAAE,MAFL;AAGPC,IAAAA,aAAa,EAAE,eAHR;AAIPE,IAAAA,aAAa,EAAE,mBAJR;AAKPC,IAAAA,UAAU,EAAE,eALL;AAMPE,IAAAA,MAAM,EAAE,QAND;AAOPC,IAAAA,eAAe,EAAE,4BAPV;AAQPlH,IAAAA,OAAO,EAAE;AACP6G,MAAAA,YAAY,EAAE,+BADP;AAEPG,MAAAA,cAAc,EAAE,yCAFT;AAGPG,MAAAA,WAAW,EAAE,6BAHN;AAIPJ,MAAAA,UAAU,EAAE,qCAJL;AAKPjC,MAAAA,IAAI,EAAE,iCALC;AAMPE,MAAAA,IAAI,EAAE,oCANC;AAOPoC,MAAAA,YAAY,EAAE,8BAPP;AAQPC,MAAAA,eAAe,EAAE,mFARV;AASPC,MAAAA,eAAe,EAAE,qCATV;AAUPC,MAAAA,SAAS,EAAE,0GAVJ;AAWPC,MAAAA,eAAe,EAAE,+CAXV;AAYPC,MAAAA,eAAe,EAAE,gHAZV;AAaPC,MAAAA,eAAe,EAAE,8BAbV;AAcPC,MAAAA,eAAe,EAAE,6BAdV;AAePC,MAAAA,SAAS,EAAE,uDAfJ;AAiBPC,MAAAA,aAAa,EAAE,qHAjBR;AAkBPC,MAAAA,aAAa,EAAE,wEAlBR;AAmBPC,MAAAA,aAAa,EAAE,uDAnBR;AAoBPC,MAAAA,KAAK,EAAE,kDApBA;AAqBPC,MAAAA,IAAI,EAAE,qFArBC;AAsBPC,MAAAA,eAAe,EAAE;AAtBV;AARF,GAzKU;AA0MnBxH,EAAAA,IAAI,EAAE;AACJyH,IAAAA,YAAY,EAAE,uBADV;AAEJnI,IAAAA,OAAO,EAAE;AACP4G,MAAAA,aAAa,EAAE,uEADR;AAEP9B,MAAAA,IAAI,EAAE,yCAFC;AAGPE,MAAAA,IAAI,EAAE,oCAHC;AAIPoD,MAAAA,QAAQ,EAAE,kEAJH;AAKPD,MAAAA,YAAY,EAAE,gFALP;AAMPE,MAAAA,YAAY,EAAE,4DANP;AAOPC,MAAAA,UAAU,EAAE;AAPL;AAFL,GA1Ma;AAsNnBtC,EAAAA,KAAK,EAAE;AACLC,IAAAA,kBAAkB,EAAE,8BADf;AAELjG,IAAAA,OAAO,EAAE;AACPkG,MAAAA,6BAA6B,EAAE,8CADxB;AAEPtB,MAAAA,MAAM,EAAE,mCAFD;AAGPuB,MAAAA,EAAE,EAAE,2DAHG;AAIPC,MAAAA,IAAI,EAAE,yDAJC;AAKPC,MAAAA,MAAM,EAAE;AALD;AAFJ,GAtNY;AAgOnBkC,EAAAA,cAAc,EAAE,QAhOG;AAiOnBC,EAAAA,cAAc,EAAE;AAjOG,CAArB;AAoOA3J,gBAAgB,CAACG,QAAjB,CAA0B,gBAA1B,EAA4CyJ,cAA5C;;;ACrOA,IAAI5J,gBAAgB,GAAGC,OAAO,CAACC,MAAR,CAAe,kBAAf,CAAvB;AAEAF,gBAAgB,CAAC6J,MAAjB,CAAwB,CAAC,oBAAD,EAAuB,UAAUC,kBAAV,EAA8B;AAC3E,MAAIC,kBAAkB,GAAG,SAArBA,kBAAqB,GAAW;AAClC,QAAI,CAACD,kBAAkB,CAACE,mBAAnB,EAAL,EAA+C,OAAO,IAAP;AAC/C,QAAIC,QAAQ,GAAGH,kBAAkB,CAACE,mBAAnB,GAAyCE,KAAzC,CAA+C,GAA/C,EAAoD,CAApD,CAAf;AACA,QAAI,CAACD,QAAL,EAAe,OAAO,IAAP;AACf,WAAOH,kBAAkB,CAACK,YAAnB,GAAkCF,QAAlC,IAA8CA,QAA9C,GAAyD,IAAhE;AACD,GALD;;AAOAH,EAAAA,kBAAkB,CACfM,iBADH,CACqBL,kBAAkB,EADvC;AAGAD,EAAAA,kBAAkB,CACfO,gBADH,CACoB,IADpB;AAGAP,EAAAA,kBAAkB,CAACQ,wBAAnB,CAA4C,IAA5C;AACAR,EAAAA,kBAAkB,CAACS,SAAnB,CAA6B,oBAA7B;AAED,CAjBuB,CAAxB;;;ACFA,IAAIvK,gBAAgB,GAAGC,OAAO,CAACC,MAAR,CAAe,kBAAf,CAAvB;AAEAF,gBAAgB,CAAC6J,MAAjB,CAAwB,CAAC,gBAAD,EAAmB,mBAAnB,EAAwC,UAASW,cAAT,EAAyBC,iBAAzB,EAA4C;AAC1GD,EAAAA,cAAc,CACXE,IADH,CACQ,iCADR,EAC2C;AACvCC,IAAAA,WAAW,EAAE,4BAD0B;AAEvCC,IAAAA,UAAU,EAAE;AAF2B,GAD3C,EAKGF,IALH,CAKQ,2BALR,EAKqC;AACjCC,IAAAA,WAAW,EAAE,gCADoB;AAEjCC,IAAAA,UAAU,EAAE;AAFqB,GALrC,EASGF,IATH,CASQ,8BATR,EASwC;AACpCC,IAAAA,WAAW,EAAE,mCADuB;AAEpCC,IAAAA,UAAU,EAAE;AAFwB,GATxC,EAaGF,IAbH,CAaQ,kBAbR,EAa4B;AACxBC,IAAAA,WAAW,EAAE,+BADW;AAExBC,IAAAA,UAAU,EAAE;AAFY,GAb5B,EAiBGF,IAjBH,CAiBQ,GAjBR,EAiBa;AACTC,IAAAA,WAAW,EAAE,+BADJ;AAETC,IAAAA,UAAU,EAAE;AAFH,GAjBb,EAD0G,CAuB1G;AACA;AACD,CAzBuB,CAAxB;AAyBI;;;AC3BJ,IAAI5K,gBAAgB,GAAGC,OAAO,CAACC,MAAR,CAAe,kBAAf,CAAvB;AAEAF,gBAAgB,CAAC6K,SAAjB,CAA2B,mBAA3B,EAAgD,CAAC,UAAD,EAAa,OAAb,EAAsB,aAAtB,EAAqC,QAArC,EAA+C,oBAA/C,EAAqE,UAASC,QAAT,EAAmBC,KAAnB,EAA0BC,WAA1B,EAAuCC,MAAvC,EAA+CC,kBAA/C,EAAmE;AACtL,SAAO;AACLC,IAAAA,KAAK,EAAE;AACLC,MAAAA,IAAI,EAAE;AADD,KADF;AAILT,IAAAA,WAAW,EAAE,kCAJR;AAKLU,IAAAA,IAAI,EAAE,cAASF,KAAT,EAAgBG,OAAhB,EAAyBC,KAAzB,EAAgC;AACpC,UAAIH,IAAJ;AACA,UAAII,KAAK,GAAGR,WAAW,CAACS,QAAZ,EAAZ;AAEAN,MAAAA,KAAK,CAACO,MAAN,GAAe,EAAf;AAEAP,MAAAA,KAAK,CAACQ,UAAN,GAAmB,EAAnB;AACAR,MAAAA,KAAK,CAACS,MAAN,GAAeX,MAAM,CAACY,KAAtB;;AACAV,MAAAA,KAAK,CAACW,YAAN,GAAqB,YAAW;AAC9BX,QAAAA,KAAK,CAACY,UAAN,CAAiB,cAAjB;AACD,OAFD;;AAIAZ,MAAAA,KAAK,CAACa,GAAN,GAAY,UAASC,GAAT,EAAcC,KAAd,EAAqB;AAC/B,YAAI;AACF,cAAIC,GAAG,GAAGC,IAAI,CAAC,2BAA2BH,GAA3B,GAAiC,MAAlC,CAAd;AACA,iBAAOC,KAAK,CAACG,KAAb;AAEA,iBAAOF,GAAP;AACD,SALD,CAKE,OAAMG,CAAN,EAAS;AACTJ,UAAAA,KAAK,CAACG,KAAN,GAAcC,CAAC,CAACC,QAAF,EAAd;AACA,gBAAMD,CAAN;AACD;AACF,OAVD;;AAYAnB,MAAAA,KAAK,CAACqB,0BAAN,GAAmCC,EAAE,CAACC,QAAH,CAAY,UAASC,QAAT,EAAmBC,KAAnB,EAA0BC,UAA1B,EAAsC;AAEnF,YAAI;AACF,cAAIF,QAAQ,GAAGP,IAAI,CAAC,2BAA2BO,QAA3B,GAAsC,MAAvC,CAAnB;AACA,cAAIG,KAAK,GAAGD,UAAZ;AACA,cAAIE,MAAM,GAAG,IAAIC,KAAJ,CAAUF,KAAV,CAAb;;AACA,eAAK,IAAIG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,KAApB,EAA2BG,CAAC,EAA5B,EAAgC;AAC9BF,YAAAA,MAAM,CAACE,CAAD,CAAN,GAAYN,QAAQ,CAACM,CAAC,GAACH,KAAH,CAApB;AACA,gBAAII,KAAK,CAACH,MAAM,CAACE,CAAD,CAAP,CAAT,EAAsB,MAAM,mBAAmBF,MAAM,CAACE,CAAD,CAA/B;AACvB;;AAED,cAAIE,EAAE,GAAG,IAAIC,GAAJ,CAAQL,MAAM,CAACM,MAAf,CAAT;AACAF,UAAAA,EAAE,CAACG,OAAH,CAAWP,MAAX;;AAEA,eAAK,IAAIE,CAAC,GAAC,CAAX,EAAaA,CAAC,GAACH,KAAf,EAAqBG,CAAC,EAAtB,EAA0B;AACxBL,YAAAA,KAAK,CAACW,GAAN,CAAUN,CAAV,IAAeE,EAAE,CAACK,IAAH,CAAQP,CAAR,CAAf;AACAL,YAAAA,KAAK,CAACa,GAAN,CAAUR,CAAV,IAAeE,EAAE,CAACO,IAAH,CAAQT,CAAR,CAAf;AACD;;AACDL,UAAAA,KAAK,CAACW,GAAN,CAAUF,MAAV,GAAmBF,EAAE,CAACK,IAAH,CAAQH,MAAR,GAAe,CAAlC;AACAT,UAAAA,KAAK,CAACa,GAAN,CAAUJ,MAAV,GAAmBF,EAAE,CAACO,IAAH,CAAQL,MAAR,GAAe,CAAlC;;AAEA,cAAIM,CAAC,GAAG,SAAJA,CAAI,CAASC,CAAT,EAAW;AACjB,gBAAIzB,GAAG,GAAG,CAAV;;AACA,iBAAK,IAAIc,CAAC,GAAC,CAAX,EAAaA,CAAC,GAACH,KAAK,GAAC,CAArB,EAAuBG,CAAC,EAAxB,EAA4B;AAC1B,kBAAIY,CAAC,GAAGjB,KAAK,CAACa,GAAN,CAAUR,CAAV,CAAR;AACA,kBAAIa,CAAC,GAAGlB,KAAK,CAACW,GAAN,CAAUN,CAAV,CAAR;AAEAd,cAAAA,GAAG,GAAGA,GAAG,GAAG0B,CAAC,GAAGE,IAAI,CAACN,GAAL,CAASG,CAAC,GAAC,CAAF,GAAIG,IAAI,CAACC,EAAT,GAAYf,CAArB,CAAhB;AACAd,cAAAA,GAAG,GAAGA,GAAG,GAAG2B,CAAC,GAAGC,IAAI,CAACR,GAAL,CAASK,CAAC,GAAC,CAAF,GAAIG,IAAI,CAACC,EAAT,GAAYf,CAArB,CAAhB;AACD;;AACD,mBAAOd,GAAP;AACD,WAVD;;AAYA,cAAI8B,QAAQ,GAAG,CAAf;AACA,cAAInB,KAAK,GAAGF,KAAK,CAACa,GAAN,CAAUJ,MAAtB;;AACA,eAAK,IAAIJ,CAAC,GAAC,CAAX,EAAcA,CAAC,GAACH,KAAhB,EAAuBG,CAAC,EAAxB,EAA4B;AAC1B,gBAAIiB,KAAK,GAAGP,CAAC,CAACV,CAAC,GAACH,KAAH,CAAb;;AACA,gBAAIoB,KAAK,GAACD,QAAV,EAAoB;AAClBA,cAAAA,QAAQ,GAACC,KAAT;AACD,aAFD,MAEO,IAAIA,KAAK,GAAC,CAACD,QAAX,EAAqB;AAC1BA,cAAAA,QAAQ,GAAC,CAACC,KAAV;AACD;AACF;;AAED,eAAK,IAAIjB,CAAC,GAAC,CAAX,EAAaA,CAAC,GAACH,KAAf,EAAqBG,CAAC,EAAtB,EAA0B;AACxBL,YAAAA,KAAK,CAACa,GAAN,CAAUR,CAAV,IAAeL,KAAK,CAACa,GAAN,CAAUR,CAAV,IAAegB,QAA9B;AACArB,YAAAA,KAAK,CAACW,GAAN,CAAUN,CAAV,IAAeL,KAAK,CAACW,GAAN,CAAUN,CAAV,IAAegB,QAA9B;AACD;;AAEDnD,UAAAA,QAAQ,CAAC,YAAW;AAClBK,YAAAA,KAAK,CAACgD,eAAN,GAAwB,KAAxB;AACD,WAFO,CAAR;AAGAhD,UAAAA,KAAK,CAACY,UAAN,CAAiB,cAAjB;AACD,SAnDD,CAmDE,OAAOqC,GAAP,EAAY;AACZtD,UAAAA,QAAQ,CAAC,YAAW;AAClBK,YAAAA,KAAK,CAACgD,eAAN,GAAwBC,GAAG,CAAC7B,QAAJ,EAAxB;AACD,WAFO,CAAR;AAGD;AAEF,OA3DkC,EA2DjC,GA3DiC,CAAnC;AA6DApB,MAAAA,KAAK,CAACkD,cAAN,GAAuB5B,EAAE,CAACC,QAAH,CAAY,UAAS4B,KAAT,EAAgB1B,KAAhB,EAAuB2B,MAAvB,EAA+B;AAEhE,YAAI;AACF,cAAID,KAAK,GAAGlC,IAAI,CAAC,2BAA2BkC,KAA3B,GAAmC,MAApC,CAAhB;;AACA,eAAK,IAAIE,CAAC,GAAC,CAAX,EAAaA,CAAC,GAAC,GAAf,EAAmBA,CAAC,EAApB,EAAwB;AACtB5B,YAAAA,KAAK,CAAC4B,CAAD,CAAL,GAASF,KAAK,CAACE,CAAD,CAAd;AACA,gBAAItB,KAAK,CAACN,KAAK,CAAC4B,CAAD,CAAN,CAAT,EAAqB,MAAM,mBAAmB5B,KAAK,CAAC4B,CAAD,CAA9B;AAEtB;;AACDrD,UAAAA,KAAK,CAACoD,MAAD,CAAL,GAAgB,KAAhB;AACAzD,UAAAA,QAAQ,CAAC,YAAW;AAClBK,YAAAA,KAAK,CAACY,UAAN,CAAiB,cAAjB;AACD,WAFO,CAAR;AAGD,SAXD,CAWE,OAAOqC,GAAP,EAAY;AACZtD,UAAAA,QAAQ,CAAC,YAAW;AAClBK,YAAAA,KAAK,CAACoD,MAAD,CAAL,GAAgBH,GAAG,CAAC7B,QAAJ,EAAhB;AACD,WAFO,CAAR;AAGD;AACF,OAlBsB,EAkBrB,GAlBqB,CAAvB;;AAoBApB,MAAAA,KAAK,CAACsD,KAAN,GAAc,UAASC,IAAT,EAAeC,GAAf,EAAoB;AAChC,YAAIC,CAAC,GAAG,EAAR;;AACA,aAAK,IAAI3B,CAAC,GAACyB,IAAX,EAAgBzB,CAAC,IAAE0B,GAAnB,EAAuB1B,CAAC,EAAxB,EAA4B;AAC1B2B,UAAAA,CAAC,CAACC,IAAF,CAAO5B,CAAP;AACD;;AACD,eAAO2B,CAAP;AACD,OAND;;AAQA,UAAIE,MAAM,GAAG,SAATA,MAAS,CAASF,CAAT,EAAa;AAAE,eAAOA,CAAP;AAAW,OAAvC;;AACA,UAAIG,YAAY,GAAG,SAAfA,YAAe,CAASC,QAAT,EAAmB;AACpClE,QAAAA,QAAQ,CAAC,YAAW;AAClB,cAAIK,KAAK,CAACC,IAAN,IAAcD,KAAK,CAACC,IAAN,CAAW6D,OAA7B,EAAsC9D,KAAK,CAACC,IAAN,CAAW6D,OAAX;AACvC,SAFO,CAAR;AAGD,OAJD;;AAMA,UAAIC,cAAJ;AACA/D,MAAAA,KAAK,CAACgE,GAAN,CAAU,UAAV,EAAsB,YAAW;AAC/B,YAAID,cAAJ,EAAoBA,cAAc,CAACE,OAAf;AACrB,OAFD;;AAIA,UAAIC,cAAc,GAAG,SAAjBA,cAAiB,CAASjE,IAAT,EAAe;AAClC,YAAI,CAACA,IAAL,EAAW;AAEX,YAAI8D,cAAJ,EAAoBA,cAAc,CAACE,OAAf;AACpB,YAAIF,cAAc,GAAGhE,kBAAkB,GAAGoE,aAArB,CAAmClE,IAAnC,EAAyC,UAASM,MAAT,EAAiB;AAC7EZ,UAAAA,QAAQ,CAAC,YAAW;AAClBK,YAAAA,KAAK,CAACO,MAAN,GAAeA,MAAf;AACD,WAFO,CAAR;AAGD,SAJoB,CAArB;AAMAF,QAAAA,KAAK,CAAC+D,IAAN,CAAW,YAAW;AACpBzE,UAAAA,QAAQ,CAAC,YAAW;AAClBK,YAAAA,KAAK,CAACqE,YAAN,GAAqBpE,IAAI,CAAC1J,IAA1B;AAEAsJ,YAAAA,WAAW,CAACyE,OAAZ,CAAoBrE,IAAI,CAAC1J,IAAzB,EAA+B,UAASA,IAAT,EAAe;AAC5CoJ,cAAAA,QAAQ,CAAC,YAAW;AAClBK,gBAAAA,KAAK,CAACR,WAAN,GAAoBjJ,IAAI,CAACiJ,WAAzB;AACAQ,gBAAAA,KAAK,CAACzJ,IAAN,GAAaA,IAAb;;AAEA,qBAAK,IAAIgO,CAAT,IAAchO,IAAI,CAACiO,QAAnB,EAA6B;AAC3B,sBAAI,OAAOvE,IAAI,CAACwE,IAAL,CAAUF,CAAV,CAAP,KAAwB,WAA5B,EAAyC;AACvCtE,oBAAAA,IAAI,CAACwE,IAAL,CAAUF,CAAV,IAAchO,IAAI,CAACiO,QAAL,CAAcD,CAAd,CAAd;AACD;AACF;;AAED,oBAAIhO,IAAI,CAACiK,UAAT,EAAqB;AACnBR,kBAAAA,KAAK,CAACQ,UAAN,GAAmBjK,IAAI,CAACiK,UAAL,CAAgBkE,GAAhB,CAAoB,UAASC,SAAT,EAAoB;AACzD,2BAAO;AACLvK,sBAAAA,IAAI,EAAEuK,SAAS,CAACvK,IADX;AAELqK,sBAAAA,IAAI,EAAEE,SAFD;AAGL5B,sBAAAA,KAAK,EAAE9C,IAAI,CAACwE,IAAL,IAAa,OAAOxE,IAAI,CAACwE,IAAL,CAAUE,SAAS,CAACvK,IAApB,CAAP,KAAqC,WAAlD,GAAgE6F,IAAI,CAACwE,IAAL,CAAUE,SAAS,CAACvK,IAApB,CAAhE,GAA4FuK,SAAS,CAAC5B;AAHxG,qBAAP;AAKD,mBANkB,CAAnB;AAOD;;AACD,oBAAIxM,IAAI,CAACqO,UAAT,EAAqB;AACnB5E,kBAAAA,KAAK,CAAC6E,WAAN,GAAoB,CAACtO,IAAI,CAACqO,UAAL,IAAiB,EAAlB,EAAsBF,GAAtB,CAA0B,UAASI,SAAT,EAAoB;AAChE,2BAAO;AACL1K,sBAAAA,IAAI,EAAE0K,SADD;AAEL/B,sBAAAA,KAAK,EAAG9C,IAAI,CAACwE,IAAL,IAAaxE,IAAI,CAACwE,IAAL,CAAUnJ,UAAvB,IAAqC2E,IAAI,CAACwE,IAAL,CAAUnJ,UAAV,CAAqBwJ,SAArB,CAAtC,IAAyE;AAC9EvO,wBAAAA,IAAI,EAAE,OADwE;AAE9EkO,wBAAAA,IAAI,EAAE;AACJM,0BAAAA,KAAK,EAAE;AADH;AAFwE;AAF3E,qBAAP;AASD,mBAVmB,CAApB;AAWD;;AAEDnB,gBAAAA,YAAY,CAAC3D,IAAI,CAACwE,IAAN,CAAZ;AACD,eAlCO,CAAR;AAmCD,aApCD;AAqCD,WAxCO,CAAR;AAyCD,SA1CD;AA2CD,OArDD;;AAsDA,UAAIzE,KAAK,CAACC,IAAV,EAAgBiE,cAAc,CAAClE,KAAK,CAACC,IAAP,CAAd;AAEhBI,MAAAA,KAAK,CAAC+D,IAAN,CAAW,UAAS/D,KAAT,EAAgB;AACzBL,QAAAA,KAAK,CAACK,KAAN,GAAcA,KAAd;AACD,OAFD;;AAIA,UAAI2E,UAAU,GAAG,SAAbA,UAAa,CAASnB,QAAT,EAAmB;AAClC,YAAI,CAACA,QAAL,EAAe;AACf,YAAI,CAAC7D,KAAK,CAACC,IAAX,EAAiB;AACjBD,QAAAA,KAAK,CAACC,IAAN,CAAW1J,IAAX,GAAkBsN,QAAlB;AACAK,QAAAA,cAAc,CAAClE,KAAK,CAACC,IAAP,CAAd;AACD,OALD;;AAOAD,MAAAA,KAAK,CAACiF,MAAN,CAAa,aAAb,EAA4B,UAASpB,QAAT,EAAmB;AAC7C,YAAI,CAAC7D,KAAK,CAAC6E,WAAX,EAAwB;AACxB7E,QAAAA,KAAK,CAAC6E,WAAN,CAAkBK,OAAlB,CAA0B,UAAS5J,UAAT,EAAqB;AAC7C0E,UAAAA,KAAK,CAACC,IAAN,CAAWwE,IAAX,CAAgBnJ,UAAhB,GAA6B0E,KAAK,CAACC,IAAN,CAAWwE,IAAX,CAAgBnJ,UAAhB,IAA4B,EAAzD;AACA0E,UAAAA,KAAK,CAACC,IAAN,CAAWwE,IAAX,CAAgBnJ,UAAhB,CAA2BA,UAAU,CAAClB,IAAtC,IAA8CkB,UAAU,CAACyH,KAAzD;AACD,SAHD;AAIA/C,QAAAA,KAAK,CAACmF,KAAN,CAAY,eAAZ;AACD,OAPD,EAOG,IAPH;AASAnF,MAAAA,KAAK,CAACiF,MAAN,CAAa,YAAb,EAA2B,UAASpB,QAAT,EAAmB;AAC5C,YAAI,CAAC7D,KAAK,CAACQ,UAAX,EAAuB;AACvBR,QAAAA,KAAK,CAACQ,UAAN,CAAiB0E,OAAjB,CAAyB,UAASP,SAAT,EAAoB;AAC3C3E,UAAAA,KAAK,CAACC,IAAN,CAAWwE,IAAX,CAAgBE,SAAS,CAACF,IAAV,CAAerK,IAA/B,IAAuCuK,SAAS,CAAC5B,KAAjD;AACD,SAFD;AAGA/C,QAAAA,KAAK,CAACmF,KAAN,CAAY,eAAZ;AACD,OAND,EAMG,IANH;AAOAnF,MAAAA,KAAK,CAACiF,MAAN,CAAa,cAAb,EAA6BD,UAA7B;AACAhF,MAAAA,KAAK,CAACiF,MAAN,CAAa,MAAb,EAAqBf,cAArB,EAjNoC,CAkNpC;AACD;AAxNI,GAAP;AA0ND,CA3N+C,CAAhD;AA6NArP,gBAAgB,CAAC6K,SAAjB,CAA2B,aAA3B,EAA0C,CAAC,UAAD,EAAa,QAAb,EAAuB,UAASC,QAAT,EAAmBG,MAAnB,EAA2B;AAC1F,SAAO;AACLE,IAAAA,KAAK,EAAE;AACLyE,MAAAA,IAAI,EAAE;AADD,KADF;AAILjF,IAAAA,WAAW,EAAE,iCAJR;AAKLU,IAAAA,IAAI,EAAE,cAASF,KAAT,EAAgBG,OAAhB,EAAyBC,KAAzB,EAAgC;AACpCJ,MAAAA,KAAK,CAACyE,IAAN,CAAWW,UAAX,GAAsBpF,KAAK,CAACyE,IAAN,CAAWW,UAAX,IAAuB,EAA7C;AACApF,MAAAA,KAAK,CAACqF,WAAN,GAAoBjF,KAAK,CAACkF,WAAN,GAAoBC,QAAQ,CAACnF,KAAK,CAACkF,WAAP,CAA5B,GAAkDE,QAAtE;AACAxF,MAAAA,KAAK,CAACyF,UAAN,GAAmB,CAAnB;AACAzF,MAAAA,KAAK,CAACS,MAAN,GAAeX,MAAM,CAACY,KAAtB;;AAEA,UAAIgF,SAAS,GAAG,SAAZA,SAAY,CAASC,SAAT,EAAoB;AAClChG,QAAAA,QAAQ,CAAC,YAAW;AAClBK,UAAAA,KAAK,CAACyE,IAAN,CAAWW,UAAX,GAAsBpF,KAAK,CAACyE,IAAN,CAAWW,UAAX,IAAuB,EAA7C;AACApF,UAAAA,KAAK,CAACyE,IAAN,CAAWW,UAAX,CAAsB1B,IAAtB,CAA2BiC,SAA3B;AACA3F,UAAAA,KAAK,CAAC4F,aAAN,CAAoB5F,KAAK,CAACyE,IAAN,CAAWW,UAAX,CAAsBlD,MAAtB,GAA6B,CAAjD;AACD,SAJO,CAAR;AAKD,OAND;;AAQAlC,MAAAA,KAAK,CAAC4F,aAAN,GAAsB,UAASC,GAAT,EAAc;AAClC7F,QAAAA,KAAK,CAACyF,UAAN,GAAmBI,GAAnB;AACD,OAFD;;AAIA7F,MAAAA,KAAK,CAAC8F,YAAN,GAAqB,UAASC,MAAT,EAAiB;AACpC/F,QAAAA,KAAK,CAACyE,IAAN,CAAWW,UAAX,GAAwBpF,KAAK,CAACyE,IAAN,CAAWW,UAAX,CAAsB9O,MAAtB,CAA6B,UAAS0P,CAAT,EAAY;AAAC,iBAAOA,CAAC,KAAKD,MAAb;AAAsB,SAAhE,CAAxB;AACD,OAFD;;AAIA/F,MAAAA,KAAK,CAAC0F,SAAN,GAAkB,YAAW;AAC3BA,QAAAA,SAAS,CAAC;AAACjB,UAAAA,IAAI,EAAE;AAACM,YAAAA,KAAK,EAAE;AAAR,WAAP;AAAoBxO,UAAAA,IAAI,EAAE;AAA1B,SAAD,CAAT;AACD,OAFD;;AAIA,UAAIyJ,KAAK,CAACyE,IAAN,CAAWW,UAAX,CAAsBlD,MAAtB,KAAiC,CAArC,EAAwC;AACtClC,QAAAA,KAAK,CAAC0F,SAAN;AACD;AACF;AAlCI,GAAP;AAoCD,CArCyC,CAA1C;AAuCA7Q,gBAAgB,CAAC6K,SAAjB,CAA2B,YAA3B,EAAyC,CAAC,UAAD,EAAa,QAAb,EAAuB,aAAvB,EAAsC,UAASC,QAAT,EAAmBG,MAAnB,EAA2BD,WAA3B,EAAwC;AACrH,SAAO;AACLG,IAAAA,KAAK,EAAE;AACLiG,MAAAA,QAAQ,EAAE,WADL;AAELC,MAAAA,iBAAiB,EAAE;AAFd,KADF;AAKL1G,IAAAA,WAAW,EAAE,2BALR;AAMLU,IAAAA,IAAI,EAAE,cAASF,KAAT,EAAgBG,OAAhB,EAAyBC,KAAzB,EAAgC;AACpCJ,MAAAA,KAAK,CAACS,MAAN,GAAeX,MAAM,CAACY,KAAtB;;AAEA,UAAIyF,IAAI,GAAG,SAAPA,IAAO,CAASC,IAAT,EAAeC,IAAf,EAAqB;AAC9BrG,QAAAA,KAAK,CAACmF,KAAN,CAAY,cAAZ;AAEAxF,QAAAA,QAAQ,CAAC,YAAW;AAClB,cAAI2G,GAAG,GAAGtG,KAAK,CAACC,IAAN,CAAW8E,KAAX,CAAiBqB,IAAjB,CAAV;AACApG,UAAAA,KAAK,CAACC,IAAN,CAAW8E,KAAX,CAAiBqB,IAAjB,IAAyBpG,KAAK,CAACC,IAAN,CAAW8E,KAAX,CAAiBsB,IAAjB,CAAzB;AACArG,UAAAA,KAAK,CAACC,IAAN,CAAW8E,KAAX,CAAiBsB,IAAjB,IAAyBC,GAAzB;AACD,SAJO,CAAR;AAKD,OARD;;AAUA,UAAIC,kBAAkB,GAAG,SAArBA,kBAAqB,CAAStG,IAAT,EAAewE,IAAf,EAAqB;AAC5CxE,QAAAA,IAAI,CAAC8E,KAAL,GAAa,CAAC;AACZxO,UAAAA,IAAI,EAAEkO,IAAI,CAACrK,IADC;AAEZqK,UAAAA,IAAI,EAAE;AAFM,SAAD,EAGV+B,MAHU,CAGHvG,IAAI,CAAC8E,KAHF,CAAb;AAID,OALD;;AAOA/E,MAAAA,KAAK,CAACyG,cAAN,GAAuB,UAAShC,IAAT,EAAeiC,KAAf,EAAsB;AAC3C,YAAIjC,IAAI,CAAClO,IAAL,KAAc,IAAlB,EAAwB;AACtBsJ,UAAAA,WAAW,CAACyE,OAAZ,CAAoBG,IAAI,CAACrK,IAAzB,EACGgK,IADH,CACQ,UAAS7N,IAAT,EAAe;AACnB,aAACA,IAAI,CAACoQ,WAAL,IAAmBJ,kBAApB,EAAwCvG,KAAK,CAACC,IAA9C,EAAoDwE,IAApD;AACAzE,YAAAA,KAAK,CAACmF,KAAN,CAAY,cAAZ;AACD,WAJH;AAKD;AACF,OARD;;AAUAnF,MAAAA,KAAK,CAAC7D,EAAN,GAAW,UAAS0J,GAAT,EAAc;AACvBM,QAAAA,IAAI,CAACN,GAAG,GAAC,CAAL,EAAQA,GAAR,CAAJ;AACD,OAFD;;AAIA7F,MAAAA,KAAK,CAAC5D,IAAN,GAAa,UAASyJ,GAAT,EAAc;AACzBM,QAAAA,IAAI,CAACN,GAAG,GAAC,CAAL,EAAQA,GAAR,CAAJ;AACD,OAFD;;AAIA7F,MAAAA,KAAK,CAACpF,MAAN,GAAe,UAASiL,GAAT,EAAc;AAC3B7F,QAAAA,KAAK,CAACmF,KAAN,CAAY,cAAZ;AAEAxF,QAAAA,QAAQ,CAAC,YAAW;AAClB,cAAIiH,aAAa,GAAG5G,KAAK,CAACC,IAAN,CAAW8E,KAA/B;AACA/E,UAAAA,KAAK,CAACC,IAAN,CAAW8E,KAAX,GAAmB,EAAnB;;AACA,eAAK,IAAIjD,CAAC,GAAC,CAAX,EAAcA,CAAC,GAAC8E,aAAa,CAAC1E,MAA9B,EAAsCJ,CAAC,EAAvC,EAA2C;AACzC,gBAAIA,CAAC,KAAG+D,GAAR,EAAa7F,KAAK,CAACC,IAAN,CAAW8E,KAAX,CAAiBrB,IAAjB,CAAsBkD,aAAa,CAAC9E,CAAD,CAAnC;AACd;AACF,SANO,CAAR;AAOD,OAVD;;AAYA9B,MAAAA,KAAK,CAAC5E,GAAN,GAAY,YAAW;AACrB4E,QAAAA,KAAK,CAACmF,KAAN,CAAY,cAAZ;AAEAxF,QAAAA,QAAQ,CAAC,YAAW;AAClBK,UAAAA,KAAK,CAACC,IAAN,CAAW8E,KAAX,CAAiBrB,IAAjB,CAAsB;AAACe,YAAAA,IAAI,EAAE,EAAP;AAAWlO,YAAAA,IAAI,EAAE;AAAjB,WAAtB;AACD,SAFO,CAAR;AAGD,OAND;;AAQAyJ,MAAAA,KAAK,CAACiF,MAAN,CAAa,UAAb,EAAyB,UAAS4B,OAAT,EAAkB;AACzC,YAAIA,OAAJ,EAAa;AACX7G,UAAAA,KAAK,CAACC,IAAN,GAAa4G,OAAO,CAACpC,IAArB;AACD;AACF,OAJD;AAKD;AArEI,GAAP;AAwED,CAzEwC,CAAzC;AA2EA5P,gBAAgB,CAAC6K,SAAjB,CAA2B,gBAA3B,EAA6C,CAAC,UAAD,EAAa,UAASC,QAAT,EAAmB;AAC3E,SAAO;AACLK,IAAAA,KAAK,EAAE;AACLyB,MAAAA,KAAK,EAAE;AADF,KADF;AAILqF,IAAAA,QAAQ,EAAE,+EAJL;AAKL5G,IAAAA,IAAI,EAAE,cAASF,KAAT,EAAgBG,OAAhB,EAAyBC,KAAzB,EAAgC;AACpC,UAAI2G,YAAY,GAAG,SAAfA,YAAe,GAAW;AAC5B/G,QAAAA,KAAK,CAACwC,CAAN,GAAU,UAASC,CAAT,EAAW;AACnB,cAAIzB,GAAG,GAAG,CAAV;;AACA,eAAK,IAAIc,CAAC,GAAC,CAAX,EAAaA,CAAC,GAAC9B,KAAK,CAACyB,KAAN,CAAYa,GAAZ,CAAgBJ,MAA/B,EAAsCJ,CAAC,EAAvC,EAA2C;AACzC,gBAAIY,CAAC,GAAG1C,KAAK,CAACyB,KAAN,CAAYa,GAAZ,CAAgBR,CAAhB,CAAR;AACA,gBAAIa,CAAC,GAAG3C,KAAK,CAACyB,KAAN,CAAYW,GAAZ,CAAgBN,CAAhB,CAAR;AAEAd,YAAAA,GAAG,GAAGA,GAAG,GAAG0B,CAAC,GAAGE,IAAI,CAACN,GAAL,CAASG,CAAC,GAAC,CAAF,GAAIG,IAAI,CAACC,EAAT,GAAYf,CAArB,CAAhB;AACAd,YAAAA,GAAG,GAAGA,GAAG,GAAG2B,CAAC,GAAGC,IAAI,CAACR,GAAL,CAASK,CAAC,GAAC,CAAF,GAAIG,IAAI,CAACC,EAAT,GAAYf,CAArB,CAAhB;AACD;;AACD,iBAAOd,GAAP;AACD,SAVD;AAWD,OAZD;;AAcAhB,MAAAA,KAAK,CAACwC,CAAN,GAAU,YAAW;AAAE,eAAO,CAAP;AAAW,OAAlC;;AACAxC,MAAAA,KAAK,CAACgE,GAAN,CAAU,cAAV,EAA0B1C,EAAE,CAACC,QAAH,CAAYwF,YAAZ,EAAyB,EAAzB,CAA1B;AAEAA,MAAAA,YAAY;AACb;AAxBI,GAAP;AA0BD,CA3B4C,CAA7C;AA6BAlS,gBAAgB,CAAC6K,SAAjB,CAA2B,WAA3B,EAAwC,CAAC,UAAD,EAAa,UAASC,QAAT,EAAmB;AACtE,SAAO;AACLK,IAAAA,KAAK,EAAE;AACLgH,MAAAA,KAAK,EAAE;AADF,KADF;AAILF,IAAAA,QAAQ,EAAE,gIAJL;AAKL5G,IAAAA,IAAI,EAAE,cAASF,KAAT,EAAgBG,OAAhB,EAAyBC,KAAzB,EAAgC;AACpC,UAAI6G,cAAc,GAAG,SAAjBA,cAAiB,CAAS5D,CAAT,EAAY;AAC/B,eAAO,CAAC,CAAD,EAAG,CAAC,CAAD,EAAG,CAAH,CAAH,EAAU,CAAV,EAAa,CAAC,CAAD,EAAG,CAAH,CAAb,EAAoB,CAApB,EAAuB,CAAvB,EAA0B,CAAC,CAAD,EAAG,CAAH,CAA1B,EAAiC,CAAjC,EAAoC,CAAC,CAAD,EAAG,CAAH,CAApC,EAA2C,CAA3C,EAA8C,CAAC,CAAD,EAAG,CAAH,CAA9C,EAAqD,CAArD,EAAwDA,CAAC,GAAC,EAA1D,CAAP;AACD,OAFD;;AAIA,UAAI6D,cAAc,GAAG,SAAjBA,cAAiB,CAAS7D,CAAT,EAAY;AAC/B,eAAO,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,EAAS,CAAT,EAAW,CAAX,EAAa,EAAb,EAAiBA,CAAC,GAAC,CAAnB,CAAP;AACD,OAFD;;AAIA,UAAI8D,SAAS,GAAG,SAAZA,SAAY,CAAS9D,CAAT,EAAY;AAC1B,eAAO,CAAC,GAAD,EAAK,GAAL,EAAS,GAAT,EAAa,GAAb,EAAiB,GAAjB,EAAqB,GAArB,EAAyB,GAAzB,EAA8BA,CAAC,GAAG,CAAlC,CAAP;AACD,OAFD;;AAIArD,MAAAA,KAAK,CAACiF,MAAN,CAAa,OAAb,EAAsB,UAASmC,MAAT,EAAiB;AACrCzH,QAAAA,QAAQ,CAAC,YAAW;AAClB,cAAIqH,KAAK,GAAG/R,KAAK,CAACoS,KAAN,CAAYC,KAAZ,CAAkBF,MAAlB,CAAZ;AACA,cAAIG,MAAM,GAAG,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,EAAS,CAAT,EAAW,CAAX,EAAa,CAAb,CAAb;AAEA,cAAIC,QAAQ,GAAGP,cAAc,CAACG,MAAD,CAA7B;AACA,cAAII,QAAQ,CAACtF,MAAb,EAAqBsF,QAAQ,GAAGA,QAAQ,CAAC,CAAD,CAAnB;AAErBxH,UAAAA,KAAK,CAACyH,KAAN,GAAcF,MAAM,CAAC7C,GAAP,CAAW,UAASgD,CAAT,EAAY;AACnC,gBAAIC,QAAQ,GAAGX,KAAK,CAAC5L,GAAN,CAAUgM,MAAV,EAAiBM,CAAjB,CAAf;AACA,gBAAIE,IAAI,GAAG,CAACJ,QAAQ,GAAGE,CAAZ,IAAiB,CAA5B;AACA,gBAAIG,GAAG,GAAG,EAAV;AAEA,gBAAIX,cAAc,CAACU,IAAD,CAAd,GAAuBD,QAAQ,GAAG,EAAtC,EAA0CE,GAAG,GAAG,GAAN;AAC1C,gBAAIX,cAAc,CAACU,IAAD,CAAd,GAAuBD,QAAQ,GAAG,EAAtC,EAA0CE,GAAG,GAAG,GAAN;AAC1C,mBAAOV,SAAS,CAACS,IAAD,CAAT,GAAkBC,GAAzB;AACD,WARa,CAAd;AASD,SAhBO,CAAR;AAiBD,OAlBD;AAmBD;AArCI,GAAP;AAuCD,CAxCuC,CAAxC;AA0CAhT,gBAAgB,CAAC6K,SAAjB,CAA2B,aAA3B,EAA0C,CAAC,QAAD,EAAW,UAAX,EAAuB,UAASoI,MAAT,EAAiBnI,QAAjB,EAA2B;AAC1F,SAAO;AACLoI,IAAAA,QAAQ,EAAE,GADL;AAEL7H,IAAAA,IAAI,EAAE,cAASF,KAAT,EAAgBG,OAAhB,EAAyBC,KAAzB,EAAgC;AACpC,UAAI4H,eAAe,GAAGF,MAAM,CAAC1H,KAAK,CAAC6H,WAAP,CAA5B;AACA,UAAIC,eAAe,GAAGF,eAAe,CAACG,MAAtC;AAEAnI,MAAAA,KAAK,CAACiF,MAAN,CAAa7E,KAAK,CAAC6H,WAAnB,EAAgC,YAAW;AACzCG,QAAAA,CAAC,CAACjI,OAAD,CAAD,CAAWkI,SAAX,CAAqBL,eAAe,CAAChI,KAAD,CAApC;AACD,OAFD;AAIAG,MAAAA,OAAO,CAACmI,EAAR,CAAW,QAAX,EAAqB,YAAW;AAC9B3I,QAAAA,QAAQ,CAAC,YAAW;AAClBuI,UAAAA,eAAe,CAAClI,KAAD,EAAQoI,CAAC,CAACjI,OAAD,CAAD,CAAWkI,SAAX,EAAR,CAAf;AACD,SAFO,CAAR;AAGD,OAJD;AAKD;AAfI,GAAP;AAiBD,CAlByC,CAA1C;AAoBAxT,gBAAgB,CAAC6K,SAAjB,CAA2B,cAA3B,EAA2C,CAAC,QAAD,EAAW,UAAX,EAAuB,UAASoI,MAAT,EAAiBnI,QAAjB,EAA2B;AAC3F,SAAO;AACLoI,IAAAA,QAAQ,EAAE,GADL;AAEL7H,IAAAA,IAAI,EAAE,cAASF,KAAT,EAAgBG,OAAhB,EAAyBC,KAAzB,EAAgC;AACpC,UAAI4H,eAAe,GAAGF,MAAM,CAAC1H,KAAK,CAACmI,YAAP,CAA5B;AACA,UAAIL,eAAe,GAAGF,eAAe,CAACG,MAAtC;AAEAnI,MAAAA,KAAK,CAACiF,MAAN,CAAa7E,KAAK,CAACmI,YAAnB,EAAiC,YAAW;AAC1CH,QAAAA,CAAC,CAACjI,OAAD,CAAD,CAAWqI,UAAX,CAAsBR,eAAe,CAAChI,KAAD,CAArC;AACD,OAFD;AAIAG,MAAAA,OAAO,CAACmI,EAAR,CAAW,QAAX,EAAqB,YAAW;AAC9B3I,QAAAA,QAAQ,CAAC,YAAW;AAClBuI,UAAAA,eAAe,CAAClI,KAAD,EAAQoI,CAAC,CAACjI,OAAD,CAAD,CAAWqI,UAAX,EAAR,CAAf;AACD,SAFO,CAAR;AAGD,OAJD;AAKD;AAfI,GAAP;AAiBD,CAlB0C,CAA3C;;;AC5aA3T,gBAAgB,CAAC6K,SAAjB,CAA2B,eAA3B,EAA4C,CAAC,UAAD,EAAa,QAAb,EAAuB,UAASC,QAAT,EAAmBmI,MAAnB,EAA2B;AAC5F,SAAO;AACL9H,IAAAA,KAAK,EAAE,EADF;AAELyI,IAAAA,OAAO,EAAE,IAFJ;AAGL3B,IAAAA,QAAQ,EAAE,qCAHL;AAIL5G,IAAAA,IAAI,EAAE,cAASF,KAAT,EAAgBG,OAAhB,EAAyBC,KAAzB,EAAgC;AACpC,UAAIoC,CAAJ;AACA,UAAIkG,EAAE,GAAGC,UAAU,CAACvI,KAAK,CAACsI,EAAP,CAAnB;AACA,UAAIE,EAAE,GAAGD,UAAU,CAACvI,KAAK,CAACwI,EAAP,CAAnB;AACA,UAAIC,OAAO,GAAGtD,QAAQ,CAACnF,KAAK,CAACyI,OAAP,CAAtB;AACA,UAAIC,MAAM,GAAGH,UAAU,CAACvI,KAAK,CAAC0I,MAAP,CAAvB;AAEA9I,MAAAA,KAAK,CAAC+I,OAAN,CAAc9D,MAAd,CAAqB7E,KAAK,CAACoC,CAA3B,EAA8B,UAASwG,EAAT,EAAa;AACzCxG,QAAAA,CAAC,GAAGwG,EAAJ;AACA,YAAIxG,CAAJ,EAAOyG,MAAM;AACd,OAHD;;AAKA,UAAIA,MAAM,GAAG,SAATA,MAAS,GAAW;AACtB,YAAIC,MAAM,GAAG/I,OAAO,CAAC,CAAD,CAApB;AACA,YAAIgJ,OAAO,GAAGD,MAAM,CAACE,UAAP,CAAkB,IAAlB,CAAd;AAEAF,QAAAA,MAAM,CAACG,KAAP,GAAeH,MAAM,CAACI,WAAP,GAAmB,CAAlC;AACAJ,QAAAA,MAAM,CAACK,MAAP,GAAgBL,MAAM,CAACM,YAAP,GAAoB,CAApC;;AAEA,YAAIC,QAAQ,GAAG,SAAXA,QAAW,CAASC,EAAT,EAAaC,EAAb,EAAiBC,EAAjB,EAAqBC,EAArB,EAAyBC,KAAzB,EAAgC;AAC7CX,UAAAA,OAAO,CAACY,IAAR;AACAZ,UAAAA,OAAO,CAACa,SAAR;AACAb,UAAAA,OAAO,CAACc,MAAR,CAAeP,EAAf,EAAmBC,EAAnB;AACAR,UAAAA,OAAO,CAACe,MAAR,CAAeN,EAAf,EAAmBC,EAAnB;AACAV,UAAAA,OAAO,CAACgB,WAAR,GAAsBL,KAAtB;AACAX,UAAAA,OAAO,CAACiB,SAAR,GAAoB,CAApB;AACAjB,UAAAA,OAAO,CAACkB,MAAR;AACAlB,UAAAA,OAAO,CAACmB,OAAR;AACD,SATD;;AAWA,YAAIC,QAAQ,GAAG,SAAXA,QAAW,CAAST,KAAT,EAAgB;AAC7BX,UAAAA,OAAO,CAACY,IAAR;AACAZ,UAAAA,OAAO,CAACY,IAAR;AACAZ,UAAAA,OAAO,CAACqB,SAAR,CAAkB,CAAlB,EAAoBtB,MAAM,CAACK,MAAP,GAAc,CAAlC;AACAJ,UAAAA,OAAO,CAACnC,KAAR,CAAckC,MAAM,CAACG,KAArB,EAA2BH,MAAM,CAACK,MAAP,GAAc,CAAzC;AAEAJ,UAAAA,OAAO,CAACc,MAAR,CAAe,CAAf,EAAkB,CAACzH,CAAC,CAACkG,EAAD,CAAF,GAAOI,MAAzB;;AACA,eAAK,IAAIhH,CAAC,GAAC,CAAX,EAAcA,CAAC,IAAE+G,OAAjB,EAA0B/G,CAAC,EAA3B,EAA+B;AAC7B,gBAAI2B,CAAC,GAAG3B,CAAC,GAAC+G,OAAV;AACA,gBAAIpG,CAAC,GAAG,CAACmG,EAAE,GAACF,EAAJ,IAAUjF,CAAV,GAAciF,EAAtB;AACAS,YAAAA,OAAO,CAACe,MAAR,CAAezG,CAAf,EAAkB,CAACjB,CAAC,CAACC,CAAD,CAAF,GAAMqG,MAAxB;AACD;;AACDK,UAAAA,OAAO,CAACmB,OAAR;AACAnB,UAAAA,OAAO,CAACsB,QAAR,GAAmB,OAAnB;AACAtB,UAAAA,OAAO,CAACiB,SAAR,GAAoB,CAApB;AACAjB,UAAAA,OAAO,CAACgB,WAAR,GAAsBL,KAAtB;AACAX,UAAAA,OAAO,CAACkB,MAAR;AACAlB,UAAAA,OAAO,CAACmB,OAAR;AACD,SAlBD;;AAoBAb,QAAAA,QAAQ,CAAC,CAAD,EAAIP,MAAM,CAACK,MAAP,GAAc,CAAlB,EAAqBL,MAAM,CAACG,KAA5B,EAAmCH,MAAM,CAACK,MAAP,GAAc,CAAjD,EAAoD,MAApD,CAAR;AACAgB,QAAAA,QAAQ,CAAC,MAAD,CAAR;AACD,OAxCD;AAyCD;AAzDI,GAAP;AA2DD,CA5D2C,CAA5C;;;ACAA,IAAI1V,gBAAgB,GAAGC,OAAO,CAACC,MAAR,CAAe,kBAAf,CAAvB;AACAF,gBAAgB,CAAC6K,SAAjB,CAA2B,UAA3B,EAAuC,CAAC,UAAD,EAAa,WAAb,EAA0B,MAA1B,EAAkC,cAAlC,EAAkD,UAASC,QAAT,EAAmB+K,SAAnB,EAA8BC,IAA9B,EAAoCC,YAApC,EAAkD;AACzI,SAAO;AACL5K,IAAAA,KAAK,EAAE;AACLxJ,MAAAA,UAAU,EAAE;AADP,KADF;AAILgJ,IAAAA,WAAW,EAAE,8BAJR;AAKLU,IAAAA,IAAI,EAAE,cAASF,KAAT,EAAgBG,OAAhB,EAAyBC,KAAzB,EAAgC;AACpC,UAAI9K,MAAJ;;AACA,UAAIuV,aAAa,GAAG,SAAhBA,aAAgB,CAASnE,KAAT,EAAgB;AAClC,YAAIoE,OAAO,GAAGpE,KAAK,CAACjC,IAAN,CAAW,CAAX,CAAd;AACA,YAAI1B,KAAK,GAAG2D,KAAK,CAACjC,IAAN,CAAW,CAAX,CAAZ;AACA,YAAIsG,QAAQ,GAAGrE,KAAK,CAACjC,IAAN,CAAW,CAAX,CAAf;AAEA,YAAIuG,YAAY,GAAGpI,IAAI,CAACqI,KAAL,CAAWlI,KAAK,GAAC,EAAjB,CAAnB;AACA,YAAIiI,YAAY,GAAG,CAAnB,EAAsB;AAEtB,YAAIE,GAAG,GAAGlL,KAAK,CAACmL,OAAN,CAAcH,YAAd,CAAV;AACA,YAAI,CAACE,GAAL,EAAU;;AAEV,YAAIJ,OAAO,KAAK,GAAhB,EAAqB;AACnBI,UAAAA,GAAG,CAAC9V,IAAJ,CAAS2N,KAAK,GAAG,EAAjB,IAAuB,IAAvB;AACAmI,UAAAA,GAAG,CAACE,MAAJ;AACD,SAHD,MAGO,IAAIN,OAAO,KAAK,GAAhB,EAAqB;AAC1BI,UAAAA,GAAG,CAAC9V,IAAJ,CAAS2N,KAAK,GAAG,EAAjB,IAAuB,KAAvB;AACAmI,UAAAA,GAAG,CAACE,MAAJ;AACD;AACF,OAlBD;;AAmBA,UAAIC,QAAQ,GAAGV,IAAI,CAACW,qBAAL,CAA2BT,aAA3B,CAAf;;AACA,UAAIU,gBAAgB,GAAG,SAAnBA,gBAAmB,GAAW;AAChCZ,QAAAA,IAAI,CAACa,SAAL,GACGpH,IADH,CACQ,UAASK,IAAT,EAAe;AACnB9E,UAAAA,QAAQ,CAAC,YAAW;AAClBK,YAAAA,KAAK,CAACyL,aAAN,GAAsBhH,IAAI,CAAClP,SAA3B;AACD,WAFO,CAAR;AAGD,SALH;AAMD,OAPD;;AASAgW,MAAAA,gBAAgB;AAEhBvL,MAAAA,KAAK,CAACgE,GAAN,CAAU,UAAV,EAAsB,YAAW;AAC/BqH,QAAAA,QAAQ,CAACpH,OAAT;AACD,OAFD;AAIA,UAAIyH,aAAa,GAAG;AACZ,YAAI,GADQ;AACH,YAAI,IADD;AACO,YAAI,GADX;AACiB,YAAI,IADrB;AAC2B,YAAI,GAD/B;AAEZ,YAAI,GAFQ;AAEH,YAAI,IAFD;AAEO,YAAI,GAFX;AAEgB,YAAI,IAFpB;AAE0B,YAAI,GAF9B;AAGZ,YAAI,IAHQ;AAGF,YAAI;AAHF,OAApB;;AAKA,UAAIC,OAAO,GAAG,SAAVA,OAAU,CAASlI,CAAT,EAAY;AACxB,eAAOA,CAAC,CAACkI,OAAF,EAAP;AACD,OAFD;;AAIA,UAAIP,MAAM,GAAG,SAATA,MAAS,CAAS1V,MAAT,EAAiB;AAC5B,eAAOA,MAAM,CAAC0V,MAAP,EAAP;AACD,OAFD;;AAIApL,MAAAA,KAAK,CAAC4L,SAAN,GAAkB,YAAW;AAC3B,YAAIC,QAAQ,GAAGnB,SAAS,CAACvQ,IAAV,CAAe;AAC5BqF,UAAAA,WAAW,EAAE,wCADe;AAE5BC,UAAAA,UAAU,EAAE;AAFgB,SAAf,EAGZqM,MAHY,CAGL1H,IAHK,CAGAmH,gBAHA,CAAf;AAID,OALD;;AAOAvL,MAAAA,KAAK,CAAC2L,OAAN,GAAgB,YAAW;AACzB3L,QAAAA,KAAK,CAACmL,OAAN,CAAcjG,OAAd,CAAsByG,OAAtB;AACD,OAFD;;AAIA,UAAIjW,MAAM,GAAG,SAATA,MAAS,CAASqW,IAAT,EAAe;AAC1B,eAAO;AACLC,UAAAA,KAAK,EAAE,EADF;AAELC,UAAAA,GAAG,EAAE,EAFA;AAGL7W,UAAAA,IAAI,EAAE,EAHD;AAIL8W,UAAAA,IAAI,EAAE,EAJD;AAKLpR,UAAAA,IAAI,EAAE,cAAS+K,GAAT,EAAc;AAClB,gBAAI,KAAKqG,IAAL,CAAUrG,GAAV,CAAJ,EAAoB;AAEpB,iBAAKqG,IAAL,CAAUrG,GAAV,IAAiB7F,KAAK,CAACxJ,UAAN,CAAiB0V,IAAjB,CAAsBH,IAAI,GAAClG,GAA3B,EAAgC/K,IAAhC,EAAjB;AACD,WATI;AAULE,UAAAA,IAAI,EAAE,cAAS6K,GAAT,EAAc;AAClB,gBAAI,CAAC,KAAKqG,IAAL,CAAUrG,GAAV,CAAL,EAAoB;AACpB,iBAAKqG,IAAL,CAAUrG,GAAV,EAAe7K,IAAf;AACA,iBAAKkR,IAAL,CAAUrG,GAAV,IAAiBsG,SAAjB;AACD,WAdI;AAeLf,UAAAA,MAAM,EAAE,kBAAW;AACjB,iBAAK,IAAIvF,GAAG,GAAC,CAAb,EAAgBA,GAAG,GAAC,EAApB,EAAwBA,GAAG,EAA3B,EAA+B;AAC7B,kBAAI,KAAKmG,KAAL,CAAWnG,GAAX,KAAmB,KAAKoG,GAAL,CAASpG,GAAT,CAAnB,IAAoC,KAAKzQ,IAAL,CAAUyQ,GAAV,CAAxC,EAAwD;AACtD,qBAAK/K,IAAL,CAAU+K,GAAV;AACD,eAFD,MAEO;AACL,qBAAK7K,IAAL,CAAU6K,GAAV;AACD;AACF;;AAEDlG,YAAAA,QAAQ,CAAC,YAAU,CAAE,CAAb,CAAR;AACD,WAzBI;AA0BLgM,UAAAA,OAAO,EAAE,mBAAW;AAClB,iBAAKO,IAAL,CAAUhH,OAAV,CAAkB,UAASgH,IAAT,EAAe;AAC/B,kBAAGA,IAAI,IAAIA,IAAI,CAAClR,IAAhB,EAAsBkR,IAAI,CAAClR,IAAL;AACvB,aAFD;AAGA,iBAAKkR,IAAL,GAAY,EAAZ;AACD;AA/BI,SAAP;AAiCD,OAlCD;;AAoCA,UAAIE,OAAO,GAAG,SAAVA,OAAU,GAAW;AACvBxB,QAAAA,YAAY,CAACyB,WAAb;AACD,OAFD;;AAIA,UAAIC,QAAQ,GAAG,SAAXA,QAAW,CAAS5W,MAAT,EAAiB;AAC9B0W,QAAAA,OAAO;AAEP1W,QAAAA,MAAM,CAACsW,KAAP,GAAe,EAAf;AACAtW,QAAAA,MAAM,CAAC0V,MAAP;AACD,OALD;;AAOApL,MAAAA,KAAK,CAACuM,UAAN,GAAmB,UAAS7W,MAAT,EAAiBmQ,GAAjB,EAAsB;AACvCuG,QAAAA,OAAO;AAEP1W,QAAAA,MAAM,CAACsW,KAAP,CAAanG,GAAb,IAAoB,KAApB;AACAnQ,QAAAA,MAAM,CAAC0V,MAAP;AACD,OALD;;AAOApL,MAAAA,KAAK,CAACwM,UAAN,GAAmB,UAAS9W,MAAT,EAAiBmQ,GAAjB,EAAsB;AACvCuG,QAAAA,OAAO;AAEPpM,QAAAA,KAAK,CAACmL,OAAN,CAAcjG,OAAd,CAAsBoH,QAAtB;AACA5W,QAAAA,MAAM,CAACsW,KAAP,CAAanG,GAAb,IAAoB,IAApB;AAEA7F,QAAAA,KAAK,CAACmL,OAAN,CAAcjG,OAAd,CAAsBkG,MAAtB;AACD,OAPD;;AASA,UAAIqB,cAAc,GAAG,SAAjBA,cAAiB,CAAStL,CAAT,EAAY;AAC/BiL,QAAAA,OAAO;AAEP,YAAIM,QAAQ,CAACC,aAAT,CAAuBC,OAAvB,CAA+BC,WAA/B,OAAiD,OAArD,EAA8D;AAE9D,YAAIC,OAAO,GAAG3L,CAAC,CAAC2L,OAAhB;AACA,YAAIC,QAAQ,GAAGrB,aAAa,CAACoB,OAAD,CAA5B;AACA,YAAI,CAACC,QAAL,EAAe;AAEf,YAAIlH,GAAG,GAAG5Q,KAAK,CAAC+X,aAAN,CAAoBD,QAApB,CAAV;AACA/M,QAAAA,KAAK,CAACmL,OAAN,CAAc,CAAd,EAAiBc,GAAjB,CAAqBpG,GAArB,IAA4B,IAA5B;AACA7F,QAAAA,KAAK,CAACmL,OAAN,CAAc,CAAd,EAAiBC,MAAjB;AAEApL,QAAAA,KAAK,CAACiN,OAAN;AACD,OAdD;;AAgBA,UAAIC,YAAY,GAAG,SAAfA,YAAe,CAAS/L,CAAT,EAAY;AAC7BiL,QAAAA,OAAO;AAEP,YAAIU,OAAO,GAAG3L,CAAC,CAAC2L,OAAhB;AACA,YAAIC,QAAQ,GAAGrB,aAAa,CAACoB,OAAD,CAA5B;AACA,YAAI,CAACC,QAAL,EAAe;AAEf,YAAIlH,GAAG,GAAG5Q,KAAK,CAAC+X,aAAN,CAAoBD,QAApB,CAAV;AACA/M,QAAAA,KAAK,CAACmL,OAAN,CAAc,CAAd,EAAiBc,GAAjB,CAAqBpG,GAArB,IAA4B,KAA5B;AACA7F,QAAAA,KAAK,CAACmL,OAAN,CAAc,CAAd,EAAiBC,MAAjB;AAEApL,QAAAA,KAAK,CAACiN,OAAN;AACD,OAZD;;AAcA7E,MAAAA,CAAC,CAACsE,QAAD,CAAD,CAAYS,IAAZ,CAAiB,SAAjB,EAA4BV,cAA5B;AACArE,MAAAA,CAAC,CAACsE,QAAD,CAAD,CAAYS,IAAZ,CAAiB,OAAjB,EAA0BD,YAA1B;AAEA,UAAIE,aAAa,GAAGhF,CAAC,CAACjI,OAAD,CAAD,CAAWkN,IAAX,CAAgB,sBAAhB,CAApB;AACA,UAAIC,cAAc,GAAGlF,CAAC,CAACjI,OAAD,CAAD,CAAWkN,IAAX,CAAgB,uBAAhB,CAArB;AAEAD,MAAAA,aAAa,CAACD,IAAd,CAAmB,OAAnB,EAA4Bf,OAA5B;AACAkB,MAAAA,cAAc,CAACH,IAAf,CAAoB,OAApB,EAA6Bf,OAA7B;AAEApM,MAAAA,KAAK,CAACgE,GAAN,CAAU,UAAV,EAAsB,YAAW;AAC/BoE,QAAAA,CAAC,CAACsE,QAAD,CAAD,CAAYa,MAAZ,CAAmB,SAAnB,EAA8Bd,cAA9B;AACArE,QAAAA,CAAC,CAACsE,QAAD,CAAD,CAAYa,MAAZ,CAAmB,OAAnB,EAA4BL,YAA5B;AAEAE,QAAAA,aAAa,CAACG,MAAd,CAAqB,OAArB,EAA8BnB,OAA9B;AACAkB,QAAAA,cAAc,CAACC,MAAf,CAAsB,OAAtB,EAA+BnB,OAA/B;AAEApM,QAAAA,KAAK,CAACmL,OAAN,CAAcjG,OAAd,CAAsB,UAASxP,MAAT,EAAiB;AACrCA,UAAAA,MAAM,CAACiW,OAAP;AACD,SAFD;AAGD,OAVD;AAYA3L,MAAAA,KAAK,CAACmL,OAAN,GAAgB,CAAC,EAAD,EAAI,EAAJ,EAAO,EAAP,EAAU,EAAV,EAAa,EAAb,EAAiBzG,GAAjB,CAAqBhP,MAArB,CAAhB;AACAsK,MAAAA,KAAK,CAACiF,MAAN,CAAa,YAAb,EAA2B,UAASzO,UAAT,EAAqB;AAC9CwJ,QAAAA,KAAK,CAACxJ,UAAN,GAAmBA,UAAnB;AACD,OAFD;AAGD;AAxLI,GAAP;AA2LD,CA5LsC,CAAvC;;;ACDA3B,gBAAgB,CAAC6K,SAAjB,CAA2B,kBAA3B,EAA+C,CAAC,UAAD,EAAa,gBAAb,EAA+B,SAA/B,EAA0C,cAA1C,EAA0D,UAASC,QAAT,EAAmB6N,cAAnB,EAAmCC,OAAnC,EAA4C7C,YAA5C,EAA0D;AACjK,SAAO;AACL5K,IAAAA,KAAK,EAAE;AACL;AACAvJ,MAAAA,OAAO,EAAE,UAFJ;;AAGL;AACAiX,MAAAA,KAAK,EAAE,QAJF;;AAKL;AACAC,MAAAA,SAAS,EAAE,YANN;AAOLC,MAAAA,SAAS,EAAE,YAPN;;AAQL;AACAC,MAAAA,OAAO,EAAE,UATJ;AAULC,MAAAA,YAAY,EAAE,eAVT;AAWLrN,MAAAA,MAAM,EAAE;AAXH,KADF;AAcLjB,IAAAA,WAAW,EAAE,iDAdR;AAeLU,IAAAA,IAAI,EAAE,cAASF,KAAT,EAAgBG,OAAhB,EAAyBC,KAAzB,EAAgC;AACpCJ,MAAAA,KAAK,CAACwN,cAAN,GAAuBA,cAAvB;AACA,UAAIO,QAAQ,GAAGP,cAAf;;AAEA,UAAIQ,WAAW,GAAG,SAAdA,WAAc,GAAW;AAC3BhO,QAAAA,KAAK,CAACiO,SAAN,GAAkB,IAAlB;AACD,OAFD;;AAIA,UAAIC,iBAAiB,GAAGF,WAAxB;;AAEA,UAAIG,gBAAgB,GAAG,SAAnBA,gBAAmB,CAASzH,KAAT,EAAgB;AACrC,YAAI0H,YAAY,GAAGZ,cAAc,GAAGxN,KAAK,CAAC2N,SAA1C;;AACA,YAAI,CAACjH,KAAK,CAAC2H,MAAN,CAAaC,SAAb,CAAuBC,QAAvB,CAAgC,YAAhC,CAAL,EAAoD;AAClD;AACD;;AAGDvO,QAAAA,KAAK,CAACiO,SAAN,GAAkBjO,KAAK,CAACiO,SAAN,IAAmB,EAArC;AACAjO,QAAAA,KAAK,CAACiO,SAAN,CAAgB5K,CAAhB,GAAoBT,IAAI,CAACqI,KAAL,CAAWuD,UAAU,KAAK9H,KAAK,CAAC+H,OAAN,GAAgB,EAA1C,CAApB;AACAzO,QAAAA,KAAK,CAACiO,SAAN,CAAgBS,CAAhB,GAAoBX,QAApB;;AAEA,YAAI/N,KAAK,CAACiO,SAAN,CAAgBU,CAApB,EAAuB;AACrB,cAAIC,aAAa,GAAGhM,IAAI,CAACqI,KAAL,CAAWvE,KAAK,CAACmI,OAAN,GAAgB7O,KAAK,CAAC4N,SAAtB,GAAkC5N,KAAK,CAAC2N,SAAxC,GAAoDH,cAA/D,CAApB;AACAoB,UAAAA,aAAa,GAAGhM,IAAI,CAACqI,KAAL,CAAW2D,aAAX,CAAhB;AACA,cAAIE,KAAK,GAAGrB,OAAO,CAACsB,SAAR,CAAkB/O,KAAK,CAACvJ,OAAxB,EAAiCuJ,KAAK,CAAC0N,KAAvC,EAA8C;AAACiB,YAAAA,CAAC,EAAEC,aAAJ;AAAmBF,YAAAA,CAAC,EAAEX;AAAtB,WAA9C,EAA+Ea,aAA/E,CAAZ;;AAEA,cAAIhM,IAAI,CAACoM,GAAL,CAASJ,aAAa,GAAGE,KAAhB,GAAwBV,YAAY,GAAG,CAAhD,IAAqDA,YAAzD,EAAuE;AACrEpO,YAAAA,KAAK,CAACiO,SAAN,CAAgBU,CAAhB,GAAoBG,KAApB;AAEArB,YAAAA,OAAO,CAACwB,QAAR,CAAiBjP,KAAK,CAACvJ,OAAvB,EAAgCuJ,KAAK,CAAC0N,KAAtC,EAA6C1N,KAAK,CAACiO,SAAnD;AACA;AACD;AACF;;AAEDjO,QAAAA,KAAK,CAACiO,SAAN,CAAgBU,CAAhB,GAAoB/L,IAAI,CAACqI,KAAL,CAAWrI,IAAI,CAACqI,KAAL,CAAWvE,KAAK,CAACmI,OAAN,GAAgB,CAAhB,GAAoB7O,KAAK,CAAC4N,SAArC,IAAkD,CAAlD,GAAsD5N,KAAK,CAAC2N,SAA5D,GAAwEH,cAAnF,CAApB;AACA,YAAIxN,KAAK,CAACiO,SAAN,CAAgBU,CAAhB,GAAoB,CAAxB,EAA2B3O,KAAK,CAACiO,SAAN,CAAgBU,CAAhB,GAAoB,CAApB;AAC3BlB,QAAAA,OAAO,CAACwB,QAAR,CAAiBjP,KAAK,CAACvJ,OAAvB,EAAgCuJ,KAAK,CAAC0N,KAAtC,EAA6C1N,KAAK,CAACiO,SAAnD;AACD,OA3BD;;AA6BA,UAAIhH,cAAc,GAAG,SAAjBA,cAAiB,CAAS5D,CAAT,EAAY;AAC/B,eAAO,CAAC,CAAD,EAAG,CAAC,CAAD,EAAG,CAAH,CAAH,EAAU,CAAV,EAAa,CAAC,CAAD,EAAG,CAAH,CAAb,EAAoB,CAApB,EAAuB,CAAvB,EAA0B,CAAC,CAAD,EAAG,CAAH,CAA1B,EAAiC,CAAjC,EAAoC,CAAC,CAAD,EAAG,CAAH,CAApC,EAA2C,CAA3C,EAA8C,CAAC,CAAD,EAAG,CAAH,CAA9C,EAAqD,CAArD,EAAwDA,CAAC,GAAC,EAA1D,CAAP;AACD,OAFD;;AAIA,UAAI6D,cAAc,GAAG,SAAjBA,cAAiB,CAAS7D,CAAT,EAAY;AAC/B,eAAO,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,EAAS,CAAT,EAAW,CAAX,EAAa,EAAb,EAAiBA,CAAC,GAAC,CAAnB,CAAP;AACD,OAFD;;AAIA,UAAI8D,SAAS,GAAG,SAAZA,SAAY,CAAS9D,CAAT,EAAY;AAC1B,eAAO,CAAC,GAAD,EAAK,GAAL,EAAS,GAAT,EAAa,GAAb,EAAiB,GAAjB,EAAqB,GAArB,EAAyB,GAAzB,EAA8BA,CAAC,GAAG,CAAlC,CAAP;AACD,OAFD;;AAIArD,MAAAA,KAAK,CAACkP,iBAAN,GAA0B,UAASC,MAAT,EAAiBC,GAAjB,EAAsB1B,KAAtB,EAA6B;AACrD1N,QAAAA,KAAK,CAACmF,KAAN,CAAY,cAAZ,EAA4B;AAACgK,UAAAA,MAAM,EAAEA,MAAT;AAAgBC,UAAAA,GAAG,EAAEA,GAArB;AAA0B1B,UAAAA,KAAK,EAAEA;AAAjC,SAA5B;AACD,OAFD;;AAIA1N,MAAAA,KAAK,CAAC+M,QAAN,GAAiB,UAAS1J,CAAT,EAAY;AAC3B,YAAIgM,KAAK,GAAGpI,cAAc,CAAC5D,CAAD,CAA1B;AACA,YAAI3N,MAAM,GAAGkN,IAAI,CAACqI,KAAL,CAAW5H,CAAC,GAAC,EAAb,CAAb;;AAEA,YAAIxB,KAAK,CAACyN,OAAN,CAAcD,KAAd,CAAJ,EAA0B;AACxBA,UAAAA,KAAK,GAAGA,KAAK,CAAC,CAAD,CAAb;AACA,iBAAOlI,SAAS,CAACkI,KAAD,CAAT,GAAmB,GAAnB,GAAyB3Z,MAAhC;AACD,SAHD,MAGO;AACL,iBAAOyR,SAAS,CAACkI,KAAD,CAAT,GAAmB3Z,MAA1B;AACD;AACF,OAVD;;AAYA,UAAI6Z,UAAU,GAAG,SAAbA,UAAa,GAAW;AAC1BvP,QAAAA,KAAK,CAACwP,aAAN,GAAsB;AAAC,6BAAoBxP,KAAK,CAAC6N,OAAN,GAAc7N,KAAK,CAAC4N,SAApB,GAA8B5N,KAAK,CAAC2N,SAArC,GAAkD;AAAtE,SAAtB;AACD,OAFD;;AAIA3N,MAAAA,KAAK,CAACiF,MAAN,CAAa,iCAAb,EAAgDsK,UAAhD;AACAvP,MAAAA,KAAK,CAACiF,MAAN,CAAa,cAAb,EAA6B,YAAW;AACtCjF,QAAAA,KAAK,CAACmF,KAAN,CAAY,cAAZ,EAA4BnF,KAAK,CAAC0N,KAAlC;AACD,OAFD;AAIA/N,MAAAA,QAAQ,CAAC4P,UAAD,CAAR;;AAEA,UAAIE,WAAW,GAAG,SAAdA,WAAc,CAASC,MAAT,EAAiB;AACjC,YAAI1P,KAAK,CAAC0N,KAAN,CAAYjY,MAAZ,CAAmB4X,IAAnB,CAAwB,UAAS+B,GAAT,EAAc;AACxC,iBAAOM,MAAM,CAACf,CAAP,KAAaS,GAAG,CAACT,CAAjB,IAAsBe,MAAM,CAACrM,CAAP,KAAa+L,GAAG,CAAC/L,CAA9C;AACD,SAFG,CAAJ,EAEI;AACF;AACD;;AAEDqM,QAAAA,MAAM,GAAG5a,OAAO,CAAC6a,IAAR,CAAaD,MAAb,CAAT;AAEA,YAAIjC,OAAO,CAACmC,SAAR,CAAkB5P,KAAK,CAAC0N,KAAxB,EAA+BgC,MAA/B,CAAJ,EAA4C;AAE5C1P,QAAAA,KAAK,CAACmF,KAAN,CAAY,oBAAZ,EAAkCuK,MAAlC;AACA1P,QAAAA,KAAK,CAAC6P,QAAN,GAAiBH,MAAjB;AAEA1P,QAAAA,KAAK,CAACS,MAAN,CAAaqP,KAAb,CAAmB,oBAAnB;AACA9P,QAAAA,KAAK,CAAC0N,KAAN,CAAYjY,MAAZ,CAAmBiO,IAAnB,CAAwBgM,MAAxB;AAEA1P,QAAAA,KAAK,CAACmF,KAAN,CAAY,cAAZ,EAA4BnF,KAAK,CAAC0N,KAAlC;AACA1N,QAAAA,KAAK,CAACmF,KAAN,CAAY,cAAZ,EAA4B;AAACgK,UAAAA,MAAM,EAAC,EAAR;AAAYC,UAAAA,GAAG,EAACM,MAAhB;AAAwBhC,UAAAA,KAAK,EAAE1N,KAAK,CAAC0N;AAArC,SAA5B;AAEA1N,QAAAA,KAAK,CAAC+P,SAAN,GAAkBC,SAAS,CAACN,MAAD,EAAS,CAAT,CAA3B;AACA1P,QAAAA,KAAK,CAACiQ,cAAN,GAAuBC,kBAAkB,CAACR,MAAD,EAAS,CAAT,CAAzC;AAEA1B,QAAAA,WAAW;;AAEXhO,QAAAA,KAAK,CAACuM,UAAN,GAAmB,YAAW;AAC5B2B,UAAAA,iBAAiB;AACjBiC,UAAAA,UAAU;AACX,SAHD;;AAKAnQ,QAAAA,KAAK,CAACoQ,kBAAN,GAA2BD,UAA3B;AACAnQ,QAAAA,KAAK,CAACqQ,YAAN,GAAqBF,UAArB;AACAnQ,QAAAA,KAAK,CAACsQ,OAAN,GAAgBH,UAAhB;AACD,OAjCD;;AAmCAnQ,MAAAA,KAAK,CAACuQ,oBAAN,GAA6B,YAAW;AACtCvC,QAAAA,WAAW;AACZ,OAFD;;AAIAhO,MAAAA,KAAK,CAACwQ,eAAN,GAAwB,UAAS9J,KAAT,EAAgB;AACtC,YAAI+J,MAAM,GAAG7N,IAAI,CAACqI,KAAL,CAAWvE,KAAK,CAACmI,OAAN,GAAgB,CAAhB,GAAoB7O,KAAK,CAAC4N,SAArC,IAAkD,CAAlD,GAAsD5N,KAAK,CAAC2N,SAA5D,GAAwEH,cAArF;AACA,YAAIiD,MAAM,GAAG,CAAb,EAAgBzQ,KAAK,CAACiO,SAAN,CAAgBU,CAAhB,GAAoB3O,KAAK,CAACiO,SAAN,CAAgBU,CAAhB,GAAoB8B,MAAxC;AAEhBhD,QAAAA,OAAO,CAACwB,QAAR,CAAiBjP,KAAK,CAACvJ,OAAvB,EAAgCuJ,KAAK,CAAC0N,KAAtC,EAA6C1N,KAAK,CAACiO,SAAnD;AACD,OALD;;AAOAjO,MAAAA,KAAK,CAAC0Q,aAAN,GAAsB,UAAShK,KAAT,EAAgB;AACpC+I,QAAAA,WAAW,CAACzP,KAAK,CAACiO,SAAP,CAAX;AACD,OAFD;;AAIAjO,MAAAA,KAAK,CAACsQ,OAAN,GAAgB,UAAS5J,KAAT,EAAgB;AAC9B1G,QAAAA,KAAK,CAAC+P,SAAN,GAAkB5B,gBAAlB;AACD,OAFD;;AAIAnO,MAAAA,KAAK,CAACuM,UAAN,GAAmB,YAAW;AAC5B2B,QAAAA,iBAAiB;AACjBlO,QAAAA,KAAK,CAAC+P,SAAN,GAAkB5B,gBAAlB;AACD,OAHD;;AAKAnO,MAAAA,KAAK,CAAC+P,SAAN,GAAkB5B,gBAAlB;AACAnO,MAAAA,KAAK,CAACiQ,cAAN,GAAuBjC,WAAvB;;AAEA,UAAIQ,UAAU,GAAG,SAAbA,UAAa,GAAW;AAC1B,eAAOxO,KAAK,CAAC0N,KAAN,CAAYlX,UAAZ,KAA2B,OAA3B,GAAqC,IAArC,GAA4C,GAAnD;AACD,OAFD;;AAIA,UAAIma,GAAG,GAAG,SAANA,GAAM,CAASC,EAAT,EAAaC,EAAb,EAAiB;AACzB,eAAOD,EAAE,GAAGC,EAAL,GAAUD,EAAV,GAAeC,EAAtB;AACD,OAFD;;AAIA,UAAIC,gBAAgB,GAAG,SAAnBA,gBAAmB,CAAS1B,GAAT,EAAc5M,CAAd,EAAiB;AACtC,eAAO,YAAW;AAChB,cAAIuO,QAAQ,GAAGjc,OAAO,CAAC6a,IAAR,CAAaP,GAAb,CAAf;AACA,cAAIpO,GAAG,GAAGwB,CAAC,CAACwO,KAAF,CAAQ,IAAR,EAAcC,SAAd,CAAV;;AAEA,cAAIxD,OAAO,CAACmC,SAAR,CAAkB5P,KAAK,CAAC0N,KAAxB,EAA+B0B,GAA/B,CAAJ,EAAyC;AACvCA,YAAAA,GAAG,CAAC/L,CAAJ,GAAQ0N,QAAQ,CAAC1N,CAAjB;AACA+L,YAAAA,GAAG,CAACT,CAAJ,GAAQoC,QAAQ,CAACpC,CAAjB;AACAS,YAAAA,GAAG,CAACV,CAAJ,GAAQqC,QAAQ,CAACrC,CAAjB;AACA;AACD;;AAED,cAAIU,GAAG,CAAC/L,CAAJ,KAAU0N,QAAQ,CAAC1N,CAAnB,IAAwB+L,GAAG,CAACV,CAAJ,KAAUqC,QAAQ,CAACrC,CAA3C,IAAgDU,GAAG,CAACT,CAAJ,KAAUoC,QAAQ,CAACpC,CAAvE,EAA0E;AACxE3O,YAAAA,KAAK,CAACmF,KAAN,CAAY,cAAZ,EAA4BnF,KAAK,CAAC0N,KAAlC;AACA1N,YAAAA,KAAK,CAACmF,KAAN,CAAY,cAAZ,EAA4B;AAACgK,cAAAA,MAAM,EAAE4B,QAAT;AAAmB3B,cAAAA,GAAG,EAACA,GAAvB;AAA4B1B,cAAAA,KAAK,EAAE1N,KAAK,CAAC0N;AAAzC,aAA5B;AACD;AACF,SAfD;AAgBD,OAjBD;;AAmBA,UAAIsC,SAAS,GAAG,SAAZA,SAAY,CAASZ,GAAT,EAAcP,OAAd,EAAuB;AACrC,eAAO,UAASnI,KAAT,EAAgB;AACrBkE,UAAAA,YAAY,CAACyB,WAAb;AAEA,cAAI+B,YAAY,GAAGZ,cAAc,GAAGxN,KAAK,CAAC2N,SAA1C;AACA,cAAIwB,MAAM,GAAG;AAAC9L,YAAAA,CAAC,EAAC+L,GAAG,CAAC/L,CAAP;AAAUsL,YAAAA,CAAC,EAACS,GAAG,CAACT,CAAhB;AAAmBD,YAAAA,CAAC,EAACU,GAAG,CAACV;AAAzB,WAAb;AAEA,cAAIE,aAAa,GAAGhM,IAAI,CAACqI,KAAL,CAAW,CAACvE,KAAK,CAACmI,OAAN,GAAgBA,OAAjB,IAA4B7O,KAAK,CAAC4N,SAAlC,GAA8C5N,KAAK,CAAC2N,SAApD,GAAgEH,cAA3E,CAApB;AACAoB,UAAAA,aAAa,GAAGhM,IAAI,CAACqI,KAAL,CAAW2D,aAAX,CAAhB;AACA,cAAIE,KAAK,GAAGrB,OAAO,CAACsB,SAAR,CAAkB/O,KAAK,CAACvJ,OAAxB,EAAiCuJ,KAAK,CAAC0N,KAAvC,EAA8C0B,GAA9C,EAAmDR,aAAnD,CAAZ;AAEA,cAAI,CAAClI,KAAK,CAAC2H,MAAN,CAAaC,SAAb,CAAuBC,QAAvB,CAAgC,YAAhC,CAAL,EAAoD;;AAEpD,cAAI3L,IAAI,CAACoM,GAAL,CAASJ,aAAa,GAAGE,KAAhB,GAAwBV,YAAY,GAAG,CAAhD,IAAqDA,YAAzD,EAAuE;AACrEgB,YAAAA,GAAG,CAACT,CAAJ,GAAQG,KAAR;AACD,WAFD,MAEO;AACLM,YAAAA,GAAG,CAACT,CAAJ,GAAQ/L,IAAI,CAACqI,KAAL,CAAW,CAACvE,KAAK,CAACmI,OAAN,GAAgBA,OAAjB,IAA4B,CAA5B,GAAgC7O,KAAK,CAAC4N,SAAjD,IAA8D,CAA9D,GAAkE5N,KAAK,CAAC2N,SAAxE,GAAoFH,cAA5F;AACA4B,YAAAA,GAAG,CAACT,CAAJ,GAAQ/L,IAAI,CAACqI,KAAL,CAAWmE,GAAG,CAACT,CAAf,CAAR;AACD;;AAED,cAAIS,GAAG,CAACT,CAAJ,GAAQ,CAAZ,EAAeS,GAAG,CAACT,CAAJ,GAAQ,CAAR;AAEf,cAAIuC,IAAI,GAAG9B,GAAG,CAAC/L,CAAf;AACA+L,UAAAA,GAAG,CAAC/L,CAAJ,GAAQT,IAAI,CAACqI,KAAL,CAAWuD,UAAU,KAAK9H,KAAK,CAAC+H,OAAN,GAAgB,EAA1C,CAAR;AACD,SAvBD;AAwBD,OAzBD;;AA2BA,UAAIyB,kBAAkB,GAAG,SAArBA,kBAAqB,CAASd,GAAT,EAAcP,OAAd,EAAuB;AAC9Cb,QAAAA,WAAW;AACX,eAAO,UAASmD,OAAT,EAAkBzK,KAAlB,EAAyB;AAC9BkE,UAAAA,YAAY,CAACyB,WAAb;AAEA,cAAI+B,YAAY,GAAGZ,cAAc,GAAGxN,KAAK,CAAC2N,SAA1C;AACA,cAAIwB,MAAM,GAAG;AAAC9L,YAAAA,CAAC,EAAC+L,GAAG,CAAC/L,CAAP;AAAUsL,YAAAA,CAAC,EAACS,GAAG,CAACT,CAAhB;AAAmBD,YAAAA,CAAC,EAACU,GAAG,CAACV;AAAzB,WAAb;AAEA,cAAIE,aAAa,GAAGuC,OAAO,CAACxC,CAAR,GAAY/L,IAAI,CAACqI,KAAL,CAAW,CAACvE,KAAK,CAACmI,OAAN,GAAgBA,OAAjB,IAA4B7O,KAAK,CAAC4N,SAAlC,GAA8C5N,KAAK,CAAC2N,SAApD,GAAgEH,cAA3E,CAAhC;AACAoB,UAAAA,aAAa,GAAGhM,IAAI,CAACqI,KAAL,CAAW2D,aAAX,CAAhB;AACA,cAAIE,KAAK,GAAGrB,OAAO,CAACsB,SAAR,CAAkB/O,KAAK,CAACvJ,OAAxB,EAAiCuJ,KAAK,CAAC0N,KAAvC,EAA8C0B,GAA9C,EAAmDR,aAAnD,CAAZ;;AAEA,cAAIhM,IAAI,CAACoM,GAAL,CAASJ,aAAa,GAAGE,KAAhB,GAAwBV,YAAY,GAAG,CAAhD,IAAqDA,YAAzD,EAAuE;AACrEgB,YAAAA,GAAG,CAACT,CAAJ,GAAQG,KAAR;AACD,WAFD,MAEO;AACLM,YAAAA,GAAG,CAACT,CAAJ,GAAQwC,OAAO,CAACxC,CAAR,GAAY/L,IAAI,CAACqI,KAAL,CAAW,CAACvE,KAAK,CAACmI,OAAN,GAAgBA,OAAjB,IAA4B,CAA5B,GAAgC7O,KAAK,CAAC4N,SAAjD,IAA8D,CAA9D,GAAkE5N,KAAK,CAAC2N,SAAxE,GAAoFH,cAAxG;AACA4B,YAAAA,GAAG,CAACT,CAAJ,GAAQ/L,IAAI,CAACqI,KAAL,CAAWmE,GAAG,CAACT,CAAf,CAAR;AACD;;AAEDS,UAAAA,GAAG,CAAC/L,CAAJ,GAAQ8N,OAAO,CAAC9N,CAAhB;AACA,cAAI+L,GAAG,CAACT,CAAJ,GAAQ,CAAZ,EAAeS,GAAG,CAACT,CAAJ,GAAQ,CAAR;AAChB,SAnBD;AAoBD,OAtBD;;AAwBA,UAAIwB,UAAU,GAAG,SAAbA,UAAa,GAAW;AAC1BnQ,QAAAA,KAAK,CAACiQ,cAAN,GAAuBjC,WAAvB;AACAhO,QAAAA,KAAK,CAAC+P,SAAN,GAAkB5B,gBAAlB;AACAnO,QAAAA,KAAK,CAACuM,UAAN,GAAmB2B,iBAAnB;AACD,OAJD;;AAMAlO,MAAAA,KAAK,CAACoR,SAAN,GAAkB,UAAS1K,KAAT,EAAgB;AAChCkE,QAAAA,YAAY,CAACyB,WAAb;AAEA,YAAI,CAAC3F,KAAK,CAAC2H,MAAN,CAAaC,SAAb,CAAuBC,QAAvB,CAAgC,YAAhC,CAAL,EAAoD;AACpD,YAAImB,MAAM,GAAG;AACXrM,UAAAA,CAAC,EAAET,IAAI,CAACqI,KAAL,CAAWuD,UAAU,KAAK9H,KAAK,CAAC+H,OAAN,GAAgB,EAA1C,CADQ;AAEXE,UAAAA,CAAC,EAAE/L,IAAI,CAACqI,KAAL,CAAWvE,KAAK,CAACmI,OAAN,GAAgB7O,KAAK,CAAC4N,SAAjC,IAA8C5N,KAAK,CAAC2N,SAApD,GAAgEH,cAFxD;AAGXkB,UAAAA,CAAC,EAAEX;AAHQ,SAAb;AAMA2B,QAAAA,MAAM,CAACf,CAAP,GAAW/L,IAAI,CAACqI,KAAL,CAAWyE,MAAM,CAACf,CAAlB,CAAX;AAEAlB,QAAAA,OAAO,CAACwB,QAAR,CAAiBjP,KAAK,CAACvJ,OAAvB,EAAgCuJ,KAAK,CAAC0N,KAAtC,EAA6CgC,MAA7C;AACAD,QAAAA,WAAW,CAACC,MAAD,CAAX;AACD,OAdD;;AAgBA,UAAI2B,UAAU,GAAG,SAAbA,UAAa,CAASjC,GAAT,EAAckC,KAAd,EAAqB;AACpC,YAAIC,SAAS,GAAGnC,GAAG,CAACV,CAApB;AACAU,QAAAA,GAAG,CAACV,CAAJ,GAAQ4C,KAAR;AACA,YAAI5B,MAAM,GAAG;AACXrM,UAAAA,CAAC,EAAE+L,GAAG,CAAC/L,CADI;AAEXsL,UAAAA,CAAC,EAAES,GAAG,CAACT,CAAJ,GAAQS,GAAG,CAACV,CAFJ;AAGXA,UAAAA,CAAC,EAAE6C,SAAS,GAAGD;AAHJ,SAAb;AAKAtR,QAAAA,KAAK,CAACS,MAAN,CAAaqP,KAAb,CAAmB,oBAAnB;AACA9P,QAAAA,KAAK,CAAC0N,KAAN,CAAYjY,MAAZ,CAAmBiO,IAAnB,CAAwBgM,MAAxB;AACD,OAVD;;AAYA,UAAI8B,cAAc,GAAG,SAAjBA,cAAiB,CAASpC,GAAT,EAAc;AACjC,YAAIA,GAAG,CAACV,CAAJ,GAAQ,CAAR,KAAc,CAAlB,EAAqB;AACnB2C,UAAAA,UAAU,CAACjC,GAAD,EAAMA,GAAG,CAACV,CAAJ,GAAQ,CAAd,CAAV;AACD,SAFD,MAEO;AACL+C,UAAAA,gBAAgB,CAACrC,GAAD,CAAhB;AACD;AACF,OAND;;AAQA,UAAIsC,eAAe,GAAG,SAAlBA,eAAkB,CAAStC,GAAT,EAAc;AAClC,YAAIA,GAAG,CAACV,CAAJ,GAAQ,CAAR,KAAc,CAAlB,EAAqB;AACnB2C,UAAAA,UAAU,CAACjC,GAAD,EAAMA,GAAG,CAACV,CAAJ,GAAQ,CAAR,GAAY,CAAlB,CAAV;AACD,SAFD,MAEO;AACL+C,UAAAA,gBAAgB,CAACrC,GAAD,CAAhB;AACD;AACF,OAND;;AAQA,UAAIqC,gBAAgB,GAAG,SAAnBA,gBAAmB,CAASrC,GAAT,EAAc;AACnC,YAAIA,GAAG,CAACV,CAAJ,GAAQ,CAAR,KAAc,CAAlB,EAAqB;AACnB2C,UAAAA,UAAU,CAACjC,GAAD,EAAMA,GAAG,CAACV,CAAJ,GAAQ,CAAd,CAAV;AACD;AACF,OAJD;;AAMA1O,MAAAA,KAAK,CAAC2R,kBAAN,GAA2B,UAASvC,GAAT,EAAc1I,KAAd,EAAqB;AAC9C,YAAIkL,YAAY,GAAGxJ,CAAC,CAAC1B,KAAK,CAAC2H,MAAP,CAAD,CAAgB,CAAhB,EAAmB/E,WAAnB,GAA+B,CAAlD;;AAEA,YAAI5C,KAAK,CAACmI,OAAN,GAAgB+C,YAAY,GAAC,CAAjC,EAAoC;AAClCJ,UAAAA,cAAc,CAACpC,GAAD,CAAd;AACD,SAFD,MAEO,IAAI1I,KAAK,CAACmI,OAAN,GAAgB+C,YAAY,GAAC,CAAb,GAAe,CAAnC,EAAsC;AAC3CF,UAAAA,eAAe,CAACtC,GAAD,CAAf;AACD,SAFM,MAEA;AACLqC,UAAAA,gBAAgB,CAACrC,GAAD,CAAhB;AACD;AACF,OAVD;;AAYApP,MAAAA,KAAK,CAAC6R,cAAN,GAAuB,UAASzC,GAAT,EAAc1I,KAAd,EAAqB;AAC1CkE,QAAAA,YAAY,CAACyB,WAAb;AAEA3F,QAAAA,KAAK,CAACoL,cAAN;AACApF,QAAAA,QAAQ,CAACC,aAAT,CAAuBoF,IAAvB;AAEA/R,QAAAA,KAAK,CAACmF,KAAN,CAAY,eAAZ,EAA6B;AAACiK,UAAAA,GAAG,EAAEA,GAAN;AAAW1B,UAAAA,KAAK,EAAE1N,KAAK,CAAC0N;AAAxB,SAA7B;AAEA1N,QAAAA,KAAK,CAACmF,KAAN,CAAY,oBAAZ,EAAkCiK,GAAlC;AACApP,QAAAA,KAAK,CAAC6P,QAAN,GAAiBT,GAAjB;AAEApP,QAAAA,KAAK,CAAC+P,SAAN,GAAkBe,gBAAgB,CAAC1B,GAAD,EAAMY,SAAS,CAACZ,GAAD,EAAM1I,KAAK,CAACmI,OAAZ,CAAf,CAAlC;AACA7O,QAAAA,KAAK,CAACiQ,cAAN,GAAuBa,gBAAgB,CAAC1B,GAAD,EAAMc,kBAAkB,CAACd,GAAD,EAAM1I,KAAK,CAACmI,OAAZ,CAAxB,CAAvC;AAEAb,QAAAA,WAAW;;AAEXhO,QAAAA,KAAK,CAACuM,UAAN,GAAmB,YAAW;AAC5B2B,UAAAA,iBAAiB;AACjBiC,UAAAA,UAAU;AACX,SAHD;;AAKA,YAAI6B,WAAW,GAAG,SAAdA,WAAc,GAAW;AAC3BhS,UAAAA,KAAK,CAACS,MAAN,CAAaqP,KAAb,CAAmB,mBAAnB;AACAK,UAAAA,UAAU;AACX,SAHD;;AAKAnQ,QAAAA,KAAK,CAACoQ,kBAAN,GAA2B4B,WAA3B;AACAhS,QAAAA,KAAK,CAACqQ,YAAN,GAAqB2B,WAArB;AACAhS,QAAAA,KAAK,CAACsQ,OAAN,GAAgB0B,WAAhB;AACD,OA7BD;;AA+BAhS,MAAAA,KAAK,CAACiS,oBAAN,GAA6B,UAAS7C,GAAT,EAAc1I,KAAd,EAAqB;AAChDkE,QAAAA,YAAY,CAACyB,WAAb;AAEA3F,QAAAA,KAAK,CAACoL,cAAN;AAEA9R,QAAAA,KAAK,CAACmF,KAAN,CAAY,oBAAZ,EAAkCiK,GAAlC;AACApP,QAAAA,KAAK,CAAC6P,QAAN,GAAiBT,GAAjB;AAEApP,QAAAA,KAAK,CAAC+P,SAAN,GAAkBe,gBAAgB,CAAC1B,GAAD,EAAM,UAAS1I,KAAT,EAAgB;AACtD,cAAIyI,MAAM,GAAG;AAAC9L,YAAAA,CAAC,EAAC+L,GAAG,CAAC/L,CAAP;AAAUsL,YAAAA,CAAC,EAACS,GAAG,CAACT,CAAhB;AAAmBD,YAAAA,CAAC,EAACU,GAAG,CAACV;AAAzB,WAAb;AACA,cAAIN,YAAY,GAAGZ,cAAc,GAAGxN,KAAK,CAAC2N,SAA1C;AACA,cAAIuE,KAAK,GAAGzE,OAAO,CAAC0E,SAAR,CAAkBnS,KAAK,CAACvJ,OAAxB,EAAiCuJ,KAAK,CAAC0N,KAAvC,EAA8C0B,GAA9C,EAAmDA,GAAG,CAACT,CAAvD,CAAZ;AAEA,cAAI,CAACjI,KAAK,CAAC2H,MAAN,CAAaC,SAAb,CAAuBC,QAAvB,CAAgC,YAAhC,CAAL,EAAoD;AAEpD,cAAI6D,MAAM,GAAGxP,IAAI,CAACqI,KAAL,CAAWvE,KAAK,CAACmI,OAAN,GAAgB7O,KAAK,CAAC4N,SAAtB,GAAkC5N,KAAK,CAAC2N,SAAxC,GAAoDH,cAA/D,IAAiF4B,GAAG,CAACT,CAAlG;;AAEA,cAAI/L,IAAI,CAACoM,GAAL,CAASoD,MAAM,GAAGF,KAAT,GAAiB9D,YAA1B,IAA0CA,YAA9C,EAA4D;AAC1DgB,YAAAA,GAAG,CAACV,CAAJ,GAAQwD,KAAR;AACD,WAFD,MAEO;AACL,gBAAIG,IAAI,GAAGzP,IAAI,CAACqI,KAAL,CAAWvE,KAAK,CAACmI,OAAN,GAAgB7O,KAAK,CAAC4N,SAAtB,GAAkC,CAA7C,IAAkD,CAAlD,GAAsD5N,KAAK,CAAC2N,SAA5D,GAAwEH,cAAnF;AACA4B,YAAAA,GAAG,CAACV,CAAJ,GAAQ2D,IAAI,GAAGjD,GAAG,CAACT,CAAnB;AACAS,YAAAA,GAAG,CAACV,CAAJ,GAAQ9L,IAAI,CAACqI,KAAL,CAAWmE,GAAG,CAACV,CAAf,CAAR;AACA,gBAAIU,GAAG,CAACV,CAAJ,GAAMlB,cAAc,GAACxN,KAAK,CAAC2N,SAA/B,EAA0CyB,GAAG,CAACV,CAAJ,GAAMlB,cAAc,GAACxN,KAAK,CAAC2N,SAA3B;AAE1CI,YAAAA,QAAQ,GAAGqB,GAAG,CAACV,CAAf;AACD;AACF,SAnBiC,CAAlC;AAqBA1O,QAAAA,KAAK,CAACiQ,cAAN,GAAuBa,gBAAgB,CAAC1B,GAAD,EAAM,UAAS+B,OAAT,EAAkBzK,KAAlB,EAAyB;AACpE,cAAIyI,MAAM,GAAG;AAAC9L,YAAAA,CAAC,EAAC+L,GAAG,CAAC/L,CAAP;AAAUsL,YAAAA,CAAC,EAACS,GAAG,CAACT,CAAhB;AAAmBD,YAAAA,CAAC,EAACU,GAAG,CAACV;AAAzB,WAAb;AACA,cAAIN,YAAY,GAAGZ,cAAc,GAAGxN,KAAK,CAAC2N,SAA1C;AACA,cAAIuE,KAAK,GAAGzE,OAAO,CAAC0E,SAAR,CAAkBnS,KAAK,CAACvJ,OAAxB,EAAiCuJ,KAAK,CAAC0N,KAAvC,EAA8C0B,GAA9C,EAAmDA,GAAG,CAACT,CAAvD,CAAZ;AAEA,cAAIyD,MAAM,GAAGjB,OAAO,CAACxC,CAAR,GACX/L,IAAI,CAACqI,KAAL,CAAWvE,KAAK,CAACmI,OAAN,GAAgB7O,KAAK,CAAC4N,SAAtB,GAAkC5N,KAAK,CAAC2N,SAAxC,GAAoDH,cAA/D,CADW,GAEX4B,GAAG,CAACT,CAFN;;AAIA,cAAI/L,IAAI,CAACoM,GAAL,CAASoD,MAAM,GAAGF,KAAT,GAAiB9D,YAA1B,IAA0CA,YAA9C,EAA4D;AAC1DgB,YAAAA,GAAG,CAACV,CAAJ,GAAQwD,KAAR;AACD,WAFD,MAEO;AACL,gBAAIG,IAAI,GAAGlB,OAAO,CAACxC,CAAR,GAAY/L,IAAI,CAACqI,KAAL,CAAWvE,KAAK,CAACmI,OAAN,GAAgB7O,KAAK,CAAC4N,SAAtB,GAAkC,CAA7C,IAAkD,CAAlD,GAAsD5N,KAAK,CAAC2N,SAA5D,GAAwEH,cAA/F;AACA4B,YAAAA,GAAG,CAACV,CAAJ,GAAQ2D,IAAI,GAAGjD,GAAG,CAACT,CAAnB;AACAS,YAAAA,GAAG,CAACV,CAAJ,GAAQ9L,IAAI,CAACqI,KAAL,CAAWmE,GAAG,CAACV,CAAf,CAAR;AAEA,gBAAIU,GAAG,CAACV,CAAJ,GAAMlB,cAAc,GAACxN,KAAK,CAAC2N,SAA/B,EAA0CyB,GAAG,CAACV,CAAJ,GAAMlB,cAAc,GAACxN,KAAK,CAAC2N,SAA3B;AAE1CI,YAAAA,QAAQ,GAAGqB,GAAG,CAACV,CAAf;AACD;AACF,SApBsC,CAAvC;AAsBA1O,QAAAA,KAAK,CAACoQ,kBAAN,GAA2BD,UAA3B;AACAnQ,QAAAA,KAAK,CAACqQ,YAAN,GAAqBF,UAArB;AACAnQ,QAAAA,KAAK,CAACsQ,OAAN,GAAgBH,UAAhB;AACD,OAtDD;;AAwDA,UAAI1D,cAAc,GAAG,SAAjBA,cAAiB,CAAStL,CAAT,EAAY;AAC/B,YAAIuL,QAAQ,CAACC,aAAT,CAAuBC,OAAvB,CAA+BC,WAA/B,OAAiD,OAArD,EAA8D;;AAE9D,YAAI1L,CAAC,CAAC2L,OAAF,IAAa,EAAjB,EAAqB;AACnBnN,UAAAA,QAAQ,CAAC,YAAW;AAClBK,YAAAA,KAAK,CAAC0N,KAAN,CAAYjY,MAAZ,GAAqBuK,KAAK,CAAC0N,KAAN,CAAYjY,MAAZ,CAAmBa,MAAnB,CAA0B,UAAS8Y,GAAT,EAAc;AAAE,qBAAOA,GAAG,KAAKpP,KAAK,CAAC6P,QAArB;AAAgC,aAA1E,CAArB;AACA7P,YAAAA,KAAK,CAACmF,KAAN,CAAY,cAAZ,EAA4BnF,KAAK,CAAC0N,KAAlC;AACD,WAHO,CAAR;AAID;AACF,OATD;;AAWAtF,MAAAA,CAAC,CAACsE,QAAD,CAAD,CAAYS,IAAZ,CAAiB,SAAjB,EAA4BV,cAA5B;AACAzM,MAAAA,KAAK,CAACgE,GAAN,CAAU,UAAV,EAAsB,YAAW;AAC/BoE,QAAAA,CAAC,CAACsE,QAAD,CAAD,CAAYa,MAAZ,CAAmB,SAAnB,EAA8Bd,cAA9B;AACD,OAFD;AAIAzM,MAAAA,KAAK,CAACgE,GAAN,CAAU,kBAAV,EAA8B,UAASoL,GAAT,EAAc1I,KAAd,EAAqB;AACjD1G,QAAAA,KAAK,CAAC6P,QAAN,GAAiBnJ,KAAjB;AACD,OAFD;AAGD;AAvZI,GAAP;AAyZD,CA1Z8C,CAA/C;;;ACAA,IAAI7R,gBAAgB,GAAGC,OAAO,CAACC,MAAR,CAAe,kBAAf,CAAvB;AACAF,gBAAgB,CAAC6K,SAAjB,CAA2B,SAA3B,EAAsC,CAAC,QAAD,EAAW,UAASoI,MAAT,EAAiB;AAChE,SAAO;AACLC,IAAAA,QAAQ,EAAE,GADL;AAEL7H,IAAAA,IAAI,EAAE,cAASF,KAAT,EAAgBG,OAAhB,EAAyBC,KAAzB,EAAgC;AACpC,UAAIkS,aAAa,GAAGxK,MAAM,CAAC1H,KAAK,CAACmS,OAAP,CAA1B;;AAEA,UAAIC,SAAS,GAAG,SAAZA,SAAY,CAASrR,CAAT,EAAY;AAC1BA,QAAAA,CAAC,CAACsR,YAAF,CAAeC,UAAf,GAA4B,MAA5B;AACAvR,QAAAA,CAAC,CAAC2Q,cAAF;AACD,OAHD;;AAKA,UAAIa,MAAM,GAAG,SAATA,MAAS,CAASxR,CAAT,EAAY;AACvBmR,QAAAA,aAAa,CAACtS,KAAD,EAAQ;AAAC,oBAAUmB,CAAC,CAACsR,YAAF,CAAeG;AAA1B,SAAR,CAAb;AACAzR,QAAAA,CAAC,CAAC2Q,cAAF;AACD,OAHD;;AAKAe,MAAAA,MAAM,CAACC,gBAAP,CAAwB,WAAxB,EAAqCN,SAArC;AACAK,MAAAA,MAAM,CAACC,gBAAP,CAAwB,UAAxB,EAAoCN,SAApC;AACAK,MAAAA,MAAM,CAACC,gBAAP,CAAwB,MAAxB,EAAgCH,MAAhC;AAEA3S,MAAAA,KAAK,CAACgE,GAAN,CAAU,UAAV,EAAsB,YAAW;AAC/B6O,QAAAA,MAAM,CAACE,mBAAP,CAA2B,WAA3B,EAAwCP,SAAxC;AACAK,QAAAA,MAAM,CAACE,mBAAP,CAA2B,UAA3B,EAAuCP,SAAvC;AACAK,QAAAA,MAAM,CAACE,mBAAP,CAA2B,MAA3B,EAAmCJ,MAAnC;AACD,OAJD;AAKD;AAxBI,GAAP;AA0BD,CA3BqC,CAAtC;;;ACDA,IAAI9d,gBAAgB,GAAGC,OAAO,CAACC,MAAR,CAAe,kBAAf,CAAvB;AACAF,gBAAgB,CAAC6K,SAAjB,CAA2B,WAA3B,EAAwC,CAAC,QAAD,EAAW,UAASoI,MAAT,EAAiB;AAClE,SAAO;AACLC,IAAAA,QAAQ,EAAE,GADL;AAEL7H,IAAAA,IAAI,EAAE,cAASF,KAAT,EAAgBG,OAAhB,EAAyBC,KAAzB,EAAgC;AACpC,UAAI4S,eAAe,GAAGlL,MAAM,CAAC1H,KAAK,CAAC6S,SAAP,CAA5B;;AACA,UAAIC,QAAQ,GAAI,SAAZA,QAAY,CAAS/R,CAAT,EAAY;AAC1B6R,QAAAA,eAAe,CAAChT,KAAD,EAAQ;AAAC,oBAAUmB,CAAC,CAACkN,MAAF,CAASuE;AAApB,SAAR,CAAf;AACAxK,QAAAA,CAAC,CAACjI,OAAD,CAAD,CAAWgT,GAAX,CAAe,EAAf;AACD,OAHD;;AAKA/K,MAAAA,CAAC,CAACjI,OAAD,CAAD,CAAWmI,EAAX,CAAc,QAAd,EAAwB4K,QAAxB;AACAlT,MAAAA,KAAK,CAACgE,GAAN,CAAU,UAAV,EAAsB,YAAW;AAC/BoE,QAAAA,CAAC,CAACjI,OAAD,CAAD,CAAWiT,GAAX,CAAe,QAAf,EAAyBF,QAAzB;AACD,OAFD;AAGD;AAbI,GAAP;AAeD,CAhBuC,CAAxC;;;ACDAre,gBAAgB,CAAC6K,SAAjB,CAA2B,yBAA3B,EAAsD,CAAC,UAAD,EAAa,gBAAb,EAA+B,QAA/B,EAAyC,SAAzC,EAAoD,cAApD,EAAoE,UAASC,QAAT,EAAmB6N,cAAnB,EAAmC1N,MAAnC,EAA2C2N,OAA3C,EAAoD7C,YAApD,EAAkE;AAC1L,SAAO;AACL5K,IAAAA,KAAK,EAAE;AACL;AACAvJ,MAAAA,OAAO,EAAE,UAFJ;;AAGL;AACAiX,MAAAA,KAAK,EAAE,QAJF;;AAKL;AACAC,MAAAA,SAAS,EAAE,YANN;AAOLC,MAAAA,SAAS,EAAE,YAPN;;AAQL;AACAC,MAAAA,OAAO,EAAE,UATJ;AAULC,MAAAA,YAAY,EAAE;AAVT,KADF;AAaLtO,IAAAA,WAAW,EAAE,wDAbR;AAcLU,IAAAA,IAAI,EAAE,cAASF,KAAT,EAAgBG,OAAhB,EAAyB;AAC7BH,MAAAA,KAAK,CAACS,MAAN,GAAeX,MAAM,CAACY,KAAtB;AAEAV,MAAAA,KAAK,CAACwN,cAAN,GAAuBA,cAAvB;;AACA,UAAIvG,cAAc,GAAG,SAAjBA,cAAiB,CAAS5D,CAAT,EAAY;AAC/B,eAAO,CAAC,CAAD,EAAG,CAAC,CAAD,EAAG,CAAH,CAAH,EAAU,CAAV,EAAa,CAAC,CAAD,EAAG,CAAH,CAAb,EAAoB,CAApB,EAAuB,CAAvB,EAA0B,CAAC,CAAD,EAAG,CAAH,CAA1B,EAAiC,CAAjC,EAAoC,CAAC,CAAD,EAAG,CAAH,CAApC,EAA2C,CAA3C,EAA8C,CAAC,CAAD,EAAG,CAAH,CAA9C,EAAqD,CAArD,EAAwDA,CAAC,GAAC,EAA1D,CAAP;AACD,OAFD;;AAGA,UAAI8D,SAAS,GAAG,SAAZA,SAAY,CAAS9D,CAAT,EAAY;AAC1B,eAAO,CAAC,GAAD,EAAK,GAAL,EAAS,GAAT,EAAa,GAAb,EAAiB,GAAjB,EAAqB,GAArB,EAAyB,GAAzB,EAA8BA,CAAC,GAAG,CAAlC,CAAP;AACD,OAFD;;AAGArD,MAAAA,KAAK,CAAC+M,QAAN,GAAiB,UAAS1J,CAAT,EAAY;AAC3B,YAAIgM,KAAK,GAAGpI,cAAc,CAAC5D,CAAD,CAA1B;AACA,YAAI3N,MAAM,GAAGkN,IAAI,CAACqI,KAAL,CAAW5H,CAAC,GAAC,EAAb,CAAb;;AAEA,YAAIxB,KAAK,CAACyN,OAAN,CAAcD,KAAd,CAAJ,EAA0B;AACxBA,UAAAA,KAAK,GAAGA,KAAK,CAAC,CAAD,CAAb;AACA,iBAAOlI,SAAS,CAACkI,KAAD,CAAT,GAAmB,GAAnB,GAAyB3Z,MAAhC;AACD,SAHD,MAGO;AACL,iBAAOyR,SAAS,CAACkI,KAAD,CAAT,GAAmB3Z,MAA1B;AACD;AACF,OAVD;;AAYA,UAAI6Z,UAAU,GAAG,SAAbA,UAAa,GAAW;AAC1BvP,QAAAA,KAAK,CAACwP,aAAN,GAAsB;AACpB,6BAAoBxP,KAAK,CAAC6N,OAAN,GAAc7N,KAAK,CAAC4N,SAApB,GAA8B5N,KAAK,CAAC2N,SAArC,GAAkD,UADjD;AAEpB,iCAAuB,CAAC3N,KAAK,CAACvJ,OAAN,CAAc+R,UAAf,GAA4B;AAF/B,SAAtB;AAID,OALD;;AAMAxI,MAAAA,KAAK,CAACiF,MAAN,CAAa,qDAAb,EAAoEsK,UAApE;AACAvP,MAAAA,KAAK,CAACgE,GAAN,CAAU,kBAAV,EAA8B,UAASoL,GAAT,EAAc1I,KAAd,EAAqB;AACjD1G,QAAAA,KAAK,CAAC6P,QAAN,GAAiBnJ,KAAjB;AACD,OAFD;;AAKA,UAAI4J,OAAO,GAAG,SAAVA,OAAU,CAAS5J,KAAT,EAAgB;AAC5B1G,QAAAA,KAAK,CAACmF,KAAN,CAAY,aAAZ,EAA2BnF,KAAK,CAAC0N,KAAjC;;AACA1N,QAAAA,KAAK,CAAC+P,SAAN,GAAkB,YAAW,CAAE,CAA/B;AACD,OAHD;;AAKA/P,MAAAA,KAAK,CAACsQ,OAAN,GAAgBA,OAAhB;;AAEAtQ,MAAAA,KAAK,CAACuM,UAAN,GAAmB,YAAW;AAC5BvM,QAAAA,KAAK,CAAC+P,SAAN,GAAkB,YAAW,CAAE,CAA/B;AACD,OAFD;;AAIA,UAAII,UAAU,GAAG,SAAbA,UAAa,GAAW;AAC1BnQ,QAAAA,KAAK,CAACiQ,cAAN,GAAuB,YAAU,CAAE,CAAnC;;AACAjQ,QAAAA,KAAK,CAAC+P,SAAN,GAAkB,YAAU,CAAE,CAA9B;;AACA/P,QAAAA,KAAK,CAACuM,UAAN,GAAmB,YAAU,CAAE,CAA/B;AACD,OAJD;;AAMAvM,MAAAA,KAAK,CAAC6R,cAAN,GAAuB,UAASzC,GAAT,EAAc1I,KAAd,EAAqB;AAC1C,YAAI2M,KAAK,GAAG,KAAZ;;AAEA,YAAIrD,SAAS,GAAG,SAAZA,SAAY,CAASZ,GAAT,EAAcP,OAAd,EAAuB;AACrC,iBAAO,UAASnI,KAAT,EAAgB;AACrBkE,YAAAA,YAAY,CAACyB,WAAb;AAEA,gBAAI+B,YAAY,GAAGZ,cAAc,GAAGxN,KAAK,CAAC2N,SAA1C;AACA,gBAAIwB,MAAM,GAAG;AAAC9L,cAAAA,CAAC,EAAC+L,GAAG,CAAC/L,CAAP;AAAUsL,cAAAA,CAAC,EAACS,GAAG,CAACT,CAAhB;AAAmBD,cAAAA,CAAC,EAACU,GAAG,CAACV;AAAzB,aAAb;AAEA,gBAAI,CAAChI,KAAK,CAAC2H,MAAN,CAAaiF,aAAb,CAA2BhF,SAA3B,CAAqCC,QAArC,CAA8C,oBAA9C,CAAL,EAA0E;AAE1E,gBAAIK,aAAa,GAAGhM,IAAI,CAACqI,KAAL,CAAW,CAACvE,KAAK,CAACmI,OAAN,GAAgBA,OAAjB,IAA4B7O,KAAK,CAAC4N,SAAlC,GAA8C5N,KAAK,CAAC2N,SAApD,GAAgEH,cAA3E,CAApB;AACAoB,YAAAA,aAAa,GAAGhM,IAAI,CAACqI,KAAL,CAAW2D,aAAX,CAAhB;AACA,gBAAIE,KAAK,GAAGrB,OAAO,CAACsB,SAAR,CAAkB/O,KAAK,CAACvJ,OAAxB,EAAiCuJ,KAAK,CAAC0N,KAAvC,EAA8C0B,GAA9C,EAAmDR,aAAnD,CAAZ;;AAEA,gBAAIhM,IAAI,CAACoM,GAAL,CAASJ,aAAa,GAAGE,KAAhB,GAAwBV,YAAY,GAAG,CAAhD,IAAqDA,YAAzD,EAAuE;AACrEgB,cAAAA,GAAG,CAACT,CAAJ,GAAQG,KAAR;AACD,aAFD,MAEO;AACLM,cAAAA,GAAG,CAACT,CAAJ,GAAQ/L,IAAI,CAACqI,KAAL,CAAW,CAACvE,KAAK,CAACmI,OAAN,GAAgBA,OAAjB,IAA4B,CAA5B,GAAgC7O,KAAK,CAAC4N,SAAjD,IAA8D,CAA9D,GAAkE5N,KAAK,CAAC2N,SAAxE,GAAoFH,cAA5F;AACA4B,cAAAA,GAAG,CAACT,CAAJ,GAAQ/L,IAAI,CAACqI,KAAL,CAAWmE,GAAG,CAACT,CAAf,CAAR;AACD;;AAED,gBAAIS,GAAG,CAACT,CAAJ,GAAQ,CAAZ,EAAeS,GAAG,CAACT,CAAJ,GAAQ,CAAR;AACf,gBAAIS,GAAG,CAACT,CAAJ,KAAUQ,MAAM,CAACR,CAArB,EAAwB0E,KAAK,GAAG,IAAR;AAExBrT,YAAAA,KAAK,CAACmF,KAAN,CAAY,cAAZ,EAA4BnF,KAAK,CAAC0N,KAAlC;AACA1N,YAAAA,KAAK,CAACmF,KAAN,CAAY,cAAZ,EAA4B;AAACgK,cAAAA,MAAM,EAAEA,MAAT;AAAiBC,cAAAA,GAAG,EAACA,GAArB;AAA0B1B,cAAAA,KAAK,EAAE1N,KAAK,CAAC0N;AAAvC,aAA5B;AACD,WAxBD;AAyBD,SA1BD;;AA4BA,YAAIwC,kBAAkB,GAAG,SAArBA,kBAAqB,CAASd,GAAT,EAAcP,OAAd,EAAuB;AAC9C,iBAAO,UAASsC,OAAT,EAAkBzK,KAAlB,EAAyB;AAC9BkE,YAAAA,YAAY,CAACyB,WAAb;AAEA,gBAAI+B,YAAY,GAAGZ,cAAc,GAAGxN,KAAK,CAAC2N,SAA1C;AACA,gBAAIwB,MAAM,GAAG;AAAC9L,cAAAA,CAAC,EAAC+L,GAAG,CAAC/L,CAAP;AAAUsL,cAAAA,CAAC,EAACS,GAAG,CAACT,CAAhB;AAAmBD,cAAAA,CAAC,EAACU,GAAG,CAACV;AAAzB,aAAb;AAEA,gBAAIE,aAAa,GAAGuC,OAAO,CAACxC,CAAR,GAAY/L,IAAI,CAACqI,KAAL,CAAW,CAACvE,KAAK,CAACmI,OAAN,GAAgBA,OAAjB,IAA4B7O,KAAK,CAAC4N,SAAlC,GAA8C5N,KAAK,CAAC2N,SAApD,GAAgEH,cAA3E,CAAhC;AACAoB,YAAAA,aAAa,GAAGhM,IAAI,CAACqI,KAAL,CAAW2D,aAAX,CAAhB;AACA,gBAAIE,KAAK,GAAGrB,OAAO,CAACsB,SAAR,CAAkB/O,KAAK,CAACvJ,OAAxB,EAAiCuJ,KAAK,CAAC0N,KAAvC,EAA8C0B,GAA9C,EAAmDR,aAAnD,CAAZ;;AAEA,gBAAIhM,IAAI,CAACoM,GAAL,CAASJ,aAAa,GAAGE,KAAhB,GAAwBV,YAAY,GAAG,CAAhD,IAAqDA,YAAzD,EAAuE;AACrEgB,cAAAA,GAAG,CAACT,CAAJ,GAAQG,KAAR;AACD,aAFD,MAEO;AACLM,cAAAA,GAAG,CAACT,CAAJ,GAAQwC,OAAO,CAACxC,CAAR,GAAY/L,IAAI,CAACqI,KAAL,CAAW,CAACvE,KAAK,CAACmI,OAAN,GAAgBA,OAAjB,IAA4B,CAA5B,GAAgC7O,KAAK,CAAC4N,SAAjD,IAA8D,CAA9D,GAAkE5N,KAAK,CAAC2N,SAAxE,GAAoFH,cAAxG;AACA4B,cAAAA,GAAG,CAACT,CAAJ,GAAQ/L,IAAI,CAACqI,KAAL,CAAWmE,GAAG,CAACT,CAAf,CAAR;AACD;;AAED,gBAAIS,GAAG,CAACT,CAAJ,GAAQ,CAAZ,EAAeS,GAAG,CAACT,CAAJ,GAAQ,CAAR;AACf,gBAAIS,GAAG,CAACT,CAAJ,KAAUQ,MAAM,CAACR,CAArB,EAAwB0E,KAAK,GAAG,IAAR;AAExBrT,YAAAA,KAAK,CAACmF,KAAN,CAAY,cAAZ,EAA4BnF,KAAK,CAAC0N,KAAlC;AACA1N,YAAAA,KAAK,CAACmF,KAAN,CAAY,cAAZ,EAA4B;AAACgK,cAAAA,MAAM,EAAEA,MAAT;AAAiBC,cAAAA,GAAG,EAACA,GAArB;AAA0B1B,cAAAA,KAAK,EAAE1N,KAAK,CAAC0N;AAAvC,aAA5B;AACD,WAtBD;AAuBD,SAxBD;;AA0BAhH,QAAAA,KAAK,CAACoL,cAAN;AACApF,QAAAA,QAAQ,CAACC,aAAT,CAAuBoF,IAAvB;AAEA/R,QAAAA,KAAK,CAACmF,KAAN,CAAY,eAAZ,EAA6B;AAACiK,UAAAA,GAAG,EAAEA,GAAN;AAAW1B,UAAAA,KAAK,EAAE1N,KAAK,CAAC0N;AAAxB,SAA7B;AAEA1N,QAAAA,KAAK,CAAC+P,SAAN,GAAkBC,SAAS,CAACZ,GAAD,EAAM1I,KAAK,CAACmI,OAAZ,CAA3B;AACA7O,QAAAA,KAAK,CAACiQ,cAAN,GAAuBC,kBAAkB,CAACd,GAAD,EAAM1I,KAAK,CAACmI,OAAZ,CAAzC;;AAEA7O,QAAAA,KAAK,CAACuM,UAAN,GAAmB,YAAW;AAC5B4D,UAAAA,UAAU;AACX,SAFD;;AAIA,YAAI6B,WAAW,GAAG,SAAdA,WAAc,GAAW;AAC3BhS,UAAAA,KAAK,CAACS,MAAN,CAAaqP,KAAb,CAAmB,mBAAnB;AACAK,UAAAA,UAAU;AACX,SAHD;;AAKAnQ,QAAAA,KAAK,CAACoQ,kBAAN,GAA2B4B,WAA3B;AACAhS,QAAAA,KAAK,CAACqQ,YAAN,GAAqB2B,WAArB;;AACAhS,QAAAA,KAAK,CAACsQ,OAAN,GAAgB,YAAW;AACzBtQ,UAAAA,KAAK,CAACsQ,OAAN,GAAgBA,OAAhB;AAEA,cAAI,CAAC+C,KAAL,EAAYrT,KAAK,CAACmF,KAAN,CAAY,aAAZ,EAA2BnF,KAAK,CAAC0N,KAAjC;AAEZ1N,UAAAA,KAAK,CAACmF,KAAN,CAAY,oBAAZ,EAAkCiK,GAAlC;;AACA4C,UAAAA,WAAW;AACZ,SAPD;AAQD,OApFD;;AAsFAhS,MAAAA,KAAK,CAACiS,oBAAN,GAA6B,UAAS7C,GAAT,EAAc1I,KAAd,EAAqB;AAChD,YAAI2M,KAAK,GAAG,KAAZ;AAEA3M,QAAAA,KAAK,CAACoL,cAAN;;AAEA9R,QAAAA,KAAK,CAAC+P,SAAN,GAAkB,UAASrJ,KAAT,EAAgB;AAChCkE,UAAAA,YAAY,CAACyB,WAAb;AAEA,cAAI8C,MAAM,GAAG;AAAC9L,YAAAA,CAAC,EAAC+L,GAAG,CAAC/L,CAAP;AAAUsL,YAAAA,CAAC,EAACS,GAAG,CAACT,CAAhB;AAAmBD,YAAAA,CAAC,EAACU,GAAG,CAACV;AAAzB,WAAb;AACA,cAAIN,YAAY,GAAGZ,cAAc,GAAGxN,KAAK,CAAC2N,SAA1C;AACA,cAAIuE,KAAK,GAAGzE,OAAO,CAAC0E,SAAR,CAAkBnS,KAAK,CAACvJ,OAAxB,EAAiCuJ,KAAK,CAAC0N,KAAvC,EAA8C0B,GAA9C,EAAmDA,GAAG,CAACT,CAAvD,CAAZ;AAEA,cAAI,CAACjI,KAAK,CAAC2H,MAAN,CAAaiF,aAAb,CAA2BhF,SAA3B,CAAqCC,QAArC,CAA8C,oBAA9C,CAAL,EAA0E;AAE1E,cAAI6D,MAAM,GAAGxP,IAAI,CAACqI,KAAL,CAAWvE,KAAK,CAACmI,OAAN,GAAgB7O,KAAK,CAAC4N,SAAtB,GAAkC5N,KAAK,CAAC2N,SAAxC,GAAoDH,cAA/D,IAAiF4B,GAAG,CAACT,CAAlG;;AAEA,cAAI/L,IAAI,CAACoM,GAAL,CAASoD,MAAM,GAAGF,KAAT,GAAiB9D,YAA1B,IAA0CA,YAA9C,EAA4D;AAC1DgB,YAAAA,GAAG,CAACV,CAAJ,GAAQwD,KAAR;AACD,WAFD,MAEO;AACL,gBAAIG,IAAI,GAAGzP,IAAI,CAACqI,KAAL,CAAWvE,KAAK,CAACmI,OAAN,GAAgB7O,KAAK,CAAC4N,SAAtB,GAAkC,CAA7C,IAAkD,CAAlD,GAAsD5N,KAAK,CAAC2N,SAA5D,GAAwEH,cAAnF;AACA4B,YAAAA,GAAG,CAACV,CAAJ,GAAQ2D,IAAI,GAAGjD,GAAG,CAACT,CAAnB;AACAS,YAAAA,GAAG,CAACV,CAAJ,GAAQ9L,IAAI,CAACqI,KAAL,CAAWmE,GAAG,CAACV,CAAf,CAAR;AAEA,gBAAIU,GAAG,CAACV,CAAJ,GAAMlB,cAAc,GAACxN,KAAK,CAAC2N,SAA/B,EAA0CyB,GAAG,CAACV,CAAJ,GAAMlB,cAAc,GAACxN,KAAK,CAAC2N,SAA3B;AAC1CI,YAAAA,QAAQ,GAAGqB,GAAG,CAACV,CAAf;AACD;;AAED,cAAIU,GAAG,CAACV,CAAJ,KAAUS,MAAM,CAACT,CAArB,EAAwB;AACtB2E,YAAAA,KAAK,GAAG,IAAR;AACD;;AAEDrT,UAAAA,KAAK,CAACmF,KAAN,CAAY,cAAZ,EAA4BnF,KAAK,CAAC0N,KAAlC;AACA1N,UAAAA,KAAK,CAACmF,KAAN,CAAY,cAAZ,EAA4B;AAACgK,YAAAA,MAAM,EAACA,MAAR;AAAgBC,YAAAA,GAAG,EAACA,GAApB;AAAyB1B,YAAAA,KAAK,EAAE1N,KAAK,CAAC0N;AAAtC,WAA5B;AACD,SA5BD;;AA8BA1N,QAAAA,KAAK,CAACiQ,cAAN,GAAuB,UAASkB,OAAT,EAAkBzK,KAAlB,EAAyB;AAC9CkE,UAAAA,YAAY,CAACyB,WAAb;AAEA,cAAI8C,MAAM,GAAG;AAAC9L,YAAAA,CAAC,EAAC+L,GAAG,CAAC/L,CAAP;AAAUsL,YAAAA,CAAC,EAACS,GAAG,CAACT,CAAhB;AAAmBD,YAAAA,CAAC,EAACU,GAAG,CAACV;AAAzB,WAAb;AACA,cAAIN,YAAY,GAAGZ,cAAc,GAAGxN,KAAK,CAAC2N,SAA1C;AACA,cAAIuE,KAAK,GAAGzE,OAAO,CAAC0E,SAAR,CAAkBnS,KAAK,CAACvJ,OAAxB,EAAiCuJ,KAAK,CAAC0N,KAAvC,EAA8C0B,GAA9C,EAAmDA,GAAG,CAACT,CAAvD,CAAZ;AAEA,cAAIyD,MAAM,GAAGjB,OAAO,CAACxC,CAAR,GACX/L,IAAI,CAACqI,KAAL,CAAWvE,KAAK,CAACmI,OAAN,GAAgB7O,KAAK,CAAC4N,SAAtB,GAAkC5N,KAAK,CAAC2N,SAAxC,GAAoDH,cAA/D,CADW,GAEX4B,GAAG,CAACT,CAFN;;AAIA,cAAI/L,IAAI,CAACoM,GAAL,CAASoD,MAAM,GAAGF,KAAT,GAAiB9D,YAA1B,IAA0CA,YAA9C,EAA4D;AAC1DgB,YAAAA,GAAG,CAACV,CAAJ,GAAQwD,KAAR;AACD,WAFD,MAEO;AACL,gBAAIG,IAAI,GAAGlB,OAAO,CAACxC,CAAR,GAAY/L,IAAI,CAACqI,KAAL,CAAWvE,KAAK,CAACmI,OAAN,GAAgB7O,KAAK,CAAC4N,SAAtB,GAAkC,CAA7C,IAAkD,CAAlD,GAAsD5N,KAAK,CAAC2N,SAA5D,GAAwEH,cAA/F;AACA4B,YAAAA,GAAG,CAACV,CAAJ,GAAQ2D,IAAI,GAAGjD,GAAG,CAACT,CAAnB;AACAS,YAAAA,GAAG,CAACV,CAAJ,GAAQ9L,IAAI,CAACqI,KAAL,CAAWmE,GAAG,CAACV,CAAf,CAAR;AAEA,gBAAIU,GAAG,CAACV,CAAJ,GAAMlB,cAAc,GAACxN,KAAK,CAAC2N,SAA/B,EAA0CyB,GAAG,CAACV,CAAJ,GAAMlB,cAAc,GAACxN,KAAK,CAAC2N,SAA3B;AAE1CI,YAAAA,QAAQ,GAAGqB,GAAG,CAACV,CAAf;AACD;;AAED,cAAIU,GAAG,CAACV,CAAJ,KAAUS,MAAM,CAACT,CAArB,EAAwB;AACtB2E,YAAAA,KAAK,GAAG,IAAR;AACD;;AAEDrT,UAAAA,KAAK,CAACmF,KAAN,CAAY,cAAZ,EAA4BnF,KAAK,CAAC0N,KAAlC;AACA1N,UAAAA,KAAK,CAACmF,KAAN,CAAY,cAAZ,EAA4B;AAACgK,YAAAA,MAAM,EAACA,MAAR;AAAgBC,YAAAA,GAAG,EAACA,GAApB;AAAyB1B,YAAAA,KAAK,EAAE1N,KAAK,CAAC0N;AAAtC,WAA5B;AACD,SA7BD;;AA+BA1N,QAAAA,KAAK,CAACoQ,kBAAN,GAA2BD,UAA3B;AACAnQ,QAAAA,KAAK,CAACqQ,YAAN,GAAqBF,UAArB;;AACAnQ,QAAAA,KAAK,CAACsQ,OAAN,GAAgB,YAAW;AACzBtQ,UAAAA,KAAK,CAACsQ,OAAN,GAAgBA,OAAhB;AAEA,cAAI,CAAC+C,KAAL,EAAYrT,KAAK,CAACmF,KAAN,CAAY,aAAZ,EAA2BnF,KAAK,CAAC0N,KAAjC;AAEZ1N,UAAAA,KAAK,CAACmF,KAAN,CAAY,oBAAZ,EAAkCiK,GAAlC;AACAe,UAAAA,UAAU;AACX,SAPD;AAQD,OA5ED;AA8ED;AArOI,GAAP;AAuOD,CAxOqD,CAAtD;;;ACAAtb,gBAAgB,CAAC6K,SAAjB,CAA2B,aAA3B,EAA0C,CAAC,UAAD,EAAa,QAAb,EAAuB,gBAAvB,EAAyC,UAASC,QAAT,EAAmBmI,MAAnB,EAA2B0F,cAA3B,EAA2C;AAC5H,SAAO;AACLxN,IAAAA,KAAK,EAAE,EADF;AAELyI,IAAAA,OAAO,EAAE,IAFJ;AAGLjJ,IAAAA,WAAW,EAAE,4CAHR;AAILU,IAAAA,IAAI,EAAE,cAASF,KAAT,EAAgBG,OAAhB,EAAyBC,KAAzB,EAAgC;AACpC,UAAIsI,EAAJ;AACA,UAAI6K,WAAJ;AACA,UAAIC,OAAO,GAAG,KAAd;AACA,UAAIC,MAAM,GAAG3L,MAAM,CAAC1H,KAAK,CAAClF,GAAP,CAAnB;AACA,UAAIwY,YAAY,GAAG5L,MAAM,CAAC1H,KAAK,CAACuN,SAAP,CAAzB;AACA,UAAIgG,YAAY,GAAG7L,MAAM,CAAC1H,KAAK,CAACwN,SAAP,CAAzB;AAEA,UAAI1S,GAAJ,EAASyS,SAAT,EAAoBC,SAApB;;AAEA,UAAIgG,SAAS,GAAG,SAAZA,SAAY,CAAStC,KAAT,EAAgB;AAC9B3D,QAAAA,SAAS,GAAG+F,YAAY,CAAC1T,KAAK,CAAC+I,OAAP,CAAxB;AACA6E,QAAAA,SAAS,GAAG+F,YAAY,CAAC3T,KAAK,CAAC+I,OAAP,CAAxB;AACA,eAAOuI,KAAK,GAAC3D,SAAN,GAAgBC,SAAhB,GAA0BJ,cAAjC;AACD,OAJD;;AAMA,UAAIqG,QAAQ,GAAG,SAAXA,QAAW,GAAW;AACxB,YAAI3Y,GAAG,IAAIsY,OAAX,EAAoB;AAClB,cAAIlC,KAAK,GAAGiC,WAAW,CAAEV,MAAM,CAACiB,WAAP,CAAmBC,GAAnB,KAA2BrL,EAA7B,CAAvB;AACA,cAAIsL,YAAY,GAAGJ,SAAS,CAACtC,KAAD,CAA5B;AAEAnR,UAAAA,OAAO,CAAC8T,GAAR,CAAY,MAAZ,EAAqBD,YAAD,GAAiB,IAArC;AACD;;AACDE,QAAAA,qBAAqB,CAACL,QAAD,CAArB;AACD,OARD;;AAUA,UAAIM,WAAW,GAAG/L,CAAC,CAACjI,OAAD,CAAnB;AACA,UAAIiU,SAAS,GAAGF,qBAAqB,CAACL,QAAD,CAArC;AAEA7T,MAAAA,KAAK,CAACgE,GAAN,CAAU,YAAV,EAAwB,UAASoL,GAAT,EAAciF,YAAd,EAA4B;AAClD,YAAIC,GAAG,GAAGzB,MAAM,CAACiB,WAAP,CAAmBC,GAAnB,EAAV;;AAEAP,QAAAA,OAAO,GAAG,IAAV;AACAtY,QAAAA,GAAG,GAAGuY,MAAM,CAACzT,KAAK,CAAC+I,OAAP,CAAZ;AAEAwK,QAAAA,WAAW,GAAGc,YAAd;AACA3L,QAAAA,EAAE,GAAG4L,GAAL;AACD,OARD;AAUAtU,MAAAA,KAAK,CAACgE,GAAN,CAAU,WAAV,EAAuB,UAASoL,GAAT,EAAc;AACnCoE,QAAAA,OAAO,GAAG,KAAV;AACD,OAFD;AAIAxT,MAAAA,KAAK,CAACgE,GAAN,CAAU,YAAV,EAAwB,UAASoL,GAAT,EAAc;AACpC,YAAIkC,KAAK,GAAGiC,WAAW,CAAEV,MAAM,CAACiB,WAAP,CAAmBC,GAAnB,KAA2BrL,EAA7B,CAAvB;AACA,YAAIsL,YAAY,GAAGJ,SAAS,CAACtC,KAAK,IAAI,CAAV,CAA5B;AAEAkC,QAAAA,OAAO,GAAG,KAAV;AACAxT,QAAAA,KAAK,CAACmF,KAAN,CAAY,aAAZ,EAA2BmM,KAA3B;AACAnR,QAAAA,OAAO,CAAC8T,GAAR,CAAY,MAAZ,EAAqBD,YAAD,GAAiB,IAArC;AACD,OAPD;AASAhU,MAAAA,KAAK,CAACgE,GAAN,CAAU,YAAV,EAAwB,UAASoL,GAAT,EAAcmF,SAAd,EAAyB;AAC/C,YAAIP,YAAY,GAAGJ,SAAS,CAACW,SAAS,IAAI,CAAd,CAA5B;AAEAf,QAAAA,OAAO,GAAG,KAAV;AACArT,QAAAA,OAAO,CAAC8T,GAAR,CAAY,MAAZ,EAAqBD,YAAD,GAAiB,IAArC;AACD,OALD;AAQAhU,MAAAA,KAAK,CAACgE,GAAN,CAAU,UAAV,EAAsB,YAAW;AAC/BwQ,QAAAA,oBAAoB,CAACJ,SAAD,CAApB;AACD,OAFD;AAGD;AAnEI,GAAP;AAqED,CAtEyC,CAA1C;;;ACAA,IAAIvf,gBAAgB,GAAGC,OAAO,CAACC,MAAR,CAAe,kBAAf,CAAvB;AACAF,gBAAgB,CAAC6K,SAAjB,CAA2B,aAA3B,EAA0C,CAAC,QAAD,EAAW,UAAX,EAAuB,QAAvB,EAAiC,UAASoI,MAAT,EAAiBnI,QAAjB,EAA2BG,MAA3B,EAAmC;AAC5G,SAAO;AACLiI,IAAAA,QAAQ,EAAE,GADL;AAEL7H,IAAAA,IAAI,EAAE,cAASF,KAAT,EAAgBG,OAAhB,EAAyBC,KAAzB,EAAgC;AACpC,UAAIqU,iBAAiB,GAAG3M,MAAM,CAAC1H,KAAK,CAACsU,WAAP,CAA9B;AACA,UAAIC,cAAc,GAAGF,iBAAiB,CAACzU,KAAD,CAAtC;;AAEA,UAAI,CAAC6B,KAAK,CAACyN,OAAN,CAAcqF,cAAd,CAAL,EAAoC;AAClCA,QAAAA,cAAc,GAAG,CAACA,cAAD,CAAjB;AACD;;AAED,UAAIC,KAAK,GAAG,SAARA,KAAQ,GAAW;AACrBjV,QAAAA,QAAQ,CAAC,YAAW;AAClByI,UAAAA,CAAC,CAACjI,OAAD,CAAD,CAAW0U,QAAX,CAAoB,OAApB;AACD,SAFO,CAAR;AAGD,OAJD;;AAMA,UAAIC,OAAO,GAAG,SAAVA,OAAU,GAAW;AACvBnV,QAAAA,QAAQ,CAAC,YAAW;AAClByI,UAAAA,CAAC,CAACjI,OAAD,CAAD,CAAW4U,WAAX,CAAuB,OAAvB;AACD,SAFO,CAAR;AAGD,OAJD;;AAMA,UAAIC,aAAa,GAAG,SAAhBA,aAAgB,CAASL,cAAT,EAAyB;AAC3C,YAAI7U,MAAM,CAACmV,SAAP,GAAmBC,OAAnB,CAA2BP,cAA3B,MAA+C,CAAC,CAApD,EAAuD;AACrDC,UAAAA,KAAK;AACN;;AAED5U,QAAAA,KAAK,CAACgE,GAAN,CAAU,mBAAmB2Q,cAA7B,EAA6C,UAASjO,KAAT,EAAgByO,IAAhB,EAAsB;AACjEP,UAAAA,KAAK;AACN,SAFD;AAIA5U,QAAAA,KAAK,CAACgE,GAAN,CAAU,oBAAoB2Q,cAA9B,EAA8C,YAAW;AACvDG,UAAAA,OAAO;AACR,SAFD;AAIA9U,QAAAA,KAAK,CAACgE,GAAN,CAAU,qBAAV,EAAiC,YAAW;AAC1C8Q,UAAAA,OAAO;AACR,SAFD;AAGD,OAhBD;;AAkBAH,MAAAA,cAAc,CAACzP,OAAf,CAAuB8P,aAAvB;AACD;AAzCI,GAAP;AA2CD,CA5CyC,CAA1C;;;ACDA,IAAIngB,gBAAgB,GAAGC,OAAO,CAACC,MAAR,CAAe,kBAAf,CAAvB;AACAF,gBAAgB,CAAC6K,SAAjB,CAA2B,eAA3B,EAA4C,CAAC,QAAD,EAAW,UAAX,EAAuB,UAASoI,MAAT,EAAiBnI,QAAjB,EAA2B;AAC5F,SAAO;AACLoI,IAAAA,QAAQ,EAAE,GADL;AAEL/H,IAAAA,KAAK,EAAE,EAFF;AAGL8G,IAAAA,QAAQ,EAAE,mLAHL;AAIL5G,IAAAA,IAAI,EAAE,cAASF,KAAT,EAAgBG,OAAhB,EAAyBC,KAAzB,EAAgC;AACpC,UAAIgV,UAAU,GAAGtN,MAAM,CAAC1H,KAAK,CAACiV,IAAP,CAAvB;AACA,UAAIC,gBAAgB,GAAGF,UAAU,CAACpV,KAAK,CAAC+I,OAAP,CAAjC;AAEA/I,MAAAA,KAAK,CAACuV,cAAN,GAAuB,KAAvB;;AACAvV,MAAAA,KAAK,CAACwV,OAAN,GAAgB,UAASrU,CAAT,EAAY;AAC1BnB,QAAAA,KAAK,CAAC+I,OAAN,CAActI,MAAd,CAAqBqP,KAArB,CAA2B,eAA3B;AACA3O,QAAAA,CAAC,CAACsU,wBAAF;AACD,OAHD;;AAKAzV,MAAAA,KAAK,CAACgE,GAAN,CAAU,sBAAsBsR,gBAAhC,EAAkD,UAAS5O,KAAT,EAAgByO,IAAhB,EAAsB;AACtExV,QAAAA,QAAQ,CAAC,YAAW;AAClB,cAAI+V,WAAW,GAAG9S,IAAI,CAAC+N,GAAL,CAASjE,QAAQ,CAACiJ,eAAT,CAAyBrM,WAAlC,EAA+CuJ,MAAM,CAAC+C,UAAP,IAAqB,CAApE,CAAlB;AACA,cAAIC,EAAE,GAAG1V,OAAO,CAAC,CAAD,CAAhB;AACA,cAAI2V,MAAM,GAAGJ,WAAW,GAAGG,EAAE,CAACE,qBAAH,GAA2BC,IAAtD;AAEAhW,UAAAA,KAAK,CAACiW,QAAN,GAAiBH,MAAM,GAAG,GAA1B;AAEA9V,UAAAA,KAAK,CAACkW,IAAN,GAAaf,IAAI,CAACe,IAAlB;AACAlW,UAAAA,KAAK,CAACuV,cAAN,GAAuB,IAAvB;AACD,SATO,CAAR;AAUD,OAXD;AAaAvV,MAAAA,KAAK,CAACgE,GAAN,CAAU,mBAAmBsR,gBAA7B,EAA+C,YAAW;AACxDtV,QAAAA,KAAK,CAACuV,cAAN,GAAuB,KAAvB;AACD,OAFD;AAIAvV,MAAAA,KAAK,CAACgE,GAAN,CAAU,oBAAV,EAAgC,YAAW;AACzChE,QAAAA,KAAK,CAACuV,cAAN,GAAuB,KAAvB;AACD,OAFD;AAGD;AAlCI,GAAP;AAoCD,CArC2C,CAA5C;;;ACDA,IAAI1gB,gBAAgB,GAAGC,OAAO,CAACC,MAAR,CAAe,kBAAf,CAAvB;AACAF,gBAAgB,CAAC6K,SAAjB,CAA2B,cAA3B,EAA2C,CAAC,UAAD,EAAa,UAASC,QAAT,EAAmB;AACzE,SAAO;AACLoI,IAAAA,QAAQ,EAAE,GADL;AAELjB,IAAAA,QAAQ,EAAE,kDAFL;AAGL5G,IAAAA,IAAI,EAAE,cAASF,KAAT,EAAgBG,OAAhB,EAAyBC,KAAzB,EAAgC,CACrC;AAJI,GAAP;AAMD,CAP0C,CAA3C;;;ACDA,IAAIvL,gBAAgB,GAAGC,OAAO,CAACC,MAAR,CAAe,kBAAf,CAAvB;AACAF,gBAAgB,CAAC6K,SAAjB,CAA2B,uBAA3B,EAAoD,CAAC,UAAD,EAAa,WAAb,EAA0B,gBAA1B,EAA4C,YAA5C,EAA0D,UAASC,QAAT,EAAmB+K,SAAnB,EAA8ByL,cAA9B,EAA8CC,UAA9C,EAA0D;AACtK,SAAO;AACL5W,IAAAA,WAAW,EAAE,sDADR;AAELQ,IAAAA,KAAK,EAAE,EAFF;AAGLE,IAAAA,IAAI,EAAE,cAASF,KAAT,EAAgBG,OAAhB,EAAyBC,KAAzB,EAAgC;AACpC,UAAIiW,QAAQ,GAAGF,cAAc,CAACG,eAAf,CAA+B,YAAW;AACvDH,QAAAA,cAAc,CAACI,cAAf,CAA8B,IAA9B,EAAoC;AAACC,UAAAA,KAAK,EAAE;AAAR,SAApC,EACGpS,IADH,CACQ,UAAS0H,MAAT,EAAiB;AACrBnM,UAAAA,QAAQ,CAAC,YAAW;AAClBK,YAAAA,KAAK,CAAC4S,KAAN,GAAc9G,MAAM,CAAC2K,OAAP,CAAeC,KAAf,CAAqB,CAArB,EAAwB,CAAxB,CAAd;AACD,WAFO,CAAR;AAGD,SALH;AAMD,OAPc,CAAf;AASA1W,MAAAA,KAAK,CAACgE,GAAN,CAAU,SAAV,EAAqBqS,QAAQ,CAACpS,OAA9B;;AAEAjE,MAAAA,KAAK,CAAC2W,cAAN,GAAuB,YAAW;AAChC;AACA,YAAI9K,QAAQ,GAAGnB,SAAS,CAACvQ,IAAV,CAAe;AAC5BqF,UAAAA,WAAW,EAAE,sCADe;AAE5BC,UAAAA,UAAU,EAAE;AAFgB,SAAf,CAAf;AAID,OAND;;AAQAO,MAAAA,KAAK,CAACsK,OAAN,GAAgB,UAASrK,IAAT,EAAe;AAC7BkW,QAAAA,cAAc,CAACS,qBAAf,CAAqC3W,IAAI,CAAC4W,EAA1C,EACGzS,IADH,CACQ,YAAW;AACf,cAAInE,IAAI,CAAC1J,IAAL,KAAc,SAAlB,EAA6B;AAC3BmW,YAAAA,QAAQ,CAACoK,QAAT,GAAoB,cAAc7W,IAAI,CAAC4W,EAAvC;AACD,WAFD,MAEO;AACLnK,YAAAA,QAAQ,CAACoK,QAAT,GAAoB,cAAY7W,IAAI,CAACnJ,OAAjB,GAAyB,GAAzB,GAA6BmJ,IAAI,CAAC1J,IAAlC,GAAuC,GAAvC,GAA2C0J,IAAI,CAAC4W,EAApE;AACD;AACF,SAPH;AAQD,OATD;;AAWA7W,MAAAA,KAAK,CAACyG,cAAN,GAAsB,UAASxG,IAAT,EAAe;AACnCkW,QAAAA,cAAc,CAACY,gBAAf,CAAgC9W,IAAI,CAAC4W,EAArC,EACGG,KADH,CACS,UAAS/T,GAAT,EAAc;AACnB,cAAIA,GAAG,CAAC1M,IAAJ,IAAY0M,GAAG,CAAC1M,IAAJ,KAAa,YAA7B,EAA2C;AACzC6f,YAAAA,UAAU,CAAC,oBAAD,EAAuB,yBAAvB,CAAV;AACD,WAFD,MAEO;AACL,kBAAMnT,GAAN;AACD;AACF,SAPH;AAQD,OATD;AAUD;AA5CI,GAAP;AA8CD,CA/CmD,CAApD;;;ACDA,IAAIpO,gBAAgB,GAAGC,OAAO,CAACC,MAAR,CAAe,kBAAf,CAAvB;AAEAF,gBAAgB,CAACyB,MAAjB,CAAwB,gBAAxB,EAA0C,YAAW;AACnD,SAAO,UAASC,IAAT,EAAe;AACpB,QAAIA,IAAI,KAAK,YAAb,EAA2B,OAAO,UAAP;AAC3B,QAAIA,IAAI,KAAK,OAAb,EAAsB,OAAO,OAAP;AACtB,QAAIA,IAAI,KAAK,MAAb,EAAqB,OAAO,IAAP;AACrB,QAAIA,IAAI,KAAK,SAAb,EAAwB,OAAO,OAAP;AACxB,QAAIA,IAAI,KAAK,IAAb,EAAmB,OAAO,OAAP;AACnB,QAAIA,IAAI,KAAK,SAAb,EAAwB,OAAO,QAAP;AACxB,WAAO,UAAP;AACD,GARD;AASD,CAVD;AAYA1B,gBAAgB,CAAC6K,SAAjB,CAA2B,UAA3B,EAAuC,CAAC,QAAD,EAAW,UAASoI,MAAT,EAAiB;AACjE,SAAO;AACLC,IAAAA,QAAQ,EAAE,GADL;AAEL/H,IAAAA,KAAK,EAAE,EAFF;AAGLyI,IAAAA,OAAO,EAAE,IAHJ;AAIL3B,IAAAA,QAAQ,EAAE,oDAJL;AAKL5G,IAAAA,IAAI,EAAE,cAASF,KAAT,EAAgBG,OAAhB,EAAyBC,KAAzB,EAAgC;AACpC,UAAI6W,YAAY,GAAGnP,MAAM,CAAC1H,KAAK,CAAC8W,QAAP,CAAzB;AAEAlX,MAAAA,KAAK,CAAC+I,OAAN,CAAc9D,MAAd,CAAqBgS,YAArB,EAAmC,UAASpT,QAAT,EAAmB;AACpD7D,QAAAA,KAAK,CAACkX,QAAN,GAAiBD,YAAY,CAACjX,KAAK,CAAC+I,OAAP,CAA7B;AACD,OAFD;AAGD;AAXI,GAAP;AAaD,CAdsC,CAAvC;;;ACdA,IAAIlU,gBAAgB,GAAGC,OAAO,CAACC,MAAR,CAAe,kBAAf,CAAvB;AAEAF,gBAAgB,CAACsiB,OAAjB,CAAyB,oBAAzB,EAA+C,CAAC,cAAD,EAAiB,IAAjB,EAAuB,aAAvB,EAAsC,cAAtC,EAAsD,UAASvM,YAAT,EAAuBwM,EAAvB,EAA2BvX,WAA3B,EAAwCwX,YAAxC,EAAsD;AACzJ,MAAIC,aAAa,GAAG,IAAIC,OAAJ,EAApB;AAEA,SAAO,UAASC,OAAT,EAAkB;AACvB,QAAIC,MAAM,GAAG,CAAb;AAEA,QAAIC,UAAU,GAAG,EAAjB;AACA,QAAIC,QAAQ,GAAG,EAAf;AAEA,QAAIC,OAAO,GAAGJ,OAAO,IAAIA,OAAO,CAACI,OAAjC;;AAEA,QAAIC,cAAc,GAAG,SAAjBA,cAAiB,CAASC,UAAT,EAAqBC,OAArB,EAA8B;AAC/C,aAAOlY,WAAW,CAACyE,OAAZ,CAAoBwT,UAAU,CAACvhB,IAA/B,EACJ6N,IADI,CACC,UAAS7N,IAAT,EAAe;AACnB,YAAIA,IAAI,CAACqhB,OAAL,IAAgB,CAACA,OAArB,EAA8B;AAC5B,iBAAO,UAASxS,UAAT,EAAqB;AAC1B,gBAAI4S,OAAO,GAAG5S,UAAU,CAAC,CAAD,CAAxB;AACA,mBAAO,UAAS6S,KAAT,EAAgB;AACrB,qBAAOD,OAAO,CAACC,KAAD,CAAd;AACD,aAFD;AAGD,WALD;AAMD;;AAED,YAAIjX,GAAG,GAAG,SAANA,GAAM,CAASoE,UAAT,EAAqB;AAC7B,cAAI8S,eAAe,GAAG,EAAtB;;AAEA,cAAI3hB,IAAI,CAACqO,UAAT,EAAqB;AACnBrO,YAAAA,IAAI,CAACqO,UAAL,CAAgBM,OAAhB,CAAwB,UAASiT,aAAT,EAAwB;AAC9C,kBAAI,CAACL,UAAU,CAACrT,IAAX,CAAgBnJ,UAArB,EAAiC;AAEjC,kBAAIyH,KAAK,GAAG+U,UAAU,CAACrT,IAAX,CAAgBnJ,UAAhB,CAA2B6c,aAA3B,CAAZ;AACA,kBAAI,CAACpV,KAAL,EAAY;AACZ,kBAAI,CAACA,KAAK,CAAC0B,IAAX,EAAiB;AACjB,kBAAI,CAAC1B,KAAK,CAAC0B,IAAN,CAAWM,KAAhB,EAAuB;AACvB,kBAAIhC,KAAK,CAAC0B,IAAN,CAAWM,KAAX,CAAiB7C,MAAjB,KAA4B,CAAhC,EAAmC;AAEnCgW,cAAAA,eAAe,CAACxU,IAAhB,CACE0U,gBAAgB,CAACrV,KAAD,CAAhB,CACGqB,IADH,CACQ,UAASiU,GAAT,EAAc;AAClB,uBAAO;AACLje,kBAAAA,IAAI,EAAE+d,aADD;AAELE,kBAAAA,GAAG,EAAEA;AAFA,iBAAP;AAID,eANH,CADF;AAUD,aAnBD;AAoBD;;AAED,iBAAOjB,EAAE,CAACkB,GAAH,CAAOJ,eAAP,EACJ9T,IADI,CACC,UAASmU,IAAT,EAAe;AACnB,gBAAI3T,UAAU,GAAG,EAAjB;AACA2T,YAAAA,IAAI,CAACrT,OAAL,CAAa,UAASmT,GAAT,EAAc;AACzBzT,cAAAA,UAAU,CAACyT,GAAG,CAACje,IAAL,CAAV,GAAuBie,GAAG,CAACA,GAA3B;AACD,aAFD;AAIAX,YAAAA,UAAU,CAACK,OAAD,CAAV,GAAsBL,UAAU,CAACK,OAAD,CAAV,IAAuB,IAAIR,OAAJ,EAA7C;AACAI,YAAAA,QAAQ,CAACI,OAAD,CAAR,GAAoBJ,QAAQ,CAACI,OAAD,CAAR,IAAqB,IAAIR,OAAJ,EAAzC;AACA,gBAAIiB,SAAS,GAAGd,UAAU,CAACK,OAAD,CAA1B;AACA,gBAAIU,OAAO,GAAGd,QAAQ,CAACI,OAAD,CAAtB;AAElB;;;;;;;;;;;;;;;;;;AAkBkBS,YAAAA,SAAS,CAACE,GAAV,CAAcZ,UAAd,EAA0BA,UAAU,CAACvhB,IAArC;AAEA,gBAAIyK,GAAG,GAAGzK,IAAI,CAACoiB,WAAL,CAAiBb,UAAU,CAACrT,IAA5B,EAAkCW,UAAlC,EAA8CR,UAA9C,CAAV;AACA6S,YAAAA,MAAM;AACNzW,YAAAA,GAAG,CAAC6V,EAAJ,GAASY,MAAT;;AAEA,gBAAIrS,UAAU,CAAClD,MAAX,KAAsB,CAA1B,EAA6B;AAC3B,kBAAI,CAACuW,OAAO,CAACG,GAAR,CAAYd,UAAZ,CAAL,EAA8BW,OAAO,CAACC,GAAR,CAAYZ,UAAZ,EAAwB,EAAxB;AAC9BW,cAAAA,OAAO,CAACI,GAAR,CAAYf,UAAZ,EAAwB1S,UAAU,CAAC,CAAD,CAAV,CAAcyR,EAAtC,IAA4C7V,GAA5C;AACD,aAHD,MAGO,IAAIoE,UAAU,CAAClD,MAAX,KAAsB,CAA1B,EAA6B;AAClC,kBAAI,CAACuW,OAAO,CAACG,GAAR,CAAYd,UAAZ,CAAL,EAA8BW,OAAO,CAACC,GAAR,CAAYZ,UAAZ,EAAwB,EAAxB;AAC9BW,cAAAA,OAAO,CAACI,GAAR,CAAYf,UAAZ,EAAwBgB,IAAxB,GAA+B9X,GAA/B;AACD;;AAED,mBAAOA,GAAP;AAED,WA9CI,CAAP;AA+CD,SAzED;;AA2EAA,QAAAA,GAAG,CAACoE,UAAJ,GAAiB7O,IAAI,CAAC6O,UAAtB;AAEA,eAAOpE,GAAP;AACD,OAzFI,CAAP;AA0FH,KA3FD;;AA6FA,QAAI+X,yBAAyB,GAAG,SAA5BA,yBAA4B,CAAShU,KAAT,EAAgBc,GAAhB,EAAqBkS,OAArB,EAA8B;AAC5D,UAAIhT,KAAK,CAAC7C,MAAN,KAAiB,CAArB,EAAwB,OAAOkV,EAAE,CAAC7X,IAAH,CAAQ,IAAR,CAAP;AAExB,UAAIuY,UAAU,GAAG/S,KAAK,CAACc,GAAD,CAAtB;AACAkS,MAAAA,OAAO,GAAGA,OAAO,IAAI,CAArB;AAEA,aAAOF,cAAc,CAACC,UAAD,EAAaC,OAAb,CAAd,CACJ3T,IADI,CACC,UAASuU,WAAT,EAAsB;AAC1B,YAAIA,WAAW,CAACvT,UAAhB,EAA4B;AAC1B,cAAI4T,SAAS,GAAG,SAAZA,SAAY,CAAStR,CAAT,EAAYtR,KAAZ,EAAmB;AACjC,gBAAI6iB,QAAQ,GAAGvR,CAAC,CAACjD,IAAF,CAAOM,KAAP,CAAayB,MAAb,CAAoBzB,KAAK,CAAC2R,KAAN,CAAY7Q,GAAG,GAAC,CAAhB,CAApB,CAAf;AACA,mBAAOkT,yBAAyB,CAACE,QAAD,EAAW,CAAX,EAAclB,OAAO,GAAC,EAAR,GAAa3hB,KAA3B,CAAhC;AACD,WAHD;;AAKA,iBAAOghB,EAAE,CAACkB,GAAH,CAAOR,UAAU,CAACrT,IAAX,CAAgBW,UAAhB,CAA2BV,GAA3B,CAA+BsU,SAA/B,CAAP,EACJ5U,IADI,CACC,UAASmU,IAAT,EAAe;AACnB,mBAAOI,WAAW,CAACJ,IAAD,CAAlB;AACD,WAHI,CAAP;AAID;;AAED,YAAIxT,KAAK,CAAC7C,MAAN,KAAiB,CAArB,EAAwB;AACtB,iBAAOyW,WAAW,CAAC,EAAD,CAAlB;AACD;;AAED,eAAOI,yBAAyB,CAAChU,KAAK,CAAC2R,KAAN,CAAY7Q,GAAG,GAAC,CAAhB,CAAD,EAAqB,CAArB,EAAwBkS,OAAxB,CAAzB,CACJ3T,IADI,CACC,UAASiU,GAAT,EAAc;AAClB,iBAAOM,WAAW,CAAC,CAACN,GAAD,CAAD,CAAlB;AACD,SAHI,CAAP;AAID,OAtBI,EAuBJjU,IAvBI,CAuBC,UAASiU,GAAT,EAAc;AAClB,YAAIA,GAAG,IAAIA,GAAG,CAACa,QAAf,EAAyB;AACvBb,UAAAA,GAAG,CAACa,QAAJ,CAAaC,eAAe,CAACrB,UAAD,CAA5B;AACD;;AACD,eAAOO,GAAP;AACD,OA5BI,CAAP;AA6BD,KAnCD;;AAqCA,QAAIc,eAAe,GAAG,SAAlBA,eAAkB,CAASrB,UAAT,EAAqB;AACzC,aAAO,UAASvX,MAAT,EAAiB;AACtB,YAAI+W,aAAa,CAACsB,GAAd,CAAkBd,UAAlB,CAAJ,EAAmC;AACjC,cAAIsB,EAAE,GAAG9B,aAAa,CAACuB,GAAd,CAAkBf,UAAlB,CAAT;AACAsB,UAAAA,EAAE,CAACC,IAAH,CAAQ,SAAR,EAAmB9Y,MAAnB;AACD;AACF,OALD;AAMD,KAPD;;AASA,QAAI6X,gBAAgB,GAAG,SAAnBA,gBAAmB,CAASN,UAAT,EAAqB;AAC1C,UAAIA,UAAU,CAACvhB,IAAX,KAAoB,OAAxB,EAAiC;AAC/B,eAAOwiB,yBAAyB,CAACjB,UAAU,CAACrT,IAAX,CAAgBM,KAAjB,EAAwB,CAAxB,CAAhC;AACD,OAFD,MAEO;AACL,eAAO8S,cAAc,CAACC,UAAD,EAAa,CAAb,CAAd,CACJ1T,IADI,CACC,UAASuU,WAAT,EAAsB;AAC1B,iBAAOA,WAAW,CAAC,EAAD,CAAlB;AACD,SAHI,CAAP;AAID;AACF,KATD;;AAWA,QAAIW,UAAU,GAAG,SAAbA,UAAa,CAASjB,GAAT,EAAc;AAC7B,WAAK,IAAIN,OAAT,IAAoBL,UAApB,EAAgC;AAC9BA,QAAAA,UAAU,CAACK,OAAD,CAAV,GAAsB,IAAIR,OAAJ,EAAtB;AACD;;AACD,WAAK,IAAIQ,OAAT,IAAoBJ,QAApB,EAA8B;AAC5BA,QAAAA,QAAQ,CAACI,OAAD,CAAR,GAAoB,IAAIR,OAAJ,EAApB;AACD;;AAEDgC,MAAAA,KAAK,CAACrU,OAAN,CAAc,UAAS6G,IAAT,EAAe;AAC3BA,QAAAA,IAAI,CAACyN,KAAL;AACD,OAFD;AAIAD,MAAAA,KAAK,GAAG,EAAR;AAEA,aAAOnC,EAAE,CAAC7X,IAAH,CAAQ,IAAR,CAAP;AACD,KAfD;;AAiBA,QAAIga,KAAK,GAAG,EAAZ;;AACA,QAAIrf,MAAM,GAAG,SAATA,MAAS,CAAS4d,UAAT,EAAqBG,KAArB,EAA4B;AACvC,aAAOG,gBAAgB,CAACN,UAAD,CAAhB,CACJ1T,IADI,CACC,UAASqV,GAAT,EAAc;AAClB,YAAI,CAACA,GAAL,EAAU;;AAEV,YAAIxB,KAAJ,EAAW;AACT,cAAIlM,IAAI,GAAEkM,KAAK,CAACyB,OAAN,EAAV;AACAH,UAAAA,KAAK,CAAC7V,IAAN,CAAWqI,IAAX;AACA,iBAAO0N,GAAG,CAAC1N,IAAD,CAAV;AACD;;AACD,eAAOnB,YAAY,CAAC+O,MAAb,CAAoB,UAAS1B,KAAT,EAAgB;AACzC,cAAIlM,IAAI,GAAGkM,KAAK,CAACyB,OAAN,EAAX;AACAH,UAAAA,KAAK,CAAC7V,IAAN,CAAWqI,IAAX;AACA,iBAAO0N,GAAG,CAAC1N,IAAD,CAAV;AACD,SAJM,CAAP;AAKD,OAdI,CAAP;AAeD,KAhBD;;AAkBA,QAAI5H,aAAa,GAAG,SAAhBA,aAAgB,CAASlE,IAAT,EAAeoL,QAAf,EAAyB;AAC3C,UAAI+N,EAAJ;;AAEA,UAAI9B,aAAa,CAACsB,GAAd,CAAkB3Y,IAAlB,CAAJ,EAA6B;AAC3BmZ,QAAAA,EAAE,GAAG9B,aAAa,CAACuB,GAAd,CAAkB5Y,IAAlB,CAAL;AACD,OAFD,MAEO;AACLmZ,QAAAA,EAAE,GAAG,IAAIQ,YAAJ,EAAL;AACAtC,QAAAA,aAAa,CAACoB,GAAd,CAAkBzY,IAAlB,EAAwBmZ,EAAxB;AACD;;AAEDA,MAAAA,EAAE,CAAC9Q,EAAH,CAAM,SAAN,EAAiB+C,QAAjB;AAEA,aAAO;AACLpH,QAAAA,OAAO,EAAE,mBAAW;AAClBmV,UAAAA,EAAE,CAACS,cAAH,CAAkB,SAAlB,EAA6BxO,QAA7B;AACD;AAHI,OAAP;AAKD,KAjBD;;AAmBA,WAAO;AACLnR,MAAAA,MAAM,EAAEA,MADH;AAELof,MAAAA,UAAU,EAAEA,UAFP;AAGLnV,MAAAA,aAAa,EAAEA;AAHV,KAAP;AAKD,GA1ND;AA2ND,CA9N8C,CAA/C;AAgOAtP,gBAAgB,CAACilB,OAAjB,CAAyB,cAAzB,EAAyC,YAAW;AAClD,MAAI7B,KAAJ;AACA,MAAI9O,OAAJ;;AAEA,MAAI4Q,UAAU,GAAG,SAAbA,UAAa,CAAS9B,KAAT,EAAgB+B,QAAhB,EAA0B5f,IAA1B,EAAgC;AAC/C,SAAK6f,SAAL,GAAiBD,QAAjB;AACA,SAAKE,MAAL,GAAcjC,KAAd;AACA,SAAKkC,KAAL,GAAa/f,IAAb;AACD,GAJD;;AAMA2f,EAAAA,UAAU,CAACK,SAAX,CAAqBnf,MAArB,GAA8B,YAAW;AACvC,QAAI+e,QAAQ,GAAG,KAAKC,SAApB;AACA,QAAII,SAAS,GAAGpC,KAAK,CAAChd,MAAN,EAAhB;AACA,QAAIqf,cAAc,GAAG,KAAKH,KAA1B;AACA,QAAI3G,OAAO,GAAGwG,QAAQ,CAAClf,IAAT,EAAd;AAEA7F,IAAAA,KAAK,CAACoS,KAAN,CAAYkT,WAAZ,CAAwBC,cAAxB,CAAuC,YAAU;AAC/CH,MAAAA,SAAS,CAACrf,IAAV;AACAqf,MAAAA,SAAS,CAACI,SAAV,CAAoB,UAASC,IAAT,EAAe;AACjC,YAAIhY,CAAC,GAAGgK,QAAQ,CAACiO,aAAT,CAAuB,GAAvB,CAAR;AACAjO,QAAAA,QAAQ,CAACkO,IAAT,CAAcC,WAAd,CAA0BnY,CAA1B;AACAA,QAAAA,CAAC,CAACoY,KAAF,GAAU,eAAV;AAEA,YAAIC,GAAG,GAAIlI,MAAM,CAACmI,GAAP,CAAWC,eAAX,CAA2BP,IAA3B,CAAX;AACAhY,QAAAA,CAAC,CAACwY,IAAF,GAASH,GAAT;AACArY,QAAAA,CAAC,CAACtE,QAAF,GAAakc,cAAc,GAAG,MAA9B;AACA5X,QAAAA,CAAC,CAACyY,KAAF;AACAtI,QAAAA,MAAM,CAACmI,GAAP,CAAWI,eAAX,CAA2BL,GAA3B;AACD,OAVD;AAWD,KAbD,EAaGf,QAAQ,CAACqB,QAAT,EAbH;AAcD,GApBD;;AAsBA,SAAO;AACLhP,IAAAA,WAAW,EAAE,uBAAW;AACtB,UAAI,CAAC4L,KAAL,EAAY;AACV9O,QAAAA,OAAO,GAAG,IAAIlU,KAAK,CAACqmB,OAAV,EAAV;AACArD,QAAAA,KAAK,GAAG9O,OAAO,CAACuQ,OAAR,EAAR;AACD;;AAEDvQ,MAAAA,OAAO,CAACoS,MAAR;AACD,KARI;AAUL5B,IAAAA,MAAM,EAAE,gBAASnX,CAAT,EAAY;AAClB,UAAI,CAACyV,KAAL,EAAY;AACV9O,QAAAA,OAAO,GAAG,IAAIlU,KAAK,CAACqmB,OAAV,EAAV;AACArD,QAAAA,KAAK,GAAG9O,OAAO,CAACuQ,OAAR,EAAR;AACD;;AACD,aAAOlX,CAAC,CAACyV,KAAD,CAAR;AACD,KAhBI;AAkBLhd,IAAAA,MAAM,EAAE,gBAASuc,OAAT,EAAkB3D,QAAlB,EAA4B;AAClC,aAAO,KAAK8F,MAAL,CAAY,YAAU;AAC3B,eAAOxQ,OAAO,CAAClO,MAAR,CAAeuc,OAAf,EAAwB3D,QAAxB,CAAP;AACD,OAFM,CAAP;AAGD,KAtBI;AAwBL2H,IAAAA,GAAG,EAAE,aAASC,IAAT,EAAe;AAClB,UAAIxD,KAAJ,EAAW;AACTA,QAAAA,KAAK,CAACuB,KAAN;AACD;;AACDvB,MAAAA,KAAK,GAAG,IAAIhjB,KAAK,CAACqmB,OAAV,GAAoB5B,OAApB,EAAR;;AAEA,UAAI;AACF,eAAO;AAAC3T,UAAAA,MAAM,EAAE9E,IAAI,CAAC,oBAAoBwa,IAApB,GAA2B,MAA5B,CAAJ;AAAT,SAAP;AACD,OAFD,CAEE,OAAMta,CAAN,EAAS;AACT,eAAO;AAACD,UAAAA,KAAK,EAAEC,CAAC,CAACC,QAAF;AAAR,SAAP;AACD;AACF;AAnCI,GAAP;AAqCD,CArED;AAuEAvM,gBAAgB,CAACilB,OAAjB,CAAyB,WAAzB,EAAsC,CAAC,YAAW;AAChD,SAAO,YAAW;AAChB,QAAI/U,KAAK,GAAG,EAAZ;AACA,QAAI2W,cAAc,GAAG,CAArB;;AAEA,QAAIC,IAAI,GAAG,SAAPA,IAAO,GAAW;AACpB,UAAID,cAAc,GAAG,CAArB,EAAwBA,cAAc;AACtC,aAAO3W,KAAK,CAAC2W,cAAD,CAAZ;AACD,KAHD;;AAKA,QAAIE,IAAI,GAAG,SAAPA,IAAO,GAAW;AACpB,UAAIF,cAAc,GAAG3W,KAAK,CAAC7C,MAAN,GAAa,CAAlC,EAAqCwZ,cAAc;AACnD,aAAO3W,KAAK,CAAC2W,cAAD,CAAZ;AACD,KAHD;;AAKA,QAAIG,eAAe,GAAG,SAAlBA,eAAkB,CAASpX,IAAT,EAAe;AACnCM,MAAAA,KAAK,GAAGA,KAAK,CAAC2R,KAAN,CAAY,CAAZ,EAAegF,cAAc,GAAC,CAA9B,CAAR;AACA3W,MAAAA,KAAK,CAACrB,IAAN,CAAWe,IAAX;AACA,UAAIM,KAAK,CAAC7C,MAAN,GAAe,GAAnB,EAAwB6C,KAAK,GAAGA,KAAK,CAAC2R,KAAN,CAAY,CAAZ,CAAR;AACxBgF,MAAAA,cAAc,GAAG3W,KAAK,CAAC7C,MAAN,GAAa,CAA9B;AACD,KALD;;AAOA,WAAO;AACL2Z,MAAAA,eAAe,EAAEA,eADZ;AAELF,MAAAA,IAAI,EAAEA,IAFD;AAGLC,MAAAA,IAAI,EAAEA;AAHD,KAAP;AAKD,GA1BD;AA2BD,CA5BqC,CAAtC;AA8BA/mB,gBAAgB,CAACilB,OAAjB,CAAyB,SAAzB,EAAoC,CAAC,OAAD,EAAU,gBAAV,EAA4B,UAAS7kB,KAAT,EAAgBuY,cAAhB,EAAgC;AAE9F,MAAIsO,QAAQ,GAAG,SAAXA,QAAW,CAASC,OAAT,EAAkB9b,IAAlB,EAAwByN,KAAxB,EAA+BsO,iBAA/B,EAAkDC,MAAlD,EAA0DC,GAA1D,EAA+D;AAC5E,QAAIzmB,MAAM,GAAGiY,KAAK,CAACjY,MAAN,CAAa0mB,IAAb,CAAkB,UAASC,EAAT,EAAaC,EAAb,EAAiB;AAAE,aAAOD,EAAE,CAACzN,CAAH,GAAO0N,EAAE,CAAC1N,CAAjB;AAAqB,KAA1D,CAAb;AACA,QAAI2N,YAAY,GAAG7mB,MAAM,CAACiP,GAAP,CAAW,UAAS0K,GAAT,EAAc;AAC1C,aAAO,CAACA,GAAG,CAAC/L,CAAL,EAAQ+L,GAAG,CAACT,CAAZ,EAAeS,GAAG,CAACV,CAAnB,EAAsB;AAAC6N,QAAAA,EAAE,EAAEnN,GAAG,CAACmN;AAAT,OAAtB,CAAP;AACD,KAFkB,CAAnB;;AAIA,SAAK,IAAIza,CAAC,GAAC,CAAX,EAAcA,CAAC,GAACwa,YAAY,CAACpa,MAA7B,EAAqCJ,CAAC,EAAtC,EAA0C;AACxC,UAAIsN,GAAG,GAAGkN,YAAY,CAACxa,CAAD,CAAtB;AACAia,MAAAA,OAAO,CAACrY,IAAR,CAAasY,iBAAiB,CAAC5M,GAAD,EAAMkN,YAAN,CAA9B,EAAmDJ,GAAnD;AACD;;AAEDH,IAAAA,OAAO,CAACS,SAAR,CAAkBhP,cAAc,GAAGvN,IAAI,CAAC6N,YAAtB,GAAqC7N,IAAI,CAAC4N,OAA5D;AACAkO,IAAAA,OAAO,CAACU,YAAR,CAAqB,CAACjP,cAAc,GAACvN,IAAI,CAAC6N,YAApB,GAAmC7N,IAAI,CAAC4N,OAAzC,EAAkDoO,MAAlD,CAArB;AAEA,QAAIS,UAAU,GAAGzc,IAAI,CAAC4N,OAAL,GAAe5N,IAAI,CAAC6N,YAArC;AACD,GAfD;;AAiBA,MAAIiO,OAAO,GAAG,iBAAS9b,IAAT,EAAeyN,KAAf,EAAsBsO,iBAAtB,EAAyCC,MAAzC,EAAiD;AAC7D,QAAIF,OAAO,GAAG,IAAI9mB,KAAK,CAAC0nB,YAAV,EAAd;AACAb,IAAAA,QAAQ,CAACC,OAAD,EAAU9b,IAAV,EAAgByN,KAAhB,EAAuBsO,iBAAvB,EAA0CC,MAA1C,CAAR;AACA,WAAOF,OAAP;AACD,GAJD;;AAMA,MAAIa,cAAc,GAAG,SAAjBA,cAAiB,CAAS3c,IAAT,EAAe4c,WAAf,EAA4B9Q,IAA5B,EAAkCkQ,MAAlC,EAA0CzE,OAA1C,EAAmD;AACtE,QAAI9W,KAAK,GAAI8W,OAAO,IAAIA,OAAO,CAAC9W,KAApB,IAA8B,CAA1C;;AACA,QAAIoc,YAAY,GAAG,SAAfA,YAAe,CAASpP,KAAT,EAAgB7H,GAAhB,EAAqB;AACtCA,MAAAA,GAAG,GAAGkG,IAAI,GAAGlG,GAAb;AACA,UAAIrP,UAAU,GAAGqmB,WAAW,CAACnP,KAAK,CAAClX,UAAN,GAAmB,GAAnB,GAAyBqP,GAA1B,CAA5B;AACA,aAAOrP,UAAU,IAAIA,UAAU,CAACumB,KAAhC;AACD,KAJD;;AAMA,QAAIC,SAAS,GAAG,SAAZA,SAAY,CAAStP,KAAT,EAAgB;AAC9B,aAAOA,KAAK,CAACjY,MAAb;AACD,KAFD;;AAIA,QAAI+Q,MAAM,GAAG,SAATA,MAAS,CAAS9D,CAAT,EAAYC,CAAZ,EAAe;AAC1B,aAAOD,CAAC,CAAC8D,MAAF,CAAS7D,CAAT,CAAP;AACD,KAFD;;AAIA,QAAIsa,OAAO,GAAG,SAAVA,OAAU,CAASva,CAAT,EAAYC,CAAZ,EAAe;AAC3B,aAAOD,CAAC,CAACiM,CAAF,GAAIhM,CAAC,CAACgM,CAAb;AACD,KAFD;;AAIA,QAAIuO,OAAO,GAAG,EAAd;AACA,QAAInB,OAAO,GAAG,IAAI9mB,KAAK,CAAC0nB,YAAV,CAAuB,IAAvB,EACd;AACEQ,MAAAA,IAAI,EAAEloB,KAAK,CAAC2N,IAAN,CAAWwa,WAAX,CAAuB;AAC3BliB,QAAAA,GAAG,EAAE+E,IAAI,CAAC/E,GADiB;AAE3BmiB,QAAAA,cAAc,EAAE7P,cAFW;AAG3B8P,QAAAA,UAAU,EAAErd,IAAI,CAAChD,MAAL,CAAY3G,MAAZ,CAAmBwmB,YAAnB,EAAiCpY,GAAjC,CAAqCsY,SAArC,EAAgDO,MAAhD,CAAuD/W,MAAvD,EAA+D,EAA/D,EAAmE2V,IAAnE,CAAwEc,OAAxE,CAHe;AAI3Bvc,QAAAA,KAAK,EAAEA;AAJoB,OAAvB,CADR;AAOEwc,MAAAA,OAAO,EAAEA;AAPX,KADc,CAAd;AAWAjd,IAAAA,IAAI,CAAChD,MAAL,CAAYiI,OAAZ,CAAoB,UAASwI,KAAT,EAAgB7H,GAAhB,EAAqB;AACvCA,MAAAA,GAAG,GAAGkG,IAAI,GAAGlG,GAAb;AAEA,UAAIrP,UAAU,GAAGqmB,WAAW,CAACnP,KAAK,CAAClX,UAAN,GAAmB,GAAnB,GAAyBqP,GAA1B,CAA5B;;AAEA,UAAIrP,UAAU,IAAI,CAACA,UAAU,CAACumB,KAA9B,EAAqC;AACnC,YAAIf,iBAAiB,GAAGxlB,UAAU,CAACwlB,iBAAX,IAAgC,UAASvY,CAAT,EAAW;AAAE,iBAAOA,CAAP;AAAW,SAAhF;;AACA,YAAI0F,OAAO,GAAGlU,KAAK,CAAC0nB,YAAN,CAAmBxT,OAAnB,CAA2B3S,UAA3B,EAAuC,IAAvC,EAA6C0mB,OAA7C,CAAd;AACApB,QAAAA,QAAQ,CAACC,OAAD,EAAU9b,IAAV,EAAgByN,KAAhB,EAAuBsO,iBAAvB,EAA0CC,MAA1C,EAAkD9S,OAAlD,CAAR;AACD;AACF,KAVD;AAYA,QAAInI,GAAG,GAAG+a,OAAO,CAACyB,YAAR,CAAqB,IAArB,CAAV;;AACAxc,IAAAA,GAAG,CAAC8a,QAAJ,GAAe,UAAS2B,YAAT,EAAuBP,OAAvB,EAAgC;AAC7C,UAAIQ,QAAQ,GAAG,EAAf;AACAR,MAAAA,OAAO,GAAGA,OAAO,IAAI,EAArB;AAEAjd,MAAAA,IAAI,CAAChD,MAAL,CAAYiI,OAAZ,CAAoB,UAASwI,KAAT,EAAgB7H,GAAhB,EAAqB;AACvCA,QAAAA,GAAG,GAAGkG,IAAI,GAAGlG,GAAb;AAEA,YAAIrP,UAAU,GAAGqmB,WAAW,CAACnP,KAAK,CAAClX,UAAN,GAAmB,GAAnB,GAAyBqP,GAA1B,CAA5B;;AAEA,YAAIrP,UAAJ,EAAgB;AACd,cAAIwlB,iBAAiB,GAAGxlB,UAAU,CAACwlB,iBAAX,IAAgC,UAASvY,CAAT,EAAW;AAAE,mBAAOA,CAAP;AAAW,WAAhF;;AACA,cAAI0F,OAAO,GAAGlU,KAAK,CAAC0nB,YAAN,CAAmBxT,OAAnB,CAA2B3S,UAA3B,EAAuC,IAAvC,EAA6C0mB,OAA7C,CAAd;AAEAQ,UAAAA,QAAQ,CAACha,IAAT,CAAcyF,OAAd;AACA2S,UAAAA,QAAQ,CAAC2B,YAAD,EAAexd,IAAf,EAAqByN,KAArB,EAA4BsO,iBAA5B,EAA+CC,MAA/C,EAAuD9S,OAAvD,CAAR;AACD;AACF,OAZD;AAcA,aAAOuU,QAAP;AACD,KAnBD;;AAqBA1c,IAAAA,GAAG,CAACuS,WAAJ,GAAkB,YAAW;AAC3B,aAAOte,KAAK,CAAC2N,IAAN,CAAW2Q,WAAX,CAAuB;AAC5BrY,QAAAA,GAAG,EAAE+E,IAAI,CAAC/E,GADkB;AAE5BmiB,QAAAA,cAAc,EAAE7P,cAFY;AAG5B8P,QAAAA,UAAU,EAAErd,IAAI,CAAChD,MAAL,CAAY3G,MAAZ,CAAmBwmB,YAAnB,EAAiCpY,GAAjC,CAAqCsY,SAArC,EAAgDO,MAAhD,CAAuD/W,MAAvD,EAA+D,EAA/D,EAAmE2V,IAAnE,CAAwEc,OAAxE,CAHgB;AAI5Bvc,QAAAA,KAAK,EAAEA;AAJqB,OAAvB,CAAP;AAMD,KAPD;;AASAM,IAAAA,GAAG,CAACsc,UAAJ,GAAiBrd,IAAI,CAAChD,MAAL,CAAY3G,MAAZ,CAAmBwmB,YAAnB,EAAiCpY,GAAjC,CAAqCsY,SAArC,EAAgDO,MAAhD,CAAuD/W,MAAvD,EAA+D,EAA/D,EAAmE2V,IAAnE,CAAwEc,OAAxE,CAAjB;AAEA,WAAOjc,GAAP;AACD,GA9ED;;AAgFA,MAAI2c,MAAM,GAAG,SAATA,MAAS,CAASjb,CAAT,EAAWC,CAAX,EAAc;AACzB,WAAOD,CAAC,GAACC,CAAF,GAAMD,CAAN,GAAUC,CAAjB;AACD,GAFD;;AAIA,MAAIib,mBAAmB,GAAG,SAAtBA,mBAAsB,CAAS3d,IAAT,EAAe4N,OAAf,EAAwB;AAChD,QAAIA,OAAO,GAAC,CAAZ,EAAeA,OAAO,GAAC,CAAR;AACf,QAAIgQ,OAAO,GAAG5d,IAAI,CAAChD,MAAL,CAAYyH,GAAZ,CAAgB,UAASgJ,KAAT,EAAgB;AAC5C,aAAOA,KAAK,CAACjY,MAAN,CAAaiP,GAAb,CAAiB,UAAS0K,GAAT,EAAc;AACpC,eAAOA,GAAG,CAACT,CAAJ,GAAQS,GAAG,CAACV,CAAnB;AACD,OAFM,EAEJ6O,MAFI,CAEGI,MAFH,EAEW,CAFX,CAAP;AAGD,KAJa,EAIXJ,MAJW,CAIJI,MAJI,EAIG,CAJH,CAAd;AAMA,QAAIG,aAAa,GAAGjQ,OAAO,GAAGL,cAA9B;AACA,QAAIM,YAAY,GAAGlL,IAAI,CAACqI,KAAL,CAAW,CAAC4S,OAAO,GAAC,CAAT,IAAYC,aAAvB,IAAwC,CAA3D;AACA,QAAIhQ,YAAY,GAAC,CAAjB,EAAoB,OAAO,CAAP;AACpB,WAAOA,YAAP;AACD,GAZD;;AAcA,MAAIiQ,aAAa,GAAG,SAAhBA,aAAgB,CAAS9d,IAAT,EAAe;AACjC,QAAI+d,QAAQ,GAAG/d,IAAI,CAAChD,MAAL,CAAYghB,IAAZ,CAAiB,UAASxb,CAAT,EAAY;AAAC,aAAOA,CAAC,CAACxE,IAAT;AAAgB,KAA9C,CAAf;AACA,WAAOgC,IAAI,CAAChD,MAAL,CAAYyH,GAAZ,CAAgB,UAASjC,CAAT,EAAY;AACjC,UAAIub,QAAJ,EAAc;AACZ,eAAOvb,CAAC,CAACzE,KAAF,IAAW,CAACyE,CAAC,CAACxE,IAArB;AACD,OAFD,MAEO;AACL,eAAOwE,CAAC,CAACzE,KAAF,IAAW,CAACyE,CAAC,CAACjM,UAArB;AACD;AACF,KANM,CAAP;AAOD,GATD;;AAWA,MAAIgQ,MAAM,GAAG,SAATA,MAAS,CAAS9D,CAAT,EAAYC,CAAZ,EAAe;AAC1B,WAAOD,CAAC,CAAC8D,MAAF,CAAS7D,CAAT,CAAP;AACD,GAFD;;AAIA,MAAIub,IAAI,GAAG,SAAPA,IAAO,CAASC,IAAT,EAAe;AACxB,WAAO,UAAS/O,GAAT,EAAc;AACnB,aAAOA,GAAG,KAAK+O,IAAf;AACD,KAFD;AAGD,GAJD;;AAMA,MAAIpP,SAAS,GAAG,SAAZA,SAAY,CAAStY,OAAT,EAAkBiX,KAAlB,EAAyByQ,IAAzB,EAA+BxP,CAA/B,EAAkC;AAChD,QAAIyP,OAAO,GAAG,SAAVA,OAAU,CAASxN,EAAT,EAAaC,EAAb,EAAiB;AAC7B,aAAOjO,IAAI,CAACoM,GAAL,CAASmP,IAAI,CAACxP,CAAL,GAASiC,EAAlB,IAAwBhO,IAAI,CAACoM,GAAL,CAASmP,IAAI,CAACxP,CAAL,GAASkC,EAAlB,CAAxB,GAAgDD,EAAhD,GAAqDC,EAA5D;AACD,KAFD;;AAIA,QAAIwN,SAAS,GAAG5nB,OAAO,CAACwG,MAAR,CAAeyH,GAAf,CAAmB,UAASgJ,KAAT,EAAgB;AACjD,aAAOA,KAAK,CAACjY,MAAN,CAAaa,MAAb,CAAoB4nB,IAAI,CAACC,IAAD,CAAxB,CAAP;AACD,KAFe,EAEbZ,MAFa,CAEN/W,MAFM,CAAhB;AAIA,QAAI8X,cAAc,GAAG7nB,OAAO,CAACwG,MAAR,CAAeyH,GAAf,CAAmB,UAAS6Z,EAAT,EAAa;AACnD,UAAI7Q,KAAK,KAAK6Q,EAAd,EAAkB,OAAO,EAAP;AAClB,aAAOA,EAAE,CAAC9oB,MAAH,CAAUa,MAAV,CAAiB4nB,IAAI,CAACC,IAAD,CAArB,CAAP;AACD,KAHoB,EAGlBZ,MAHkB,CAGX/W,MAHW,CAArB;AAKA,QAAI6X,SAAS,CAACnc,MAAV,KAAqB,CAAzB,EAA4B,OAAO,CAAP;AAE5B,QAAIsc,KAAK,GAAGH,SAAS,CAAC3Z,GAAV,CAAc,UAAS0K,GAAT,EAAc;AACtC,aAAOA,GAAG,CAACT,CAAJ,GAAQS,GAAG,CAACV,CAAnB;AACD,KAFW,EAETlI,MAFS,CAEF6X,SAAS,CAAC3Z,GAAV,CAAc,UAAS0K,GAAT,EAAc;AACpC,aAAOA,GAAG,CAACT,CAAJ,GAAQwP,IAAI,CAACzP,CAApB;AACD,KAFS,CAFE,EAIRlI,MAJQ,CAID8X,cAAc,CAAC5Z,GAAf,CAAmB,UAAS0K,GAAT,EAAc;AAC1C,aAAOA,GAAG,CAACT,CAAX;AACD,KAFU,CAJC,CAAZ;AAQA,WAAO6P,KAAK,CAACjB,MAAN,CAAaa,OAAb,CAAP;AACD,GAzBD;;AA2BA,MAAIjM,SAAS,GAAG,SAAZA,SAAY,CAAS1b,OAAT,EAAkBiX,KAAlB,EAAyByQ,IAAzB,EAA+BxP,CAA/B,EAAkC;AAChD,QAAIyP,OAAO,GAAG,SAAVA,OAAU,CAASxN,EAAT,EAAaC,EAAb,EAAiB;AAC7B,aAAOjO,IAAI,CAACoM,GAAL,CAASmP,IAAI,CAACxP,CAAL,GAASwP,IAAI,CAACzP,CAAd,GAAkBkC,EAA3B,IAAiChO,IAAI,CAACoM,GAAL,CAASmP,IAAI,CAACxP,CAAL,GAASwP,IAAI,CAACzP,CAAd,GAAkBmC,EAA3B,CAAjC,GAAkED,EAAlE,GAAuEC,EAA9E;AACD,KAFD;;AAIA,QAAIwN,SAAS,GAAG5nB,OAAO,CAACwG,MAAR,CAAeyH,GAAf,CAAmB,UAASgJ,KAAT,EAAgB;AACjD,aAAOA,KAAK,CAACjY,MAAN,CAAaa,MAAb,CAAoB4nB,IAAI,CAACC,IAAD,CAAxB,CAAP;AACD,KAFe,EAEbZ,MAFa,CAEN/W,MAFM,CAAhB;AAIA,QAAI8X,cAAc,GAAG7nB,OAAO,CAACwG,MAAR,CAAeyH,GAAf,CAAmB,UAAS6Z,EAAT,EAAa;AACnD,UAAI7Q,KAAK,KAAK6Q,EAAd,EAAkB,OAAO,EAAP;AAClB,aAAOA,EAAE,CAAC9oB,MAAH,CAAUa,MAAV,CAAiB4nB,IAAI,CAACC,IAAD,CAArB,CAAP;AACD,KAHoB,EAGlBZ,MAHkB,CAGX/W,MAHW,CAArB;AAKA,QAAI6X,SAAS,CAACnc,MAAV,KAAqB,CAAzB,EAA4B,OAAO,CAAP;AAC5B,QAAIsc,KAAK,GAAGH,SAAS,CAAC3Z,GAAV,CAAc,UAAS0K,GAAT,EAAc;AACtC,aAAOA,GAAG,CAACT,CAAX;AACD,KAFW,EAETnI,MAFS,CAEF8X,cAAc,CAAC5Z,GAAf,CAAmB,UAAS0K,GAAT,EAAc;AACzC,aAAOA,GAAG,CAACT,CAAJ,GAAQS,GAAG,CAACV,CAAnB;AACD,KAFS,CAFE,CAAZ;AAMA,WAAO8P,KAAK,CAACjB,MAAN,CAAaa,OAAb,IAAwBD,IAAI,CAACxP,CAApC;AACD,GAtBD;;AAwBA,MAAIM,QAAQ,GAAG,SAAXA,QAAW,CAASxY,OAAT,EAAkBiX,KAAlB,EAAyByQ,IAAzB,EAA+B;AAC5C,QAAIE,SAAS,GAAG3Q,KAAK,CAACjY,MAAN,CAAaa,MAAb,CAAoB4nB,IAAI,CAACC,IAAD,CAAxB,CAAhB;AAEAE,IAAAA,SAAS,CAAC/nB,MAAV,CAAiB,UAAS8Y,GAAT,EAAc;AAC7B,aAAOA,GAAG,CAACT,CAAJ,GAAQwP,IAAI,CAACxP,CAApB;AACD,KAFD,EAEGzJ,OAFH,CAEW,UAASkK,GAAT,EAAc;AACvB,UAAI+O,IAAI,CAACxP,CAAL,GAASwP,IAAI,CAACzP,CAAd,GAAkBU,GAAG,CAACT,CAA1B,EAA6B;AAC3BwP,QAAAA,IAAI,CAACzP,CAAL,GAASU,GAAG,CAACT,CAAJ,GAAQwP,IAAI,CAACxP,CAAtB;AACD;AACF,KAND;AAQA,QAAI8P,YAAY,GAAGhoB,OAAO,CAACoX,OAAR,GAAkBL,cAArC;;AACA,QAAI,CAAC2Q,IAAI,CAACxP,CAAL,GAASwP,IAAI,CAACzP,CAAf,IAAoB+P,YAApB,GAAmCN,IAAI,CAACxP,CAAL,GAAS8P,YAAhD,EAA8D;AAC5DN,MAAAA,IAAI,CAACzP,CAAL,GAASyP,IAAI,CAACzP,CAAL,GAAS,CAACyP,IAAI,CAACxP,CAAL,GAASwP,IAAI,CAACzP,CAAf,IAAoB+P,YAAtC;AACD;AACF,GAfD;;AAiBA,MAAI7O,SAAS,GAAG,SAAZA,SAAY,CAASlC,KAAT,EAAgByQ,IAAhB,EAAsB;AACpC,QAAIE,SAAS,GAAG3Q,KAAK,CAACjY,MAAN,CAAaa,MAAb,CAAoB4nB,IAAI,CAACC,IAAD,CAAxB,CAAhB;AACA,WAAOE,SAAS,CAACJ,IAAV,CAAe,UAAS7O,GAAT,EAAc;AAClC,UAAIA,GAAG,CAAC/L,CAAJ,KAAU8a,IAAI,CAAC9a,CAAnB,EAAsB,OAAO,KAAP;AACtB,UAAI+L,GAAG,CAACT,CAAJ,IAASwP,IAAI,CAACxP,CAAd,IAAmBwP,IAAI,CAACxP,CAAL,GAASS,GAAG,CAACT,CAAJ,GAAQS,GAAG,CAACV,CAA5C,EAA+C,OAAO,IAAP;AAC/C,UAAIyP,IAAI,CAACxP,CAAL,IAAUS,GAAG,CAACT,CAAd,IAAmBS,GAAG,CAACT,CAAJ,GAAQwP,IAAI,CAACxP,CAAL,GAASwP,IAAI,CAACzP,CAA7C,EAAgD,OAAO,IAAP;AAEhD,aAAO,KAAP;AACD,KANM,CAAP;AAOD,GATD;;AAWA,SAAO;AACLqN,IAAAA,OAAO,EAAEA,OADJ;AAELa,IAAAA,cAAc,EAAEA,cAFX;AAGLgB,IAAAA,mBAAmB,EAAEA,mBAHhB;AAILG,IAAAA,aAAa,EAAEA,aAJV;AAKL5L,IAAAA,SAAS,EAAEA,SALN;AAMLpD,IAAAA,SAAS,EAAEA,SANN;AAOLE,IAAAA,QAAQ,EAAEA,QAPL;AAQLW,IAAAA,SAAS,EAAEA;AARN,GAAP;AAUD,CAzOmC,CAApC;AA4OA/a,gBAAgB,CAACilB,OAAjB,CAAyB,eAAzB,EAA0C,CAAC,gBAAD,EAAmB,oBAAnB,EAAyC,cAAzC,EAAyD,UAAS3D,cAAT,EAAyBpW,kBAAzB,EAA6C6K,YAA7C,EAA2D;AAC5J,MAAI5J,GAAG,GAAG,SAANA,GAAM,CAASiX,KAAT,EAAgB;AACxB,QAAIyG,kBAAJ;AACA,QAAIC,YAAY,GAAG,EAAnB;AAEA,QAAIjG,GAAG,GAAG,EAAV;AACA,QAAIkG,OAAO,GAAG,EAAd;;AACA,QAAIC,IAAI,GAAG,SAAPA,IAAO,CAAShI,EAAT,EAAaiI,OAAb,EAAsB;AAC/BA,MAAAA,OAAO,GAAGA,OAAO,IAAI,CAArB;;AACA,UAAIC,GAAG,GAAGlI,EAAE,GAAG,GAAL,GAAWiI,OAArB;;AACA,UAAI,CAACpG,GAAG,CAACqG,GAAD,CAAR,EAAe;AACbJ,QAAAA,YAAY,CAACG,OAAD,CAAZ,GAAwBH,YAAY,CAACG,OAAD,CAAZ,IAAyB7G,KAAK,CAAC+G,IAAN,CAAW,GAAX,CAAjD;AAEAtG,QAAAA,GAAG,CAACqG,GAAD,CAAH,GAAW5I,cAAc,CAAC8I,OAAf,CAAuBpI,EAAvB,EACRzS,IADQ,CACH,UAASnE,IAAT,EAAe;AACnB,cAAIA,IAAI,CAAC7J,KAAL,CAAWG,IAAX,KAAoB,YAAxB,EAAsC;AACpC,gBAAI,CAACmoB,kBAAL,EAAyBA,kBAAkB,GAAG3e,kBAAkB,EAAvC;AACzB,mBAAO2e,kBAAkB,CAACxkB,MAAnB,CAA0B+F,IAAI,CAACif,QAA/B,EAAyCP,YAAY,CAACG,OAAD,CAArD,EACJ1a,IADI,CACC,UAASiU,GAAT,EAAa;AACjBuG,cAAAA,OAAO,CAAClb,IAAR,CAAa2U,GAAb;AACA,qBAAOA,GAAP;AACD,aAJI,CAAP;AAMD,WARD,MAQO;AACL,mBAAO;AAAC0E,cAAAA,KAAK,EAAE;AAAR,aAAP;AACD;AACF,SAbQ,CAAX;AAcD;;AAED,aAAOrE,GAAG,CAACqG,GAAD,CAAV;AACD,KAvBD;;AAyBA,QAAII,OAAO,GAAG,SAAVA,OAAU,GAAW;AACvBP,MAAAA,OAAO,CAAC1Z,OAAR,CAAgB,UAAS1O,UAAT,EAAoB;AAClC,YAAIA,UAAU,CAAC2oB,OAAf,EAAwB;AACtB3oB,UAAAA,UAAU,CAAC2oB,OAAX;AACD;AACF,OAJD;;AAMA,UAAIT,kBAAJ,EAAwB;AACtB,eAAOA,kBAAkB,CAACpF,UAAnB,EAAP;AACD;AACF,KAVD;;AAYA,QAAI8F,IAAI,GAAG,SAAPA,IAAO,CAASN,OAAT,EAAkBO,SAAlB,EAA6B;AACtCV,MAAAA,YAAY,CAACG,OAAD,CAAZ,GAAwBH,YAAY,CAACG,OAAD,CAAZ,IAAyB7G,KAAK,CAAC+G,IAAN,CAAW,GAAX,CAAjD;AACAL,MAAAA,YAAY,CAACG,OAAD,CAAZ,CAAsB1T,MAAtB,CAA6BiU,SAAS,GAAG,GAAH,GAAS,GAA/C;AACD,KAHD;;AAKA,WAAO;AACLR,MAAAA,IAAI,EAAEA,IADD;AAELO,MAAAA,IAAI,EAAEA,IAFD;AAGL9G,MAAAA,GAAG,EAAEI,GAHA;AAILyG,MAAAA,OAAO,EAAEA;AAJJ,KAAP;AAMD,GAtDD;;AAwDA,SAAO,UAASlH,KAAT,EAAgB;AACrB,QAAIA,KAAJ,EAAW,OAAOjX,GAAG,CAACiX,KAAD,CAAV;AACX,WAAOrN,YAAY,CAAC+O,MAAb,CAAoB3Y,GAApB,CAAP;AACD,GAHD;AAID,CA7DyC,CAA1C;AA+DAnM,gBAAgB,CAACilB,OAAjB,CAAyB,gBAAzB,EAA2C,CAAC,OAAD,EAAU,IAAV,EAAgB,aAAhB,EAA+B,WAA/B,EAA4C,OAA5C,EAAqD,cAArD,EAAqE,UAASla,KAAT,EAAgBwX,EAAhB,EAAoBvX,WAApB,EAAiCyf,SAAjC,EAA4CC,KAA5C,EAAmDrqB,WAAnD,EAAgE;AAC9K,MAAIsqB,iBAAiB,GAAG,EAAxB;AACA,MAAIC,YAAY,GAAG,EAAnB;AAEA,MAAIC,QAAQ,GAAG,CACb,kCADa,EAEb,2BAFa,EAGb,kCAHa,EAIb,iCAJa,EAKb,6BALa,EAMb,+BANa,EAOb,gCAPa,EAQb,mCARa,CAAf;;AAWA,MAAIC,WAAW,GAAG,SAAdA,WAAc,CAASC,GAAT,EAAc;AAC9B,WAAOhgB,KAAK,CAACiZ,GAAN,CAAU+G,GAAV,EACJxb,IADI,CACC,UAASyb,CAAT,EAAY;AAChBA,MAAAA,CAAC,CAACpb,IAAF,CAAOS,OAAP,CAAe,UAASmT,GAAT,EAAc;AAC3B,YAAIyH,QAAQ,GAAGzH,GAAG,CAACxB,EAAnB;AAEA4I,QAAAA,YAAY,CAACK,QAAD,CAAZ,GAAyBzH,GAAG,CAAC6G,QAA7B;AAEAM,QAAAA,iBAAiB,CAAC9b,IAAlB,CAAuB;AACrB5M,UAAAA,OAAO,EAAEuhB,GAAG,CAACvhB,OADQ;AAErBP,UAAAA,IAAI,EAAE8hB,GAAG,CAAC9hB,IAFW;AAGrB6D,UAAAA,IAAI,EAAEie,GAAG,CAACje,IAHW;AAIrByc,UAAAA,EAAE,EAAEiJ,QAJiB;AAKrBC,UAAAA,GAAG,EAAE1H,GAAG,CAAC0H,GALY;AAMrBC,UAAAA,OAAO,EAAE;AANY,SAAvB;AAQD,OAbD;AAcD,KAhBI,CAAP;AAiBD,GAlBD;;AAoBA,MAAIC,aAAa,GAAG,SAAhBA,aAAgB,CAASpJ,EAAT,EAAatgB,IAAb,EAAmB6D,IAAnB,EAAyB8lB,OAAzB,EAAkC;AACpDV,IAAAA,iBAAiB,CAAC9b,IAAlB,CAAuB;AACrB5M,MAAAA,OAAO,EAAE,SADY;AAErBP,MAAAA,IAAI,EAAEA,IAFe;AAGrBsgB,MAAAA,EAAE,EAAEA,EAHiB;AAIrBzc,MAAAA,IAAI,EAAEA,IAJe;AAKrB+lB,MAAAA,YAAY,EAAE;AALO,KAAvB;AAQAV,IAAAA,YAAY,CAAC5I,EAAD,CAAZ,GAAmBqJ,OAAnB;AACD,GAVD;;AAYAD,EAAAA,aAAa,CAAC,OAAD,EAAU,OAAV,EAAmB,OAAnB,EAA4B,EAA5B,CAAb;AAEA,MAAIG,aAAa,GAAGhJ,EAAE,CAACkB,GAAH,CAAOoH,QAAQ,CAAChb,GAAT,CAAaib,WAAb,CAAP,CAApB;;AAEA,MAAIU,QAAQ,GAAG,SAAXA,QAAW,GAAW;AACxB,QAAItb,KAAK,GAAG,EAAZ;;AACA,SAAK,IAAIjD,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,EAApB,EAAwBA,CAAC,EAAzB,EAA6B;AAC3B,UAAIiB,KAAK,GAAG,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,EAAS,CAAT,EAAW,CAAX,EAAa,CAAb,EAAe,CAAf,EAAiB,CAAjB,EAAmB,CAAnB,EAAqB,GAArB,EAAyB,GAAzB,EAA6B,GAA7B,EAAiC,GAAjC,EAAqC,GAArC,EAAyC,GAAzC,EAA8CH,IAAI,CAACqI,KAAL,CAAWrI,IAAI,CAAC0d,MAAL,KAAc,EAAzB,CAA9C,CAAZ;AACAvb,MAAAA,KAAK,CAACrB,IAAN,CAAWX,KAAX;AACD;;AAED,WAAOgC,KAAK,CAACwb,IAAN,CAAW,EAAX,CAAP;AACD,GARD;;AAUA,MAAIC,mBAAmB,GAAG,IAAI5G,YAAJ,EAA1B;AACA,MAAI6G,eAAe,GAAG,IAAI7G,YAAJ,EAAtB;AAEA,MAAI8G,WAAW,GAAG;AAChBlqB,IAAAA,UAAU,EAAE;AACVD,MAAAA,IAAI,EAAE,OADI;AAEVkO,MAAAA,IAAI,EAAE;AACJM,QAAAA,KAAK,EAAE;AADH;AAFI,KADI;AAOhBrO,IAAAA,IAAI,EAAE;AACJmX,MAAAA,OAAO,EAAE,CADL;AAEJ3S,MAAAA,GAAG,EAAE,GAFD;AAGJ+B,MAAAA,MAAM,EAAE,CACN;AAAC0jB,QAAAA,MAAM,EAAE,CAAC,EAAD,EAAI,EAAJ,EAAO,EAAP;AAAT,OADM,EAEN;AAACA,QAAAA,MAAM,EAAE,CAAC,EAAD,EAAI,EAAJ,EAAO,EAAP;AAAT,OAFM;AAHJ,KAPU;AAehBlqB,IAAAA,OAAO,EAAE;AACPoX,MAAAA,OAAO,EAAE,CADF;AAEPC,MAAAA,YAAY,EAAE,CAFP;AAGP5S,MAAAA,GAAG,EAAE,GAHE;AAIP0lB,MAAAA,aAAa,EAAE,CAJR;AAKP3jB,MAAAA,MAAM,EAAC,CACL;AAAC4jB,QAAAA,MAAM,EAAE,IAAT;AAAeprB,QAAAA,MAAM,EAAE;AAAvB,OADK,CALA;AAQP+S,MAAAA,UAAU,EAAE;AARL;AAfO,GAAlB;AA2BA,MAAIsY,IAAI,GAAG,IAAIvJ,OAAJ,EAAX;;AAEA,MAAIwJ,UAAU,GAAG,SAAbA,UAAa,CAASlK,EAAT,EAAaqI,QAAb,EAAuB1H,OAAvB,EAAgC;AAC/C,WAAOJ,EAAE,CAAC7X,IAAH,GACJ6E,IADI,CACC,YAAW;AACf,UAAI4c,SAAS,GAAGxB,iBAAiB,CAAClpB,MAAlB,CAAyB,UAASmN,CAAT,EAAY;AAAC,eAAOA,CAAC,CAACoT,EAAF,KAASA,EAAhB;AAAqB,OAA3D,EAA6D,CAA7D,CAAhB;AACA,UAAImK,SAAJ,EAAe,OAAOA,SAAP;AAEf,aAAOC,YAAY,CAACC,QAAb,CAAsBrK,EAAtB,CAAP;AACD,KANI,EAOJzS,IAPI,CAOC,UAAS4c,SAAT,EAAoB;AACxB,UAAIA,SAAJ,EAAe;AACb,YAAIG,UAAU,GAAGlsB,KAAK,CAACmsB,OAAN,CAAcC,eAAd,CAA8BC,SAA9B,CAAwCN,SAAS,CAACzqB,IAAlD,EAAwD2oB,QAAxD,CAAjB;;AAEA,YAAI,CAAC1H,OAAD,IAAY,CAACA,OAAO,CAAC+J,SAAzB,EAAoC;AAClCT,UAAAA,IAAI,CAACjK,EAAD,CAAJ,GAAWiK,IAAI,CAACjK,EAAD,CAAJ,IAAYyI,SAAS,EAAhC;AACAwB,UAAAA,IAAI,CAACjK,EAAD,CAAJ,CAASgF,eAAT,CAAyB2F,IAAI,CAACC,SAAL,CAAevC,QAAf,CAAzB;AACD;;AAED,eAAOhqB,WAAW,CAACwsB,OAAZ,CAAoB7K,EAApB,EAAwBsK,UAAxB,CAAP;AACD;AACF,KAlBI,EAmBJ/c,IAnBI,CAmBC,YAAW;AACf,aAAOud,YAAY,CAACC,MAAb,EAAP;AACD,KArBI,EAsBJxd,IAtBI,CAsBC,YAAW;AACfqc,MAAAA,eAAe,CAACpH,IAAhB,CAAqB,SAArB;AACD,KAxBI,CAAP;AAyBD,GA1BD;;AA4BA,MAAIwI,WAAW,GAAG,SAAdA,WAAc,CAAShL,EAAT,EAAa;AAC7B,WAAO3hB,WAAW,CAAC4sB,UAAZ,CAAuBjL,EAAvB,EACJzS,IADI,CACC,YAAW;AACf,aAAOgT,EAAE,CAACkB,GAAH,CAAO;AAACuH,QAAAA,CAAC,EAAE8B,YAAY,CAACI,WAAb,CAAyBlL,EAAzB,CAAJ;AAAkCnI,QAAAA,CAAC,EAAEuS,YAAY,CAACc,WAAb,CAAyBlL,EAAzB;AAArC,OAAP,CAAP;AACD,KAHI,CAAP;AAID,GALD;;AAOA,MAAImL,mBAAmB,GAAG,SAAtBA,mBAAsB,CAASnL,EAAT,EAAa;AACrC,WAAO8K,YAAY,CAACI,WAAb,CAAyBlL,EAAzB,CAAP;AACD,GAFD;;AAIA,MAAID,qBAAqB,GAAG,SAAxBA,qBAAwB,CAASC,EAAT,EAAa;AACvC,WAAOoL,sBAAsB,CAACpL,EAAD,CAAtB,CACJzS,IADI,CACC,YAAW;AACfoc,MAAAA,mBAAmB,CAACnH,IAApB,CAAyB,SAAzB;AACAoH,MAAAA,eAAe,CAACpH,IAAhB,CAAqB,SAArB;AACD,KAJI,CAAP;AAKD,GAND;;AAQA,MAAI4I,sBAAsB,GAAG,SAAzBA,sBAAyB,CAASpL,EAAT,EAAa;AACxC,WAAO8K,YAAY,CAACT,QAAb,CAAsBrK,EAAtB,EACJzS,IADI,CACC,UAAS4c,SAAT,EAAoB;AACxB,UAAIA,SAAJ,EAAe;AACb,eAAOW,YAAY,CAACI,WAAb,CAAyBlL,EAAzB,EACJzS,IADI,CACC,YAAW;AACf,iBAAO6c,YAAY,CAACiB,WAAb,CAAyBlB,SAAzB,CAAP;AACD,SAHI,EAIJ5c,IAJI,CAIC,YAAW;AACf,cAAIiO,IAAI,GAAI2O,SAAS,CAACjB,GAAV,IAAe,EAA3B;AACA,cAAIiB,SAAS,CAAClqB,OAAd,EAAuBub,IAAI,CAAC3O,IAAL,CAAUsd,SAAS,CAAClqB,OAApB;AAEvB,iBAAOsgB,EAAE,CAACkB,GAAH,CAAOjG,IAAI,CAAC3N,GAAL,CAASud,sBAAT,CAAP,CAAP;AACD,SATI,CAAP;AAUD;AACF,KAdI,CAAP;AAeD,GAhBD;;AAkBA,MAAIlL,gBAAgB,GAAG,SAAnBA,gBAAmB,CAASF,EAAT,EAAa;AAClC,WAAOsL,iBAAiB,CAACtL,EAAD,CAAjB,CACJzS,IADI,CACC,YAAW;AACfoc,MAAAA,mBAAmB,CAACnH,IAApB,CAAyB,SAAzB;AACAoH,MAAAA,eAAe,CAACpH,IAAhB,CAAqB,SAArB;AACD,KAJI,CAAP;AAKD,GAND;;AAQA,MAAI8I,iBAAiB,GAAG,SAApBA,iBAAoB,CAAStL,EAAT,EAAa;AACnC,QAAIuL,KAAK,GAAG,SAARA,KAAQ,CAAS3e,CAAT,EAAW;AAAE,aAAOA,CAAC,CAACoT,EAAT;AAAc,KAAvC;;AACA,QAAIwL,aAAa,GAAG,SAAhBA,aAAgB,CAASpiB,IAAT,EAAe;AACjC,aAAOA,IAAI,CAAC1J,IAAL,KAAc,SAArB;AACD,KAFD;;AAIA,WAAO0qB,YAAY,CAACqB,UAAb,CAAwBzL,EAAxB,EACJzS,IADI,CACC,YAAW;AACf,aAAO6c,YAAY,CAACC,QAAb,CAAsBrK,EAAtB,EACJzS,IADI,CACC,UAAS4c,SAAT,EAAoB;AACxB,YAAIA,SAAJ,EAAe;AACb,iBAAOW,YAAY,CAACY,MAAb,GACJne,IADI,CACC,UAASyB,GAAT,EAAc;AAClB,gBAAIA,GAAG,IAAIA,GAAG,CAAC3D,MAAJ,IAAc,GAAzB,EAA8B;AAC5B,qBAAOyf,YAAY,CAACa,YAAb,GACJpe,IADI,CACC,UAASyB,GAAT,EAAc;AAClB,oBAAI,CAACA,GAAG,CAAC,CAAD,CAAR,EAAa;AAEb,uBAAO8b,YAAY,CAACI,WAAb,CAAyBlc,GAAG,CAAC,CAAD,CAAH,CAAOgR,EAAhC,EACJzS,IADI,CACC,YAAW;AACf,yBAAOlP,WAAW,CAAC4sB,UAAZ,CAAuBjL,EAAvB,CAAP;AACD,iBAHI,CAAP;AAID,eARI,CAAP;AASD;AACF,WAbI,EAcJzS,IAdI,CAcC,YAAW;AACf,mBAAO6c,YAAY,CAACc,WAAb,CAAyBlL,EAAzB,CAAP;AACD,WAhBI,EAiBJzS,IAjBI,CAiBC,YAAW;AACf,mBAAOud,YAAY,CAACO,WAAb,CAAyBlB,SAAzB,CAAP;AACD,WAnBI,CAAP;AAoBD;AACF,OAxBI,CAAP;AAyBD,KA3BI,EA4BJ5c,IA5BI,CA4BC,YAAW;AACf,aAAO6c,YAAY,CAACwB,SAAb,CACLjD,iBAAiB,CAAC9a,GAAlB,CAAsB0d,KAAtB,CADK,EAEL5C,iBAAiB,CAAClpB,MAAlB,CAAyB+rB,aAAzB,EAAwC3d,GAAxC,CAA4C0d,KAA5C,CAFK,CAAP;AAGD,KAhCI,EAiCJhe,IAjCI,CAiCC,UAASse,WAAT,EAAsB;AAC1B,aAAOtL,EAAE,CAACkB,GAAH,CAAOoK,WAAW,CAAChe,GAAZ,CAAgB0d,KAAhB,EAAuB1d,GAAvB,CAA2Byd,iBAA3B,CAAP,EACJnL,KADI,CACE,UAAS7V,CAAT,EAAY;AACjBwhB,QAAAA,OAAO,CAACzhB,KAAR,CAAcC,CAAd;AACD,OAHI,CAAP;AAID,KAtCI,CAAP;AAuCD,GA7CD;;AA+CA,MAAIyhB,eAAe,GAAG,SAAlBA,eAAkB,CAASpL,OAAT,EAAkB;AACtC,QAAIqL,SAAS,GAAG,SAAZA,SAAY,CAAS5iB,IAAT,EAAe;AAC7B,aAAOA,IAAI,CAACnJ,OAAL,KAAiB0gB,OAAO,CAAC1gB,OAAhC;AACD,KAFD;;AAIA,QAAIgsB,MAAM,GAAG,SAATA,MAAS,CAAS7iB,IAAT,EAAe;AAC1B,aAAOA,IAAI,CAAC1J,IAAL,KAAc,SAAd,IAA2B0J,IAAI,CAAC1J,IAAL,KAAc,MAAhD;AACD,KAFD;;AAIA,QAAIwsB,QAAQ,GAAG,SAAXA,QAAW,CAAS9iB,IAAT,EAAe;AAC5B,aAAOA,IAAI,CAAC1J,IAAL,KAAc,MAArB;AACD,KAFD;;AAIA,QAAIysB,QAAQ,GAAG,SAAXA,QAAW,CAAS/iB,IAAT,EAAe;AAC5B,aAAOgf,OAAO,CAAChf,IAAI,CAAC4W,EAAN,CAAd;AACD,KAFD;;AAIA,WAAOO,EAAE,CAACkB,GAAH,CAAO;AACV2K,MAAAA,OAAO,EAAEhC,YAAY,CAACsB,MAAb,EADC;AAEVW,MAAAA,OAAO,EAAE1D;AAFC,KAAP,EAGFpb,IAHE,CAGG,UAAS0H,MAAT,EAAiB;AACvB,UAAI8G,KAAK,GAAG9G,MAAM,CAACmX,OAAP,CAAezc,MAAf,CAAsBsF,MAAM,CAACoX,OAA7B,CAAZ;AACA,UAAIC,WAAW,GAAGvQ,KAAK,CAACtc,MAAN,CAAausB,SAAb,EAAwBvsB,MAAxB,CAA+BwsB,MAA/B,CAAlB;;AAEA,UAAIK,WAAW,CAAClF,IAAZ,CAAiB8E,QAAjB,CAAJ,EAAgC;AAC9BI,QAAAA,WAAW,GAAGA,WAAW,CAAC7sB,MAAZ,CAAmBysB,QAAnB,CAAd;AACD;;AAED,aAAO3L,EAAE,CAACkB,GAAH,CAAO6K,WAAW,CAACze,GAAZ,CAAgBse,QAAhB,CAAP,CAAP;AACD,KAZI,CAAP;AAaD,GA9BD;;AAgCA,MAAII,IAAI,GAAG,SAAPA,IAAO,CAASxQ,KAAT,EAAgB6G,GAAhB,EAAqB;AAC9B,QAAIpB,GAAG,GAAG,EAAV;AACAzF,IAAAA,KAAK,CAAC1N,OAAN,CAAc,UAASjF,IAAT,EAAe;AAC3B,UAAI8C,KAAK,GAAG0W,GAAG,CAACxZ,IAAD,CAAf;AACAoY,MAAAA,GAAG,CAACtV,KAAD,CAAH,GAAa,CAACsV,GAAG,CAACtV,KAAD,CAAH,IAAc,CAAf,IAAoB,CAAjC;AACD,KAHD;AAKA,QAAIsgB,QAAQ,GAAG,CAAf;;AACA,QAAIC,EAAJ;;AACA,SAAK,IAAI/e,CAAT,IAAc8T,GAAd,EAAmB;AACjB,UAAI1W,KAAK,GAAG0W,GAAG,CAAC9T,CAAD,CAAf;;AACA,UAAI5C,KAAK,GAAG0hB,QAAZ,EAAsB;AACpBC,QAAAA,EAAE,GAAG/e,CAAL;AACA8e,QAAAA,QAAQ,GAAG1hB,KAAX;AACD;AACF;;AAAA;AAED,WAAO2hB,EAAP;AACD,GAlBD;;AAoBA,MAAIC,iBAAiB,GAAG,SAApBA,iBAAoB,CAAS/L,OAAT,EAAkB;AACxC,WAAOoL,eAAe,CAACpL,OAAD,CAAf,CACJpT,IADI,CACC,UAASwO,KAAT,EAAgB;AACpB,UAAI,CAACA,KAAK,CAAC1Q,MAAX,EAAmB,OAAO,CAAP;AAEnB,aAAOkhB,IAAI,CAACxQ,KAAD,EAAQ,UAAS3S,IAAT,EAAe;AAChC,eAAOA,IAAI,CAACif,QAAL,CAAcrR,OAArB;AACD,OAFU,CAAX;AAGD,KAPI,CAAP;AAQD,GATD;;AAWA,MAAI2V,aAAa,GAAG,SAAhBA,aAAgB,CAAShM,OAAT,EAAkB;AACpC,WAAOoL,eAAe,CAACpL,OAAD,CAAf,CACJpT,IADI,CACC,UAASwO,KAAT,EAAgB;AACpB,UAAI,CAACA,KAAK,CAAC1Q,MAAX,EAAmB,OAAO,GAAP;AAEnB,aAAOkhB,IAAI,CAACxQ,KAAD,EAAQ,UAAS3S,IAAT,EAAe;AAChC,eAAOA,IAAI,CAACif,QAAL,CAAchkB,GAArB;AACD,OAFU,CAAX;AAGD,KAPI,CAAP;AAQD,GATD;;AAWA,MAAI+jB,OAAO,GAAG,SAAVA,OAAU,CAASpI,EAAT,EAAa;AACvB,QAAImJ,OAAO,GAAG,KAAd;AACA,QAAIlc,OAAO,GAAG,KAAd;AACA,WAAOsc,aAAa,CACjBhc,IADI,CACC,YAAW;AACf,UAAI4c,SAAS,GAAGxB,iBAAiB,CAAClpB,MAAlB,CAAyB,UAASmN,CAAT,EAAY;AAAC,eAAOA,CAAC,CAACoT,EAAF,KAASA,EAAhB;AAAqB,OAA3D,EAA6D,CAA7D,CAAhB;;AACA,UAAImK,SAAJ,EAAe;AACbhB,QAAAA,OAAO,GAAG,IAAV;AACA,eAAOgB,SAAP;AACD;;AAED,aAAOC,YAAY,CAACC,QAAb,CAAsBrK,EAAtB,CAAP;AACD,KATI,EAUJzS,IAVI,CAUC,UAAS4c,SAAT,EAAoB;AACxB,aAAO9rB,WAAW,CAACuuB,OAAZ,CAAoB5M,EAApB,EACJzS,IADI,CACC,UAAS+c,UAAT,EAAqB;AACzB,YAAIA,UAAJ,EAAgB;AACd,cAAIjC,QAAQ,GAAGjqB,KAAK,CAACmsB,OAAN,CAAcC,eAAd,CAA8BqC,WAA9B,CAA0C1C,SAAS,CAACzqB,IAApD,EAA0D4qB,UAA1D,CAAf;AACA,iBAAO;AACL/qB,YAAAA,KAAK,EAAE;AACLgE,cAAAA,IAAI,EAAE4mB,SAAS,CAAC5mB,IADX;AAELyc,cAAAA,EAAE,EAAEmK,SAAS,CAACnK,EAFT;AAGLmJ,cAAAA,OAAO,EAAEA,OAHJ;AAILzpB,cAAAA,IAAI,EAAEyqB,SAAS,CAACzqB,IAJX;AAKLwpB,cAAAA,GAAG,EAAEiB,SAAS,CAACjB,GAAV,IAAe4D,OAAO,CAAC3C,SAAS,CAACzqB,IAAX,EAAiB2oB,QAAjB,CALtB;AAML0E,cAAAA,OAAO,EAAE,IANJ;AAOL9sB,cAAAA,OAAO,EAAEkqB,SAAS,CAAClqB;AAPd,aADF;AAULooB,YAAAA,QAAQ,EAAEA;AAVL,WAAP;AAYD,SAdD,MAcO;AACL,cAAI8B,SAAJ,EAAe;AACb,mBAAO;AACL5qB,cAAAA,KAAK,EAAE;AACLgE,gBAAAA,IAAI,EAAE4mB,SAAS,CAAC5mB,IADX;AAELyc,gBAAAA,EAAE,EAAEmK,SAAS,CAACnK,EAFT;AAGLmJ,gBAAAA,OAAO,EAAEA,OAHJ;AAILzpB,gBAAAA,IAAI,EAAEyqB,SAAS,CAACzqB,IAJX;AAKLwpB,gBAAAA,GAAG,EAAEiB,SAAS,CAACjB,GALV;AAMLjpB,gBAAAA,OAAO,EAAEkqB,SAAS,CAAClqB,OANd;AAOLqpB,gBAAAA,YAAY,EAAEa,SAAS,CAACb;AAPnB,eADF;AAULjB,cAAAA,QAAQ,EAAEsC,IAAI,CAACqC,KAAL,CAAWrC,IAAI,CAACC,SAAL,CAAehC,YAAY,CAAC5I,EAAD,CAA3B,CAAX;AAVL,aAAP;AAYD;;AAAA;AACF;AACF,OAhCI,CAAP;AAiCD,KA5CI,CAAP;AA6CD,GAhDH;;AAkDA,MAAIiN,UAAU,GAAG,SAAbA,UAAa,CAAStM,OAAT,EAAkB;AACjC,QAAIuM,KAAK,GAAGvM,OAAO,CAACX,EAAR,IAAcwJ,QAAQ,EAAlC;AAEA,QAAInB,QAAQ,GAAG1H,OAAO,CAAC0H,QAAR,IAAoBwB,WAAW,CAAClJ,OAAO,CAACjhB,IAAT,CAA/B,IAAiD,EAAhE;AAEA,WAAO6gB,EAAE,CAACkB,GAAH,CAAO;AACZ0L,MAAAA,cAAc,EAAET,iBAAiB,CAAC/L,OAAD,CADrB;AAEZyM,MAAAA,UAAU,EAAET,aAAa,CAAChM,OAAD;AAFb,KAAP,EAGJpT,IAHI,CAGC,UAASrB,KAAT,EAAgB;AACtBmc,MAAAA,QAAQ,CAACrR,OAAT,GAAmBtI,QAAQ,CAACxC,KAAK,CAACihB,cAAP,CAA3B;AACA9E,MAAAA,QAAQ,CAAChkB,GAAT,GAAeqK,QAAQ,CAACxC,KAAK,CAACkhB,UAAP,CAAvB;AACD,KANM,EAMJ7f,IANI,CAMC,YAAW;AACjB0c,MAAAA,IAAI,CAACiD,KAAD,CAAJ,GAAcjD,IAAI,CAACiD,KAAD,CAAJ,IAAezE,SAAS,EAAtC;AACAwB,MAAAA,IAAI,CAACiD,KAAD,CAAJ,CAAYlI,eAAZ,CAA4B2F,IAAI,CAACC,SAAL,CAAevC,QAAf,CAA5B;AAEA,UAAIiC,UAAU,GAAGlsB,KAAK,CAACmsB,OAAN,CAAcC,eAAd,CAA8BC,SAA9B,CAAwC9J,OAAO,CAACjhB,IAAhD,EAAsD2oB,QAAtD,CAAjB;AACA,aAAOhqB,WAAW,CAACwsB,OAAZ,CAAoBqC,KAApB,EAA2B5C,UAA3B,CAAP;AACD,KAZM,EAYJ/c,IAZI,CAYC,YAAW;AACf,aAAO6c,YAAY,CAACiB,WAAb,CAAyB;AAC9B3rB,QAAAA,IAAI,EAAEihB,OAAO,CAACjhB,IADgB;AAE9B6D,QAAAA,IAAI,EAAEod,OAAO,CAACpd,IAFgB;AAG9BtD,QAAAA,OAAO,EAAE0gB,OAAO,CAAC1gB,OAHa;AAI9B+f,QAAAA,EAAE,EAAEkN,KAJ0B;AAK9BhE,QAAAA,GAAG,EAAEvI,OAAO,CAACuI;AALiB,OAAzB,CAAP;AAOH,KApBM,EAqBN3b,IArBM,CAqBD,YAAW;AACf,aAAOud,YAAY,CAACC,MAAb,EAAP;AACD,KAvBM,EAwBNxd,IAxBM,CAwBD,YAAW;AACboc,MAAAA,mBAAmB,CAACnH,IAApB,CAAyB,SAAzB;AACAoH,MAAAA,eAAe,CAACpH,IAAhB,CAAqB,SAArB;AACA,aAAO0K,KAAP;AACH,KA5BM,EA6BN/M,KA7BM,CA6BA,UAAS/T,GAAT,EAAc;AACnB;AACD,KA/BM,CAAP;AAgCD,GArCD;;AAwCA,MAAIihB,EAAE,GAAGjvB,KAAK,CAACmsB,OAAN,CAAc+C,cAAvB;AACA,MAAIC,EAAE,GAAGnvB,KAAK,CAACmsB,OAAN,CAAciD,gBAAd,CAA+BpvB,KAAK,CAACmsB,OAAN,CAAckD,oBAA7C,CAAT;AACA,MAAIC,EAAE,GAAGtvB,KAAK,CAACmsB,OAAN,CAAcoD,wBAAd,CAAuCN,EAAvC,CAAT;AACA,MAAIO,EAAE,GAAGxvB,KAAK,CAACmsB,OAAN,CAAcoD,wBAAd,CAAuCJ,EAAvC,CAAT;AACA,MAAIM,EAAE,GAAGzvB,KAAK,CAACmsB,OAAN,CAAciD,gBAAd,CAA+BpvB,KAAK,CAACmsB,OAAN,CAAcuD,qBAA7C,CAAT;AACA,MAAIC,EAAE,GAAG3vB,KAAK,CAACmsB,OAAN,CAAcoD,wBAAd,CAAuCE,EAAvC,CAAT;AAEAzvB,EAAAA,KAAK,CAACmsB,OAAN,CAAcC,eAAd,CAA8BwD,cAA9B,CAA6C,CAC3C;AAACC,IAAAA,UAAU,EAAEZ,EAAb;AAAiBnY,IAAAA,IAAI,EAAE;AAAvB,GAD2C,EAE3C;AAAC+Y,IAAAA,UAAU,EAAEV,EAAb;AAAiBrY,IAAAA,IAAI,EAAE;AAAvB,GAF2C,EAG3C;AAAC+Y,IAAAA,UAAU,EAAEP,EAAb;AAAiBxY,IAAAA,IAAI,EAAE;AAAvB,GAH2C,EAI3C;AAAC+Y,IAAAA,UAAU,EAAEL,EAAb;AAAiB1Y,IAAAA,IAAI,EAAE;AAAvB,GAJ2C,EAK3C;AAAC+Y,IAAAA,UAAU,EAAEJ,EAAb;AAAiB3Y,IAAAA,IAAI,EAAE;AAAvB,GAL2C,EAM3C;AAAC+Y,IAAAA,UAAU,EAAEF,EAAb;AAAiB7Y,IAAAA,IAAI,EAAE;AAAvB,GAN2C,CAA7C;AASA,MAAIkV,YAAY,GAAG1B,KAAK,CAAC,OAAD,CAAxB;AACA,MAAIoC,YAAY,GAAGpC,KAAK,CAAC,SAAD,CAAxB;AAEAoC,EAAAA,YAAY,CAACY,MAAb,GAAsBne,IAAtB,CAA2B,YAAW;AACpCqc,IAAAA,eAAe,CAACpH,IAAhB,CAAqB,SAArB;AACD,GAFD;;AAIA,MAAIvV,OAAO,GAAG,SAAVA,OAAU,GAAW;AACvB0c,IAAAA,mBAAmB,CAACnH,IAApB,CAAyB,SAAzB;AACAoH,IAAAA,eAAe,CAACpH,IAAhB,CAAqB,SAArB;AACD,GAHD;;AAKA,MAAIsK,OAAO,GAAG,SAAVA,OAAU,CAASptB,IAAT,EAAe2oB,QAAf,EAAyB;AACrC,QAAIa,GAAG,GAAG,EAAV;;AACA,QAAIxpB,IAAI,KAAK,MAAb,EAAqB;AACnB2oB,MAAAA,QAAQ,CAACjiB,MAAT,CAAgBiI,OAAhB,CAAwB,UAASwI,KAAT,EAAgB;AACtC,aAAK,IAAI5L,CAAC,GAAC,CAAX,EAAaA,CAAC,GAAC4L,KAAK,CAACiT,MAAN,CAAaze,MAA5B,EAAmCJ,CAAC,EAApC,EAAwC;AACtC,cAAIijB,OAAO,GAAGrX,KAAK,CAACiT,MAAN,CAAa7e,CAAb,EAAgB+U,EAA9B;AACA,cAAIkO,OAAO,IAAIhF,GAAG,CAAC7K,OAAJ,CAAY6P,OAAZ,MAAyB,CAAC,CAAzC,EAA4ChF,GAAG,CAACrc,IAAJ,CAASqhB,OAAT;AAC7C;AACF,OALD;AAMD,KAPD,MAOO,IAAIxuB,IAAI,KAAK,SAAb,EAAwB;AAC7B2oB,MAAAA,QAAQ,CAACjiB,MAAT,CAAgBiI,OAAhB,CAAwB,UAASwI,KAAT,EAAgB;AACtC,YAAIA,KAAK,CAAClX,UAAN,IAAoBupB,GAAG,CAAC7K,OAAJ,CAAYxH,KAAK,CAAClX,UAAlB,MAAkC,CAAC,CAA3D,EAA8DupB,GAAG,CAACrc,IAAJ,CAASgK,KAAK,CAAClX,UAAf;AAC/D,OAFD;AAGD;;AAED,WAAOupB,GAAP;AACD,GAhBD;;AAkBA,MAAIiF,eAAe,GAAG,SAAlBA,eAAkB,CAASC,SAAT,EAAoB;AACxC,WAAOhE,YAAY,CAACsB,MAAb,GACJne,IADI,CACC,UAASyB,GAAT,EAAc;AAClB,aAAOA,GAAG,CAACW,MAAJ,CAAWgZ,iBAAX,EAA8BlpB,MAA9B,CAAqC,UAAS2J,IAAT,EAAe;AACzD,eAAOA,IAAI,CAACnJ,OAAL,KAAiBmuB,SAAjB,IAA8BhlB,IAAI,CAAC4W,EAAL,KAAYoO,SAAjD;AACD,OAFM,CAAP;AAGD,KALI,CAAP;AAMD,GAPD;;AASA,SAAO;AACLtB,IAAAA,OAAO,EAAEA,OADJ;AAELqB,IAAAA,eAAe,EAAEA,eAFZ;AAGLrJ,IAAAA,IAAI,EAAE,cAAS9E,EAAT,EAAa;AACjB,UAAIqO,MAAM,GAAGpE,IAAI,CAACjK,EAAD,CAAJ,CAAS8E,IAAT,EAAb;AACA,UAAI,CAACuJ,MAAL,EAAa;AAEb,aAAOnE,UAAU,CAAClK,EAAD,EAAK2K,IAAI,CAACqC,KAAL,CAAWqB,MAAX,CAAL,EAAyB;AAAC3D,QAAAA,SAAS,EAAE;AAAZ,OAAzB,CAAjB;AACD,KARI;AASL3F,IAAAA,IAAI,EAAE,cAAS/E,EAAT,EAAa;AACjB,UAAIsO,OAAO,GAAGrE,IAAI,CAACjK,EAAD,CAAJ,CAAS+E,IAAT,EAAd;AACA,UAAI,CAACuJ,OAAL,EAAc;AAEd,aAAOpE,UAAU,CAAClK,EAAD,EAAK2K,IAAI,CAACqC,KAAL,CAAWsB,OAAX,CAAL,EAA0B;AAAC5D,QAAAA,SAAS,EAAE;AAAZ,OAA1B,CAAjB;AACD,KAdI;AAeLS,IAAAA,mBAAmB,EAAEA,mBAfhB;AAgBLjL,IAAAA,gBAAgB,EAAEA,gBAhBb;AAiBLH,IAAAA,qBAAqB,EAAEA,qBAjBlB;AAkBLiL,IAAAA,WAAW,EAAEA,WAlBR;AAmBLiC,IAAAA,UAAU,EAAEA,UAnBP;AAoBLhgB,IAAAA,OAAO,EAAEA,OApBJ;AAqBLshB,IAAAA,WAAW,EAAE,qBAASvO,EAAT,EAAawO,UAAb,EAAyB;AACpC,UAAIrE,SAAS,GAAGxB,iBAAiB,CAAClpB,MAAlB,CAAyB,UAASmN,CAAT,EAAY;AAAE,eAAOA,CAAC,CAACoT,EAAF,KAASA,EAAhB;AAAqB,OAA5D,EAA8D,CAA9D,CAAhB;;AACA,UAAImK,SAAJ,EAAe;AACbA,QAAAA,SAAS,CAAC5mB,IAAV,GAAiBirB,UAAU,CAACjrB,IAA5B;AACAomB,QAAAA,mBAAmB,CAACnH,IAApB,CAAyB,SAAzB;AACA,eAAOjC,EAAE,CAAC7X,IAAH,CAAQyhB,SAAR,CAAP;AACD;;AAED,aAAOC,YAAY,CAACqE,WAAb,CAAyBzO,EAAzB,EAA6BwO,UAA7B,EACJjhB,IADI,CACC,YAAW;AACfoc,QAAAA,mBAAmB,CAACnH,IAApB,CAAyB,SAAzB;AACD,OAHI,CAAP;AAID,KAjCI;AAkCLkM,IAAAA,QAAQ,EAAE,kBAAS1O,EAAT,EAAa;AACrB,UAAImK,SAAS,GAAGxB,iBAAiB,CAAClpB,MAAlB,CAAyB,UAASmN,CAAT,EAAY;AAAE,eAAOA,CAAC,CAACoT,EAAF,KAASA,EAAhB;AAAqB,OAA5D,EAA8D,CAA9D,CAAhB;AACA,UAAImK,SAAJ,EAAe,OAAO5J,EAAE,CAAC7X,IAAH,CAAQyhB,SAAR,CAAP;AAEf,aAAOC,YAAY,CAACC,QAAb,CAAsBrK,EAAtB,CAAP;AACD,KAvCI;AAwCLkK,IAAAA,UAAU,EAAEA,UAxCP;AAyCL9B,IAAAA,OAAO,EAAEA,OAzCJ;AA0CL3I,IAAAA,eAAe,EAAE,yBAASzC,QAAT,EAAmB;AAClC8N,MAAAA,YAAY,CAACC,MAAb,GACGxd,IADH,CACQ,YAAW;AACfqc,QAAAA,eAAe,CAACpH,IAAhB,CAAqB,SAArB;AACD,OAHH;AAKAoH,MAAAA,eAAe,CAAC+E,WAAhB,CAA4B,SAA5B,EAAuC3R,QAAvC;AAEA,aAAO;AACL5P,QAAAA,OAAO,EAAE,mBAAW;AAClBwc,UAAAA,eAAe,CAAC5G,cAAhB,CAA+B,SAA/B,EAA0ChG,QAA1C;AACD;AAHI,OAAP;AAKD,KAvDI;AAwDL0C,IAAAA,cAAc,EAAE,wBAASkP,OAAT,EAAkBjO,OAAlB,EAA2B;AACzCA,MAAAA,OAAO,GAAGA,OAAO,IAAI,EAArB;AACA,UAAIhB,KAAK,GAAG,OAAOgB,OAAO,CAAChB,KAAf,KAAyB,WAAzB,GAAuC,EAAvC,GAA4CgB,OAAO,CAAChB,KAAhE;;AACA,UAAIkP,UAAU,GAAG,sBAAW;AAAE,eAAO,IAAP;AAAa,OAA3C;;AACA,UAAID,OAAO,IAAIA,OAAO,CAACvjB,MAAR,GAAiB,CAAhC,EAAmC;AACjCujB,QAAAA,OAAO,GAAGA,OAAO,CAAC5Y,WAAR,EAAV;;AACA6Y,QAAAA,UAAU,GAAG,oBAASjiB,CAAT,EAAY;AAAE,iBAAOA,CAAC,CAACrJ,IAAF,CAAOyS,WAAP,GAAqBqI,OAArB,CAA6BuQ,OAA7B,MAA0C,CAAC,CAAlD;AAAqD,SAAhF;AACD;;AAED,aAAO9D,YAAY,CAACY,MAAb,GAAsBne,IAAtB,CAA2B,UAAShO,KAAT,EAAgB;AAChD,YAAIuvB,QAAQ,GAAG,CAACvvB,KAAK,IAAE,EAAR,EAAYE,MAAZ,CAAmBovB,UAAnB,EAA+BE,OAA/B,EAAf;AACA,eAAO;AACLnP,UAAAA,OAAO,EAAED,KAAK,GAAGmP,QAAQ,CAACjP,KAAT,CAAe,CAAf,EAAiBF,KAAjB,CAAH,GAA6BmP,QADtC;AAELE,UAAAA,KAAK,EAAEF,QAAQ,CAACzjB;AAFX,SAAP;AAID,OANM,CAAP;AAOD,KAxEI;AAyEL4jB,IAAAA,MAAM,EAAE,gBAASL,OAAT,EAAkBjO,OAAlB,EAA2B;AACjCA,MAAAA,OAAO,GAAGA,OAAO,IAAI,EAArB;;AAEA,UAAIkO,UAAU,GAAG,sBAAW;AAAE,eAAO,IAAP;AAAa,OAA3C;;AACA,UAAID,OAAO,IAAIA,OAAO,CAACvjB,MAAR,GAAiB,CAAhC,EAAmC;AACjCujB,QAAAA,OAAO,GAAGA,OAAO,CAAC5Y,WAAR,EAAV;;AACA6Y,QAAAA,UAAU,GAAG,oBAASjiB,CAAT,EAAY;AAAE,iBAAOA,CAAC,CAACrJ,IAAF,CAAOyS,WAAP,GAAqBqI,OAArB,CAA6BuQ,OAA7B,MAA0C,CAAC,CAAlD;AAAqD,SAAhF;AACD;;AAED,UAAI5C,SAAS,GAAG,qBAAW;AAAE,eAAO,IAAP;AAAa,OAA1C;;AACA,UAAIrL,OAAO,CAAC1gB,OAAZ,EAAqB;AACnB+rB,QAAAA,SAAS,GAAG,mBAASpf,CAAT,EAAY;AACtB,cAAI+T,OAAO,CAACjhB,IAAZ,EAAkB;AAChB,gBAAIihB,OAAO,CAACjhB,IAAR,CAAa2e,OAAb,CAAqBzR,CAAC,CAAClN,IAAvB,MAAiC,CAAC,CAAtC,EAAyC,OAAO,KAAP;AAC1C;;AACD,iBAAOkN,CAAC,CAAClN,IAAF,KAAW,OAAX,IAAsBihB,OAAO,CAAC1gB,OAAR,CAAgBoe,OAAhB,CAAwBzR,CAAC,CAAC3M,OAA1B,MAAuC,CAAC,CAArE;AACD,SALD;AAMD,OAPD,MAOO;AACL,YAAI0gB,OAAO,CAACjhB,IAAZ,EAAkB;AAChBssB,UAAAA,SAAS,GAAG,mBAASpf,CAAT,EAAY;AACtB,gBAAI+T,OAAO,CAACjhB,IAAR,CAAa2e,OAAb,CAAqBzR,CAAC,CAAClN,IAAvB,MAAiC,CAAC,CAAtC,EAAyC,OAAO,KAAP;AACzC,mBAAO,IAAP;AACD,WAHD;AAID;AACF;;AAED,UAAI6iB,EAAE,GAAG,IAAIQ,YAAJ,EAAT;;AACA,UAAImM,YAAY,GAAG,SAAfA,YAAe,GAAW;AAC5B3F,QAAAA,aAAa,CACVhc,IADH,CACQ,YAAW;AACfgT,UAAAA,EAAE,CAACkB,GAAH,CAAO,CACL2I,YAAY,CAACsB,MAAb,EADK,EAEL/C,iBAFK,EAGL3f,WAAW,CAACS,QAAZ,CAAqBmlB,OAArB,CAHK,CAAP,EAIGrhB,IAJH,CAIQ,UAAS0H,MAAT,EAAiB;AACvB,gBAAIka,QAAQ,GAAG,SAAXA,QAAW,CAASC,IAAT,EAAe;AAC5B,qBAAO,IAAP,CAD4B,CAE5C;AACe,aAHD;;AAKA,gBAAIC,GAAG,GAAGpa,MAAM,CAAC,CAAD,CAAN,IAAW,EAArB;AACA,gBAAIqa,GAAG,GAAGD,GAAG,CAACxhB,GAAJ,CAAQ,UAASjB,CAAT,EAAW;AAAE,qBAAOA,CAAC,CAACoT,EAAT;AAAc,aAAnC,CAAV;AACA,gBAAI/K,MAAM,CAAC,CAAD,CAAV,EAAeoa,GAAG,GAAGA,GAAG,CAAC1f,MAAJ,CAAWsF,MAAM,CAAC,CAAD,CAAN,CAAUxV,MAAV,CAAiB0vB,QAAjB,CAAX,CAAN;AACfE,YAAAA,GAAG,GAAGA,GAAG,CAAC1f,MAAJ,CAAWsF,MAAM,CAAC,CAAD,CAAN,CAAUpH,GAAV,CAAc0hB,WAAd,CAAX,CAAN;AACAF,YAAAA,GAAG,GAAGA,GAAG,CAAC5vB,MAAJ,CAAWovB,UAAX,EAAuBpvB,MAAvB,CAA8BusB,SAA9B,CAAN;AAEAzJ,YAAAA,EAAE,CAACC,IAAH,CAAQ,SAAR,EAAmB;AACjB5C,cAAAA,OAAO,EAAEyP,GAAG,CAACxP,KAAJ,CAAU,CAAV,EAAY,EAAZ,CADQ;AAEjBmP,cAAAA,KAAK,EAAEK,GAAG,CAAChkB;AAFM,aAAnB;AAID,WApBD;AAqBD,SAvBH;AAwBD,OAzBD;;AA2BA,aAAO;AACLmkB,QAAAA,OAAO,EAAE,iBAASC,EAAT,EAAa;AACpBlN,UAAAA,EAAE,CAACoM,WAAH,CAAe,SAAf,EAA0Bc,EAA1B;AACA9F,UAAAA,mBAAmB,CAACgF,WAApB,CAAgC,SAAhC,EAA2CO,YAA3C;AACAA,UAAAA,YAAY;AAEZ,iBAAO;AACLQ,YAAAA,KAAK,EAAE,iBAAW;AAChBnN,cAAAA,EAAE,CAACS,cAAH,CAAkB,SAAlB,EAA6ByM,EAA7B;AACA9F,cAAAA,mBAAmB,CAAC3G,cAApB,CAAmC,SAAnC,EAA8CkM,YAA9C;AACD;AAJI,WAAP;AAMD;AAZI,OAAP;AAcD;AA7II,GAAP;AA+ID,CA/jB0C,CAA3C;;AAikBA,IAAIK,WAAW,GAAG,SAAdA,WAAc,CAAS7vB,IAAT,EAAe;AAC/B,SAAO;AACLA,IAAAA,IAAI,EAAE,IADD;AAEL6D,IAAAA,IAAI,EAAE7D,IAAI,CAAC6D,IAFN;AAGLyc,IAAAA,EAAE,EAAE,SAAQtgB,IAAI,CAAC6D,IAHZ;AAILtD,IAAAA,OAAO,EAAE;AAJJ,GAAP;AAMD,CAPD;;AASAjC,gBAAgB,CAACsiB,OAAjB,CAAyB,cAAzB,EAAyC,YAAW;AAClD,SAAO,UAASsC,GAAT,EAAc;AACnB,QAAI,CAACA,GAAG,CAAC+M,QAAT,EAAmB;AACjB/M,MAAAA,GAAG,CAAC+M,QAAJ,GAAe,UAASvO,KAAT,EAAgBwO,UAAhB,EAA4B;AACzC,YAAI/M,OAAO,GAAGzB,KAAK,CAACyB,OAAN,EAAd;AACA,YAAIrB,GAAG,GAAGoB,GAAG,CAACC,OAAD,EAAU+M,UAAV,CAAb;AACA,YAAIC,eAAJ;;AAEA,YAAIrO,GAAG,CAAC8G,OAAR,EAAiB;AACfuH,UAAAA,eAAe,GAAGrO,GAAG,CAAC8G,OAAJ,CAAYhS,IAAZ,CAAiBkL,GAAjB,CAAlB;;AACAA,UAAAA,GAAG,CAAC8G,OAAJ,GAAc,YAAW;AACvBuH,YAAAA,eAAe;AACfhN,YAAAA,OAAO,CAACF,KAAR;AACD,WAHD;AAID,SAND,MAMO;AACLnB,UAAAA,GAAG,CAAC8G,OAAJ,GAAc,YAAW;AACvBzF,YAAAA,OAAO,CAACF,KAAR;AACD,WAFD;AAGD;;AAED,eAAOnB,GAAP;AACD,OAlBD;AAmBD;;AACD,WAAOoB,GAAG,CAAC+M,QAAX;AACD,GAvBD;AAwBD,CAzBD;AA2BA3xB,gBAAgB,CAACsiB,OAAjB,CAAyB,6BAAzB,EAAwD,YAAW;AAC/D,SAAO,UAASsC,GAAT,EAAa;AAClB,QAAIkN,UAAJ;;AACA,QAAIC,aAAJ;;AACA,QAAI5lB,GAAG,GAAG,SAANA,GAAM,CAASiX,KAAT,EAAgBT,OAAhB,EAAyB;AACjCA,MAAAA,OAAO,GAAGA,OAAO,IAAG,EAApB;;AAEA,UAAI,CAACA,OAAO,CAACqP,MAAb,EAAqB;AACnB,YAAIF,UAAU,IAAIA,UAAU,KAAK1O,KAAjC,EAAwC;AACtC,iBAAO2O,aAAP;AACD;AACF;;AAEDD,MAAAA,UAAU,GAAG1O,KAAb;AACA2O,MAAAA,aAAa,GAAGnN,GAAG,CAACxB,KAAD,EAAQT,OAAR,CAAnB;AAEA,aAAOoP,aAAP;AACD,KAbD;;AAeA5lB,IAAAA,GAAG,CAACoK,MAAJ,GAAa,YAAW;AACtBqO,MAAAA,GAAG,CAACrO,MAAJ,CAAW+B,IAAX,CAAgBsM,GAAhB,EAAqBzI,KAArB,CAA2B,IAA3B,EAAiCC,SAAjC;AACA,aAAOjQ,GAAP;AACD,KAHD;;AAIA,WAAOA,GAAP;AACD,GAvBD;AAwBH,CAzBD;;;ACvtCA,IAAInM,gBAAgB,GAAGC,OAAO,CAACC,MAAR,CAAe,kBAAf,CAAvB;AACAF,gBAAgB,CAACsiB,OAAjB,CAAyB,YAAzB,EAAuC,CAAC,WAAD,EAAc,YAAd,EAA4B,UAASzM,SAAT,EAAoBoc,UAApB,EAAgC;AACjG,SAAO,UAAShxB,MAAT,EAAgBogB,KAAhB,EAAsB;AAC3B,QAAIrK,QAAQ,GAAGnB,SAAS,CAACvQ,IAAV,CAAe;AAC5BqF,MAAAA,WAAW,EAAE,iCADe;AAE5BC,MAAAA,UAAU,EAAE,gBAFgB;AAG5BsnB,MAAAA,WAAW,EAAE,OAHe;AAI5BC,MAAAA,OAAO,EAAE;AACP9Q,QAAAA,IAAI,EAAE,gBAAW;AACf,iBAAO4Q,UAAU,CAAC5Q,KAAD,CAAjB;AACD,SAHM;AAIPpgB,QAAAA,KAAK,EAAE,iBAAW;AAChB,iBAAOgxB,UAAU,CAAChxB,MAAD,CAAjB;AACD;AANM;AAJmB,KAAf,CAAf;AAcA,WAAO+V,QAAP;AACD,GAhBD;AAiBD,CAlBsC,CAAvC;;;ACDA,IAAIhX,gBAAgB,GAAGC,OAAO,CAACC,MAAR,CAAe,kBAAf,CAAvB;AACAF,gBAAgB,CAACsiB,OAAjB,CAAyB,QAAzB,EAAmC,CAAC,IAAD,EAAO,gBAAP,EAAyB,UAASC,EAAT,EAAajB,cAAb,EAA6B;AACvF,MAAI8Q,cAAc,GAAG,SAAjBA,cAAiB,CAAS7sB,IAAT,EAAe8kB,QAAf,EAAyB;AAC5C,QAAIxc,CAAC,GAAGgK,QAAQ,CAACiO,aAAT,CAAuB,GAAvB,CAAR;AACAjO,IAAAA,QAAQ,CAACkO,IAAT,CAAcC,WAAd,CAA0BnY,CAA1B;AACAA,IAAAA,CAAC,CAACoY,KAAF,GAAU,eAAV;AAEA,QAAIJ,IAAI,GAAG,IAAIwM,IAAJ,CAAS,CAAC1F,IAAI,CAACC,SAAL,CAAevC,QAAf,CAAD,CAAT,CAAX;AACA,QAAInE,GAAG,GAAIlI,MAAM,CAACmI,GAAP,CAAWC,eAAX,CAA2BP,IAA3B,CAAX;AACAhY,IAAAA,CAAC,CAACwY,IAAF,GAASH,GAAT;AACArY,IAAAA,CAAC,CAACtE,QAAF,GAAahE,IAAI,GAAG,OAApB;AACAsI,IAAAA,CAAC,CAACyY,KAAF;AACAtI,IAAAA,MAAM,CAACmI,GAAP,CAAWI,eAAX,CAA2BL,GAA3B;AACD,GAXD;;AAaA,MAAIoM,aAAa,GAAG,SAAhBA,aAAgB,CAASlnB,IAAT,EAAe;AACjC,QAAIA,IAAI,CAAC7J,KAAL,CAAWG,IAAX,KAAoB,SAAxB,EAAmC;AACjC,aAAQ0J,IAAI,CAAC7J,KAAL,CAAW2pB,GAAX,IAAgB,EAAxB;AACD,KAFD,MAEO;AACL,UAAI/e,GAAG,GAAGmV,cAAc,CAACwN,OAAf,CAAuB1jB,IAAI,CAAC7J,KAAL,CAAWG,IAAlC,EAAwC0J,IAAI,CAACif,QAA7C,CAAV;AACA,UAAIjf,IAAI,CAAC7J,KAAL,CAAWU,OAAf,EAAwBkK,GAAG,CAAC0C,IAAJ,CAASzD,IAAI,CAAC7J,KAAL,CAAWU,OAApB;AACxB,aAAOkK,GAAP;AACD;AACF,GARD;;AAUA,MAAIwF,MAAM,GAAG,SAATA,MAAS,CAAS/C,CAAT,EAAY2jB,CAAZ,EAAe;AAAC,WAAO3jB,CAAC,CAAC+C,MAAF,CAAS4gB,CAAT,CAAP;AAAqB,GAAlD;;AACA,MAAIC,kBAAkB,GAAG,SAArBA,kBAAqB,CAASxQ,EAAT,EAAa;AACpC,QAAI7V,GAAG,GAAG,EAAV;AACA,WAAOmV,cAAc,CAAC8I,OAAf,CAAuBpI,EAAvB,EACJzS,IADI,CACC,UAASnE,IAAT,EAAe;AACnB,UAAI,CAACA,IAAL,EAAW,OAAO,EAAP;;AACX,UAAIA,IAAI,CAAC7J,KAAL,CAAW+pB,YAAf,EAA6B;AAC3B,eAAO,EAAP;AACD;;AAEDnf,MAAAA,GAAG,CAAC0C,IAAJ,CAAS;AACPtJ,QAAAA,IAAI,EAAE6F,IAAI,CAAC7J,KAAL,CAAWgE,IADV;AAEP7D,QAAAA,IAAI,EAAE0J,IAAI,CAAC7J,KAAL,CAAWG,IAFV;AAGPsgB,QAAAA,EAAE,EAAE5W,IAAI,CAAC7J,KAAL,CAAWygB,EAHR;AAIPqI,QAAAA,QAAQ,EAAEjf,IAAI,CAACif,QAJR;AAKPpoB,QAAAA,OAAO,EAAEmJ,IAAI,CAAC7J,KAAL,CAAWU,OALb;AAMPipB,QAAAA,GAAG,EAAE9f,IAAI,CAAC7J,KAAL,CAAW2pB;AANT,OAAT;AASA,aAAO3I,EAAE,CAACkB,GAAH,CAAO6O,aAAa,CAAClnB,IAAD,CAAb,CAAoByE,GAApB,CAAwB2iB,kBAAxB,CAAP,EACJjjB,IADI,CACC,UAASkjB,QAAT,EAAmB;AACvBA,QAAAA,QAAQ,CAACpiB,OAAT,CAAiB,UAASqiB,GAAT,EAAc;AAC7BvmB,UAAAA,GAAG,GAAGA,GAAG,CAACwF,MAAJ,CAAW+gB,GAAX,CAAN;AACD,SAFD;AAGA,eAAOvmB,GAAP;AACD,OANI,CAAP;AAOD,KAvBI,CAAP;AAwBD,GA1BD;;AA4BA,MAAIwmB,IAAI,GAAG,SAAPA,IAAO,CAASziB,KAAT,EAAgB;AACzB,QAAI6N,KAAK,GAAG,EAAZ;AACA7N,IAAAA,KAAK,CAACG,OAAN,CAAc,UAASjF,IAAT,EAAe;AAC3B2S,MAAAA,KAAK,CAAC3S,IAAI,CAAC4W,EAAN,CAAL,GAAiB5W,IAAjB;AACD,KAFD;AAIA,WAAOwnB,MAAM,CAACC,IAAP,CAAY9U,KAAZ,EAAmBlO,GAAnB,CAAuB,UAASmS,EAAT,EAAa;AACzC,aAAOjE,KAAK,CAACiE,EAAD,CAAZ;AACD,KAFM,CAAP;AAGD,GATD;;AAWA,MAAI8Q,aAAa,GAAG,SAAhBA,aAAgB,CAASvtB,IAAT,EAAeyc,EAAf,EAAmB;AACrC,QAAIuL,KAAK,GAAG,SAARA,KAAQ,CAAS3e,CAAT,EAAY;AAAE,aAAOA,CAAC,CAACoT,EAAT;AAAc,KAAxC;;AAEAV,IAAAA,cAAc,CAAC6O,eAAf,CAA+BnO,EAA/B,EACGzS,IADH,CACQ,UAASwO,KAAT,EAAgB;AACpB,aAAOwE,EAAE,CAACkB,GAAH,CAAO1F,KAAK,CAAClO,GAAN,CAAU0d,KAAV,EAAiB1d,GAAjB,CAAqB2iB,kBAArB,CAAP,CAAP;AACD,KAHH,EAIGjjB,IAJH,CAIQ,UAASW,KAAT,EAAe;AACnBA,MAAAA,KAAK,GAAGA,KAAK,CAACwY,MAAN,CAAa/W,MAAb,EAAqB,EAArB,CAAR;AACAygB,MAAAA,cAAc,CAAC7sB,IAAD,EAAOotB,IAAI,CAACziB,KAAD,CAAX,CAAd;AACD,KAPH;AAQD,GAXD;;AAaA,MAAI6iB,UAAU,GAAG,SAAbA,UAAa,CAASxtB,IAAT,EAAeyc,EAAf,EAAmB;AAClC,WAAOwQ,kBAAkB,CAACxQ,EAAD,CAAlB,CACJzS,IADI,CACC,UAASW,KAAT,EAAgB;AACpBkiB,MAAAA,cAAc,CAAC7sB,IAAD,EAAOotB,IAAI,CAACziB,KAAD,CAAX,CAAd;AACD,KAHI,CAAP;AAID,GALD;;AAOA,MAAI8iB,UAAU,GAAG,SAAbA,UAAa,CAAS3I,QAAT,EAAmB;AAClC,QAAI4I,UAAU,GAAG,SAAbA,UAAa,CAAS7B,IAAT,EAAe;AAC9B,aAAO,YAAW;AAChB,eAAO9P,cAAc,CAACoP,QAAf,CAAwBU,IAAI,CAACpP,EAA7B,EACJzS,IADI,CACC,UAAShO,KAAT,EAAgB;AACpB,cAAIA,KAAJ,EAAW;AACT,mBAAO+f,cAAc,CAAC4K,UAAf,CAA0BkF,IAAI,CAACpP,EAA/B,EAAmCoP,IAAI,CAAC/G,QAAxC,EACJ9a,IADI,CACC,YAAW;AACf,qBAAO+R,cAAc,CAACiP,WAAf,CAA2Ba,IAAI,CAACpP,EAAhC,EAAoC;AACzCzc,gBAAAA,IAAI,EAAE6rB,IAAI,CAAC7rB,IAD8B;AAEzCtD,gBAAAA,OAAO,EAAEmvB,IAAI,CAACnvB;AAF2B,eAApC,CAAP;AAID,aANI,CAAP;AAOD,WARD,MAQO;AACL,mBAAOqf,cAAc,CAAC6L,mBAAf,CAAmCiE,IAAI,CAACpP,EAAxC,EACJzS,IADI,CACC,YAAW;AACf,qBAAO+R,cAAc,CAAC2N,UAAf,CAA0B;AAC/BjN,gBAAAA,EAAE,EAAEoP,IAAI,CAACpP,EADsB;AAE/BqI,gBAAAA,QAAQ,EAAE+G,IAAI,CAAC/G,QAFgB;AAG/B3oB,gBAAAA,IAAI,EAAE0vB,IAAI,CAAC1vB,IAHoB;AAI/B6D,gBAAAA,IAAI,EAAE6rB,IAAI,CAAC7rB,IAJoB;AAK/BtD,gBAAAA,OAAO,EAAEmvB,IAAI,CAACnvB,OALiB;AAM/BipB,gBAAAA,GAAG,EAAEkG,IAAI,CAAClG;AANqB,eAA1B,CAAP;AAQD,aAVI,CAAP;AAWD;AACF,SAvBI,CAAP;AAwBD,OAzBD;AA0BD,KA3BD;;AA6BA,WAAO3I,EAAE,CAAC7X,IAAH,GACJ6E,IADI,CACC,YAAW;AACf,UAAI2jB,CAAC,GAAG,IAAR;AACA,UAAIC,MAAM,GAAGxG,IAAI,CAACqC,KAAL,CAAW3E,QAAX,CAAb;AACA,UAAI+I,SAAS,GAAGD,MAAM,CAAC,CAAD,CAAtB;AAEAA,MAAAA,MAAM,CAAC9iB,OAAP,CAAe,UAAS+gB,IAAT,EAAe;AAC5B,YAAI8B,CAAJ,EAAO;AACLA,UAAAA,CAAC,GAAGA,CAAC,CAAC3jB,IAAF,CAAO0jB,UAAU,CAAC7B,IAAD,CAAjB,CAAJ;AACD,SAFD,MAEO;AACL8B,UAAAA,CAAC,GAAGD,UAAU,CAAC7B,IAAD,CAAV,EAAJ;AACD;AACF,OAND;AAQA,aAAO8B,CAAC,CAAC3jB,IAAF,CAAO,YAAW;AACvB,eAAO;AAACyS,UAAAA,EAAE,EAAEoR,SAAS,CAACpR,EAAf;AAAmBtgB,UAAAA,IAAI,EAAE0xB,SAAS,CAAC1xB,IAAnC;AAAyCO,UAAAA,OAAO,EAAEmxB,SAAS,CAACnxB;AAA5D,SAAP;AACD,OAFM,CAAP;AAGD,KAjBI,CAAP;AAkBD,GAhDD;;AAkDA,SAAO;AACLmwB,IAAAA,cAAc,EAAEA,cADX;AAELW,IAAAA,UAAU,EAAEA,UAFP;AAGLD,IAAAA,aAAa,EAAEA,aAHV;AAILE,IAAAA,UAAU,EAAEA;AAJP,GAAP;AAMD,CA5IkC,CAAnC;;;ACDA,IAAIhzB,gBAAgB,GAAGC,OAAO,CAACC,MAAR,CAAe,kBAAf,CAAvB;AACAF,gBAAgB,CAACsiB,OAAjB,CAAyB,OAAzB,EAAkC,CAAC,IAAD,EAAO,UAAP,EAAmB,MAAnB,EAA2B,cAA3B,EAA2C,UAASC,EAAT,EAAazX,QAAb,EAAuBuoB,IAAvB,EAA6BhzB,WAA7B,EAA0C;AACrH,WAASizB,UAAT,CAAoBtR,EAApB,EAAwB5W,IAAxB,EAA8B;AAC1B,SAAK4W,EAAL,GAAUA,EAAV;AACA,SAAK5W,IAAL,GAAYA,IAAZ;AACA,SAAKjE,KAAL,GAAc,IAAIosB,KAAJ,EAAD,CAAcpsB,KAA3B;AACA,SAAKzF,IAAL,GAAY,YAAZ;AACH;;AACD4xB,EAAAA,UAAU,CAAC/N,SAAX,GAAuB,IAAIgO,KAAJ,EAAvB;;AAEA,MAAIC,YAAY,GAAG,SAAfA,YAAe,CAASC,SAAT,EAAoB;AACrC,QAAIC,WAAW,GAAG,IAAIL,IAAJ,EAAlB;;AAEA,QAAItG,MAAM,GAAG,SAATA,MAAS,GAAW;AACtB;AACA,UAAIX,YAAJ;AACAA,MAAAA,YAAY,GAAG/rB,WAAW,CAACuuB,OAAZ,CAAoB6E,SAApB,EACZlkB,IADY,CACP,UAASW,KAAT,EAAe;AACnB,eAAOA,KAAK,IAAE,EAAd;AACD,OAHY,CAAf;AAIA,aAAOkc,YAAP;AACD,KARD;;AAUA,QAAIuH,SAAS,GAAG,SAAZA,SAAY,CAAS/jB,IAAT,EAAe;AAC7B,UAAIzD,GAAG,GAAG;AAAC6V,QAAAA,EAAE,EAAEpS,IAAI,CAACoS,EAAV;AAAczc,QAAAA,IAAI,EAAEqK,IAAI,CAACrK,IAAzB;AAA+B7D,QAAAA,IAAI,EAAEkO,IAAI,CAAClO,IAA1C;AAAgDO,QAAAA,OAAO,EAAE2N,IAAI,CAAC3N,OAA9D;AAAuEipB,QAAAA,GAAG,EAAEtb,IAAI,CAACsb;AAAjF,OAAV;AACA,UAAItb,IAAI,CAACgkB,CAAT,EAAYznB,GAAG,CAACynB,CAAJ,GAAMhkB,IAAI,CAACgkB,CAAX;AACZ,aAAOznB,GAAP;AACD,KAJD;;AAMA,QAAI+gB,WAAW,GAAGwG,WAAW,CAACG,IAAZ,CAAiB,UAAS7R,EAAT,EAAa;AAC9C,aAAO+K,MAAM,GACVxd,IADI,CACC,UAAShO,KAAT,EAAgB;AACpB,YAAI,CAACA,KAAL,EAAY;AACZA,QAAAA,KAAK,GAAGA,KAAK,CAACE,MAAN,CAAa,UAASmN,CAAT,EAAY;AAAE,iBAAOA,CAAC,CAACoT,EAAF,KAASA,EAAhB;AAAqB,SAAhD,CAAR;AACA,eAAO3hB,WAAW,CAACwsB,OAAZ,CAAoB4G,SAApB,EAA+BlyB,KAAK,CAACsO,GAAN,CAAU8jB,SAAV,CAA/B,CAAP;AACD,OALI,EAMJpkB,IANI,CAMCwd,MAND,CAAP;AAOD,KARiB,CAAlB;;AAUA,QAAIV,QAAQ,GAAG,SAAXA,QAAW,CAASrK,EAAT,EAAa;AAC1B,aAAO+K,MAAM,GACVxd,IADI,CACC,UAAShO,KAAT,EAAgB;AACpB,YAAI,CAACA,KAAL,EAAY,OAAO,IAAP;AACZ,eAAOA,KAAK,CAACE,MAAN,CAAa,UAASmN,CAAT,EAAY;AAAE,iBAAOA,CAAC,CAACoT,EAAF,KAASA,EAAhB;AAAqB,SAAhD,EAAkD,CAAlD,CAAP;AACD,OAJI,CAAP;AAKD,KAND;;AAQA,QAAIqL,WAAW,GAAGqG,WAAW,CAACG,IAAZ,CAAiB,UAASjkB,IAAT,EAAe;AAChD,aAAOmd,MAAM,GACVxd,IADI,CACC,UAAShO,KAAT,EAAgB;AACpBA,QAAAA,KAAK,GAAGA,KAAK,IAAI,EAAjB;;AAEA,YAAIiyB,YAAY,CAACM,eAAjB,EAAkC;AAChClkB,UAAAA,IAAI,CAACgkB,CAAL,GAASJ,YAAY,CAACM,eAAtB;AACD;;AAEDvyB,QAAAA,KAAK,CAACsN,IAAN,CAAWe,IAAX;AACA,eAAOvP,WAAW,CAACwsB,OAAZ,CAAoB4G,SAApB,EAA+BlyB,KAAK,CAACsO,GAAN,CAAU8jB,SAAV,CAA/B,CAAP;AACD,OAVI,EAWJpkB,IAXI,CAWCwd,MAXD,CAAP;AAYD,KAbiB,CAAlB;AAeA,QAAI0D,WAAW,GAAGiD,WAAW,CAACG,IAAZ,CAAiB,UAAS7R,EAAT,EAAawO,UAAb,EAAyB;AAC1D,aAAOzD,MAAM,GACVxd,IADI,CACC,UAAShO,KAAT,EAAgB;AACpB,YAAI4qB,SAAS,GAAG5qB,KAAK,CAACE,MAAN,CAAa,UAASmN,CAAT,EAAY;AAAE,iBAAOA,CAAC,CAACoT,EAAF,KAASA,EAAhB;AAAqB,SAAhD,EAAkD,CAAlD,CAAhB;AACAmK,QAAAA,SAAS,CAAC5mB,IAAV,GAAiBirB,UAAU,CAACjrB,IAA5B;AACA4mB,QAAAA,SAAS,CAACjB,GAAV,GAAgBsF,UAAU,CAACtF,GAA3B;;AAEA,YAAIsI,YAAY,CAACM,eAAjB,EAAkC;AAChC3H,UAAAA,SAAS,CAACyH,CAAV,GAAcJ,YAAY,CAACM,eAA3B;AACD;;AAED,eAAOzzB,WAAW,CAACwsB,OAAZ,CAAoB4G,SAApB,EAA+BlyB,KAAK,CAACsO,GAAN,CAAU8jB,SAAV,CAA/B,CAAP;AACD,OAXI,EAYJpkB,IAZI,CAYCwd,MAZD,CAAP;AAaD,KAdiB,CAAlB;;AAgBA,QAAIW,MAAM,GAAG,SAATA,MAAS,GAAW;AACtB,aAAOX,MAAM,GACVxd,IADI,CACC,UAAShO,KAAT,EAAgB;AACpB,YAAIwyB,EAAE,GAAGP,YAAY,CAACM,eAAtB;;AACA,YAAIC,EAAJ,EAAQ;AACN,iBAAOxyB,KAAK,CAACE,MAAN,CAAa,UAASuyB,KAAT,EAAgB;AAAC,mBAAOA,KAAK,CAACJ,CAAN,KAAYG,EAAnB;AAAwB,WAAtD,CAAP;AACD;;AACD,eAAOxyB,KAAP;AACD,OAPI,CAAP;AAQD,KATD;;AAWA,QAAIic,IAAI,GAAG,SAAPA,IAAO,CAASjc,KAAT,EAAgBygB,EAAhB,EAAoB;AAC7B,aAAOzgB,KAAK,CAACE,MAAN,CAAa,UAAS2J,IAAT,EAAe;AACjC,eAAO,CAACA,IAAI,CAAC8f,GAAL,IAAU,EAAX,EAAe7K,OAAf,CAAuB2B,EAAvB,MAA+B,CAAC,CAAvC;AACD,OAFM,CAAP;AAGD,KAJD;;AAMA,QAAIwL,aAAa,GAAG,SAAhBA,aAAgB,CAASpiB,IAAT,EAAe;AACjC,aAAOA,IAAI,CAAC1J,IAAL,KAAc,SAArB;AACD,KAFD;;AAIA,QAAI6rB,KAAK,GAAG,SAARA,KAAQ,CAASniB,IAAT,EAAe;AACzB,aAAOA,IAAI,CAAC4W,EAAZ;AACD,KAFD;;AAIA,QAAIyL,UAAU,GAAG,SAAbA,UAAa,CAASzL,EAAT,EAAa;AAC5B,aAAO+K,MAAM,GACVxd,IADI,CACC,UAAShO,KAAT,EAAgB;AACpB,YAAI4qB,SAAS,GAAG5qB,KAAK,CAACE,MAAN,CAAa,UAASmN,CAAT,EAAY;AAAE,iBAAOA,CAAC,CAACoT,EAAF,KAASA,EAAhB;AAAqB,SAAhD,EAAkD,CAAlD,CAAhB;AAEA,YAAI,CAACmK,SAAL,EAAgB;AAEhB,YAAInB,CAAC,GAAGxN,IAAI,CAACjc,KAAD,EAAQygB,EAAR,CAAZ,CALoB,CAMpB;;AACA,YAAIgJ,CAAC,CAAC3d,MAAF,KAAa,CAAjB,EAAoB;;AAEpB,YAAI8e,SAAS,CAACzqB,IAAV,KAAmB,SAAvB,EAAkC;AAChC,cAAIspB,CAAC,CAAC5B,IAAF,CAAOoE,aAAP,CAAJ,EAA2B;AACzB,kBAAM,IAAI8F,UAAJ,CAAetR,EAAf,EAAmBmK,SAAnB,CAAN;AACD;AACF,SAJD,MAIO;AACL,gBAAM,IAAImH,UAAJ,CAAetR,EAAf,EAAmBmK,SAAnB,CAAN;AACD;;AAED,eAAO5J,EAAE,CAACkB,GAAH,CAAOuH,CAAC,CAACnb,GAAF,CAAM0d,KAAN,EAAa1d,GAAb,CAAiB4d,UAAjB,CAAP,CAAP;AACD,OAnBI,CAAP;AAoBD,KArBD;;AAuBA,QAAIG,SAAS,GAAG,SAAZA,SAAY,CAASqG,QAAT,EAAmBC,eAAnB,EAAoC;AAClD,aAAOnH,MAAM,GACVxd,IADI,CACC,UAAShO,KAAT,EAAgB;AACpB,YAAI4yB,UAAU,GAAG5yB,KAAK,CAACE,MAAN,CAAa+rB,aAAb,EAA4B3d,GAA5B,CAAgC0d,KAAhC,EAAuC5b,MAAvC,CAA8CuiB,eAA9C,CAAjB;AACA,YAAI5C,GAAG,GAAG/vB,KAAK,CAACsO,GAAN,CAAU0d,KAAV,EAAiB5b,MAAjB,CAAwBsiB,QAAQ,IAAE,EAAlC,CAAV;;AACA,YAAIG,QAAQ,GAAG,SAAXA,QAAW,CAAShpB,IAAT,EAAe;AAC5B,cAAIA,IAAI,CAACnJ,OAAT,EAAkB;AAChB,gBAAIkyB,UAAU,CAAC9T,OAAX,CAAmBjV,IAAI,CAACnJ,OAAxB,MAAqC,CAAC,CAA1C,EAA6C;AAC3C,qBAAO,IAAP;AACD;AACF;;AACD,iBAAO,CAACmJ,IAAI,CAAC8f,GAAL,IAAU,EAAX,EAAe9B,IAAf,CAAoB,UAASpH,EAAT,EAAa;AACtC,mBAAOsP,GAAG,CAACjR,OAAJ,CAAY2B,EAAZ,MAAoB,CAAC,CAA5B;AACD,WAFM,CAAP;AAGD,SATD;;AAWA,eAAOzgB,KAAK,CAACE,MAAN,CAAa2yB,QAAb,CAAP;AACD,OAhBI,CAAP;AAiBD,KAlBD;;AAoBA,QAAIzG,YAAY,GAAG,SAAfA,YAAe,GAAW;AAC5B,aAAOZ,MAAM,GACVxd,IADI,CACC,UAAShO,KAAT,EAAgB;AACpB,YAAI8yB,UAAU,GAAG,EAAjB;AACA9yB,QAAAA,KAAK,CAAC8O,OAAN,CAAc,UAASjF,IAAT,EAAe;AAC3B,WAACA,IAAI,CAAC8f,GAAL,IAAU,EAAX,EAAe7a,OAAf,CAAuB,UAAS2a,CAAT,EAAY;AACjCqJ,YAAAA,UAAU,CAACrJ,CAAD,CAAV,GAAc,IAAd;AACD,WAFD;AAGD,SAJD;AAMA,eAAOzpB,KAAK,CAACE,MAAN,CAAa,UAAS2J,IAAT,EAAe;AACjC,iBAAO,CAACipB,UAAU,CAACjpB,IAAI,CAAC4W,EAAN,CAAlB;AACD,SAFM,CAAP;AAGD,OAZI,CAAP;AAaD,KAdD;;AAgBA+K,IAAAA,MAAM;AAEN,WAAO;AACLU,MAAAA,UAAU,EAAEA,UADP;AAELV,MAAAA,MAAM,EAAEA,MAFH;AAGLG,MAAAA,WAAW,EAAEA,WAHR;AAILU,MAAAA,SAAS,EAAEA,SAJN;AAKLvB,MAAAA,QAAQ,EAAEA,QALL;AAMLsB,MAAAA,YAAY,EAAEA,YANT;AAOLN,MAAAA,WAAW,EAAEA,WAPR;AAQLoD,MAAAA,WAAW,EAAEA,WARR;AASL/C,MAAAA,MAAM,EAAEA;AATH,KAAP;AAWD,GArKD;;AAuKA,SAAO8F,YAAP;AACD,CAjLiC,CAAlC;;;ACDA,IAAIc,OAAO,GAAGr0B,OAAO,CAACC,MAAR,CAAe,kBAAf,CAAd;AACAo0B,OAAO,CAAChS,OAAR,CAAgB,MAAhB,EAAwB,CAAC,IAAD,EAAO,MAAP,EAAe,cAAf,EAA+B,UAASC,EAAT,EAAa8Q,IAAb,EAAmBhzB,WAAnB,EAAgC;AACrF,MAAIk0B,UAAU,GAAG,IAAIlB,IAAJ,EAAjB;AACA,MAAImB,kBAAJ;AACA,MAAIC,UAAJ;AACA,MAAIC,iBAAiB,GAAGH,UAAU,CAACV,IAAX,CAAgB,UAASc,OAAT,EAAkBC,OAAlB,EAA2B;AACjE,WAAOv0B,WAAW,CAACuuB,OAAZ,CAAoB,WAApB,EACJrf,IADI,CACC,UAASwH,SAAT,EAAoB;AACxBA,MAAAA,SAAS,GAAGA,SAAS,IAAI,EAAzB;AACAA,MAAAA,SAAS,CAACtW,MAAV,GAAmBsW,SAAS,CAACtW,MAAV,IAAoB,EAAvC;AACAsW,MAAAA,SAAS,CAACtW,MAAV,CAAiBk0B,OAAjB,IAA4BC,OAA5B;AAEA,aAAOv0B,WAAW,CAACwsB,OAAZ,CAAoB,WAApB,EAAiC9V,SAAjC,CAAP;AACD,KAPI,CAAP;AAQD,GATuB,CAAxB;AAWA,MAAI8d,mBAAJ;;AACA,MAAIC,SAAS,CAACC,iBAAd,EAAiC;AAC7BF,IAAAA,mBAAmB,GAAGC,SAAS,CAACC,iBAAV,CAA4B;AAAEC,MAAAA,KAAK,EAAE;AAAT,KAA5B,CAAtB;AACH;;AAED,MAAIC,SAAS,GAAG,SAAZA,SAAY,CAASC,KAAT,EAAgB;AAC9B,QAAIvxB,MAAM,GAAG,SAATA,MAAS,GAAW;AACtBuxB,MAAAA,KAAK,CAACC,aAAN,GAAsBnf,aAAtB;AACAkf,MAAAA,KAAK,CAACN,OAAN,GAAgB,IAAhB;AAEAF,MAAAA,iBAAiB,CAACQ,KAAK,CAAClT,EAAP,EAAW,IAAX,CAAjB;AACD,KALD;;AAOA,QAAIpe,OAAO,GAAG,SAAVA,OAAU,GAAW;AACvBsxB,MAAAA,KAAK,CAACC,aAAN,GAAsB,IAAtB;AACAD,MAAAA,KAAK,CAACN,OAAN,GAAgB,KAAhB;AAEAF,MAAAA,iBAAiB,CAACQ,KAAK,CAAClT,EAAP,EAAW,KAAX,CAAjB;AACD,KALD;;AAOA,QAAIzL,MAAM,GAAG,SAATA,MAAS,GAAW;AACtB,UAAI,KAAKqe,OAAT,EAAkB;AAChBjxB,QAAAA,MAAM;AACP,OAFD,MAEO;AACLC,QAAAA,OAAO;AACR;AACF,KAND;;AAQA,QAAIuI,GAAG,GAAG;AACRyoB,MAAAA,OAAO,EAAE,CAAC,CAACM,KAAK,CAACC,aADT;AAERxxB,MAAAA,MAAM,EAAEA,MAFA;AAGRC,MAAAA,OAAO,EAAEA,OAHD;AAIR2S,MAAAA,MAAM,EAAEA,MAJA;AAKRhR,MAAAA,IAAI,EAAE2vB,KAAK,CAAC3vB,IALJ;AAMRyc,MAAAA,EAAE,EAAEkT,KAAK,CAAClT;AANF,KAAV;AASA,WAAO7V,GAAP;AACD,GAjCD;;AAmCA,MAAIwK,SAAS,GAAG,SAAZA,SAAY,GAAW;AACzB,WAAO8d,UAAU,CACdllB,IADI,CACC,YAAW;AACf,aAAOslB,mBAAP;AACD,KAHI,EAIJtlB,IAJI,CAIC,UAAS6lB,UAAT,EAAqB;AACzB,UAAIxlB,IAAI,GAAG;AAAClP,QAAAA,SAAS,EAAE;AAAZ,OAAX;AACA,UAAID,MAAM,GAAG20B,UAAU,CAAC30B,MAAX,CAAkBsM,MAAlB,EAAb;;AAEA,WAAK,IAAImoB,KAAK,GAAGz0B,MAAM,CAAC40B,IAAP,EAAjB,EAAgCH,KAAK,IAAI,CAACA,KAAK,CAACI,IAAhD,EAAsDJ,KAAK,GAAGz0B,MAAM,CAAC40B,IAAP,EAA9D,EAA6E;AAC3E,YAAIH,KAAK,CAAChnB,KAAN,CAAYinB,aAAhB,EAA+B;AAC7BvlB,UAAAA,IAAI,CAAClP,SAAL,GAAiB,IAAjB;AACD;AACF;;AACD,aAAOkP,IAAP;AACD,KAdI,CAAP;AAeD,GAhBD;;AAkBA,MAAI2lB,SAAS,GAAG,SAAZA,SAAY,GAAW;AACzB,WAAOV,mBAAmB,CACvBtlB,IADI,CACC,UAAS6lB,UAAT,EAAqB;AACzB,UAAII,SAAS,GAAG,EAAhB;AACA,UAAI/0B,MAAM,GAAG20B,UAAU,CAAC30B,MAAX,CAAkBsM,MAAlB,EAAb;;AAEA,WAAK,IAAImoB,KAAK,GAAGz0B,MAAM,CAAC40B,IAAP,EAAjB,EAAgCH,KAAK,IAAI,CAACA,KAAK,CAACI,IAAhD,EAAsDJ,KAAK,GAAGz0B,MAAM,CAAC40B,IAAP,EAA9D,EAA6E;AACzEG,QAAAA,SAAS,CAAC3mB,IAAV,CAAeomB,SAAS,CAACC,KAAK,CAAChnB,KAAP,CAAxB;AACH;;AACD,aAAOsnB,SAAP;AACD,KATI,CAAP;AAUD,GAXD;;AAaA,MAAIC,cAAc,GAAG,EAArB;;AACA,MAAIhf,qBAAqB,GAAG,SAAxBA,qBAAwB,CAASuI,QAAT,EAAmB;AAC7C,QAAI5P,OAAO,GAAG,SAAVA,OAAU,GAAW;AACvBqmB,MAAAA,cAAc,GAAGA,cAAc,CAACh0B,MAAf,CAAsB,UAASmyB,CAAT,EAAY;AAAE,eAAOA,CAAC,KAAK5U,QAAb;AAAwB,OAA5D,CAAjB;AACD,KAFD;;AAIAyW,IAAAA,cAAc,CAAC5mB,IAAf,CAAoBmQ,QAApB;AAEA,WAAO;AACL5P,MAAAA,OAAO,EAAEA;AADJ,KAAP;AAGD,GAVD;;AAYA,MAAI4G,aAAa,GAAG,SAAhBA,aAAgB,CAASnE,KAAT,EAAgB;AAClC2iB,IAAAA,kBAAkB,CAACjlB,IAAnB,CAAwB,UAASmmB,GAAT,EAAc;AACpC7jB,MAAAA,KAAK,CAACjC,IAAN,CAAW,CAAX,IAAgBiC,KAAK,CAACjC,IAAN,CAAW,CAAX,IAAgB8lB,GAAG,CAAC70B,MAAJ,GAAW,EAA3B,GAAgC60B,GAAG,CAAC50B,SAApD;AACA20B,MAAAA,cAAc,CAACplB,OAAf,CAAuB,UAAS2O,QAAT,EAAmB;AACxCA,QAAAA,QAAQ,CAACnN,KAAD,CAAR;AACD,OAFD;AAGD,KALD;AAMD,GAPD;;AASA,MAAI8jB,YAAY,GAAG,SAAfA,YAAe,GAAW;AAC5BnB,IAAAA,kBAAkB,GAAGn0B,WAAW,CAACuuB,OAAZ,CAAoB,WAApB,EAClBrf,IADkB,CACb,UAASwH,SAAT,EAAoB;AACxB,UAAI,CAACA,SAAL,EAAgBA,SAAS,GAAG,EAAZ;AAChB,UAAI,OAAOA,SAAS,CAAClW,MAAjB,KAA4B,WAAhC,EAA6CkW,SAAS,CAAClW,MAAV,GAAmB,CAAnB;AAC7C,UAAI,OAAOkW,SAAS,CAACjW,SAAjB,KAA+B,WAAnC,EAAgDiW,SAAS,CAACjW,SAAV,GAAsB,CAAtB;AAEhD,aAAOiW,SAAP;AACD,KAPkB,CAArB;AAQD,GATD;;AAWA4e,EAAAA,YAAY;AAEZlB,EAAAA,UAAU,GAAGlS,EAAE,CAACkB,GAAH,CAAO;AAClBhjB,IAAAA,MAAM,EAAE80B,SAAS,EADC;AAElBxe,IAAAA,SAAS,EAAEyd;AAFO,GAAP,EAGVjlB,IAHU,CAGL,UAAS0H,MAAT,EAAiB;AACvB,QAAIF,SAAS,GAAGE,MAAM,CAACF,SAAvB;;AAEA,QAAIA,SAAS,IAAIA,SAAS,CAACtW,MAA3B,EAAmC;AACjCwW,MAAAA,MAAM,CAACxW,MAAP,CAAc4P,OAAd,CAAsB,UAAS6kB,KAAT,EAAgB;AACpC,YAAIne,SAAS,CAACtW,MAAV,CAAiBy0B,KAAK,CAAClT,EAAvB,CAAJ,EAAgC;AAC9BkT,UAAAA,KAAK,CAACvxB,MAAN;AACD;AACF,OAJD;AAKD;AACF,GAbY,CAAb;;AAeA,MAAIiyB,SAAS,GAAG,SAAZA,SAAY,GAAW;AACzB,WAAOpB,kBAAP;AACD,GAFD;;AAIA,MAAIqB,SAAS,GAAGtB,UAAU,CAACV,IAAX,CAAgB,UAAS6B,GAAT,EAAc;AAC5C,WAAOr1B,WAAW,CAACuuB,OAAZ,CAAoB,WAApB,EACJrf,IADI,CACC,UAASwH,SAAT,EAAoB;AACxBA,MAAAA,SAAS,GAAGA,SAAS,IAAI,EAAzB;AACAA,MAAAA,SAAS,CAACtW,MAAV,GAAmBsW,SAAS,CAACtW,MAAV,IAAoB,EAAvC;AACAsW,MAAAA,SAAS,CAAClW,MAAV,GAAmB60B,GAAG,CAAC70B,MAAvB;AACAkW,MAAAA,SAAS,CAACjW,SAAV,GAAsB40B,GAAG,CAAC50B,SAA1B;AAEA,aAAOT,WAAW,CAACwsB,OAAZ,CAAoB,WAApB,EAAiC9V,SAAjC,CAAP;AACD,KARI,EASJxH,IATI,CASComB,YATD,CAAP;AAUD,GAXe,CAAhB;AAaA,SAAO;AACLJ,IAAAA,SAAS,EAAEA,SADN;AAEL9e,IAAAA,qBAAqB,EAAEA,qBAFlB;AAGLE,IAAAA,SAAS,EAAEA,SAHN;AAILif,IAAAA,SAAS,EAAEA,SAJN;AAKLC,IAAAA,SAAS,EAAEA;AALN,GAAP;AAOD,CAhKuB,CAAxB;;;ACDA,IAAI71B,gBAAgB,GAAGC,OAAO,CAACC,MAAR,CAAe,kBAAf,CAAvB;AACAF,gBAAgB,CAACsiB,OAAjB,CAAyB,QAAzB,EAAmC,CAAC,IAAD,EAAO,UAAP,EAAmB,YAAnB,EAAiC,OAAjC,EAA0C,OAA1C,EAAmD,gBAAnD,EAAqE,UAASC,EAAT,EAAazX,QAAb,EAAuBgrB,UAAvB,EAAmC/qB,KAAnC,EAA0C2f,KAA1C,EAAiDpJ,cAAjD,EAAiE;AAErK,MAAIyU,UAAU,GAAG,CAAC,OAAD,EAAU,eAAV,EAA2B,sBAA3B,CAAjB;AACA,MAAIC,MAAM,GAAG,EAAb;AAEA,MAAIC,aAAa,GAAG;AAClBC,IAAAA,KAAK,EAAE,EADW;AAElBC,IAAAA,WAAW,EAAE;AAFK,GAApB;;AAKA,MAAIC,WAAW,GAAG,SAAdA,WAAc,CAASvkB,KAAT,EAAgByO,IAAhB,EAAsB;AACtC,QAAI+V,IAAI,GAAGJ,aAAa,CAACC,KAAd,CAAoBD,aAAa,CAACE,WAAlC,CAAX;AAEA,QAAI,CAACE,IAAL,EAAW;AACX,QAAIA,IAAI,CAACC,YAAT,EAAuBD,IAAI,CAACC,YAAL,CAAkBzkB,KAAlB,EAAyByO,IAAzB;AACxB,GALD;;AAOA,MAAIiW,aAAa,GAAG,SAAhBA,aAAgB,CAASJ,WAAT,EAAsB;AACxCA,IAAAA,WAAW,GAAGA,WAAW,IAAEF,aAAa,CAACE,WAAzC;AAEA,QAAIE,IAAI,GAAGJ,aAAa,CAACC,KAAd,CAAoBC,WAApB,CAAX;AAEAH,IAAAA,MAAM,GAAG,EAAT;AAEAF,IAAAA,UAAU,CAAC/pB,UAAX,CAAsB,qBAAtB;AACA+pB,IAAAA,UAAU,CAAC/pB,UAAX,CAAsB,oBAAtB;;AACA,QAAI,CAACsqB,IAAL,EAAW;AACT;AACA3L,MAAAA,KAAK,CAACoJ,eAAN,GAAwB,IAAxB;AACAxS,MAAAA,cAAc,CAACrS,OAAf;AAEA;AACD;;AAED,KAAConB,IAAI,CAACtW,KAAL,IAAY,EAAb,EAAiB1P,OAAjB,CAAyB,UAASmmB,QAAT,EAAmB;AAC1CR,MAAAA,MAAM,CAACnnB,IAAP,CAAY2nB,QAAZ;AACAV,MAAAA,UAAU,CAAC/pB,UAAX,CAAsB,mBAAmByqB,QAAzC;AACD,KAHD;;AAKA,SAAK,IAAIC,UAAT,IAAuBJ,IAAI,CAACl1B,OAAL,IAAc,EAArC,EAAyC;AACvC20B,MAAAA,UAAU,CAAC/pB,UAAX,CAAsB,sBAAsB0qB,UAA5C,EAAwD;AAACpV,QAAAA,IAAI,EAAEgV,IAAI,CAACl1B,OAAL,CAAas1B,UAAb;AAAP,OAAxD;AACD;;AAED,QAAIJ,IAAI,CAAC7P,QAAT,EAAmB;AACjB1b,MAAAA,QAAQ,CAAC,YAAW;AAClB,YAAImrB,aAAa,CAACE,WAAd,IAA6BA,WAAjC,EAA8C;AAC5CF,UAAAA,aAAa,CAACE,WAAd,GAA4BA,WAAW,GAAG,CAA1C;AACAI,UAAAA,aAAa;AACd;AACF,OALO,EAKLF,IAAI,CAAC7P,QAAL,GAAc,IALT,CAAR;AAMD;AACF,GAlCD;;AAoCA,MAAIkQ,YAAY,GAAG,SAAfA,YAAe,CAASC,SAAT,EAAoB;AACrC,WAAO,UAAS9kB,KAAT,EAAgByO,IAAhB,EAAsB;AAC3B,UAAIzO,KAAK,KAAK8kB,SAAd,EAAyB;AACvBV,QAAAA,aAAa,CAACE,WAAd;AACAI,QAAAA,aAAa;AACd;AACF,KALD;AAMD,GAPD;;AASA,MAAIK,KAAK,GAAG,SAARA,KAAQ,CAAShS,GAAT,EAAciS,EAAd,EAAkB;AAC5B,WAAO,UAAShlB,KAAT,EAAgByO,IAAhB,EAAsB;AAC3BxV,MAAAA,QAAQ,CAAC,YAAW;AAClB8Z,QAAAA,GAAG,CAAC/S,KAAD,EAAQyO,IAAR,CAAH;AACD,OAFO,EAELuW,EAFK,CAAR;AAGD,KAJD;AAKD,GAND;;AAQA,MAAIC,aAAa,GAAG,SAAhBA,aAAgB,CAASC,SAAT,EAAoBC,WAApB,EAAiC;AAClD,WAAO,MAAID,SAAJ,GAAc,WAAd,GAA4BC,WAAnC;AACF,GAFD;;AAIA,MAAInrB,KAAK,GAAG,SAARA,KAAQ,CAAStG,IAAT,EAAe;AACzB,QAAI0xB,gBAAgB,GAAG,SAAnBA,gBAAmB,CAASC,gBAAT,EAA2B;AAChD,UAAIA,gBAAgB,CAACR,YAArB,EAAmC;AACjC,eAAOA,YAAY,CAACQ,gBAAgB,CAACR,YAAlB,CAAnB;AACD,OAFD,MAEO,IAAIQ,gBAAgB,CAACN,KAArB,EAA4B;AACjC,eAAOA,KAAK,CAACK,gBAAgB,CAACC,gBAAgB,CAACC,KAAlB,CAAjB,EAA2CD,gBAAgB,CAACN,KAA5D,CAAZ;AACD;AACF,KAND;;AAQA,QAAIQ,QAAQ,GAAG,SAAXA,QAAW,CAASC,QAAT,EAAmBN,SAAnB,EAA8B;AAE3C,UAAIrN,EAAE,GAAG,EAAT;;AACA,WAAK,IAAIha,CAAT,IAAc2nB,QAAQ,CAACl2B,OAAvB,EAAgC;AAC9BuoB,QAAAA,EAAE,CAACha,CAAD,CAAF,GAAQ,WAAW,GAAX,GAAiBnK,IAAjB,GAAwB,GAAxB,GAA8BuxB,aAAa,CAACC,SAAD,EAAYrnB,CAAZ,CAAnD;AACD;;AAED,aAAO;AACLqQ,QAAAA,KAAK,EAAEsX,QAAQ,CAACtX,KADX;AAEL5e,QAAAA,OAAO,EAAEuoB,EAFJ;AAGL4M,QAAAA,YAAY,EAAEW,gBAAgB,CAACI,QAAQ,CAACf,YAAV,CAHzB;AAIL9P,QAAAA,QAAQ,EAAE6Q,QAAQ,CAAC7Q;AAJd,OAAP;AAMD,KAbD;;AAeA,QAAIyI,UAAU,GAAG,SAAbA,UAAa,CAAS7jB,IAAT,EAAe;AAC9B,aAAOkW,cAAc,CAAC0L,WAAf,CAA2B5hB,IAAI,CAAC7J,KAAL,CAAWygB,EAAtC,EACJzS,IADI,CACC,YAAW;AACf,eAAO+R,cAAc,CAAC2N,UAAf,CAA0B;AAC/BjN,UAAAA,EAAE,EAAE5W,IAAI,CAAC7J,KAAL,CAAWygB,EADgB;AAE/BtgB,UAAAA,IAAI,EAAE0J,IAAI,CAAC7J,KAAL,CAAWG,IAFc;AAG/BO,UAAAA,OAAO,EAAEmJ,IAAI,CAAC7J,KAAL,CAAWU,OAHW;AAI/BsD,UAAAA,IAAI,EAAE6F,IAAI,CAAC7J,KAAL,CAAWgE,IAJc;AAK/B8kB,UAAAA,QAAQ,EAAEjf,IAAI,CAACif;AALgB,SAA1B,CAAP;AAOD,OATI,CAAP;AAUD,KAXD;;AAaA,QAAIiN,WAAW,GAAG,SAAdA,WAAc,CAASrgB,MAAT,EAAiB;AACjC,aAAOsL,EAAE,CAACkB,GAAH,CAAO,CAACxM,MAAM,CAACrH,IAAP,CAAYmO,KAAZ,IAAmB,EAApB,EAAwBlO,GAAxB,CAA4Bof,UAA5B,CAAP,EACJ1f,IADI,CACC,YAAW;AACf,eAAO0H,MAAP;AACD,OAHI,CAAP;AAID,KALD;;AAOA,QAAIsgB,aAAa,GAAG,SAAhBA,aAAgB,CAAStgB,MAAT,EAAiB;AACnC,UAAIA,MAAM,CAACrH,IAAP,CAAY3N,OAAhB,EAAyB;AACvB4V,QAAAA,QAAQ,CAACoK,QAAT,GAAoB,cAAahL,MAAM,CAACrH,IAAP,CAAY3N,OAA7C;AACD;;AAED,aAAOgV,MAAP;AACD,KAND;;AAQA,WAAOlM,KAAK,CAACiZ,GAAN,CAAU,aAAaze,IAAb,GAAmB,OAA7B,EACJgK,IADI,CACC+nB,WADD,EAEJ/nB,IAFI,CAECgoB,aAFD,EAGJhoB,IAHI,CAGC,UAAS0H,MAAT,EAAiB;AACrB,UAAIugB,UAAU,GAAGvgB,MAAM,CAACrH,IAAxB;;AAEA,UAAIqH,MAAM,CAACrH,IAAP,CAAYkkB,eAAhB,EAAiC;AAC/BpJ,QAAAA,KAAK,CAACoJ,eAAN,GAAwB7c,MAAM,CAACrH,IAAP,CAAYkkB,eAAZ,GAA8B/lB,IAAI,CAACqI,KAAL,CAAWqhB,IAAI,CAACvY,GAAL,KAAa,IAAxB,CAAtD;AACAoC,QAAAA,cAAc,CAACrS,OAAf;AACD;;AAEDgnB,MAAAA,aAAa,CAACC,KAAd,GAAsBsB,UAAU,CAACtB,KAAX,CAAiBrmB,GAAjB,CAAqBunB,QAArB,CAAtB;AACAnB,MAAAA,aAAa,CAACE,WAAd,GAA4B,CAA5B;AACAI,MAAAA,aAAa;AACd,KAdI,CAAP;AAeD,GAnED;;AAqEA1qB,EAAAA,KAAK,CAACoP,KAAN,GAAc,UAAS1V,IAAT,EAAe;AAC3B6wB,IAAAA,WAAW,CAAC7wB,IAAD,CAAX;AACD,GAFD;;AAIA,MAAImyB,gBAAgB,GAAG,SAAnBA,gBAAmB,CAAS/U,OAAT,EAAkB;AACvC,QAAIvL,GAAG,GAAGuL,OAAO,CAACvL,GAAlB;;AAEA,QAAIugB,qBAAqB,GAAG,SAAxBA,qBAAwB,CAASpyB,IAAT,EAAe;AACzC,aAAOwF,KAAK,CAACiZ,GAAN,CAAU,aAAaze,IAAb,GAAmB,OAA7B,EACJgK,IADI,CACC,UAAS0H,MAAT,EAAiB;AACrB,YAAIugB,UAAU,GAAGvgB,MAAM,CAACrH,IAAxB;AACA,YAAI,CAAC4nB,UAAU,CAACI,IAAhB,EAAsB,OAAO,EAAP;AAEtB,YAAIC,SAAS,GAAGL,UAAU,CAACI,IAAX,CAAgBvX,OAAhB,CAAwBjJ,GAAxB,CAAhB;AACA,YAAIygB,SAAS,KAAK,CAAC,CAAnB,EAAsB,OAAO,EAAP;AAEtB,YAAIjoB,IAAI,GAAG,EAAX;AACA4nB,QAAAA,UAAU,CAACtB,KAAX,CAAiB7lB,OAAjB,CAAyB,UAASgmB,IAAT,EAAeU,SAAf,EAA0B;AACjD,cAAIV,IAAI,CAACl1B,OAAT,EAAkB;AAChB,iBAAK,IAAIuO,CAAT,IAAc2mB,IAAI,CAACl1B,OAAnB,EAA4B;AAC1B,kBAAI22B,EAAE,GAAGzB,IAAI,CAACl1B,OAAL,CAAauO,CAAb,CAAT;AACA,kBAAIqoB,UAAU,GAAGjB,aAAa,CAACC,SAAD,EAAYrnB,CAAZ,CAA9B;;AACA,kBAAI1C,KAAK,CAACyN,OAAN,CAAcqd,EAAd,CAAJ,EAAuB;AACrBloB,gBAAAA,IAAI,CAACmoB,UAAD,CAAJ,GAAmBD,EAAE,CAACD,SAAD,CAArB;AACD,eAFD,MAEO;AACL,oBAAIA,SAAS,KAAG,CAAhB,EAAmB;AACjBjoB,kBAAAA,IAAI,CAACmoB,UAAD,CAAJ,GAAmBD,EAAnB;AACD;AACF;AACF;AACF;AACF,SAdD;AAgBA,eAAOloB,IAAP;AACD,OA1BI,CAAP;AA2BD,KA5BD;;AA8BA,QAAIooB,OAAO,GAAG,EAAd;AACAjC,IAAAA,UAAU,CAAC1lB,OAAX,CAAmB,UAAS4nB,QAAT,EAAmB;AACpCD,MAAAA,OAAO,CAACC,QAAD,CAAP,GAAoBN,qBAAqB,CAACM,QAAD,CAAzC;AACD,KAFD;AAIA,WAAO1V,EAAE,CAACkB,GAAH,CAAOuU,OAAP,EACJzoB,IADI,CACC,UAAS2oB,qBAAT,EAAgC;AACpC,aAAO;AACLtsB,QAAAA,MAAM,EAAEssB;AADH,OAAP;AAGD,KALI,CAAP;AAMD,GA5CD;;AA8CA,MAAI9X,SAAS,GAAG,SAAZA,SAAY,GAAW;AACzB,WAAO4V,MAAP;AACD,GAFD;;AAIA,SAAO;AACLnqB,IAAAA,KAAK,EAAEA,KADF;AAELwqB,IAAAA,IAAI,EAAEE,aAFD;AAGLH,IAAAA,WAAW,EAAEA,WAHR;AAILsB,IAAAA,gBAAgB,EAAEA,gBAJb;AAKLtX,IAAAA,SAAS,EAAEA;AALN,GAAP;AAOH,CA5MkC,CAAnC;;;ACDA,IAAIkU,OAAO,GAAGr0B,OAAO,CAACC,MAAR,CAAe,kBAAf,CAAd;AACAo0B,OAAO,CAAChS,OAAR,CAAgB,MAAhB,EAAwB,CAAC,IAAD,EAAO,UAASC,EAAT,EAAa;AAC1C,SAAO,YAAW;AAChB,QAAI4V,OAAO,GAAG5V,EAAE,CAAC7X,IAAH,EAAd;;AACA,SAAKmpB,IAAL,GAAY,UAASlmB,CAAT,EAAY;AACtB,aAAO,YAAW;AAChB,YAAIyqB,KAAK,GAAGhc,SAAZ;;AACA,YAAIic,KAAK,GAAG,IAAZ;;AACA,YAAIC,KAAK,GAAG/V,EAAE,CAAC+V,KAAH,EAAZ;AAEAH,QAAAA,OAAO,GAAGA,OAAO,CAAC5oB,IAAR,CAAa,YAAW;AAChC,iBAAO5B,CAAC,CAACwO,KAAF,CAAQkc,KAAR,EAAeD,KAAf,EACJ7oB,IADI,CACC,UAASrB,KAAT,EAAgB;AACpBoqB,YAAAA,KAAK,CAACnG,OAAN,CAAcjkB,KAAd;AACD,WAHI,EAIJiU,KAJI,CAIE,UAAS/T,GAAT,EAAc;AACnBkqB,YAAAA,KAAK,CAACC,MAAN,CAAanqB,GAAb;AACD,WANI,CAAP;AAOD,SARS,CAAV;AASA,eAAOkqB,KAAK,CAACH,OAAb;AACD,OAfD;AAgBD,KAjBD;AAkBD,GApBD;AAqBD,CAtBuB,CAAxB;;;ACDA,IAAIn4B,gBAAgB,GAAGC,OAAO,CAACC,MAAR,CAAe,kBAAf,CAAvB;AACAF,gBAAgB,CAACsiB,OAAjB,CAAyB,oBAAzB,EAA+C,CAAC,IAAD,EAAO,aAAP,EAAsB,gBAAtB,EAAwC,gBAAxC,EAA0D,QAA1D,EAAoE,UAASC,EAAT,EAAavX,WAAb,EAA0BpB,cAA1B,EAA0CtJ,cAA1C,EAA0D2K,MAA1D,EAAkE;AACjL,SAAO,UAAS0X,OAAT,EAAkB;AACvB,QAAI6V,eAAe,GAAG,EAAtB;;AAEA,QAAI7V,OAAO,CAACvL,GAAR,KAAc,IAAlB,EAAwB;AACtBohB,MAAAA,eAAe,GAAG5uB,cAAlB;AACD;;AAED,QAAI+Y,OAAO,CAACvL,GAAR,KAAc,IAAlB,EAAwB;AACtBohB,MAAAA,eAAe,GAAGl4B,cAAlB;AACD;;AAED,QAAIm4B,eAAe,GAAG,SAAlBA,eAAkB,CAAS/O,EAAT,EAAa;AACjC,WAAK,IAAIha,CAAT,IAAcga,EAAd,EAAkB;AAChB8O,QAAAA,eAAe,CAAC9oB,CAAD,CAAf,GAAqBga,EAAE,CAACha,CAAD,CAAvB;AACD;AACF,KAJD;;AAMA,WAAO6S,EAAE,CAACkB,GAAH,CAAO;AACZiV,MAAAA,gBAAgB,EAAE1tB,WAAW,CAAC0sB,gBAAZ,CAA6B/U,OAA7B,CADN;AAEZgW,MAAAA,kBAAkB,EAAE1tB,MAAM,CAACysB,gBAAP,CAAwB/U,OAAxB;AAFR,KAAP,EAIJpT,IAJI,CAIC,UAAS0H,MAAT,EAAiB;AACrBwhB,MAAAA,eAAe,CAACxhB,MAAM,CAACyhB,gBAAR,CAAf;AACAD,MAAAA,eAAe,CAACxhB,MAAM,CAAC0hB,kBAAR,CAAf;AAEA,aAAOH,eAAP;AACD,KATI,CAAP;AAUD,GA3BD;AA4BH,CA7B8C,CAA/C;;;ACDA,IAAIx4B,gBAAgB,GAAGC,OAAO,CAACC,MAAR,CAAe,kBAAf,CAAvB;;AAEA,IAAI04B,WAAW,GAAG,SAAdA,WAAc,GAAW;AAC3B,MAAIC,EAAE,GAAG,IAAInW,OAAJ,EAAT;;AACA,OAAKsB,GAAL,GAAW,UAASZ,KAAT,EAAgBlS,MAAhB,EAAwB;AACjC,QAAIhB,KAAK,GAAG2oB,EAAE,CAAC7U,GAAH,CAAOZ,KAAP,CAAZ;AACA,QAAI0V,MAAM,GAAGnM,IAAI,CAACC,SAAL,CAAe1b,MAAf,CAAb;AAEA,QAAI,CAAChB,KAAL,EAAY,OAAOoH,SAAP;AAEZ,QAAIyhB,IAAI,GAAG7oB,KAAK,CAACzO,MAAN,CAAa,UAASmN,CAAT,EAAY;AAClC,aAAOA,CAAC,CAAC4U,GAAF,KAAUsV,MAAjB;AACD,KAFU,EAER,CAFQ,CAAX;AAIA,WAAOC,IAAI,IAAIA,IAAI,CAAC7qB,KAApB;AACD,GAXD;;AAaA,OAAK2V,GAAL,GAAW,UAAST,KAAT,EAAgBlS,MAAhB,EAAwBhD,KAAxB,EAA+B;AACxC,QAAIgC,KAAK,GAAG2oB,EAAE,CAAC7U,GAAH,CAAOZ,KAAP,CAAZ;AACA,QAAI0V,MAAM,GAAGnM,IAAI,CAACC,SAAL,CAAe1b,MAAf,CAAb;;AAEA,QAAI,CAAChB,KAAL,EAAY;AACVA,MAAAA,KAAK,GAAG,EAAR;AACD;;AAED,QAAI6oB,IAAI,GAAG7oB,KAAK,CAACzO,MAAN,CAAa,UAASmN,CAAT,EAAY;AAClC,aAAOA,CAAC,CAAC4U,GAAF,KAAUsV,MAAjB;AACD,KAFU,EAER,CAFQ,CAAX;;AAIA,QAAIC,IAAJ,EAAU;AACRA,MAAAA,IAAI,CAAC7qB,KAAL,GAAaA,KAAb;AACD,KAFD,MAEO;AACLgC,MAAAA,KAAK,CAACrB,IAAN,CAAW;AAAC2U,QAAAA,GAAG,EAAEsV,MAAN;AAAc5qB,QAAAA,KAAK,EAAEA;AAArB,OAAX;AACD;;AAED,QAAIgC,KAAK,CAAC7C,MAAN,GAAe,CAAnB,EAAsB6C,KAAK,GAAGA,KAAK,CAAC2R,KAAN,CAAY,CAAZ,CAAR;AAEtBgX,IAAAA,EAAE,CAAChV,GAAH,CAAOT,KAAP,EAAclT,KAAd;AACD,GArBD;AAsBD,CArCD;;AAuCAlQ,gBAAgB,CAACilB,OAAjB,CAAyB,aAAzB,EAAwC,CAAC,OAAD,EAAU,IAAV,EAAgB,UAASla,KAAT,EAAgBwX,EAAhB,EAAoB;AAC1E,MAAIyW,YAAY,GAAG,SAAfA,YAAe,CAASpU,GAAT,EAAcjC,OAAd,EAAuB;AACxC,QAAIsW,SAAS,GAAG,IAAIL,WAAJ,EAAhB;;AAEA,QAAIM,SAAS,GAAG,SAAZA,SAAY,CAAShoB,MAAT,EAAiBioB,SAAjB,EAA4B;AAC1C,UAAIC,aAAa,GAAGD,SAAS,CAACxU,KAA9B;;AACAwU,MAAAA,SAAS,CAACxU,KAAV,GAAkB,YAAW;AAC3BsU,QAAAA,SAAS,GAAG,IAAIL,WAAJ,EAAZ;;AAEA,YAAIQ,aAAJ,EAAmB;AACjB,iBAAOA,aAAa,CAACjd,KAAd,CAAoB,IAApB,EAA0BC,SAA1B,CAAP;AACD;AACF,OAND;;AAQA,aAAO,UAAS0H,WAAT,EAAsB;AAC3B,eAAO,UAASV,KAAT,EAAgBiW,MAAhB,EAAuB;AAC5B,cAAIjiB,GAAG,GAAG+hB,SAAV;AACA,cAAI/hB,GAAG,CAACkiB,WAAR,EAAqBliB,GAAG,GAAGA,GAAG,CAACkiB,WAAJ,EAAN;AACrBL,UAAAA,SAAS,CAACpV,GAAV,CAAczM,GAAd,EAAmBlG,MAAnB,EAA2BkS,KAA3B;AAEA,iBAAOU,WAAW,CAACV,KAAD,EAAQiW,MAAR,CAAlB;AACD,SAND;AAOD,OARD;AASD,KAnBD;;AAqBA,WAAO,UAASnoB,MAAT,EAAiBX,UAAjB,EAA6BR,UAA7B,EAAyC;AAC9C,UAAIwpB,OAAJ;AACA,UAAIC,SAAS,GAAG,EAAhB;;AAEA,UAAI7W,OAAO,IAAIA,OAAO,CAAC8W,YAAvB,EAAqC;AACnCF,QAAAA,OAAO,GAAG,iBAASnW,KAAT,EAAgBiW,MAAhB,EAAwB;AAChC,cAAIlW,OAAO,GAAG5S,UAAU,CAAC,CAAD,CAAxB;AACA,cAAIuT,WAAW,GAAGc,GAAG,CAAC1T,MAAD,EAASX,UAAU,CAACV,GAAX,CAAeqpB,SAAS,CAAChoB,MAAD,EAASkS,KAAT,CAAxB,CAAT,EAAmDrT,UAAnD,CAArB;AACA,cAAIqH,GAAG,GAAGgM,KAAV;AACA,cAAIhM,GAAG,CAACkiB,WAAR,EAAqBliB,GAAG,GAAGA,GAAG,CAACkiB,WAAJ,EAAN;AAErB,cAAII,OAAO,GAAGT,SAAS,CAACjV,GAAV,CAAc5M,GAAd,EAAmBlG,MAAnB,CAAd;;AACA,cAAIwoB,OAAJ,EAAa;AACX,mBAAOvW,OAAO,CAACuW,OAAD,CAAd;AACD,WAFD,MAEO;AACL,mBAAO5V,WAAW,CAACV,KAAD,EAAQiW,MAAR,CAAlB;AACD;AACF,SAZD;AAaD,OAdD,MAcO;AACLE,QAAAA,OAAO,GAAG3U,GAAG,CAAC1T,MAAD,EAASX,UAAT,EAAqBR,UAArB,CAAb;AACD;;AAED,UAAIwpB,OAAO,CAAChjB,MAAZ,EAAoB;AAClB,eAAOgjB,OAAP;AACD;;AAED,UAAIptB,GAAG,GAAG,SAANA,GAAM,CAASiX,KAAT,EAAgBT,OAAhB,EAAyB;AACjC,YAAIqI,CAAJ;AACA,YAAI7H,OAAO,GAAG,EAAd;AACA,YAAIwW,WAAW,GAAGJ,OAAlB;;AACA,YAAIK,KAAK,GAAG,SAARA,KAAQ,CAASr0B,IAAT,EAAe;AACzB4d,UAAAA,OAAO,CAAC5d,IAAD,CAAP,GAAgB,YAAW;AACzB,gBAAIo0B,WAAW,IAAIJ,OAAnB,EAA4BhjB,MAAM;AAClC,mBAAOyU,CAAC,CAACzlB,IAAD,CAAD,CAAQ4W,KAAR,CAAc6O,CAAd,EAAiB5O,SAAjB,CAAP;AACD,WAHD;AAID,SALD;;AAOA,YAAI7F,MAAM,GAAG,SAATA,MAAS,GAAW;AACpB,cAAIsjB,IAAI,GAAGN,OAAO,CAACnW,KAAD,EAAQT,OAAR,CAAlB;AACA,cAAIkX,IAAI,KAAK7O,CAAT,IAAcA,CAAd,IAAmBA,CAAC,CAACV,OAAzB,EAAkCU,CAAC,CAACV,OAAF;AAClCU,UAAAA,CAAC,GAAG6O,IAAJ;AAEAL,UAAAA,SAAS,CAAC3qB,IAAV,CAAegrB,IAAf;AAEAF,UAAAA,WAAW,GAAGJ,OAAd;;AACA,eAAK,IAAI7pB,CAAT,IAAcsb,CAAd;AAAiB4O,YAAAA,KAAK,CAAClqB,CAAD,CAAL;AAAjB;AACH,SATD;;AAWA6G,QAAAA,MAAM;AAEN,eAAO4M,OAAP;AACD,OAzBD;;AA2BA,UAAI2W,WAAJ;;AACA3tB,MAAAA,GAAG,CAACoK,MAAJ,GAAa,UAASwjB,SAAT,EAAoBC,WAApB,EAAiC;AAC5CjqB,QAAAA,UAAU,GAAGiqB,WAAb;AACA,YAAIrN,IAAI,CAACC,SAAL,CAAemN,SAAf,MAA8BD,WAAlC,EAA+C,OAAO3tB,GAAP;AAC/C2tB,QAAAA,WAAW,GAAGnN,IAAI,CAACC,SAAL,CAAemN,SAAf,CAAd;AAEAP,QAAAA,SAAS,CAACnpB,OAAV,CAAkB,UAAS4pB,QAAT,EAAmB;AACnC,cAAGA,QAAQ,CAAC3P,OAAZ,EAAqB2P,QAAQ,CAAC3P,OAAT;AACtB,SAFD;AAGAkP,QAAAA,SAAS,GAAG,EAAZ;AAEAD,QAAAA,OAAO,GAAG3U,GAAG,CAACmV,SAAD,EAAYxpB,UAAZ,EAAwBR,UAAxB,CAAb;AACA,eAAO5D,GAAP;AACD,OAZD;;AAcA,aAAOA,GAAP;AACD,KArED;AAsED,GA9FD;;AAiGA,MAAI+tB,OAAO,GAAG,CAAC,MAAD,CAAd;AACA,MAAI1uB,KAAK,GAAG,EAAZ;AACA,MAAI2uB,WAAW,GAAG,EAAlB;;AACA,MAAIC,CAAC,GAAG,SAAJA,CAAI,CAASC,UAAT,EAAqB;AAC3B,WAAO;AACLzC,MAAAA,IAAI,EAAE,cAASxgB,GAAT,EAAckjB,aAAd,EAA6B;AACjCH,QAAAA,WAAW,CAAC/iB,GAAD,CAAX,GAAkB+iB,WAAW,CAAC/iB,GAAD,CAAX,IAAkB,EAApC;AACA+iB,QAAAA,WAAW,CAAC/iB,GAAD,CAAX,CAAiBijB,UAAjB,IAA+BC,aAA/B;AACD,OAJI;AAKL54B,MAAAA,IAAI,EAAE,cAAS64B,QAAT,EAAmB5X,OAAnB,EAA4BmB,WAA5B,EAAyC;AAC7CtY,QAAAA,KAAK,CAACqD,IAAN,CAAW;AACTlE,UAAAA,WAAW,EAAE,iBAAiB0vB,UAAjB,GAA8B,GAA9B,GAAoC1X,OAAO,CAAC1Q,QAA5C,GAAuD,OAD3D;AAETtG,UAAAA,UAAU,EAAEgX,OAAO,CAAChX,UAFX;AAGTmY,UAAAA,WAAW,EAAEkV,YAAY,CAAClV,WAAD,EAAc;AAAC2V,YAAAA,YAAY,EAAE9W,OAAO,CAAC8W;AAAvB,WAAd,CAHhB;AAITl0B,UAAAA,IAAI,EAAEg1B,QAJG;AAKTC,UAAAA,WAAW,EAAE7X,OAAO,CAAC6X,WALZ;AAMTzqB,UAAAA,UAAU,EAAE4S,OAAO,CAAC5S,UANX;AAOT0qB,UAAAA,WAAW,EAAE9X,OAAO,CAAC8X,WAPZ;AAQT9qB,UAAAA,QAAQ,EAAEgT,OAAO,CAAChT,QART;AASTY,UAAAA,UAAU,EAAEoS,OAAO,CAACpS,UATX;AAUTuB,UAAAA,WAAW,EAAE6Q,OAAO,CAAC7Q,WAVZ;AAWTiR,UAAAA,OAAO,EAAEJ,OAAO,CAACI;AAXR,SAAX;AAaD;AAnBI,KAAP;AAqBD,GAtBD;;AAwBA,MAAI2X,UAAU,GAAG,SAAbA,UAAa,CAASL,UAAT,EAAqB;AACpC,WAAOtvB,KAAK,CAACiZ,GAAN,CAAU,iBAAiBqW,UAAjB,GAA8B,WAAxC,EACJ9qB,IADI,CACC,UAAS0H,MAAT,EAAiB;AACrB,UAAI0jB,UAAU,GAAG1jB,MAAM,CAACrH,IAAxB;AACA,UAAI1P,MAAM,GAAG;AAAC06B,QAAAA,MAAM,EAAE,mBAAU,CAAE;AAArB,OAAb;AACAxuB,MAAAA,IAAI,CAACuuB,UAAD,CAAJ;AAEAz6B,MAAAA,MAAM,CAAC06B,MAAP,CAAcR,CAAC,CAACC,UAAD,CAAf;AACD,KAPI,CAAP;AAQD,GATD;;AAWA,MAAIQ,aAAa,GAAGtY,EAAE,CAACkB,GAAH,CAAOyW,OAAO,CAACrqB,GAAR,CAAY6qB,UAAZ,CAAP,CAApB;;AAEA,MAAIjvB,QAAQ,GAAG,SAAXA,QAAW,CAASmlB,OAAT,EAAkB;AAC7B,QAAIC,UAAU,GAAG,sBAAW;AAC1B,aAAO,IAAP;AACD,KAFD;;AAIA,QAAID,OAAJ,EAAa;AACXA,MAAAA,OAAO,GAAGA,OAAO,CAAC5Y,WAAR,EAAV;;AACA6Y,MAAAA,UAAU,GAAG,oBAASjiB,CAAT,EAAY;AACvB,eAAOA,CAAC,CAACrJ,IAAF,CAAOyS,WAAP,GAAqBqI,OAArB,CAA6BuQ,OAA7B,MAA0C,CAAC,CAAlD;AACD,OAFD;AAGD;;AAED,WAAOiK,aAAa,CAACtrB,IAAd,CAAmB,YAAW;AACnC,aAAO/D,KAAK,CAAC/J,MAAN,CAAaovB,UAAb,CAAP;AACD,KAFM,CAAP;AAGH,GAfD;;AAiBA,MAAIphB,OAAO,GAAG,SAAVA,OAAU,CAAS8qB,QAAT,EAAmBvb,QAAnB,EAA6B;AACzC,WAAO6b,aAAa,CACjBtrB,IADI,CACC,YAAW;AACf,UAAIpD,GAAG,GAAGX,KAAK,CAAC/J,MAAN,CAAa,UAASC,IAAT,EAAe;AAAE,eAAOA,IAAI,CAAC6D,IAAL,KAAcg1B,QAArB;AAAgC,OAA9D,EAAgE,CAAhE,CAAV;AACA,UAAIvb,QAAJ,EAAcA,QAAQ,CAAC7S,GAAD,CAAR;AACd,aAAOA,GAAP;AACD,KALI,CAAP;AAMD,GAPD;;AASA,MAAIurB,gBAAgB,GAAG,SAAnBA,gBAAmB,CAAS/U,OAAT,EAAkB;AACvC,WAAOkY,aAAa,CACjBtrB,IADI,CACC,YAAW;AACf,aAAO4qB,WAAW,CAACxX,OAAO,CAACvL,GAAT,CAAX,IAA0B,EAAjC;AACD,KAHI,CAAP;AAID,GALD;;AAOA,SAAO;AACL3L,IAAAA,QAAQ,EAAEA,QADL;AAELgE,IAAAA,OAAO,EAAEA,OAFJ;AAGLioB,IAAAA,gBAAgB,EAAEA;AAHb,GAAP;AAMD,CAjLuC,CAAxC;;;ACzCA,IAAI13B,gBAAgB,GAAGC,OAAO,CAACC,MAAR,CAAe,kBAAf,CAAvB;AACAF,gBAAgB,CAACsiB,OAAjB,CAAyB,gBAAzB,EAA2C,CAAC,aAAD,EAAgB,UAASjiB,WAAT,EAAsB;AAC7E,MAAIy6B,IAAI,GAAG,SAAPA,IAAO,GAAW;AACpB,WAAOz6B,WAAW,CAACuuB,OAAZ,CAAoB,cAApB,EACJrf,IADI,CACC,UAAS0H,MAAT,EAAiB;AACrB,aAAO,CAAC,CAACA,MAAT;AACD,KAHI,CAAP;AAID,GALD;;AAOA,MAAI8jB,OAAO,GAAG,SAAVA,OAAU,CAAS7sB,KAAT,EAAgB;AAC5B,QAAIA,KAAJ,EAAW;AACT,aAAO7N,WAAW,CAACwsB,OAAZ,CAAoB,cAApB,EAAoC3e,KAApC,CAAP;AACD,KAFD,MAEO;AACL,aAAO7N,WAAW,CAAC4sB,UAAZ,CAAuB,cAAvB,CAAP;AACD;AACF,GAND;;AAQA,SAAO;AACL8N,IAAAA,OAAO,EAAEA,OADJ;AAELD,IAAAA,IAAI,EAAEA;AAFD,GAAP;AAIH,CApB0C,CAA3C;;;ACDA,IAAI96B,gBAAgB,GAAGC,OAAO,CAACC,MAAR,CAAe,kBAAf,CAAvB;AACAF,gBAAgB,CAACsiB,OAAjB,CAAyB,cAAzB,EAAyC,CAAC,IAAD,EAAO,aAAP,EAAsB,UAASC,EAAT,EAAaliB,WAAb,EAA0B;AACvF,MAAIuuB,OAAO,GAAGvuB,WAAW,CAACuuB,OAAZ,CAAoBtW,IAApB,CAAyBjY,WAAzB,CAAd;;AAEA,MAAI26B,gBAAgB,GAAG,SAAnBA,gBAAmB,CAASz5B,KAAT,EAAgB05B,KAAhB,EAAuB;AAC5C,QAAI15B,KAAK,CAAC8L,MAAN,KAAiB,CAArB,EAAwB,OAAOkV,EAAE,CAAC7X,IAAH,CAAQnJ,KAAR,CAAP;AACxB,QAAI05B,KAAK,IAAI,CAAb,EAAgB,OAAO1Y,EAAE,CAAC7X,IAAH,CAAQnJ,KAAR,CAAP;AAEhB,QAAI25B,SAAS,GAAG35B,KAAK,CAAC45B,KAAN,EAAhB;AACA,WAAO96B,WAAW,CAACuuB,OAAZ,CAAoBsM,SAAS,CAAClZ,EAA9B,EACJzS,IADI,CACC,UAASrB,KAAT,EAAgB;AACpB,aAAO7N,WAAW,CAAC4sB,UAAZ,CAAuBiO,SAAS,CAAClZ,EAAjC,EACJzS,IADI,CACC,YAAW;AACd,eAAOyrB,gBAAgB,CAACz5B,KAAD,EAAQ05B,KAAK,IAAI/sB,KAAK,GAAGA,KAAK,CAACb,MAAT,GAAkB,CAA3B,CAAb,CAAvB;AACF,OAHI,CAAP;AAID,KANI,CAAP;AAOD,GAZD;;AAcA,MAAIsmB,SAAS,GAAG,SAAZA,SAAY,CAAS/jB,IAAT,EAAe;AAC7B,WAAO;AAACoS,MAAAA,EAAE,EAAEpS,IAAI,CAACoS,EAAV;AAAczc,MAAAA,IAAI,EAAEqK,IAAI,CAACrK,IAAzB;AAA+B7D,MAAAA,IAAI,EAAEkO,IAAI,CAAClO;AAA1C,KAAP;AACD,GAFD;;AAIA,MAAI05B,OAAO,GAAG,SAAVA,OAAU,CAASH,KAAT,EAAgB;AAC5B,WAAO56B,WAAW,CAACuuB,OAAZ,CAAoB,SAApB,EACJrf,IADI,CACC,UAAShO,KAAT,EAAgB;AACpB,aAAOy5B,gBAAgB,CAACz5B,KAAD,EAAQ05B,KAAR,CAAvB;AACD,KAHI,EAIJ1rB,IAJI,CAIC,UAAS8rB,QAAT,EAAmB;AACvB,aAAOh7B,WAAW,CAACwsB,OAAZ,CAAoB,SAApB,EAA+BwO,QAAQ,CAACxrB,GAAT,CAAa8jB,SAAb,CAA/B,CAAP;AACD,KANI,CAAP;AAOD,GARD;;AAUA,MAAI9G,OAAO,GAAG,SAAVA,OAAU,CAASzV,GAAT,EAAclG,MAAd,EAAsBoqB,OAAtB,EAA+B;AAC3C,WAAOj7B,WAAW,CAACwsB,OAAZ,CAAoBzV,GAApB,EAAyBlG,MAAzB,EACJiR,KADI,CACE,UAAS/T,GAAT,EAAc;AACnB,UAAI,CAACktB,OAAL,EAAc;AACZ,eAAOF,OAAO,CAAClqB,MAAM,CAAC7D,MAAR,CAAP,CACJkC,IADI,CACC,YAAW;AACf,iBAAOsd,OAAO,CAACzV,GAAD,EAAMlG,MAAN,EAAc,IAAd,CAAd;AACD,SAHI,CAAP;AAID;;AAED,YAAM9C,GAAN;AACD,KAVI,CAAP;AAWD,GAZD;;AAeA,MAAI6e,UAAU,GAAG5sB,WAAW,CAAC4sB,UAAZ,CAAuB3U,IAAvB,CAA4BjY,WAA5B,CAAjB;AAEA,SAAO;AACLuuB,IAAAA,OAAO,EAAEA,OADJ;AAEL/B,IAAAA,OAAO,EAAEA,OAFJ;AAGLI,IAAAA,UAAU,EAAEA;AAHP,GAAP;AAKD,CArDwC,CAAzC;;;ACDA,IAAIjtB,gBAAgB,GAAGC,OAAO,CAACC,MAAR,CAAe,kBAAf,CAAvB;AAEAF,gBAAgB,CAACyB,MAAjB,CAAwB,iBAAxB,EAA2C,YAAW;AACpD,SAAO,UAAS85B,YAAT,EAAuBC,aAAvB,EAAsC;AAC3C,WAAOA,aAAa,CAACD,YAAD,CAAb,IAA+BC,aAAa,CAACD,YAAD,CAA5C,GAA6DC,aAAa,CAACD,YAAD,CAAb,CAA4Bh2B,IAAzF,GAAgGg2B,YAAvG;AACD,GAFD;AAGD,CAJD;AAMAv7B,gBAAgB,CAACyB,MAAjB,CAAwB,iBAAxB,EAA2C,YAAW;AACpD,SAAO,UAAS85B,YAAT,EAAuBC,aAAvB,EAAsC;AAC3C,WAAOA,aAAa,CAACD,YAAD,CAAb,IAA+BC,aAAa,CAACD,YAAD,CAA5C,GAA6DC,aAAa,CAACD,YAAD,CAAb,CAA4B75B,IAAzF,GAAgG,YAAvG;AACD,GAFD;AAGD,CAJD;AAMA1B,gBAAgB,CAACyB,MAAjB,CAAwB,YAAxB,EAAsC,YAAW;AAC/C,SAAO,UAASg6B,KAAT,EAAgBC,QAAhB,EAA0B;AAC/B,WAAOA,QAAQ,CAACD,KAAK,CAACzZ,EAAP,CAAR,IAAsB0Z,QAAQ,CAACD,KAAK,CAACzZ,EAAP,CAAR,CAAmBzgB,KAAzC,GAAiDm6B,QAAQ,CAACD,KAAK,CAACzZ,EAAP,CAAR,CAAmBzgB,KAAnB,CAAyBgE,IAA1E,GAAiFk2B,KAAK,CAACzZ,EAA9F;AACD,GAFD;AAGD,CAJD;AAMAhiB,gBAAgB,CAACyB,MAAjB,CAAwB,cAAxB,EAAwC,CAAC,SAAD,EAAY,UAASmX,OAAT,EAAkB;AACpE,SAAO,UAAS6iB,KAAT,EAAgBC,QAAhB,EAA0B1iB,OAA1B,EAAmC;AACxC,QAAI,CAACyiB,KAAK,CAACzZ,EAAX,EAAe,OAAO,CAAP;AACf,QAAI,CAAC0Z,QAAQ,CAACD,KAAK,CAACzZ,EAAP,CAAb,EAAyB,OAAO,CAAP;AACzB,QAAI,CAAC0Z,QAAQ,CAACD,KAAK,CAACzZ,EAAP,CAAR,CAAmBqI,QAAxB,EAAkC,OAAO,CAAP;AAElC,WAAOzR,OAAO,CAACmQ,mBAAR,CAA4B2S,QAAQ,CAACD,KAAK,CAACzZ,EAAP,CAAR,CAAmBqI,QAA/C,EAAyDrR,OAAzD,CAAP;AACD,GAND;AAOD,CARuC,CAAxC;AAUAhZ,gBAAgB,CAAC4K,UAAjB,CAA4B,mBAA5B,EAAiD,CAAC,QAAD,EAAW,mBAAX,EAAgC,QAAhC,EAA0C,UAAS+wB,MAAT,EAAiBC,iBAAjB,EAAoC3wB,MAApC,EAA4C;AACrI0wB,EAAAA,MAAM,CAACE,WAAP,GAAqB,CAArB;AACAF,EAAAA,MAAM,CAACG,QAAP,GAAkB,KAAlB;AACAH,EAAAA,MAAM,CAAC/vB,MAAP,GAAgBX,MAAM,CAACY,KAAvB;;AAEA8vB,EAAAA,MAAM,CAACv2B,MAAP,GAAgB,YAAW;AACzBw2B,IAAAA,iBAAiB,CAACz2B,OAAlB;AACD,GAFD;;AAIAw2B,EAAAA,MAAM,CAAC9vB,KAAP,GAAe,YAAW;AACxB8vB,IAAAA,MAAM,CAAC/vB,MAAP,CAAcqP,KAAd,CAAoB,kBAApB;AAEA2gB,IAAAA,iBAAiB,CAAClK,KAAlB,CAAwB;AACtBoK,MAAAA,QAAQ,EAAEH,MAAM,CAACG,QADK;AAEtBD,MAAAA,WAAW,EAAEF,MAAM,CAACE;AAFE,KAAxB;AAID,GAPD;AAQD,CAjBgD,CAAjD;AAmBA77B,gBAAgB,CAAC4K,UAAjB,CAA4B,qBAA5B,EAAmD,CAAC,QAAD,EAAW,UAAS+wB,MAAT,EAAiB;AAC7EA,EAAAA,MAAM,CAACrrB,KAAP,CAAa,eAAb,EAA8B,SAA9B;AACD,CAFkD,CAAnD;AAIAtQ,gBAAgB,CAAC4K,UAAjB,CAA4B,4BAA5B,EAA0D,CAAC,QAAD,EAAW,cAAX,EAA2B,UAAS+wB,MAAT,EAAiBI,YAAjB,EAA+B;AAClHJ,EAAAA,MAAM,CAACrrB,KAAP,CAAa,eAAb,EAA8ByrB,YAAY,CAAC95B,OAA3C;AACD,CAFyD,CAA1D;AAIAjC,gBAAgB,CAAC4K,UAAjB,CAA4B,sBAA5B,EAAoD,CAAC,QAAD,EAAW,WAAX,EAAwB,IAAxB,EAA8B,UAA9B,EAA0C,cAA1C,EAA0D,OAA1D,EAAmE,cAAnE,EAAmF,gBAAnF,EAAqG,eAArG,EAAsH,SAAtH,EAAiI,QAAjI,EAA2I,gBAA3I,EAA6J,iBAA7J,EAChD,UAAS+wB,MAAT,EAAiB9lB,SAAjB,EAA4B0M,EAA5B,EAAgCzX,QAAhC,EAA0CixB,YAA1C,EAAwDhxB,KAAxD,EAA+DgL,YAA/D,EAA6EuL,cAA7E,EAA6F0a,aAA7F,EAA4GpjB,OAA5G,EAAqHqjB,MAArH,EAA6HtjB,cAA7H,EAA6IujB,eAA7I,EAA8J;AAEhKP,EAAAA,MAAM,CAACD,QAAP,GAAkB,EAAlB;AACA,MAAI1Z,EAAE,GAAG+Z,YAAY,CAAC/Z,EAAtB;AACA,MAAIma,OAAO,GAAGH,aAAa,EAA3B;AACA,MAAII,kBAAkB,GAAG,CAAzB;AAEAT,EAAAA,MAAM,CAACrrB,KAAP,CAAa,eAAb,EAA8ByrB,YAAY,CAAC95B,OAA3C;;AAEA,MAAIo6B,SAAS,GAAG,SAAZA,SAAY,CAASC,EAAT,EAAa;AAC3B,QAAIvjB,SAAS,GAAG,MAAM4iB,MAAM,CAACvwB,IAAP,CAAY4N,OAAlC;AACA,QAAIF,SAAS,GAAG,CAAhB;AACA,WAAOH,cAAc,GAAC2jB,EAAf,GAAkBxjB,SAAlB,GAA4BC,SAAnC;AACD,GAJD;;AAMA4iB,EAAAA,MAAM,CAACY,IAAP,GAAc,UAAS1qB,KAAT,EAAgB;AAC5B,QAAI8pB,MAAM,CAACa,UAAX,EAAuB;AAEvBJ,IAAAA,kBAAkB,GAAGC,SAAS,CAACxqB,KAAK,CAACmI,OAAP,CAA9B;AACA2hB,IAAAA,MAAM,CAAC5vB,UAAP,CAAkB,YAAlB,EAAgCqwB,kBAAhC;;AAEA,QAAIT,MAAM,CAAChd,OAAX,EAAoB;AAClBgd,MAAAA,MAAM,CAAChd,OAAP,CAAexY,IAAf;AACAw1B,MAAAA,MAAM,CAAChd,OAAP,GAAiB,IAAjB;AACAgd,MAAAA,MAAM,CAACc,MAAP;AACD;AACF,GAXD;;AAaAd,EAAAA,MAAM,CAACe,WAAP,GAAqB,UAASjB,KAAT,EAAgB;AACnC5jB,IAAAA,QAAQ,CAACoK,QAAT,GAAoB,cAAc8Z,YAAY,CAAC95B,OAA3B,GAAqC,WAArC,GAAmDw5B,KAAK,CAACzZ,EAA7E;AACD,GAFD;;AAIA2Z,EAAAA,MAAM,CAACgB,UAAP,GAAoB,YAAW;AAC7BV,IAAAA,MAAM,CAAClJ,UAAP,CAAkB4I,MAAM,CAACiB,SAAP,CAAiBr3B,IAAnC,EAAyCo2B,MAAM,CAACiB,SAAP,CAAiB5a,EAA1D;AACD,GAFD;;AAIA2Z,EAAAA,MAAM,CAAC1O,UAAP,GAAoB,YAAW;AAC7B,QAAI0O,MAAM,CAACiB,SAAP,CAAiBzR,OAArB,EAA8B;AAC5BwQ,MAAAA,MAAM,CAACvwB,IAAP,GAAc,IAAd;AACAuwB,MAAAA,MAAM,CAACiB,SAAP,GAAmB,IAAnB;AACAtb,MAAAA,cAAc,CAAC0L,WAAf,CAA2BhL,EAA3B,EACGzS,IADH,CACQ,YAAW;AACfstB,QAAAA,cAAc;AACf,OAHH;AAIA;AACD;;AAEDvb,IAAAA,cAAc,CAACY,gBAAf,CAAgCF,EAAhC,EACGzS,IADH,CACQ,YAAW;AACfsI,MAAAA,QAAQ,CAACoK,QAAT,GAAoB,cAAc8Z,YAAY,CAAC95B,OAA/C;AACD,KAHH;AAID,GAfD;;AAiBA05B,EAAAA,MAAM,CAAC51B,MAAP,GAAgB,UAAS01B,KAAT,EAAgB;AAC9B,WAAOA,KAAK,CAACzZ,EAAb;AACA8a,IAAAA,YAAY;AACZnB,IAAAA,MAAM,CAACoB,WAAP;AACD,GAJD;;AAMApB,EAAAA,MAAM,CAACa,UAAP,GAAoB,IAApB;;AAEAb,EAAAA,MAAM,CAACv1B,MAAP,GAAgB,YAAW;AACzB,QAAIu1B,MAAM,CAAChd,OAAX,EAAoB;AAClBgd,MAAAA,MAAM,CAAChd,OAAP,CAAexY,IAAf;AACAw1B,MAAAA,MAAM,CAAChd,OAAP,GAAiB,IAAjB;AAEAgd,MAAAA,MAAM,CAAC5vB,UAAP,CAAkB,YAAlB;AACD;;AAED,QAAIiL,QAAQ,GAAGnB,SAAS,CAACvQ,IAAV,CAAe;AAC5BqF,MAAAA,WAAW,EAAE,yCADe;AAE5BC,MAAAA,UAAU,EAAE;AAFgB,KAAf,CAAf;AAKAoM,IAAAA,QAAQ,CAACC,MAAT,CAAgB1H,IAAhB,CAAqB,UAASytB,eAAT,EAA0B;AAC7CrB,MAAAA,MAAM,CAACa,UAAP,GAAoBzmB,YAAY,CAAC3P,MAAb,CAAoB;AACtC01B,QAAAA,QAAQ,EAAEkB,eAAe,CAAClB,QADY;AAEtCD,QAAAA,WAAW,EAAEmB,eAAe,CAACnB;AAFS,OAApB,EAGjB,UAAShW,IAAT,EAAe;AAChB,YAAIhY,CAAC,GAAGgK,QAAQ,CAACiO,aAAT,CAAuB,GAAvB,CAAR;AACAjO,QAAAA,QAAQ,CAACkO,IAAT,CAAcC,WAAd,CAA0BnY,CAA1B;AACAA,QAAAA,CAAC,CAACoY,KAAF,GAAU,eAAV;AAEA,YAAIC,GAAG,GAAIlI,MAAM,CAACmI,GAAP,CAAWC,eAAX,CAA2BP,IAA3B,CAAX;AACAhY,QAAAA,CAAC,CAACwY,IAAF,GAASH,GAAT;AACArY,QAAAA,CAAC,CAACtE,QAAF,GAAaoyB,MAAM,CAACiB,SAAP,CAAiBr3B,IAAjB,GAAwB,GAAxB,GAA8By3B,eAAe,CAAClB,QAA3D;AACAjuB,QAAAA,CAAC,CAACyY,KAAF;AACAtI,QAAAA,MAAM,CAACmI,GAAP,CAAWI,eAAX,CAA2BL,GAA3B;AAEAyV,QAAAA,MAAM,CAAC/vB,MAAP,CAAcqP,KAAd,CAAoB,eAApB;AACD,OAfmB,CAApB;AAiBA0gB,MAAAA,MAAM,CAAC11B,IAAP;AACD,KAnBD;AAoBD,GAjCD;;AAmCA01B,EAAAA,MAAM,CAACx1B,IAAP,GAAc,YAAW;AACvBi2B,IAAAA,kBAAkB,GAAG,CAArB;AAEAT,IAAAA,MAAM,CAAC5vB,UAAP,CAAkB,WAAlB;AACA4vB,IAAAA,MAAM,CAAC5vB,UAAP,CAAkB,YAAlB,EAAgCqwB,kBAAhC;AAEA,QAAIT,MAAM,CAAChd,OAAX,EAAoBgd,MAAM,CAAChd,OAAP,CAAexY,IAAf;AACpBw1B,IAAAA,MAAM,CAAC/vB,MAAP,CAAcqP,KAAd,CAAoB,mBAApB;AACA0gB,IAAAA,MAAM,CAAChd,OAAP,GAAiB,IAAjB;AACD,GATD;;AAWAgd,EAAAA,MAAM,CAAChd,OAAP,GAAiB,IAAjB;AAEAgd,EAAAA,MAAM,CAACxsB,GAAP,CAAW,aAAX,EAA0B,UAASoL,GAAT,EAAckC,KAAd,EAAqB;AAC7C2f,IAAAA,kBAAkB,GAAG3f,KAArB;AACD,GAFD;;AAIAkf,EAAAA,MAAM,CAAC11B,IAAP,GAAc,YAAW;AACvB,QAAI01B,MAAM,CAAChd,OAAX,EAAoB;AAClBgd,MAAAA,MAAM,CAAChd,OAAP,CAAexY,IAAf;AACAw1B,MAAAA,MAAM,CAAChd,OAAP,GAAiB,IAAjB;AAEAgd,MAAAA,MAAM,CAAC5vB,UAAP,CAAkB,YAAlB;AACA;AACD;;AAED4vB,IAAAA,MAAM,CAACc,MAAP;AACD,GAVD;;AAYAd,EAAAA,MAAM,CAACc,MAAP,GAAgB,YAAW;AACzB1mB,IAAAA,YAAY,CAACyB,WAAb;AAEA+K,IAAAA,EAAE,CAACkB,GAAH,CAAO0Y,OAAO,CAAC1Y,GAAf,EACGlU,IADH,CACQ,UAASyY,WAAT,EAAqB;AACzB,UAAIiV,QAAQ,GAAG,EAAf;;AAEA,UAAIC,aAAa,GAAG,SAAhBA,aAAgB,CAASlb,EAAT,EAAamb,YAAb,EAA2B;AAC7C,YAAI,CAACnb,EAAL,EAAS,OAAO,IAAP;AACT,YAAIib,QAAQ,CAACjb,EAAD,CAAZ,EAAkB,OAAOib,QAAQ,CAACjb,EAAD,CAAf;AAElB,YAAIpgB,OAAO,GAAG+5B,MAAM,CAACD,QAAP,CAAgB1Z,EAAhB,EAAoBqI,QAAlC;AACA,YAAI+S,UAAU,GAAGxK,MAAM,CAACvtB,MAAP,CAAczD,OAAd,CAAjB;AACAw7B,QAAAA,UAAU,CAAC/2B,GAAX,GAAiBs1B,MAAM,CAACvwB,IAAP,CAAY/E,GAA7B;AAEA42B,QAAAA,QAAQ,CAACjb,EAAD,CAAR,GAAepJ,OAAO,CAACmP,cAAR,CAAuBqV,UAAvB,EAAmCpV,WAAnC,EAAgDmV,YAAY,GAACjB,eAA7D,EAA8E,YAAW,CAAE,CAA3F,CAAf;AACA,eAAOe,QAAQ,CAACjb,EAAD,CAAf;AACD,OAVD;;AAYA,UAAIngB,IAAI,GAAG,IAAIzB,KAAK,CAACi9B,IAAV,CACT1B,MAAM,CAACvwB,IAAP,CAAYhD,MAAZ,CAAmByH,GAAnB,CAAuB,UAASgJ,KAAT,EAAgBskB,YAAhB,EAA8B;AACnD,eAAOtkB,KAAK,CAACiT,MAAN,CAAajc,GAAb,CAAiB,UAAS4rB,KAAT,EAAgB;AACtC,iBAAOyB,aAAa,CAACzB,KAAK,CAACzZ,EAAP,EAAWmb,YAAX,CAApB;AACD,SAFM,CAAP;AAGD,OAJD,CADS,EAMT;AACEnkB,QAAAA,OAAO,EAAE2iB,MAAM,CAACvwB,IAAP,CAAY4N,OADvB;AAEE3S,QAAAA,GAAG,EAAEs1B,MAAM,CAACvwB,IAAP,CAAY/E,GAFnB;AAGEmiB,QAAAA,cAAc,EAAE7P,cAHlB;AAIE9M,QAAAA,KAAK,EAAEuwB;AAJT,OANS,CAAX;AAaAT,MAAAA,MAAM,CAAC5vB,UAAP,CAAkB,YAAlB,EAAgClK,IAAI,CAAC6c,WAAL,EAAhC;AACAid,MAAAA,MAAM,CAAChd,OAAP,GAAiB9c,IAAI,CAACoE,IAAL,CAAU;AACzBmhB,QAAAA,MAAM,EAAE,kBAAW;AACjBuU,UAAAA,MAAM,CAAC5vB,UAAP,CAAkB,WAAlB;AACA4vB,UAAAA,MAAM,CAAC5vB,UAAP,CAAkB,YAAlB,EAAgCqwB,kBAAhC;AAEAT,UAAAA,MAAM,CAAC/vB,MAAP,CAAcqP,KAAd,CAAoB,mBAApB;AACA0gB,UAAAA,MAAM,CAAChd,OAAP,GAAiB,IAAjB;AACA,cAAIgd,MAAM,CAACa,UAAX,EAAuBb,MAAM,CAACa,UAAP,CAAkBr2B,IAAlB;AACvBw1B,UAAAA,MAAM,CAACa,UAAP,GAAoB,IAApB;AACA1xB,UAAAA,QAAQ,CAAC,YAAW,CAAE,CAAd,CAAR;AACD;AAVwB,OAAV,CAAjB;AAaD,KA3CH;AA4CD,GA/CD;;AAiDA6wB,EAAAA,MAAM,CAAC2B,YAAP,GAAsB,YAAW;AAC/B3B,IAAAA,MAAM,CAACiB,SAAP,CAAiB1R,GAAjB,GAAuB5J,cAAc,CAACwN,OAAf,CAAuB,MAAvB,EAA+B6M,MAAM,CAACvwB,IAAtC,CAAvB;AACAkW,IAAAA,cAAc,CAACiP,WAAf,CAA2BvO,EAA3B,EAA+B2Z,MAAM,CAACiB,SAAtC;AACD,GAHD;;AAKAjB,EAAAA,MAAM,CAACoB,WAAP,GAAqBtwB,EAAE,CAACC,QAAH,CAAY,YAAW;AAC1C4U,IAAAA,cAAc,CAAC4K,UAAf,CAA0BlK,EAA1B,EAA8B2Z,MAAM,CAACvwB,IAArC,EACGmE,IADH,CACQ,YAAW;AACfosB,MAAAA,MAAM,CAAC2B,YAAP;AACD,KAHH;AAID,GALoB,EAKnB,GALmB,CAArB;;AAOA,MAAIR,YAAY,GAAG,SAAfA,YAAe,GAAW;AAC5B,QAAIS,SAAS,GAAG,CAAhB;AACA,QAAIC,aAAa,GAAG,CAApB;AAEA,QAAI,CAAC7B,MAAM,CAACvwB,IAAZ,EAAkB;AAClB,QAAI,CAACuwB,MAAM,CAACvwB,IAAP,CAAYhD,MAAjB,EAAyB;AAEzBuzB,IAAAA,MAAM,CAACvwB,IAAP,CAAYhD,MAAZ,CAAmBiI,OAAnB,CAA2B,UAASwI,KAAT,EAAgB4kB,UAAhB,EAA4B;AACrD,WAAK,IAAIxwB,CAAC,GAAC,CAAX,EAAaA,CAAC,GAAC4L,KAAK,CAACiT,MAAN,CAAaze,MAA5B,EAAmCJ,CAAC,EAApC,EAAwC;AACtC,YAAI4L,KAAK,CAACiT,MAAN,CAAa7e,CAAb,EAAgB+U,EAApB,EAAuB;AACrB,cAAI0b,MAAM,GAAG9kB,OAAO,CAACmQ,mBAAR,CAA4B4S,MAAM,CAACD,QAAP,CAAgB7iB,KAAK,CAACiT,MAAN,CAAa7e,CAAb,EAAgB+U,EAAhC,EAAoCqI,QAAhE,EAA0EsR,MAAM,CAACvwB,IAAP,CAAY4N,OAAtF,CAAb;AACA,cAAI/L,CAAC,GAACywB,MAAF,GAASH,SAAb,EAAwBA,SAAS,GAACtwB,CAAC,GAACywB,MAAZ;AACxB,cAAID,UAAU,GAAGD,aAAjB,EAAgCA,aAAa,GAAGC,UAAhB;AACjC;AACF;AACF,KARD;;AAUA,QAAI9B,MAAM,CAACvwB,IAAP,CAAYhD,MAAZ,CAAmBiF,MAAnB,GAA4BmwB,aAAa,GAAC,CAA1C,IAA+C7B,MAAM,CAACvwB,IAAP,CAAYhD,MAAZ,CAAmBiF,MAAnB,GAA4B6uB,eAA/E,EAAgG;AAC9FP,MAAAA,MAAM,CAACvwB,IAAP,CAAYhD,MAAZ,CAAmByG,IAAnB,CAAwB;AACtBid,QAAAA,MAAM,EAAE6P,MAAM,CAACvwB,IAAP,CAAYhD,MAAZ,CAAmB,CAAnB,EAAsB0jB,MAAtB,CAA6Bjc,GAA7B,CAAiC,YAAW;AAAC,iBAAO,EAAP;AAAW,SAAxD;AADc,OAAxB;AAGD,KAJD,MAIO;AACL8rB,MAAAA,MAAM,CAACvwB,IAAP,CAAYhD,MAAZ,GAAqBuzB,MAAM,CAACvwB,IAAP,CAAYhD,MAAZ,CAAmByZ,KAAnB,CAAyB,CAAzB,EAA2B2b,aAAa,GAAC,CAAzC,CAArB;AACD;;AAED,QAAIhkB,MAAM,GAAG+jB,SAAS,GAAG,CAAzB;AACA5B,IAAAA,MAAM,CAACvwB,IAAP,CAAYhD,MAAZ,CAAmBiI,OAAnB,CAA2B,UAASwI,KAAT,EAAgB;AACzC,UAAIW,MAAM,GAAGX,KAAK,CAACiT,MAAN,CAAaze,MAA1B,EAAkC;AAChC,YAAIswB,OAAO,GAAGnkB,MAAM,GAACX,KAAK,CAACiT,MAAN,CAAaze,MAAlC;;AACA,aAAK,IAAIJ,CAAC,GAAC,CAAX,EAAaA,CAAC,GAAC0wB,OAAf,EAAuB1wB,CAAC,EAAxB,EAA4B;AAC1B4L,UAAAA,KAAK,CAACiT,MAAN,CAAajd,IAAb,CAAkB,EAAlB;AACD;AACF,OALD,MAKO;AACLgK,QAAAA,KAAK,CAACiT,MAAN,GAAejT,KAAK,CAACiT,MAAN,CAAajK,KAAb,CAAmB,CAAnB,EAAsBrI,MAAtB,CAAf;AACD;AACF,KATD;AAUAmiB,IAAAA,MAAM,CAACoB,WAAP;AACD,GArCD;;AAsCApB,EAAAA,MAAM,CAACvrB,MAAP,CAAc,cAAd,EAA8B0sB,YAA9B;;AAEAnB,EAAAA,MAAM,CAAC/pB,cAAP,GAAwB,UAASgsB,KAAT,EAAeC,MAAf,EAAsBpC,KAAtB,EAA4B0B,YAA5B,EAA0C;AAChE,QAAIS,KAAK,CAACE,SAAV,EAAqB;AAEnB,UAAIC,MAAM,GAAGtC,KAAK,CAACzZ,EAAnB;AACAyZ,MAAAA,KAAK,CAACzZ,EAAN,GAAW4b,KAAK,CAACE,SAAN,CAAgB9b,EAA3B;AACA4b,MAAAA,KAAK,CAACE,SAAN,CAAgB9b,EAAhB,GAAqB+b,MAArB;AAEAjB,MAAAA,YAAY;AACZ;AACD;;AACD,QAAIc,KAAK,CAACl8B,IAAN,KAAe,SAAnB,EAA8B;AAE9B+5B,IAAAA,KAAK,CAACzZ,EAAN,GAAW4b,KAAK,CAAC5b,EAAjB;AACAV,IAAAA,cAAc,CAAC8I,OAAf,CAAuBwT,KAAK,CAAC5b,EAA7B,EACGzS,IADH,CACQ,UAAS5B,CAAT,EAAY;AAChBA,MAAAA,CAAC,CAAC0c,QAAF,CAAWjiB,MAAX,CAAkBiI,OAAlB,CAA0B,UAASwI,KAAT,EAAgB7H,GAAhB,EAAqB;AAC7C,YAAI6H,KAAK,CAAClX,UAAV,EAAsBw6B,OAAO,CAACnS,IAAR,CAAanR,KAAK,CAAClX,UAAnB,EAA+Bw7B,YAAY,GAACjB,eAAb,GAA+BlrB,GAA9D;AACvB,OAFD;AAIA2qB,MAAAA,MAAM,CAACD,QAAP,CAAgBkC,KAAK,CAAC5b,EAAtB,IAA4BrU,CAA5B;AACAmvB,MAAAA,YAAY;AACZnB,MAAAA,MAAM,CAACoB,WAAP;AAEApB,MAAAA,MAAM,CAAC/vB,MAAP,CAAcqP,KAAd,CAAoB,sBAApB;AACD,KAXH;AAaD,GA1BD;;AA4BA,MAAI4hB,cAAc,GAAG,SAAjBA,cAAiB,GAAW;AAC9B,QAAImB,SAAS,GAAG,EAAhB;AAEA1c,IAAAA,cAAc,CAAC8I,OAAf,CAAuBpI,EAAvB,EAA2BzS,IAA3B,CAAgC,UAASnE,IAAT,EAAe;AAC7C,UAAIA,IAAJ,EAAU;AACRA,QAAAA,IAAI,CAACif,QAAL,CAAcjiB,MAAd,CAAqBiI,OAArB,CAA6B,UAASwI,KAAT,EAAgB7H,GAAhB,EAAqB;AAChD6H,UAAAA,KAAK,CAACiT,MAAN,CAAazb,OAAb,CAAqB,UAASorB,KAAT,EAAe;AAClC,gBAAIA,KAAK,IAAIA,KAAK,CAACzZ,EAAnB,EAAuB;AACrB,kBAAI,CAACgc,SAAS,CAACvC,KAAK,CAACzZ,EAAP,CAAd,EAAyB;AACvBgc,gBAAAA,SAAS,CAACvC,KAAK,CAACzZ,EAAP,CAAT,GAAsBV,cAAc,CAAC8I,OAAf,CAAuBqR,KAAK,CAACzZ,EAA7B,EACnBzS,IADmB,CACd,UAASnE,IAAT,EAAe;AACnB,yBAAO;AACLA,oBAAAA,IAAI,EAAEA,IADD;AAEL4F,oBAAAA,GAAG,EAAEA;AAFA,mBAAP;AAID,iBANmB,CAAtB;AAOD;AACF;AACF,WAZD;AAaD,SAdD;AAeD;;AAAA;AAED,aAAOuR,EAAE,CAACkB,GAAH,CAAOua,SAAP,EACJzuB,IADI,CACC,UAASmsB,QAAT,EAAmB;AACvBC,QAAAA,MAAM,CAACD,QAAP,GAAkB,EAAlB;;AAEA,aAAK,IAAIxL,OAAT,IAAoBwL,QAApB,EAA8B;AAC5B,cAAI95B,OAAO,GAAG85B,QAAQ,CAACxL,OAAD,CAAR,CAAkB9kB,IAAlB,CAAuBif,QAArC;AACA,cAAI8S,YAAY,GAAGzB,QAAQ,CAACxL,OAAD,CAAR,CAAkBlf,GAArC;AAEA2qB,UAAAA,MAAM,CAACD,QAAP,CAAgBxL,OAAhB,IAA2BwL,QAAQ,CAACxL,OAAD,CAAR,CAAkB9kB,IAA7C;AACAxJ,UAAAA,OAAO,CAACwG,MAAR,CAAeiI,OAAf,CAAuB,UAASwI,KAAT,EAAgB7H,GAAhB,EAAqB;AAC1C,gBAAI6H,KAAK,CAAClX,UAAV,EAAsBw6B,OAAO,CAACnS,IAAR,CAAanR,KAAK,CAAClX,UAAnB,EAA+Bw7B,YAAY,GAACjB,eAAb,GAA+BlrB,GAA9D;AACvB,WAFD;AAGD;AACF,OAbI,EAcJzB,IAdI,CAcC,YAAW;AACfzE,QAAAA,QAAQ,CAAC,YAAW;AAClB,cAAImzB,UAAU,GAAG,EAAjB;AACAtC,UAAAA,MAAM,CAACiB,SAAP,GAAmBxxB,IAAI,CAAC7J,KAAxB;AACAo6B,UAAAA,MAAM,CAACvwB,IAAP,GAAcA,IAAI,CAACif,QAAnB;AACD,SAJO,CAAR;AAKD,OApBI,CAAP;AAqBD,KAxCD;AAyCD,GA5CD;;AA8CAwS,EAAAA,cAAc;;AAEd,MAAIjlB,cAAc,GAAG,SAAjBA,cAAiB,CAAS2C,GAAT,EAAc;AACjC,QAAI1C,QAAQ,CAACC,aAAT,CAAuBC,OAAvB,CAA+BC,WAA/B,OAAiD,OAArD,EAA8D;;AAE9D,QAAIuC,GAAG,CAACtC,OAAJ,KAAgB,EAAhB,IAAsBsC,GAAG,CAAC2jB,OAA9B,EAAuC;AACrC5c,MAAAA,cAAc,CAACwF,IAAf,CAAoB9E,EAApB,EAAwBzS,IAAxB,CAA6BstB,cAA7B;AACD;;AAED,QAAItiB,GAAG,CAACtC,OAAJ,KAAgB,EAAhB,IAAsBsC,GAAG,CAAC2jB,OAA9B,EAAuC;AACrC5c,MAAAA,cAAc,CAACyF,IAAf,CAAoB/E,EAApB,EAAwBzS,IAAxB,CAA6BstB,cAA7B;AACD;AACF,GAVD;;AAYAtpB,EAAAA,CAAC,CAACsE,QAAD,CAAD,CAAYS,IAAZ,CAAiB,SAAjB,EAA4BV,cAA5B;AACA+jB,EAAAA,MAAM,CAACxsB,GAAP,CAAW,UAAX,EAAuB,YAAW;AAChCoE,IAAAA,CAAC,CAACsE,QAAD,CAAD,CAAYa,MAAZ,CAAmB,SAAnB,EAA8Bd,cAA9B;AACAukB,IAAAA,OAAO,CAAC7R,OAAR;AACD,GAHD;AAID,CAhUmD,CAApD;AAkUAtqB,gBAAgB,CAAC4K,UAAjB,CAA4B,yBAA5B,EAAuD,CAAC,IAAD,EAAO,YAAP,EAAqB,QAArB,EAA+B,UAA/B,EAA2C,cAA3C,EAA2D,OAA3D,EAAoE,gBAApE,EAAsF,cAAtF,EAAsG,gBAAtG,EAAwH,SAAxH,EAAmI,eAAnI,EAAoJ,QAApJ,EAA8J,YAA9J,EACrD,UAAS2X,EAAT,EAAa0P,UAAb,EAAyB0J,MAAzB,EAAiC7wB,QAAjC,EAA2CixB,YAA3C,EAAyDhxB,KAAzD,EAAgE4N,cAAhE,EAAgF5C,YAAhF,EAA8FuL,cAA9F,EAA8G1I,OAA9G,EAAuHojB,aAAvH,EAAsIC,MAAtI,EAA8I1a,UAA9I,EAA0J;AAC1J,MAAIS,EAAE,GAAG+Z,YAAY,CAAC/Z,EAAtB;AACA,MAAIoa,kBAAkB,GAAG,CAAzB;;AAEAT,EAAAA,MAAM,CAACgB,UAAP,GAAoB,YAAW;AAC7BV,IAAAA,MAAM,CAAClJ,UAAP,CAAkB4I,MAAM,CAACiB,SAAP,CAAiBr3B,IAAnC,EAAyCo2B,MAAM,CAACiB,SAAP,CAAiB5a,EAA1D;AACD,GAFD;;AAIA2Z,EAAAA,MAAM,CAACrrB,KAAP,CAAa,eAAb,EAA8ByrB,YAAY,CAAC95B,OAA3C;;AAEA05B,EAAAA,MAAM,CAACwC,cAAP,GAAwB,UAAStlB,KAAT,EAAgB;AACtChB,IAAAA,QAAQ,CAACoK,QAAT,GAAoB,cAAc8Z,YAAY,CAAC95B,OAA3B,GAAqC,cAArC,GAAsD4W,KAAK,CAAClX,UAAhF;AACD,GAFD;;AAIAg6B,EAAAA,MAAM,CAACH,aAAP,GAAuB,EAAvB;AACAG,EAAAA,MAAM,CAAC5iB,SAAP,GAAmB,EAAnB;AACA4iB,EAAAA,MAAM,CAAC7iB,SAAP,GAAmB,CAAnB;AACA6iB,EAAAA,MAAM,CAAC5P,aAAP,GAAuB,CAAvB;AACA4P,EAAAA,MAAM,CAACyC,UAAP,GAAoB,EAApB;AAEA,MAAIjC,OAAO,GAAGH,aAAa,EAA3B;;AAEA,MAAIK,SAAS,GAAG,SAAZA,SAAY,CAASC,EAAT,EAAa;AAC3B,QAAIvjB,SAAS,GAAG,EAAhB;AACA,WAAOJ,cAAc,GAAC2jB,EAAf,GAAkBX,MAAM,CAAC7iB,SAAzB,GAAmCC,SAA1C;AACD,GAHD;;AAKA4iB,EAAAA,MAAM,CAACY,IAAP,GAAc,UAAS1qB,KAAT,EAAgB;AAC5BuqB,IAAAA,kBAAkB,GAAGC,SAAS,CAACxqB,KAAK,CAACmI,OAAN,GAAgB2hB,MAAM,CAACvwB,IAAP,CAAYuI,UAA7B,CAA9B;AACAgoB,IAAAA,MAAM,CAAC5vB,UAAP,CAAkB,YAAlB,EAAgCqwB,kBAAhC;;AAEA,QAAIT,MAAM,CAAChd,OAAX,EAAoB;AAClBgd,MAAAA,MAAM,CAAChd,OAAP,CAAexY,IAAf;AACAw1B,MAAAA,MAAM,CAAChd,OAAP,GAAiB,IAAjB;AACAgd,MAAAA,MAAM,CAACc,MAAP;AACD;AACF,GATD;;AAWAd,EAAAA,MAAM,CAAC0C,WAAP,GAAqB,YAAW;AAC9B1C,IAAAA,MAAM,CAACyC,UAAP,GAAoBxlB,OAAO,CAACsQ,aAAR,CAAsByS,MAAM,CAACvwB,IAA7B,CAApB;AACAuwB,IAAAA,MAAM,CAACoB,WAAP;AAEApB,IAAAA,MAAM,CAACvwB,IAAP,CAAYhD,MAAZ,CAAmBiI,OAAnB,CAA2B,UAASwI,KAAT,EAAgB7H,GAAhB,EAAqB;AAC9CmrB,MAAAA,OAAO,CAAC5R,IAAR,CAAavZ,GAAb,EAAkB2qB,MAAM,CAACyC,UAAP,CAAkBptB,GAAlB,CAAlB;AACD,KAFD;AAGD,GAPD;;AASA2qB,EAAAA,MAAM,CAAC1O,UAAP,GAAoB,YAAW;AAC7B,QAAI0O,MAAM,CAACiB,SAAP,CAAiBzR,OAArB,EAA8B;AAC5BwQ,MAAAA,MAAM,CAACvwB,IAAP,GAAc,IAAd;AACAuwB,MAAAA,MAAM,CAACiB,SAAP,GAAmB,IAAnB;AACAtb,MAAAA,cAAc,CAAC0L,WAAf,CAA2BhL,EAA3B,EACGzS,IADH,CACQ,YAAW;AACfstB,QAAAA,cAAc;AACf,OAHH;AAIA;AACD;;AAEDvb,IAAAA,cAAc,CAACY,gBAAf,CAAgCF,EAAhC,EACGzS,IADH,CACQ,YAAW;AACfsI,MAAAA,QAAQ,CAACoK,QAAT,GAAoB,cAAc8Z,YAAY,CAAC95B,OAA/C;AACD,KAHH,EAIGkgB,KAJH,CAIS,UAAS/T,GAAT,EAAc;AACnB,UAAIA,GAAG,CAAC1M,IAAJ,IAAY0M,GAAG,CAAC1M,IAAJ,KAAa,YAA7B,EAA2C;AACzC6f,QAAAA,UAAU,CAAC,oBAAD,EAAuB,yBAAvB,CAAV;AACD,OAFD,MAEO;AACL,cAAMnT,GAAN;AACD;AACF,KAVH;AAWD,GAtBD;;AAwBAutB,EAAAA,MAAM,CAAC2C,WAAP,GAAqB,UAASC,QAAT,EAAmB;AACtC5C,IAAAA,MAAM,CAACvwB,IAAP,CAAYhD,MAAZ,GACEuzB,MAAM,CAACvwB,IAAP,CAAYhD,MAAZ,CAAmByZ,KAAnB,CAAyB,CAAzB,EAA4B0c,QAA5B,EACG5sB,MADH,CACUgqB,MAAM,CAACvwB,IAAP,CAAYhD,MAAZ,CAAmByZ,KAAnB,CAAyB0c,QAAQ,GAAC,CAAlC,CADV,CADF;AAIA5C,IAAAA,MAAM,CAACvwB,IAAP,CAAY2gB,aAAZ,GAA4B4P,MAAM,CAACvwB,IAAP,CAAY2gB,aAAZ,GAA4B4P,MAAM,CAACvwB,IAAP,CAAYhD,MAAZ,CAAmBiF,MAA3E;AAEAsuB,IAAAA,MAAM,CAAC0C,WAAP;AACA1C,IAAAA,MAAM,CAACoB,WAAP;AACD,GATD;;AAWApB,EAAAA,MAAM,CAAC6C,QAAP,GAAkB,YAAW;AAC3B7C,IAAAA,MAAM,CAACvwB,IAAP,CAAYhD,MAAZ,CAAmByG,IAAnB,CAAwB;AACtBjO,MAAAA,MAAM,EAAE,EADc;AAEtBorB,MAAAA,MAAM,EAAE;AAFc,KAAxB;AAKA2P,IAAAA,MAAM,CAACvwB,IAAP,CAAY2gB,aAAZ,GAA4B4P,MAAM,CAACvwB,IAAP,CAAYhD,MAAZ,CAAmBiF,MAAnB,GAA4B,CAAxD;AACAsuB,IAAAA,MAAM,CAAC0C,WAAP;AACA1C,IAAAA,MAAM,CAACoB,WAAP;AACD,GATD;;AAYApB,EAAAA,MAAM,CAACx1B,IAAP,GAAc,YAAW;AACvBi2B,IAAAA,kBAAkB,GAAG,CAArB;AAEAT,IAAAA,MAAM,CAAC5vB,UAAP,CAAkB,WAAlB;AACA4vB,IAAAA,MAAM,CAAC5vB,UAAP,CAAkB,YAAlB,EAAgCqwB,kBAAhC;AAEA,QAAIT,MAAM,CAAChd,OAAX,EAAoBgd,MAAM,CAAChd,OAAP,CAAexY,IAAf;AACpBw1B,IAAAA,MAAM,CAAC/vB,MAAP,CAAcqP,KAAd,CAAoB,mBAApB;AACA0gB,IAAAA,MAAM,CAAChd,OAAP,GAAiB,IAAjB;AACD,GATD;;AAWAgd,EAAAA,MAAM,CAACxsB,GAAP,CAAW,aAAX,EAA0B,UAASoL,GAAT,EAAckC,KAAd,EAAqB;AAC7C2f,IAAAA,kBAAkB,GAAG3f,KAArB;AACD,GAFD;;AAIAkf,EAAAA,MAAM,CAAC11B,IAAP,GAAc,YAAW;AACvB,QAAI01B,MAAM,CAAChd,OAAX,EAAoB;AAClBgd,MAAAA,MAAM,CAAChd,OAAP,CAAexY,IAAf;AACAw1B,MAAAA,MAAM,CAAChd,OAAP,GAAiB,IAAjB;AAEAgd,MAAAA,MAAM,CAAC5vB,UAAP,CAAkB,YAAlB;AACA;AACD;;AAED4vB,IAAAA,MAAM,CAACc,MAAP;AACD,GAVD;;AAYAd,EAAAA,MAAM,CAACc,MAAP,GAAgB,YAAW;AACzB1mB,IAAAA,YAAY,CAACyB,WAAb;AAEA,QAAI8H,WAAW,GAAG/L,CAAC,CAAC,eAAD,CAAnB;AAEAgP,IAAAA,EAAE,CAACkB,GAAH,CAAO0Y,OAAO,CAAC1Y,GAAf,EACGlU,IADH,CACQ,UAASyY,WAAT,EAAsB;AAC1B,UAAI2T,MAAM,CAAChd,OAAX,EAAoBgd,MAAM,CAAChd,OAAP,CAAexY,IAAf;;AAEpB,UAAIihB,MAAM,GAAG,SAATA,MAAS,GAAW;AACtBuU,QAAAA,MAAM,CAAC5vB,UAAP,CAAkB,WAAlB;AACA4vB,QAAAA,MAAM,CAAC5vB,UAAP,CAAkB,YAAlB;AACA4vB,QAAAA,MAAM,CAAC/vB,MAAP,CAAcqP,KAAd,CAAoB,sBAApB;AAEAnQ,QAAAA,QAAQ,CAAC,YAAW;AAClB6wB,UAAAA,MAAM,CAAChd,OAAP,GAAiB,IAAjB;AACD,SAFO,CAAR;AAIAyd,QAAAA,kBAAkB,GAAG,CAArB;AACD,OAVD;;AAYA,UAAIx6B,OAAO,GAAGgX,OAAO,CAACmP,cAAR,CAAuB4T,MAAM,CAACvwB,IAA9B,EAAoC4c,WAApC,EAAiD,CAAjD,EAAoDZ,MAApD,EAA4D;AACxEvb,QAAAA,KAAK,EAAEuwB;AADiE,OAA5D,CAAd;AAIAT,MAAAA,MAAM,CAAChd,OAAP,GAAiB/c,OAAO,CAACqE,IAAR,EAAjB;AAEA,UAAIyY,WAAW,GAAG9c,OAAO,CAAC8c,WAAR,EAAlB;AACAid,MAAAA,MAAM,CAAC5vB,UAAP,CAAkB,YAAlB,EAAgC2S,WAAhC;AACD,KAxBH;AAyBD,GA9BD;;AAgCAid,EAAAA,MAAM,CAAC8C,MAAP,GAAgB,YAAW;AACzB9C,IAAAA,MAAM,CAAC7iB,SAAP,GAAmB6iB,MAAM,CAAC7iB,SAAP,GAAmB,CAAtC;AACA,QAAI6iB,MAAM,CAAC7iB,SAAP,GAAmB,EAAvB,EAA2B6iB,MAAM,CAAC7iB,SAAP,GAAmB,EAAnB;AAC5B,GAHD;;AAKA6iB,EAAAA,MAAM,CAAC+C,OAAP,GAAiB,YAAW;AAC1B/C,IAAAA,MAAM,CAAC7iB,SAAP,GAAmB6iB,MAAM,CAAC7iB,SAAP,GAAmB,CAAtC;AACA,QAAI6iB,MAAM,CAAC7iB,SAAP,GAAmB,CAAvB,EAA0B6iB,MAAM,CAAC7iB,SAAP,GAAmB,CAAnB;AAC3B,GAHD;;AAKA6iB,EAAAA,MAAM,CAAC2B,YAAP,GAAsB,YAAW;AAC/B3B,IAAAA,MAAM,CAACiB,SAAP,CAAiB1R,GAAjB,GAAuB5J,cAAc,CAACwN,OAAf,CAAuB,SAAvB,EAAkC6M,MAAM,CAACvwB,IAAzC,CAAvB;AACAkW,IAAAA,cAAc,CAACiP,WAAf,CAA2BvO,EAA3B,EAA+B2Z,MAAM,CAACiB,SAAtC;AACD,GAHD;;AAKAjB,EAAAA,MAAM,CAACoB,WAAP,GAAqBtwB,EAAE,CAACC,QAAH,CAAY,YAAW;AAC1C4U,IAAAA,cAAc,CAAC4K,UAAf,CAA0BlK,EAA1B,EAA8B2Z,MAAM,CAACvwB,IAArC,EACGmE,IADH,CACQosB,MAAM,CAAC2B,YADf;AAED,GAHoB,EAGnB,GAHmB,CAArB;AAKA3B,EAAAA,MAAM,CAACxsB,GAAP,CAAW,cAAX,EAA2B,UAAS0J,KAAT,EAAgB;AACzCkQ,IAAAA,mBAAmB;AACnB4S,IAAAA,MAAM,CAACoB,WAAP;AACD,GAHD;;AAKA,MAAI4B,IAAI,GAAG,SAAPA,IAAO,CAASh9B,UAAT,EAAqB6M,CAArB,EAAwB;AAC/B,QAAI,CAAC7M,UAAL,EAAiB;AACjB,QAAI,CAACA,UAAU,CAAC0V,IAAhB,EAAsB;AAEtB,QAAIunB,WAAJ,EAAiBA,WAAW,CAACz4B,IAAZ;AACjBy4B,IAAAA,WAAW,GAAGj9B,UAAU,CAAC0V,IAAX,CAAgB7I,CAAhB,EAAmBvI,IAAnB,EAAd;AAEA44B,IAAAA,UAAU,CAAC,YAAU;AACnB,UAAID,WAAJ,EAAiBA,WAAW,CAACz4B,IAAZ;AACjBy4B,MAAAA,WAAW,GAAG,IAAd;AACD,KAHS,EAGR,EAHQ,CAAV;AAIH,GAXD;;AAaA,MAAI7V,mBAAmB,GAAG,SAAtBA,mBAAsB,GAAW;AACnC,QAAI,CAAC4S,MAAM,CAACvwB,IAAZ,EAAkB;AAClB,QAAI,CAACuwB,MAAM,CAACvwB,IAAP,CAAYhD,MAAZ,CAAmB,CAAnB,CAAL,EAA4B;AAE5BuzB,IAAAA,MAAM,CAACvwB,IAAP,CAAY6N,YAAZ,GAA2BL,OAAO,CAACmQ,mBAAR,CAA4B4S,MAAM,CAACvwB,IAAnC,EAAyCuwB,MAAM,CAACvwB,IAAP,CAAY4N,OAArD,CAA3B;AACD,GALD;;AAOA,MAAI4lB,WAAJ;;AACA,MAAIE,UAAU,GAAG,SAAbA,UAAa,CAASjmB,KAAT,EAAgB;AAC/B,WAAO8iB,MAAM,CAACyC,UAAP,CAAkBzC,MAAM,CAACvwB,IAAP,CAAYhD,MAAZ,CAAmBiY,OAAnB,CAA2BxH,KAA3B,CAAlB,CAAP;AACD,GAFD;;AAIA8iB,EAAAA,MAAM,CAACxsB,GAAP,CAAW,cAAX,EAA2B,UAASoL,GAAT,EAAc3K,IAAd,EAAoB;AAC7CmZ,IAAAA,mBAAmB;AAEnB,QAAInZ,IAAI,CAAC0K,MAAL,CAAY9L,CAAZ,KAAkBoB,IAAI,CAAC2K,GAAL,CAAS/L,CAA3B,IAAgC,CAACswB,UAAU,CAAClvB,IAAI,CAACiJ,KAAN,CAA/C,EAA6D8lB,IAAI,CAACh9B,UAAU,CAACqiB,GAAX,CAAepU,IAAI,CAACiJ,KAApB,CAAD,EAA6BjJ,IAAI,CAAC2K,GAAL,CAAS/L,CAAtC,CAAJ;AAE7DmtB,IAAAA,MAAM,CAACoB,WAAP;AACD,GAND;AAQApB,EAAAA,MAAM,CAACxsB,GAAP,CAAW,eAAX,EAA4B,UAASoL,GAAT,EAAc3K,IAAd,EAAoB;AAC9C,QAAI,CAACkvB,UAAU,CAAClvB,IAAI,CAACiJ,KAAN,CAAf,EAA6B8lB,IAAI,CAACh9B,UAAU,CAACqiB,GAAX,CAAepU,IAAI,CAACiJ,KAApB,CAAD,EAA6BjJ,IAAI,CAAC2K,GAAL,CAAS/L,CAAtC,CAAJ;AAC9B,GAFD;AAIAmtB,EAAAA,MAAM,CAACvrB,MAAP,CAAc,cAAd,EAA8B2Y,mBAA9B;AAEA,MAAIpnB,UAAU,GAAG,IAAI+gB,OAAJ,EAAjB;;AAEAiZ,EAAAA,MAAM,CAACoD,gBAAP,GAA0B,UAAS9U,OAAT,EAAkB;AAC1C,QAAI,CAAC0R,MAAM,CAACvwB,IAAP,CAAYhD,MAAZ,CAAmB6hB,OAAnB,CAAL,EAAkC;AAClC,QAAI,CAAC0R,MAAM,CAACvwB,IAAP,CAAYhD,MAAZ,CAAmB6hB,OAAnB,EAA4BtoB,UAAjC,EAA6C;AAE7C,WAAO4gB,EAAE,CAACkB,GAAH,CAAO;AACZub,MAAAA,WAAW,EAAE7C,OAAO,CAACnS,IAAR,CAAa2R,MAAM,CAACvwB,IAAP,CAAYhD,MAAZ,CAAmB6hB,OAAnB,EAA4BtoB,UAAzC,EAAqDsoB,OAArD,CADD;AAEZ1oB,MAAAA,KAAK,EAAE+f,cAAc,CAACoP,QAAf,CAAwBiL,MAAM,CAACvwB,IAAP,CAAYhD,MAAZ,CAAmB6hB,OAAnB,EAA4BtoB,UAApD;AAFK,KAAP,EAGJ4N,IAHI,CAGC,UAAS0H,MAAT,EAAiB;AACrB0kB,MAAAA,MAAM,CAACH,aAAP,CAAqBG,MAAM,CAACvwB,IAAP,CAAYhD,MAAZ,CAAmB6hB,OAAnB,EAA4BtoB,UAAjD,IAA+DsV,MAAM,CAAC1V,KAAtE;AACA,UAAI0V,MAAM,CAAC+nB,WAAX,EAAwBr9B,UAAU,CAACkiB,GAAX,CAAe8X,MAAM,CAACvwB,IAAP,CAAYhD,MAAZ,CAAmB6hB,OAAnB,CAAf,EAA4ChT,MAAM,CAAC+nB,WAAnD;AACxB,aAAO/nB,MAAM,CAAC+nB,WAAd;AACH,KAPM,CAAP;AAQD,GAZD;;AAcArD,EAAAA,MAAM,CAAC/pB,cAAP,GAAwB,UAASjQ,UAAT,EAAoBkQ,KAApB,EAA2B;AACjDkE,IAAAA,YAAY,CAACyB,WAAb;AAEA,QACE7V,UAAU,CAACD,IAAX,KAAoB,YAApB,IACAC,UAAU,CAACD,IAAX,KAAoB,OAFtB,EAGE;AAEF,QAAIuoB,OAAO,GAAG0R,MAAM,CAACvwB,IAAP,CAAY2gB,aAA1B;AAEA4P,IAAAA,MAAM,CAACvwB,IAAP,CAAYhD,MAAZ,GAAqBuzB,MAAM,CAACvwB,IAAP,CAAYhD,MAAZ,IAAsB,EAA3C;AACAuzB,IAAAA,MAAM,CAACvwB,IAAP,CAAYhD,MAAZ,CAAmB6hB,OAAnB,IAA8B0R,MAAM,CAACvwB,IAAP,CAAYhD,MAAZ,CAAmB6hB,OAAnB,KAA+B,EAA7D;AACA0R,IAAAA,MAAM,CAACvwB,IAAP,CAAYhD,MAAZ,CAAmB6hB,OAAnB,EAA4BtoB,UAA5B,GAAyCA,UAAU,CAACqgB,EAApD;AAEAV,IAAAA,cAAc,CAAC4K,UAAf,CAA0BlK,EAA1B,EAA8B2Z,MAAM,CAACvwB,IAArC;AACAuwB,IAAAA,MAAM,CAACoD,gBAAP,CAAwB9U,OAAxB,EACG1a,IADH,CACQ,UAASyvB,WAAT,EAAsB;AAC1BrD,MAAAA,MAAM,CAAC0C,WAAP;AACA,UAAI,CAAC1C,MAAM,CAACyC,UAAP,CAAkBnU,OAAlB,CAAL,EAAiC0U,IAAI,CAACK,WAAD,EAAc,EAAd,CAAJ;AAClC,KAJH;AAKD,GApBD;;AAsBA,MAAInC,cAAc,GAAG,SAAjBA,cAAiB,GAAW;AAC9Bvb,IAAAA,cAAc,CAAC8I,OAAf,CAAuBpI,EAAvB,EAA2BzS,IAA3B,CAAgC,UAASnE,IAAT,EAAe;AAC7CN,MAAAA,QAAQ,CAAC,YAAW;AAClB,YAAImzB,UAAU,GAAG,EAAjB;AACAtC,QAAAA,MAAM,CAACiB,SAAP,GAAmBxxB,IAAI,CAAC7J,KAAxB;AACAo6B,QAAAA,MAAM,CAACvwB,IAAP,GAAcA,IAAI,CAACif,QAAnB;AACAsR,QAAAA,MAAM,CAACyC,UAAP,GAAoBxlB,OAAO,CAACsQ,aAAR,CAAsByS,MAAM,CAACvwB,IAA7B,CAApB;AACAuwB,QAAAA,MAAM,CAAC0C,WAAP;AAEA,YAAI,CAAC1C,MAAM,CAACvwB,IAAP,CAAYhD,MAAjB,EAAyBuzB,MAAM,CAACvwB,IAAP,CAAYhD,MAAZ,GAAmB,CAAC,EAAD,CAAnB;AAEzBuzB,QAAAA,MAAM,CAACvwB,IAAP,CAAYhD,MAAZ,CAAmBiI,OAAnB,CAA2B,UAASwI,KAAT,EAAgB7H,GAAhB,EAAqB;AAC9C6H,UAAAA,KAAK,CAACjY,MAAN,GAAeiY,KAAK,CAACjY,MAAN,IAAgB,EAA/B;AACA+6B,UAAAA,MAAM,CAACoD,gBAAP,CAAwB/tB,GAAxB;AACD,SAHD;AAID,OAbO,CAAR;AAcD,KAfD;AAgBD,GAjBD;;AAmBA6rB,EAAAA,cAAc,GAlR4I,CAoR1J;;AAEA,MAAIjlB,cAAc,GAAG,SAAjBA,cAAiB,CAAS2C,GAAT,EAAc;AACjC,QAAI1C,QAAQ,CAACC,aAAT,CAAuBC,OAAvB,CAA+BC,WAA/B,OAAiD,OAArD,EAA8D;;AAE9D,QAAIuC,GAAG,CAACtC,OAAJ,KAAgB,EAAhB,IAAsBsC,GAAG,CAAC2jB,OAA9B,EAAuC;AACrC5c,MAAAA,cAAc,CAACwF,IAAf,CAAoB9E,EAApB,EAAwBzS,IAAxB,CAA6BstB,cAA7B;AACD;;AAED,QAAItiB,GAAG,CAACtC,OAAJ,KAAgB,EAAhB,IAAsBsC,GAAG,CAAC2jB,OAA9B,EAAuC;AACrC5c,MAAAA,cAAc,CAACyF,IAAf,CAAoB/E,EAApB,EAAwBzS,IAAxB,CAA6BstB,cAA7B;AACD;AACF,GAVD;;AAYA,MAAIoC,UAAU,GAAG1rB,CAAC,CAAC,oBAAD,CAAlB;AAEA0rB,EAAAA,UAAU,CAAC3mB,IAAX,CAAgB,OAAhB,EAAyBvC,YAAY,CAACyB,WAAtC;AACAjE,EAAAA,CAAC,CAACsE,QAAD,CAAD,CAAYS,IAAZ,CAAiB,SAAjB,EAA4BV,cAA5B;AACA+jB,EAAAA,MAAM,CAACxsB,GAAP,CAAW,UAAX,EAAuB,YAAW;AAChC8vB,IAAAA,UAAU,CAACvmB,MAAX,CAAkB,OAAlB,EAA2B3C,YAAY,CAACyB,WAAxC;AACAjE,IAAAA,CAAC,CAACsE,QAAD,CAAD,CAAYa,MAAZ,CAAmB,SAAnB,EAA8Bd,cAA9B;AAEAukB,IAAAA,OAAO,CAAC7R,OAAR;AACD,GALD;AAOAqR,EAAAA,MAAM,CAACxsB,GAAP,CAAW,aAAX,EAA0B,UAASoL,GAAT,EAAc1B,KAAd,EAAqB;AAC7C8iB,IAAAA,MAAM,CAACvwB,IAAP,CAAY2gB,aAAZ,GAA4B4P,MAAM,CAACvwB,IAAP,CAAYhD,MAAZ,CAAmBiY,OAAnB,CAA2BxH,KAA3B,CAA5B;AACD,GAFD;AAIA8iB,EAAAA,MAAM,CAACxsB,GAAP,CAAW,oBAAX,EAAiC,UAASoL,GAAT,EAAc1I,KAAd,EAAqB;AACpD/G,IAAAA,QAAQ,CAAC,YAAW;AAClB6wB,MAAAA,MAAM,CAAC5vB,UAAP,CAAkB,kBAAlB,EAAsC8F,KAAtC;AACD,KAFO,CAAR;AAGD,GAJD;AAKD,CAvTsD,CAAvD;AAyTA7R,gBAAgB,CAAC4K,UAAjB,CAA4B,kBAA5B,EAAgD,CAAC,QAAD,EAAW,IAAX,EAAiB,UAAjB,EAA6B,cAA7B,EAA6C,OAA7C,EAAsD,cAAtD,EAAsE,gBAAtE,EAAwF,oBAAxF,EAA8G,QAA9G,EAAwH,UAAS+wB,MAAT,EAAiBpZ,EAAjB,EAAqBzX,QAArB,EAA+BixB,YAA/B,EAA6ChxB,KAA7C,EAAoDgL,YAApD,EAAkEuL,cAAlE,EAAkFpW,kBAAlF,EAAsG+wB,MAAtG,EAA8G;AACpR,MAAIja,EAAE,GAAG+Z,YAAY,CAAC/Z,EAAtB;AACA2Z,EAAAA,MAAM,CAACrrB,KAAP,CAAa,eAAb,EAA8ByrB,YAAY,CAAC95B,OAA3C;;AAEA05B,EAAAA,MAAM,CAACgB,UAAP,GAAoB,YAAW;AAC7BV,IAAAA,MAAM,CAAClJ,UAAP,CAAkB4I,MAAM,CAACiB,SAAP,CAAiBr3B,IAAnC,EAAyCo2B,MAAM,CAACiB,SAAP,CAAiB5a,EAA1D;AACD,GAFD;;AAIA2Z,EAAAA,MAAM,CAAC1O,UAAP,GAAoB,YAAW;AAC7BxI,IAAAA,UAAU;;AAEV,QAAIkX,MAAM,CAACiB,SAAP,CAAiBzR,OAArB,EAA8B;AAC5BwQ,MAAAA,MAAM,CAACvwB,IAAP,GAAc,IAAd;AACAuwB,MAAAA,MAAM,CAACiB,SAAP,GAAmB,IAAnB;AACAtb,MAAAA,cAAc,CAAC0L,WAAf,CAA2BhL,EAA3B,EACGzS,IADH,CACQ,YAAW;AACfstB,QAAAA,cAAc;AACf,OAHH;AAIA;AACD,KARD,MAQO;AACLvb,MAAAA,cAAc,CAACY,gBAAf,CAAgCF,EAAhC,EACGzS,IADH,CACQ,YAAW;AACfsI,QAAAA,QAAQ,CAACoK,QAAT,GAAoB,cAAc8Z,YAAY,CAAC95B,OAA/C;AACD,OAHH,EAIGkgB,KAJH,CAIS,UAAS/T,GAAT,EAAc;AACnB,YAAIA,GAAG,CAAC1M,IAAJ,IAAY0M,GAAG,CAAC1M,IAAJ,KAAa,YAA7B,EAA2C;AACzC6f,UAAAA,UAAU,CAAC,oBAAD,EAAuB,yBAAvB,CAAV;AACD,SAFD,MAEO;AACL,gBAAMnT,GAAN;AACD;AACF,OAVH;AAWD;AACF,GAxBD;;AA0BA,MAAI8wB,OAAJ;AACA,MAAIrV,kBAAkB,GAAG3e,kBAAkB,CAAC;AAAC6X,IAAAA,OAAO,EAAE;AAAV,GAAD,CAA3C;;AAEA,MAAI0B,UAAU,GAAG,SAAbA,UAAa,GAAW;AAC1B,KAACkX,MAAM,CAAC3T,WAAP,IAAoB,EAArB,EAAyB3X,OAAzB,CAAiC,UAAS1O,UAAT,EAAqB;AACpD,UAAIA,UAAU,CAAC2oB,OAAf,EAAwB3oB,UAAU,CAAC2oB,OAAX;AACzB,KAFD;AAIA,KAACqR,MAAM,CAACwD,SAAP,IAAkB,EAAnB,EAAuB9uB,OAAvB,CAA+B,UAAS8U,QAAT,EAAmB;AAChDwW,MAAAA,MAAM,CAACyD,QAAP,CAAgBja,QAAhB;AACD,KAFD;AAIA,WAAO0E,kBAAkB,CAACpF,UAAnB,EAAP;AACD,GAVD;;AAYA,MAAI4a,kBAAkB,GAAG,SAArBA,kBAAqB,CAAS1xB,CAAT,EAAY;AACnC,QAAI2xB,QAAQ,GAAG,SAAXA,QAAW,CAASpM,CAAT,EAAY;AAAE,aAAOA,CAAC,CAAC/sB,IAAF,EAAP;AAAkB,KAA/C;;AACA,QAAIo5B,QAAQ,GAAG,SAAXA,QAAW,CAASrM,CAAT,EAAY;AAAE,aAAOA,CAAC,CAACjtB,IAAF,EAAP;AAAkB,KAA/C;;AAEA,QAAIu5B,iBAAJ;AACA,QAAIC,eAAJ;;AAEA,QAAIpoB,IAAI,GAAG,SAAPA,IAAO,CAAS7I,CAAT,EAAY;AACrB,UAAIixB,eAAJ,EAAqB,OAAOA,eAAe,CAACpoB,IAAhB,CAAqB7I,CAArB,CAAP;AACrB,UAAIkxB,SAAJ;;AAEA,UAAI,CAACF,iBAAL,EAAwB;AACtBA,QAAAA,iBAAiB,GAAG7xB,CAAC,EAArB;AACD;;AAED+xB,MAAAA,SAAS,GAAGF,iBAAiB,CAACjwB,IAAlB,CAAuB,UAASowB,IAAT,EAAe;AAChDF,QAAAA,eAAe,GAAGE,IAAlB;AACA,eAAOA,IAAI,CAACtoB,IAAL,CAAU7I,CAAV,CAAP;AACD,OAHW,CAAZ;;AAKA,UAAIvI,IAAI,GAAG,SAAPA,IAAO,GAAW;AACpB,YAAI0Y,OAAO,GAAG+gB,SAAS,CAACnwB,IAAV,CAAegwB,QAAf,CAAd;;AAEA,YAAIp5B,IAAI,GAAG,SAAPA,IAAO,GAAW;AACpB,iBAAOwY,OAAO,CAACpP,IAAR,CAAa+vB,QAAb,CAAP;AACD,SAFD;;AAIA,eAAO;AAACn5B,UAAAA,IAAI,EAAEA;AAAP,SAAP;AACD,OARD;;AAUA,aAAO;AAACF,QAAAA,IAAI,EAAEA;AAAP,OAAP;AACD,KAxBD;;AA0BA,WAAO7F,KAAK,CAACw/B,gBAAN,CAAuB;AAC5BvoB,MAAAA,IAAI,EAAEA;AADsB,KAAvB,EAEJwoB,SAFI,CAEM,EAFN,CAAP;AAGD,GApCD;;AAsCA,MAAIC,wBAAwB,GAAG,SAA3BA,wBAA2B,GAAW;AACxC,WAAOjW,kBAAkB,CAACxkB,MAAnB,CAA0Bs2B,MAAM,CAACvwB,IAAjC,CAAP;AACD,GAFD;;AAIA,MAAI2xB,WAAW,GAAGtwB,EAAE,CAACC,QAAH,CAAY,UAASsF,OAAT,EAAkB+tB,OAAlB,EAA2B;AACvD,QAAI,CAACpE,MAAM,CAACvwB,IAAZ,EAAkB;AAElBmX,IAAAA,EAAE,CAAC7X,IAAH,CAAQ,IAAR,EACG6E,IADH,CACQ,YAAW;AACf,aAAOkV,UAAU,EAAjB;AACD,KAHH,EAIGlV,IAJH,CAIQ,YAAW;AACf,aAAO8vB,kBAAkB,CAACS,wBAAD,CAAzB;AACD,KANH,EAOGvwB,IAPH,CAOQ,UAASiU,GAAT,EAAc;AAChB,UAAI,CAACA,GAAL,EAAU;AACRmY,QAAAA,MAAM,CAAC3T,WAAP,GAAqB,EAArB;AACA2T,QAAAA,MAAM,CAACwD,SAAP,GAAmB,EAAnB;AACA;AACD;;AAED,UAAI3b,GAAG,KAAK0b,OAAZ,EAAqB;AACnBvD,QAAAA,MAAM,CAAC3T,WAAP,GAAqB,EAArB;AACA2T,QAAAA,MAAM,CAACwD,SAAP,GAAmB,EAAnB;;AACA,YAAI3b,GAAG,CAACnM,IAAR,EAAc;AACZ;AACAskB,UAAAA,MAAM,CAAC3T,WAAP,CAAmBnZ,IAAnB,CAAwB2U,GAAxB;AACD,SAHD,MAGO,IAAIA,GAAG,CAACvd,IAAR,EAAc;AACnB01B,UAAAA,MAAM,CAACwD,SAAP,CAAiBtwB,IAAjB,CAAsB2U,GAAtB;AACD;AACF;;AAED,UAAIuc,OAAJ,EAAa;AACXze,QAAAA,cAAc,CAAC4K,UAAf,CAA0BlK,EAA1B,EAA8B2Z,MAAM,CAACvwB,IAArC;AACAuwB,QAAAA,MAAM,CAACiB,SAAP,CAAiB7N,OAAjB,GAA2B,IAA3B;AACD;;AACDmQ,MAAAA,OAAO,GAAG1b,GAAV;AACH,KA9BH;AA+BD,GAlCiB,EAkCf,GAlCe,CAAlB;AAmCAmY,EAAAA,MAAM,CAACvrB,MAAP,CAAc,MAAd,EAAsB2sB,WAAtB,EAAmC,IAAnC;;AAEApB,EAAAA,MAAM,CAAC2B,YAAP,GAAsB,YAAW;AAC/Bhc,IAAAA,cAAc,CAACiP,WAAf,CAA2BvO,EAA3B,EAA+B2Z,MAAM,CAACiB,SAAtC;AACD,GAFD;;AAIA,MAAIC,cAAc,GAAG,SAAjBA,cAAiB,GAAW;AAC9Bvb,IAAAA,cAAc,CAAC8I,OAAf,CAAuBpI,EAAvB,EAA2BzS,IAA3B,CAAgC,UAASnE,IAAT,EAAe;AAC7CN,MAAAA,QAAQ,CAAC,YAAW;AAClB,YAAImzB,UAAU,GAAG,EAAjB;AAEAtC,QAAAA,MAAM,CAACsC,UAAP,GAAoBA,UAApB;AACAtC,QAAAA,MAAM,CAACvwB,IAAP,GAAcA,IAAI,CAACif,QAAnB;AACAsR,QAAAA,MAAM,CAACiB,SAAP,GAAmBxxB,IAAI,CAAC7J,KAAxB;AACAo6B,QAAAA,MAAM,CAACna,QAAP,GAAkB,EAAlB;;AAEAma,QAAAA,MAAM,CAACna,QAAP,CAAgBwe,MAAhB,GAAyB,YAAW;AAClCl1B,UAAAA,QAAQ,CAAC,YAAW;AAClB6wB,YAAAA,MAAM,CAAC3T,WAAP,GAAqB,EAArB;AACA2T,YAAAA,MAAM,CAACwD,SAAP,GAAmB,EAAnB;AACD,WAHO,CAAR;AAID,SALD;AAOD,OAfO,CAAR;AAgBD,KAjBD;AAkBD,GAnBD;;AAqBAtC,EAAAA,cAAc;AAEdlB,EAAAA,MAAM,CAACxsB,GAAP,CAAW,cAAX,EAA2B,YAAW;AACpCwsB,IAAAA,MAAM,CAACsE,UAAP,GAAoB,IAApB;AACAlD,IAAAA,WAAW;AACZ,GAHD;AAKApB,EAAAA,MAAM,CAACxsB,GAAP,CAAW,UAAX,EAAuBsV,UAAvB;;AAEAkX,EAAAA,MAAM,CAACuE,SAAP,GAAmB,UAAS/a,QAAT,EAAmB;AACpCA,IAAAA,QAAQ,CAACxG,OAAT,GAAmBwG,QAAQ,CAAClf,IAAT,EAAnB;AACD,GAFD;;AAIA01B,EAAAA,MAAM,CAACyD,QAAP,GAAkB,UAASja,QAAT,EAAmB;AACnC,QAAI,CAACA,QAAQ,CAACxG,OAAd,EAAuB;AACvBwG,IAAAA,QAAQ,CAACxG,OAAT,CAAiBxY,IAAjB;AACAgf,IAAAA,QAAQ,CAACxG,OAAT,GAAmBrH,SAAnB;AACD,GAJD;AAMD,CA5K+C,CAAhD;AA8KAtX,gBAAgB,CAAC4K,UAAjB,CAA4B,gBAA5B,EACE,CAAC,IAAD,EAAO,QAAP,EAAiB,UAAjB,EAA6B,WAA7B,EAA0C,YAA1C,EAAwD,cAAxD,EAAwE,gBAAxE,EAA0F,QAA1F,EAAoG,gBAApG,EAAsH,aAAtH,EAAqI,QAArI,EAA+I,YAA/I,EACA,UAAS2X,EAAT,EAAaoZ,MAAb,EAAqB7wB,QAArB,EAA+B+K,SAA/B,EAA0Coc,UAA1C,EAAsDlc,YAAtD,EAAoEuL,cAApE,EAAoFrW,MAApF,EAA4Fk1B,cAA5F,EAA4G9/B,WAA5G,EAAyH47B,MAAzH,EAAiI1a,UAAjI,EAA6I;AAC7I,MAAI6B,KAAJ;AAEAuY,EAAAA,MAAM,CAACxsB,GAAP,CAAW,eAAX,EAA4B,UAASoL,GAAT,EAAcyH,EAAd,EAAkB;AAC5CuV,IAAAA,aAAa,CAACvV,EAAD,CAAb;AACD,GAFD;;AAIA,MAAIrQ,MAAM,GAAG,SAATA,MAAS,CAAS9D,CAAT,EAAYC,CAAZ,EAAe;AAC1B,WAAOD,CAAC,CAAC8D,MAAF,CAAS7D,CAAT,CAAP;AACD,GAFD;;AAIA,MAAIypB,aAAa,GAAG,SAAhBA,aAAgB,CAASnH,SAAT,EAAoB;AACtC,QAAIgQ,OAAO,GAAG,CAAChQ,SAAD,CAAd;AAEA,WAAO9O,cAAc,CAAC8I,OAAf,CAAuBgG,SAAvB,EAAkC7gB,IAAlC,CAAuC,UAASnE,IAAT,EAAe;AAC3DuwB,MAAAA,MAAM,CAAC15B,OAAP,GAAiBmJ,IAAjB;AAEA,aAAO,CAACA,IAAI,CAAC7J,KAAL,CAAW2pB,GAAX,IAAgB,EAAjB,EAAqBvZ,MAArB,CAA4B,CAACye,SAAD,CAA5B,CAAP;AACD,KAJM,EAIJ7gB,IAJI,CAIC,UAAS9N,MAAT,EAAiB;AACvBk6B,MAAAA,MAAM,CAAC0E,aAAP,GAAuB5+B,MAAM,CAACkQ,MAAP,CAAc,CAAC,MAAD,CAAd,CAAvB;AACA,UAAIlQ,MAAM,CAAC4e,OAAP,CAAe,SAAf,MAA8B,CAAC,CAAnC,EAAsCsb,MAAM,CAAC0E,aAAP,CAAqBxxB,IAArB,CAA0ByI,SAA1B;AACvC,KAPM,EAQN/H,IARM,CAQD2hB,YARC,EASN/O,KATM,CASA,YAAW;AAChBtK,MAAAA,QAAQ,CAACoK,QAAT,GAAoB,GAApB;AACD,KAXM,CAAP;AAYD,GAfD;;AAiBA,MAAIiP,YAAY,GAAGzkB,EAAE,CAACC,QAAH,CAAY,YAAW;AACxC,QAAI4zB,eAAJ,EAAqBA,eAAe,CAAC5O,KAAhB;AACrB4O,IAAAA,eAAe,GAAGhf,cAAc,CAAC2P,MAAf,CAAsB,IAAtB,EAA4B;AAC5ChvB,MAAAA,OAAO,EAAE05B,MAAM,CAAC0E,aAD4B;AACb3+B,MAAAA,IAAI,EAAE,CAAC,YAAD,EAAe,SAAf,EAA0B,MAA1B,EAAkC,IAAlC;AADO,KAA5B,EAEf8vB,OAFe,CAEP,UAASzT,KAAT,EAAgB;AACzBjT,MAAAA,QAAQ,CAAC,YAAW;AAClB6wB,QAAAA,MAAM,CAAC4E,UAAP,GAAoBxiB,KAAK,CAACiT,KAA1B;AACA2K,QAAAA,MAAM,CAAC5d,KAAP,GAAeA,KAAK,CAAC6D,OAArB;AACD,OAHO,CAAR;AAID,KAPiB,CAAlB;AAQD,GAVkB,EAUjB,GAViB,CAAnB;AAYA,MAAI0e,eAAJ;;AACA3E,EAAAA,MAAM,CAAC6E,cAAP,GAAwB,YAAW;AACjC11B,IAAAA,QAAQ,CAAC,YAAW;AAClByI,MAAAA,CAAC,CAAC,gDAAD,CAAD,CAAoD+S,KAApD;AACD,KAFO,CAAR;AAGD,GAJD;;AAMAqV,EAAAA,MAAM,CAAC8E,UAAP,GAAoB,UAAS1iB,KAAT,EAAgB;AAClC,QAAI2iB,YAAY,GAAG,SAAfA,YAAe,CAASt1B,IAAT,EAAe;AAChC,aAAOmX,EAAE,CAAC,UAAS4P,OAAT,EAAkBoG,MAAlB,EAA0B;AAClC,YAAIoI,UAAU,GAAG,IAAIC,UAAJ,EAAjB;;AACAD,QAAAA,UAAU,CAACE,MAAX,GAAoB,UAASv0B,CAAT,EAAY;AAC9B6lB,UAAAA,OAAO,CAAC7lB,CAAC,CAACkN,MAAF,CAASvC,MAAV,CAAP;AACD,SAFD;;AAIA0pB,QAAAA,UAAU,CAACG,OAAX,GAAqB,UAAS1yB,GAAT,EAAc;AACjCmqB,UAAAA,MAAM,CAACnqB,GAAD,CAAN;AACD,SAFD;;AAIAuyB,QAAAA,UAAU,CAACI,UAAX,CAAsB31B,IAAtB;AACD,OAXQ,CAAT;AAYD,KAbD;;AAeA,QAAI41B,YAAJ;;AACA,QAAIhO,UAAU,GAAG,SAAbA,UAAa,CAAS5nB,IAAT,EAAe;AAC9B,aAAO,UAASuX,OAAT,EAAkB;AACvB,eAAO+d,YAAY,CAACt1B,IAAD,CAAZ,CACJmE,IADI,CACC,UAAS0xB,IAAT,EAAe;AACnB,iBAAOhF,MAAM,CAACjJ,UAAP,CAAkBiO,IAAlB,EACJ1xB,IADI,CACC,UAASnE,IAAT,EAAe;AACnB,gBAAIuX,OAAO,IAAIA,OAAO,CAACue,KAAvB,EAA8B;AAC5B,kBAAI91B,IAAI,CAAC1J,IAAL,KAAc,SAAlB,EAA6B;AAC3Bs/B,gBAAAA,YAAY,GAAG,cAAa51B,IAAI,CAAC4W,EAAjC;AACD,eAFD,MAEO;AACLgf,gBAAAA,YAAY,GAAG,cAAa51B,IAAI,CAACnJ,OAAlB,GAA4B,GAA5B,GAAiCmJ,IAAI,CAAC1J,IAAtC,GAA6C,GAA7C,GAAkD0J,IAAI,CAAC4W,EAAtE;AACD;AACF;AACF,WATI,CAAP;AAUD,SAZI,CAAP;AAaD,OAdD;AAeD,KAhBD;;AAkBA,QAAIkR,CAAC,GAAG,IAAR;;AACA,SAAK,IAAIjmB,CAAC,GAAC,CAAX,EAAcA,CAAC,GAAC8Q,KAAK,CAAC1Q,MAAtB,EAA8BJ,CAAC,EAA/B,EAAmC;AACjC,UAAIimB,CAAJ,EAAO;AACLA,QAAAA,CAAC,GAAGA,CAAC,CAAC3jB,IAAF,CAAOyjB,UAAU,CAACjV,KAAK,CAAC9Q,CAAD,CAAN,CAAjB,CAAJ;AACD,OAFD,MAEO;AACLimB,QAAAA,CAAC,GAAGF,UAAU,CAACjV,KAAK,CAAC9Q,CAAD,CAAN,CAAV,CAAqB;AAACi0B,UAAAA,KAAK,EAAE;AAAR,SAArB,CAAJ;AACD;AACF;;AAED,QAAIhO,CAAJ,EAAO;AACLA,MAAAA,CAAC,CAAC3jB,IAAF,CAAO,UAAShO,KAAT,EAAgB;AACrB,YAAIy/B,YAAJ,EAAkBnpB,QAAQ,CAACoK,QAAT,GAAoB+e,YAApB;AACnB,OAFD,EAEG7e,KAFH,CAES,UAAS/T,GAAT,EAAc;AACrB,YAAI4I,QAAQ,GAAGnB,SAAS,CAACvQ,IAAV,CAAe;AAC5BqF,UAAAA,WAAW,EAAE,iCADe;AAE5BC,UAAAA,UAAU,EAAE,gBAFgB;AAG5BsnB,UAAAA,WAAW,EAAE,OAHe;AAI5BC,UAAAA,OAAO,EAAE;AACP9Q,YAAAA,IAAI,EAAE,gBAAW;AACf,qBAAO4Q,UAAU,CAAC,qBAAD,CAAjB;AACD,aAHM;AAIPhxB,YAAAA,KAAK,EAAE,iBAAW;AAChB,qBAAOgxB,UAAU,CAAC,oBAAD,CAAjB;AACD;AANM;AAJmB,SAAf,CAAf;AAaD,OAhBD;AAiBD;AACF,GA/DD;;AAiEA0J,EAAAA,MAAM,CAACwF,cAAP,GAAwB,UAAUC,OAAV,EAAmB;AACzC/gC,IAAAA,WAAW,CAACwsB,OAAZ,CAAoB,MAApB,EAA4BuU,OAA5B;AACAnP,IAAAA,UAAU,CAACoP,GAAX,CAAeD,OAAf;AACD,GAHD;;AAKA/gC,EAAAA,WAAW,CAACuuB,OAAZ,CAAoB,MAApB,EACGrf,IADH,CACQ,UAAS+xB,eAAT,EAA0B;AAC9B,QAAIA,eAAJ,EAAqB3F,MAAM,CAACwF,cAAP,CAAsBG,eAAtB;AAErBx2B,IAAAA,QAAQ,CAAC,YAAW;AAClB6wB,MAAAA,MAAM,CAAC4F,UAAP,GAAoB,IAApB;AACD,KAFO,CAAR;AAGD,GAPH;;AASA5F,EAAAA,MAAM,CAACv3B,OAAP,GAAiB,YAAW;AAC1B;AACA,QAAI4S,QAAQ,GAAGnB,SAAS,CAACvQ,IAAV,CAAe;AAC5BqF,MAAAA,WAAW,EAAE,mCADe;AAE5BC,MAAAA,UAAU,EAAE,kBAFgB;AAG5BunB,MAAAA,OAAO,EAAE;AACPqP,QAAAA,aAAa,EAAE,CAAC,gBAAD,EAAmB,UAASrB,cAAT,EAAyB;AACzD,iBAAOA,cAAc,CAACrF,IAAf,EAAP;AACD,SAFc;AADR;AAHmB,KAAf,CAAf;AASD,GAXD;;AAaAa,EAAAA,MAAM,CAAC7Z,cAAP,GAAwB,YAAW;AACjC;AACA,QAAI9K,QAAQ,GAAGnB,SAAS,CAACvQ,IAAV,CAAe;AAC5BqF,MAAAA,WAAW,EAAE,sCADe;AAE5BC,MAAAA,UAAU,EAAE;AAFgB,KAAf,CAAf;AAID,GAND;;AASAu1B,EAAAA,cAAc,CAACrF,IAAf,GACGvrB,IADH,CACQ,UAASurB,IAAT,EAAe;AACnB,QAAI,CAACA,IAAL,EAAWa,MAAM,CAACv3B,OAAP;AACZ,GAHH;AAKAu3B,EAAAA,MAAM,CAAC/vB,MAAP,GAAgBX,MAAM,CAACY,KAAvB;;AAEA8vB,EAAAA,MAAM,CAAC8F,QAAP,GAAkB,UAASC,OAAT,EAAkB;AAClC,QAAIA,OAAO,CAAChgC,IAAR,KAAiB,YAAjB,IAA+BggC,OAAO,CAAChgC,IAAR,KAAiB,MAAhD,IAAwDggC,OAAO,CAAChgC,IAAR,KAAiB,SAA7E,EAAwF;AACtFmW,MAAAA,QAAQ,CAACoK,QAAT,GAAoB,cAAc0Z,MAAM,CAAC15B,OAAP,CAAeV,KAAf,CAAqBygB,EAAnC,GAAwC,GAAxC,GAA6C0f,OAAO,CAAChgC,IAArD,GAA0D,GAA1D,GAA8DggC,OAAO,CAAC1f,EAA1F;AACD;;AACD,QAAI0f,OAAO,CAAChgC,IAAR,KAAiB,SAArB,EAAgC;AAC9BmW,MAAAA,QAAQ,CAACoK,QAAT,GAAoB,cAAcyf,OAAO,CAAC1f,EAA1C;AACD;AACF,GAPD;;AASA2Z,EAAAA,MAAM,CAACgG,cAAP,GAAwBl1B,EAAE,CAACC,QAAH,CAAY,YAAW;AAC7C,QAAI4zB,eAAJ,EAAqBA,eAAe,CAAC5O,KAAhB;AACrB4O,IAAAA,eAAe,GAAGhf,cAAc,CAAC2P,MAAf,CAAsB0K,MAAM,CAACiG,aAA7B,EAA4C;AAC5D3/B,MAAAA,OAAO,EAAE05B,MAAM,CAAC0E,aAD4C;AAC7B3+B,MAAAA,IAAI,EAAE,CAAC,YAAD,EAAe,SAAf,EAA0B,MAA1B,EAAkC,IAAlC,EAAwC,OAAxC;AADuB,KAA5C,EAEf8vB,OAFe,CAEP,UAASzT,KAAT,EAAgB;AACzB4d,MAAAA,MAAM,CAAC4E,UAAP,GAAoBxiB,KAAK,CAACiT,KAA1B;AACA2K,MAAAA,MAAM,CAAC5d,KAAP,GAAeA,KAAK,CAAC6D,OAArB;AACD,KALiB,CAAlB;AAMD,GARuB,EAQtB,GARsB,CAAxB;;AAUA+Z,EAAAA,MAAM,CAACkG,aAAP,GAAuB,YAAW;AAChCvgB,IAAAA,cAAc,CAACY,gBAAf,CAAgCyZ,MAAM,CAAC15B,OAAP,CAAeV,KAAf,CAAqBygB,EAArD,EACGzS,IADH,CACQ,YAAW;AACfsI,MAAAA,QAAQ,CAACoK,QAAT,GAAoB,GAApB;AACD,KAHH,EAIGE,KAJH,CAIS,UAAS/T,GAAT,EAAc;AACnB,UAAIA,GAAG,CAAC1M,IAAJ,IAAY0M,GAAG,CAAC1M,IAAJ,KAAa,YAA7B,EAA2C;AACzC6f,QAAAA,UAAU,CAAC,oBAAD,EAAuB,iCAAvB,CAAV;AACD,OAFD,MAEO;AACL,cAAMnT,GAAN;AACD;AACF,KAVH;AAWD,GAZD;;AAcAutB,EAAAA,MAAM,CAAC7I,aAAP,GAAuB,YAAW;AAChCmJ,IAAAA,MAAM,CAACnJ,aAAP,CAAqB6I,MAAM,CAAC15B,OAAP,CAAeV,KAAf,CAAqBgE,IAA1C,EAAgDo2B,MAAM,CAAC15B,OAAP,CAAeV,KAAf,CAAqBygB,EAArE;AACD,GAFD;;AAIA2Z,EAAAA,MAAM,CAACmG,eAAP,GAAyB,YAAW;AAClCjsB,IAAAA,SAAS,CAACvQ,IAAV,CAAe;AACbqF,MAAAA,WAAW,EAAE,2CADA;AAEbC,MAAAA,UAAU,EAAE,0BAFC;AAGbunB,MAAAA,OAAO,EAAE;AACPlwB,QAAAA,OAAO,EAAE;AACPsD,UAAAA,IAAI,EAAEo2B,MAAM,CAAC15B,OAAP,CAAeV,KAAf,CAAqBgE,IADpB;AAEP2lB,UAAAA,GAAG,EAAEyQ,MAAM,CAAC15B,OAAP,CAAeV,KAAf,CAAqB2pB;AAFnB,SADF;AAKP6W,QAAAA,UAAU,EAAE,sBAAW;AAAE,iBAAO,WAAP;AAAqB;AALvC;AAHI,KAAf,EAUG9qB,MAVH,CAUU1H,IAVV,CAUe,UAAStN,OAAT,EAAkB;AAC/B05B,MAAAA,MAAM,CAAC15B,OAAP,CAAeV,KAAf,CAAqBgE,IAArB,GAA4BtD,OAAO,CAACsD,IAApC;AACA+b,MAAAA,cAAc,CAACiP,WAAf,CAA2BoL,MAAM,CAAC15B,OAAP,CAAeV,KAAf,CAAqBygB,EAAhD,EAAoD;AAClDtgB,QAAAA,IAAI,EAAE,SAD4C;AAElD6D,QAAAA,IAAI,EAAEtD,OAAO,CAACsD,IAFoC;AAGlD2lB,QAAAA,GAAG,EAAEjpB,OAAO,CAACipB;AAHqC,OAApD,EAKC3b,IALD,CAKM,YAAW;AACfgoB,QAAAA,aAAa,CAACoE,MAAM,CAAC15B,OAAP,CAAeV,KAAf,CAAqBygB,EAAtB,CAAb;AACD,OAPD;AAQD,KApBD;AAqBD,GAtBD;;AAwBA2Z,EAAAA,MAAM,CAACqG,UAAP,GAAoB,YAAW;AAC7B;AACA/P,IAAAA,UAAU,CAAC,aAAD,CAAV,CAA0B1iB,IAA1B,CAA+B,UAAS0yB,WAAT,EAAsB;AACnDpsB,MAAAA,SAAS,CAACvQ,IAAV,CAAe;AACbqF,QAAAA,WAAW,EAAE,2CADA;AAEbC,QAAAA,UAAU,EAAE,0BAFC;AAGbunB,QAAAA,OAAO,EAAE;AACPlwB,UAAAA,OAAO,EAAE;AAACsD,YAAAA,IAAI,EAAE08B;AAAP,WADF;AAEPF,UAAAA,UAAU,EAAE,sBAAW;AAAE,mBAAO,eAAP;AAAyB;AAF3C;AAHI,OAAf,EAOG9qB,MAPH,CAOU1H,IAPV,CAOe,UAAStN,OAAT,EAAkB;AAC/Bqf,QAAAA,cAAc,CAAC2N,UAAf,CAA0B;AAACvtB,UAAAA,IAAI,EAAE,SAAP;AAAkB6D,UAAAA,IAAI,EAAEtD,OAAO,CAACsD,IAAhC;AAAsC2lB,UAAAA,GAAG,EAAEjpB,OAAO,CAACipB;AAAnD,SAA1B,EACG3b,IADH,CACQ,UAASyS,EAAT,EAAa;AACjBnK,UAAAA,QAAQ,CAACoK,QAAT,GAAkB,cAAcD,EAAhC;AACD,SAHH;AAID,OAZD;AAaD,KAdD;AAeD,GAjBD;;AAmBA2Z,EAAAA,MAAM,CAACuG,WAAP,GAAqB,YAAW;AAC9BrsB,IAAAA,SAAS,CAACvQ,IAAV,CAAe;AACbqF,MAAAA,WAAW,EAAE,uCADA;AAEbC,MAAAA,UAAU,EAAE;AAFC,KAAf,EAGGqM,MAHH,CAGU1H,IAHV,CAGe,UAASyS,EAAT,EAAa;AAC1B,UAAImgB,aAAa,GAAG,SAAhBA,aAAgB,CAASC,KAAT,EAAgBC,KAAhB,EAAuB;AACzC,YAAID,KAAK,CAAC1gC,IAAN,KAAe2gC,KAAK,CAAC3gC,IAAzB,EAA+B;AAC7B,cAAI0gC,KAAK,CAAC1gC,IAAN,KAAa,MAAjB,EAAyB,OAAO0gC,KAAP;AACzB,cAAIC,KAAK,CAAC3gC,IAAN,KAAa,MAAjB,EAAyB,OAAO2gC,KAAP;AAEzB,cAAID,KAAK,CAAC1gC,IAAN,KAAa,SAAjB,EAA4B,OAAO0gC,KAAP;AAC5B,cAAIC,KAAK,CAAC3gC,IAAN,KAAa,SAAjB,EAA4B,OAAO2gC,KAAP;AAC7B,SAND,MAMO;AACL,iBAAO,CAACD,KAAK,CAAClX,GAAN,IAAW,EAAZ,EAAgB7d,MAAhB,GAAyB,CAACg1B,KAAK,CAACnX,GAAN,IAAW,EAAZ,EAAgB7d,MAAzC,GAAkD+0B,KAAlD,GAA0DC,KAAjE;AACD;;AAED,eAAOA,KAAP;AACD,OAZD,CAD0B,CAe1B;;;AACA,aAAO/gB,cAAc,CAAC6O,eAAf,CAA+BnO,EAA/B,EACJzS,IADI,CACC,UAASwO,KAAT,EAAgB;AACpB,YAAIA,KAAK,CAAC1Q,MAAN,GAAe,CAAnB,EAAsB;AACpB,cAAIi1B,MAAM,GAAGvkB,KAAK,CAAC2K,MAAN,CAAayZ,aAAb,EAA4BpkB,KAAK,CAAC,CAAD,CAAjC,CAAb;;AACA,cAAIukB,MAAM,IAAIA,MAAM,CAAC5gC,IAAP,KAAgB,SAA9B,EAAyC;AACvCmW,YAAAA,QAAQ,CAACoK,QAAT,GAAoB,cAAcD,EAAd,GAAmB,GAAnB,GAAyBsgB,MAAM,CAAC5gC,IAAhC,GAAqC,GAArC,GAAyC4gC,MAAM,CAACtgB,EAApE;AACD,WAFD,MAEO;AACLnK,YAAAA,QAAQ,CAACoK,QAAT,GAAoB,cAAcD,EAAlC;AACD;AACF,SAPD,MAOO;AACLnK,UAAAA,QAAQ,CAACoK,QAAT,GAAoB,cAAcD,EAAlC;AACD;AACF,OAZI,CAAP;AAaD,KAhCD;AAiCD,GAlCD;;AAoCA2Z,EAAAA,MAAM,CAAC4G,aAAP,GAAuB,YAAW;AAChCtQ,IAAAA,UAAU,CAAC,uBAAD,CAAV,CACG1iB,IADH,CACQ,UAAShK,IAAT,EAAe;AACnB,aAAO+b,cAAc,CAAC2N,UAAf,CAA0B;AAC/BvtB,QAAAA,IAAI,EAAE,YADyB;AAE/B6D,QAAAA,IAAI,EAAEA,IAFyB;AAG/BtD,QAAAA,OAAO,EAAE05B,MAAM,CAAC15B,OAAP,CAAeV,KAAf,CAAqBygB;AAHC,OAA1B,CAAP;AAKD,KAPH,EAQGzS,IARH,CAQQ,UAASyS,EAAT,EAAa;AACjBnK,MAAAA,QAAQ,CAACoK,QAAT,GAAoB,cAAc0Z,MAAM,CAAC15B,OAAP,CAAeV,KAAf,CAAqBygB,EAAnC,GAAwC,cAAxC,GAAyDA,EAA7E;AACD,KAVH,EAWGG,KAXH,CAWS,UAAS/T,GAAT,EAAc;AACnB;AACD,KAbH;AAcD,GAfD;;AAiBAutB,EAAAA,MAAM,CAAC6G,OAAP,GAAiB,YAAW;AAC1BvQ,IAAAA,UAAU,CAAC,iBAAD,CAAV,CACG1iB,IADH,CACQ,UAAShK,IAAT,EAAe;AACnB,aAAO+b,cAAc,CAAC2N,UAAf,CAA0B;AAC/BvtB,QAAAA,IAAI,EAAE,MADyB;AAE/B6D,QAAAA,IAAI,EAAEA,IAFyB;AAG/BtD,QAAAA,OAAO,EAAE05B,MAAM,CAAC15B,OAAP,CAAeV,KAAf,CAAqBygB;AAHC,OAA1B,CAAP;AAKD,KAPH,EAQGzS,IARH,CAQQ,UAASyS,EAAT,EAAa;AACjBnK,MAAAA,QAAQ,CAACoK,QAAT,GAAoB,cAAc0Z,MAAM,CAAC15B,OAAP,CAAeV,KAAf,CAAqBygB,EAAnC,GAAwC,QAAxC,GAAiDA,EAArE;AACD,KAVH;AAWD,GAZD;;AAcA2Z,EAAAA,MAAM,CAAC8G,UAAP,GAAoB,YAAW;AAC7BxQ,IAAAA,UAAU,CAAC,oBAAD,CAAV,CACG1iB,IADH,CACQ,UAAShK,IAAT,EAAe;AACnB,aAAO+b,cAAc,CAAC2N,UAAf,CAA0B;AAC/BvtB,QAAAA,IAAI,EAAE,SADyB;AAE/B6D,QAAAA,IAAI,EAAEA,IAFyB;AAG/BtD,QAAAA,OAAO,EAAE05B,MAAM,CAAC15B,OAAP,CAAeV,KAAf,CAAqBygB;AAHC,OAA1B,CAAP;AAKD,KAPH,EAQGzS,IARH,CAQQ,UAASyS,EAAT,EAAa;AACjBnK,MAAAA,QAAQ,CAACoK,QAAT,GAAoB,cAAc0Z,MAAM,CAAC15B,OAAP,CAAeV,KAAf,CAAqBygB,EAAnC,GAAwC,WAAxC,GAAoDA,EAAxE;AACD,KAVH;AAWD,GAZD;;AAeA2Z,EAAAA,MAAM,CAACr3B,KAAP,GAAe,YAAW;AACxBuR,IAAAA,SAAS,CAACvQ,IAAV,CAAe;AACbqF,MAAAA,WAAW,EAAE,iCADA;AAEbC,MAAAA,UAAU,EAAE;AAFC,KAAf;AAID,GALD;;AAOA+wB,EAAAA,MAAM,CAACr4B,IAAP,GAAc,YAAW;AACvBuS,IAAAA,SAAS,CAACvQ,IAAV,CAAe;AACbqF,MAAAA,WAAW,EAAE,gCADA;AAEbC,MAAAA,UAAU,EAAE;AAFC,KAAf;AAID,GALD;;AAOA+wB,EAAAA,MAAM,CAAC+G,IAAP,GAAc,YAAW;AACvB7sB,IAAAA,SAAS,CAACvQ,IAAV,CAAe;AACbqF,MAAAA,WAAW,EAAE,gBADA;AAEbC,MAAAA,UAAU,EAAE;AAFC,KAAf;AAID,GALD;AAMD,CAlVC,CADF;AAqVA5K,gBAAgB,CAAC4K,UAAjB,CAA4B,eAA5B,EAA6C,CAAC,QAAD,EAAW,mBAAX,EAAgC,UAAS+wB,MAAT,EAAiBC,iBAAjB,EAAoC;AAC/GD,EAAAA,MAAM,CAACx2B,OAAP,GAAiB,YAAW;AAC1By2B,IAAAA,iBAAiB,CAACz2B,OAAlB;AACD,GAFD;AAGD,CAJ4C,CAA7C;;;ACvrCA,IAAInF,gBAAgB,GAAGC,OAAO,CAACC,MAAR,CAAe,kBAAf,CAAvB;AACAF,gBAAgB,CAAC4K,UAAjB,CAA4B,gBAA5B,EAA8C,CAAC,QAAD,EAAW,mBAAX,EAAgC,MAAhC,EAAwC,OAAxC,EAAiD,UAAS+wB,MAAT,EAAiBC,iBAAjB,EAAoCva,IAApC,EAA0CpgB,KAA1C,EAAiD;AAC9I06B,EAAAA,MAAM,CAACta,IAAP,GAAcA,IAAd;AACAsa,EAAAA,MAAM,CAAC16B,KAAP,GAAeA,KAAf;;AACA06B,EAAAA,MAAM,CAACx2B,OAAP,GAAiB,YAAW;AAC1By2B,IAAAA,iBAAiB,CAACz2B,OAAlB;AACD,GAFD;AAGD,CAN6C,CAA9C;;;ACDA,IAAInF,gBAAgB,GAAGC,OAAO,CAACC,MAAR,CAAe,kBAAf,CAAvB;AACAF,gBAAgB,CAAC4K,UAAjB,CAA4B,eAA5B,EAA6C,CAAC,QAAD,EAAW,mBAAX,EAAgC,UAAS+wB,MAAT,EAAiBC,iBAAjB,EAAoC;AAC/GD,EAAAA,MAAM,CAACx2B,OAAP,GAAiB,YAAW;AAC1By2B,IAAAA,iBAAiB,CAACz2B,OAAlB;AACD,GAFD;AAGD,CAJ4C,CAA7C;;;ACDA,IAAInF,gBAAgB,GAAGC,OAAO,CAACC,MAAR,CAAe,kBAAf,CAAvB;AACAF,gBAAgB,CAAC4K,UAAjB,CAA4B,uBAA5B,EAAqD,CAAC,QAAD,EAAW,IAAX,EAAiB,UAAjB,EAA6B,mBAA7B,EAAkD,MAAlD,EAA0D,UAAS+wB,MAAT,EAAiBpZ,EAAjB,EAAqBzX,QAArB,EAA+B8wB,iBAA/B,EAAkD9lB,IAAlD,EAAwD;AACrKA,EAAAA,IAAI,CAACyf,SAAL,GAAiBhmB,IAAjB,CAAsB,UAAS9O,MAAT,EAAiB;AACrCk7B,IAAAA,MAAM,CAACl7B,MAAP,GAAgBA,MAAhB;AACD,GAFD;AAIAqV,EAAAA,IAAI,CAAC8f,SAAL,GAAiBrmB,IAAjB,CAAsB,UAAS1F,MAAT,EAAiB;AACrC8xB,IAAAA,MAAM,CAAC9xB,MAAP,GAAgBA,MAAhB;AACD,GAFD;;AAIA8xB,EAAAA,MAAM,CAACgH,YAAP,GAAsB,YAAW;AAC/B7sB,IAAAA,IAAI,CAAC+f,SAAL,CAAe8F,MAAM,CAAC9xB,MAAtB;AACD,GAFD;;AAIA8xB,EAAAA,MAAM,CAACrG,IAAP,GAAc,YAAW;AACvBsG,IAAAA,iBAAiB,CAAClK,KAAlB;AACD,GAFD;AAGD,CAhBoD,CAArD;;;ACDA,IAAI1xB,gBAAgB,GAAGC,OAAO,CAACC,MAAR,CAAe,kBAAf,CAAvB;AACAF,gBAAgB,CAAC4K,UAAjB,CAA4B,sBAA5B,EAAoD,CAAC,IAAD,EAAO,QAAP,EAAiB,mBAAjB,EAAsC,gBAAtC,EAAwD,UAAS2X,EAAT,EAAaoZ,MAAb,EAAqBC,iBAArB,EAAwCta,cAAxC,EAAwD;AAClK,MAAIgf,eAAJ;;AACA,MAAIsC,qBAAqB,GAAG,SAAxBA,qBAAwB,GAAW;AACrC,QAAItC,eAAJ,EAAqBA,eAAe,CAAC5O,KAAhB;AACrB4O,IAAAA,eAAe,GAAGhf,cAAc,CAAC2P,MAAf,CAAsB0K,MAAM,CAACiG,aAA7B,EAA4C;AAAClgC,MAAAA,IAAI,EAAE,CAAC,SAAD;AAAP,KAA5C,EACf8vB,OADe,CACP,UAASzT,KAAT,EAAgB;AACvB4d,MAAAA,MAAM,CAAC4E,UAAP,GAAoBxiB,KAAK,CAACiT,KAA1B;AACA2K,MAAAA,MAAM,CAAC5d,KAAP,GAAeA,KAAK,CAAC6D,OAArB;AACD,KAJe,CAAlB;AAKD,GAPD;;AASA+Z,EAAAA,MAAM,CAACzK,YAAP,GAAsBzkB,EAAE,CAACC,QAAH,CAAYk2B,qBAAZ,EAAkC,GAAlC,CAAtB;;AACAjH,EAAAA,MAAM,CAACv2B,MAAP,GAAgB,YAAW;AACzBw2B,IAAAA,iBAAiB,CAACz2B,OAAlB;AACD,GAFD;;AAIAw2B,EAAAA,MAAM,CAACkH,MAAP,GAAgB,UAASzS,SAAT,EAAoB;AAClCuL,IAAAA,MAAM,CAAC3gB,QAAP,GAAkBoV,SAAlB;AACD,GAFD;;AAIAuL,EAAAA,MAAM,CAACr2B,IAAP,GAAc,UAAS8qB,SAAT,EAAoB;AAChCwL,IAAAA,iBAAiB,CAAClK,KAAlB,CAAwBtB,SAAxB;AACD,GAFD;;AAIAwS,EAAAA,qBAAqB;AACtB,CAzBmD,CAApD;;;ACDA,IAAI5iC,gBAAgB,GAAGC,OAAO,CAACC,MAAR,CAAe,kBAAf,CAAvB;AACAF,gBAAgB,CAAC4K,UAAjB,CAA4B,0BAA5B,EAAwD,CAAC,IAAD,EAAO,QAAP,EAAiB,mBAAjB,EAAsC,gBAAtC,EAAwD,SAAxD,EAAmE,YAAnE,EAAiF,UAAS2X,EAAT,EAAaoZ,MAAb,EAAqBC,iBAArB,EAAwCta,cAAxC,EAAwDrf,OAAxD,EAAiE8/B,UAAjE,EAA6E;AACpN,MAAIzB,eAAJ;;AACA,MAAIsC,qBAAqB,GAAG,SAAxBA,qBAAwB,GAAW;AACrC,QAAItC,eAAJ,EAAqBA,eAAe,CAAC5O,KAAhB;AACrB4O,IAAAA,eAAe,GAAGhf,cAAc,CAAC2P,MAAf,CAAsB0K,MAAM,CAACiG,aAA7B,EAA4C;AAAClgC,MAAAA,IAAI,EAAE,CAAC,SAAD;AAAP,KAA5C,EACf8vB,OADe,CACP,UAASzT,KAAT,EAAgB;AACvB4d,MAAAA,MAAM,CAAC4E,UAAP,GAAoBxiB,KAAK,CAACiT,KAA1B;AACA2K,MAAAA,MAAM,CAAC5d,KAAP,GAAeA,KAAK,CAAC6D,OAArB;AACD,KAJe,CAAlB;AAKD,GAPD;;AASA+Z,EAAAA,MAAM,CAAC15B,OAAP,GAAiBA,OAAjB;AACA05B,EAAAA,MAAM,CAACoG,UAAP,GAAoBA,UAApB;;AAEA,MAAIrR,QAAQ,GAAG,SAAXA,QAAW,CAAS1O,EAAT,EAAa;AAC1B,WAAOV,cAAc,CAAC8I,OAAf,CAAuBpI,EAAvB,EACJzS,IADI,CACC,UAASnE,IAAT,EAAe;AACnB,aAAOA,IAAI,CAAC7J,KAAZ;AACD,KAHI,CAAP;AAID,GALD;;AAOAo6B,EAAAA,MAAM,CAACne,IAAP,GAAc,EAAd;AACA+E,EAAAA,EAAE,CAACkB,GAAH,CAAO,CAACkY,MAAM,CAAC15B,OAAP,CAAeipB,GAAf,IAAoB,EAArB,EAAyBrb,GAAzB,CAA6B6gB,QAA7B,CAAP,EACGnhB,IADH,CACQ,UAASiO,IAAT,EAAe;AACnBme,IAAAA,MAAM,CAACne,IAAP,GAAcA,IAAd;AACD,GAHH;AAKAme,EAAAA,MAAM,CAACzK,YAAP,GAAsBzkB,EAAE,CAACC,QAAH,CAAYk2B,qBAAZ,EAAkC,GAAlC,CAAtB;;AACAjH,EAAAA,MAAM,CAACv2B,MAAP,GAAgB,YAAW;AACzBw2B,IAAAA,iBAAiB,CAACz2B,OAAlB;AACD,GAFD;;AAIAw2B,EAAAA,MAAM,CAACrG,IAAP,GAAc,YAAW;AACvBqG,IAAAA,MAAM,CAAC15B,OAAP,CAAeipB,GAAf,GAAqByQ,MAAM,CAACne,IAAP,CAAY3N,GAAZ,CAAgB0d,KAAhB,CAArB;AACAqO,IAAAA,iBAAiB,CAAClK,KAAlB,CAAwBiK,MAAM,CAAC15B,OAA/B;AACD,GAHD;;AAKA,MAAIsrB,KAAK,GAAG,SAARA,KAAQ,CAAS3e,CAAT,EAAY;AAAE,WAAOA,CAAC,CAACoT,EAAT;AAAc,GAAxC;;AACA2Z,EAAAA,MAAM,CAAC51B,MAAP,GAAgB,UAASqF,IAAT,EAAe;AAC7BuwB,IAAAA,MAAM,CAACne,IAAP,GAAcme,MAAM,CAACne,IAAP,CAAY/b,MAAZ,CAAmB,UAASkM,CAAT,EAAY;AAC3C,aAAOA,CAAC,CAACqU,EAAF,KAAS5W,IAAI,CAAC4W,EAArB;AACD,KAFa,CAAd;AAGD,GAJD;;AAMA2Z,EAAAA,MAAM,CAACp1B,GAAP,GAAa,UAAS6E,IAAT,EAAe;AAC1B,QAAIuwB,MAAM,CAACne,IAAP,CAAY3N,GAAZ,CAAgB0d,KAAhB,EAAuBlN,OAAvB,CAA+BjV,IAAI,CAAC4W,EAApC,MAA4C,CAAC,CAAjD,EAAoD;AAClD2Z,MAAAA,MAAM,CAACne,IAAP,CAAY3O,IAAZ,CAAiBzD,IAAjB;AACD;AACF,GAJD;;AAMAw3B,EAAAA,qBAAqB;AACtB,CAnDuD,CAAxD;;;ACDA,IAAI5iC,gBAAgB,GAAGC,OAAO,CAACC,MAAR,CAAe,kBAAf,CAAvB;AACAF,gBAAgB,CAAC4K,UAAjB,CAA4B,qBAA5B,EAAmD,CAAC,QAAD,EAAW,UAAX,EAAuB,mBAAvB,EAA4C,gBAA5C,EAA8D,UAAS+wB,MAAT,EAAiB7wB,QAAjB,EAA2B8wB,iBAA3B,EAA8Cta,cAA9C,EAA8D;AAC7Kqa,EAAAA,MAAM,CAACx2B,OAAP,GAAiB,YAAW;AAC1By2B,IAAAA,iBAAiB,CAACz2B,OAAlB;AACD,GAFD;;AAIA,MAAIy9B,qBAAqB,GAAG,SAAxBA,qBAAwB,GAAW;AACrCthB,IAAAA,cAAc,CAACI,cAAf,CAA8Bia,MAAM,CAACiG,aAArC,EAAoD;AAACjgB,MAAAA,KAAK,EAAE;AAAR,KAApD,EACGpS,IADH,CACQ,UAASqS,OAAT,EAAkB;AACtB9W,MAAAA,QAAQ,CAAC,YAAW;AAClB6wB,QAAAA,MAAM,CAAC5d,KAAP,GAAe6D,OAAO,CAACA,OAAvB;AACA+Z,QAAAA,MAAM,CAAC4E,UAAP,GAAoB3e,OAAO,CAACoP,KAA5B;AACD,OAHO,CAAR;AAID,KANH;AAOD,GARD;;AAUA2K,EAAAA,MAAM,CAACzK,YAAP,GAAsBzkB,EAAE,CAACC,QAAH,CAAYk2B,qBAAZ,EAAkC,GAAlC,CAAtB;;AAEAjH,EAAAA,MAAM,CAAC5Z,qBAAP,GAA+B,UAAS3W,IAAT,EAAe;AAC5CkW,IAAAA,cAAc,CAACS,qBAAf,CAAqC3W,IAAI,CAAC4W,EAA1C,EAA8CzS,IAA9C,CAAmDqzB,qBAAnD;AACD,GAFD;;AAIAA,EAAAA,qBAAqB;AACtB,CAtBkD,CAAnD;;;ACDA,IAAI5iC,gBAAgB,GAAGC,OAAO,CAACC,MAAR,CAAe,kBAAf,CAAvB;AACAF,gBAAgB,CAAC4K,UAAjB,CAA4B,kBAA5B,EAAgD,CAAC,IAAD,EAAO,QAAP,EAAiB,mBAAjB,EAAsC,QAAtC,EAAgD,gBAAhD,EAAkE,eAAlE,EAAmF,UAAS2X,EAAT,EAAaoZ,MAAb,EAAqBC,iBAArB,EAAwC3wB,MAAxC,EAAgDk1B,cAAhD,EAAgEqB,aAAhE,EAA+E;AAChN7F,EAAAA,MAAM,CAAC6F,aAAP,GAAuBA,aAAvB;AAEA,MAAIsB,WAAW,GAAGvgB,EAAE,CAAC7X,IAAH,CAAQ,IAAR,CAAlB;;AACAixB,EAAAA,MAAM,CAACoH,UAAP,GAAoB,YAAW;AAC7BD,IAAAA,WAAW,GAAG3C,cAAc,CAACpF,OAAf,CAAuBY,MAAM,CAAC6F,aAA9B,CAAd;AACD,GAFD;;AAIA7F,EAAAA,MAAM,CAACx2B,OAAP,GAAiB,YAAW;AAC1B29B,IAAAA,WAAW,CACRvzB,IADH,CACQ,YAAW;AACfqsB,MAAAA,iBAAiB,CAACz2B,OAAlB;AACD,KAHH;AAKD,GAND;;AAQAw2B,EAAAA,MAAM,CAACqH,QAAP,GAAkB,YAAW;AAC3BF,IAAAA,WAAW,CACRvzB,IADH,CACQ,YAAW;AACfqsB,MAAAA,iBAAiB,CAACz2B,OAAlB;AACA8F,MAAAA,MAAM,CAACY,KAAP,CAAa,OAAb;AACD,KAJH;AAKD,GAND;AAOD,CAvB+C,CAAhD","file":"site.js","sourcesContent":["var musicShowCaseApp = angular.module(\"MusicShowCaseApp\", ['ui.codemirror', 'ngRoute', 'ui.bootstrap', 'ngDraggable', 'ngCookies', 'pascalprecht.translate']);\r\n\r\nmusicShowCaseApp.constant(\"MUSIC\", MUSIC);\r\nmusicShowCaseApp.constant(\"TICKS_PER_BEAT\", 96);\r\nmusicShowCaseApp.constant(\"SONG_MAX_TRACKS\", 32);\r\nmusicShowCaseApp.constant(\"localforage\", localforage);\r\n","var musicShowCaseApp = angular.module(\"MusicShowCaseApp\");\r\nvar enTranslations = {\r\n  midi: {\r\n    settings: 'MIDI Settings',\r\n    inputs: 'Inputs',\r\n    connected: 'MIDI Input Connected',\r\n    disconnected: 'MIDI Input Disconnected (Click to setup)',\r\n    events: 'Events',\r\n    octave: 'Base Octave',\r\n    transpose: 'Transpose'\r\n  },\r\n  open_project: {\r\n    p1: 'Select the project you want to open',\r\n    title: 'Open Project'\r\n  },\r\n  array_editor: {\r\n    tooltip: {\r\n      remove_item: 'Removes the object from array',\r\n      add_item: 'Click to add a new object to array',\r\n      edit_item: 'Click to edit this object'\r\n    }\r\n  },\r\n  index: {\r\n    not_implemented: 'Sorry. Not implemented Yet :P',\r\n    filter: 'Type here the word to filter objects',\r\n    tooltip: {\r\n      type: {\r\n        instrument: 'This is a resource object of type instrument',\r\n        pattern: 'This is a resource object of type pattern',\r\n        song: 'This is a resource object of type song',\r\n        fx: 'This is a resource object of type fx'\r\n      },\r\n      type_p1: 'To use the resource, drag them from here into your creation on the right',\r\n      type_p2: 'To instead, *edit* the resource, double click it',\r\n      index: 'This is the object index, you can find here your crafting outputs and inputs'\r\n    }\r\n  },\r\n  project: {\r\n    basic_info: 'Properties',\r\n    references: 'References',\r\n    settings: 'Project Settings',\r\n    'new': 'New Project'\r\n  },\r\n  menu: {\r\n    'new': 'File',\r\n    new_instrument: 'New Instrument',\r\n    new_pattern: 'New Pattern',\r\n    new_song: 'New Song',\r\n    new_project: 'New Project...',\r\n    open_project: 'Open Project...',\r\n    file_import: 'Import...',\r\n    tools: 'Tools',\r\n    tools_preferences: 'Preferences',\r\n    help_view_help: 'View Help',\r\n    help_recipes: 'Recipes',\r\n    help_recipes_intro: 'Basic intro tour',\r\n    help_recipes_howto_create_song: 'How to create a song',\r\n    help_recipes_howto_create_instrument: 'How to create an instrument (square + 2 voices echo)',\r\n    help_contextual_help: 'Contextual Help',\r\n    help_welcome: 'Welcome!',\r\n    help_about: 'About Music.js',\r\n    recycle_bin: 'Recycle Bin...',\r\n    tooltip: {\r\n      'new': 'You can create new blank items from this option',\r\n      preferences: 'You can edit your preferences here',\r\n      help: 'Menu to access help options and about'\r\n    },\r\n    project: 'Project',\r\n    project_settings: 'Settings...',\r\n    project_remove_project: 'Remove Project',\r\n    project_export_project: 'Export Project'\r\n  },\r\n  contextual_help: {\r\n    enable: 'Enable Contextual Help',\r\n    disable: 'Disable Contextual Help'\r\n  },\r\n  recycle: {\r\n    p1: 'This is the recycle bin, from here, you can restore the items that have been removed',\r\n    p2: 'Remember: items in the recycle bin will be permanently deleted if and when available storage space runs out',\r\n    p3: '* Double-click the item you want to RESTORE',\r\n    title: 'Recycle Bin',\r\n    compact_title: 'Recycle Bin',\r\n    compact_hint_restore: '* Double-click the item you want to RESTORE',\r\n    compact_hint_open: '* Click here to open recycle bin window',\r\n    EMPTY: 'EMPTY'\r\n  },\r\n  welcome: {\r\n    title: 'Welcome to Music.js: 8bit Edition',\r\n    p1: 'Music.js is a web application that allows the composition of melodies powered (optionally) by javascript programming',\r\n    p2: 'This first basic edition, is fully oriented towards retro/8bit music by providing elemental oscillators, noise generators and basic modulation patterns',\r\n    p3: 'Do you want a basic tour?',\r\n    nevershow: 'Never show this message again'\r\n  },\r\n  about: {\r\n    title: 'About Music.js: 8bit Edition',\r\n    p3: 'In the long term, the goal of music.js is to cover all the layers needed between HTML5 Web Audio API provided by browsers and fully usable music composition application similar to known ones like FL Studio',\r\n    authors: 'AUTHORS',\r\n    i_am: 'I am Dario Seminara, but also I should give credit to some key library authors:',\r\n    credit: {\r\n      mohayonao: '@mohayonao (Author of Timbre.js)',\r\n      higuma: '@higuma (Author of WebAudioRecorder)',\r\n      kristopolous: '@kristopolous (Author of BOOTSTRA.386 Bootstrap Template)'\r\n    },\r\n    contribute: 'CONTRIBUTE',\r\n    contact_me: 'Contact me at github'\r\n  },\r\n  common: {\r\n    yes: 'Yes',\r\n    no: 'No',\r\n    ok: 'Ok',\r\n    dismiss: 'Dismiss',\r\n    cancel: 'Cancel',\r\n    create: 'Create',\r\n    open: 'Open',\r\n    name: 'Name',\r\n    language: 'Language:',\r\n    loader_error: 'Error when trying to load file',\r\n    cantremove_error: 'Can not delete the file if it is being used',\r\n    cantremove_project_error: 'Can not delete the project if it is being used in another project',\r\n    error_title: 'Error',\r\n    HELP: 'HELP',\r\n    more: 'more',\r\n    remove: 'Remove',\r\n    'export': 'Export',\r\n    reset: 'Reset',\r\n    play: 'Play',\r\n    pause: 'Pause',\r\n    stop: 'Stop',\r\n    record: 'Rec.',\r\n    bpm: 'Bpm',\r\n    bpm_lc: 'bpm',\r\n    add: 'Add',\r\n    tooltip: {\r\n      playing_speed: 'Playing speed, number of beats per minute',\r\n      remove_item: 'Removes item, you can restore it from recycle bin',\r\n      modulation: 'You can setup the effects modulation for {{name}} here. If you leave it empty, there will be no modulation at all'\r\n    },\r\n    new_instrument: 'New Instrument',\r\n    new_pattern: 'New Pattern',\r\n    new_song: 'New Song',\r\n    modulation: '{{name}} Modulation'\r\n  },\r\n  help: {\r\n    FLOW: 'MUSIC.JS FLOW',\r\n    RECIPES: 'RECIPES',\r\n    p1: 'In order to create a song, you need to craft it, and craft the materials.',\r\n    p2: 'Actually, there are three types of craftable resources: instruments, patterns and songs',\r\n    p3: 'While the right section shows the item being crafted. The left pannel shows the crafting materials',\r\n    p4: 'You can drop resources (instruments or patterns) into drop zones, when applicable',\r\n    p5: 'To use the resource on the item being crafted, you need to drag it to any of the dropzones',\r\n    p6: 'Following this principle, you can use instruments to compose patterns, and finally, patterns to compose songs',\r\n    p7: 'Furthermore, you can compose your custom instruments, from a range of effects:',\r\n    p8: 'Don\\'t worry, if you don\\'t get it at first, there are recipes and contextual help at your disposal',\r\n    recipes: {\r\n      p1: 'Recipes are interactive mini-tutorials on how to craft anything here (example: a song)',\r\n      p2: 'Some tutorials (such as \\'intro\\') only explain a few things about the main interface',\r\n      p3: 'It\\'s recommended to follow these recipes if you don\\'t know what to do or how to start using the app. The recipes are reachable from the help menu (?)'\r\n    },\r\n    CONTEXTUAL_HELP: \"CONTEXTUAL HELP\",\r\n    contextual_help: {\r\n      p1: 'There is a series of tooltips explaining on detail the different features of the app. You can enable or disable these tooltips by clicking on the box in the left-bottom corner of the screen'\r\n    }\r\n  },\r\n  stack: {\r\n    drop_elements_here: \"drop new elements here\",\r\n    tooltip: {\r\n      you_can_drop_new_effects_here: 'You can drop new effects from the object index here',\r\n      remove: 'Removes the effect element from the pipeline',\r\n      up: 'Changes the order of the element, to execute it AFTER',\r\n      down: 'Changes the order of the element, to execute it BEFORE',\r\n      expand: 'Expand/Shrink the display of advanced options for the element'\r\n    }\r\n  },\r\n  editor: {\r\n    keyboard_instructions: 'Use ZXCVBNM keys to play instrument, or hover mouse on virtual keyboard',\r\n    tooltip: {\r\n      test_instrument_here: 'Test the instrument here, using mouse or keyboard',\r\n      type_here_instrument: 'Type here the name of the instrument'\r\n    }\r\n  },\r\n  pattern: {\r\n    track_muted: 'Muted',\r\n    track_solo: 'Solo',\r\n    measure_beats: 'Measure beats',\r\n    amount_beats: 'Amount of beats per measure',\r\n    measure_count: 'Measure count',\r\n    zoom_level: 'Zoom level',\r\n    total_measures: 'Total count of measures on pattern',\r\n    tracks: 'Tracks',\r\n    drop_instrument: 'drop instrument here',\r\n    tooltip: {\r\n      change_name: 'Change the pattern name',\r\n      zoom_level: 'Zoom level for all tracks',\r\n      play: 'Click to play the pattern',\r\n      stop: 'Click to stop playing',\r\n      remove_track: 'Click to remove track',\r\n      compact_view_p1: 'Track compact view: see the notes without having to expand the track.',\r\n      compact_view_p2: 'Click here to expand the track',\r\n      drop_zone: 'Instrument drop zone, drop instruments from the left panel to use it on the track',\r\n      editor_notes_p1: 'Note area, add the notes here:',\r\n      editor_notes_p2: 'Click to add a new one, and drag to change value/time',\r\n      editor_notes_p3: 'CTRL+Z to undo changes',\r\n      editor_notes_p4: 'CTRL+Y to redo changes',\r\n      add_track: 'Click this button to add new empty tracks',\r\n      note_event_p1: 'Note event. Drag from the right edge to change the duration or press delete key to remove',\r\n      note_event_p2: 'Drag to change the value and/or starting time',\r\n      note_event_p3: 'Note event. Click to select and edit it',\r\n      muted: 'Disable the track in order to silence it',\r\n      solo: 'Isolate the track so that it is the only one that plays. Can be more than one',\r\n      instrument_edit: \"Click this button to edit the instrument\"\r\n    }\r\n  },\r\n  song: {\r\n    drop_pattern: \"Drop pattern here\",\r\n    tooltip: {\r\n      measure_beats: \"Amount of beats per measure. Make sure this value match the measure length of the patterns\",\r\n      play: \"Click to play/pause the song\",\r\n      stop: \"Click to stop playing the song\",\r\n      download: \"Click to record the song and download the audio file\",\r\n      drop_pattern: \"Drop zone for patterns, drop here a pattern from the panel on the left\",\r\n      remove_block: \"Click here to remove the pattern and leave the block empty\",\r\n      edit_block: \"Click here to edit the pattern used by this block\"\r\n    }\r\n  },\r\n  BUTTON_LANG_EN: 'English',\r\n  BUTTON_LANG_ES: 'Spanish'\r\n\r\n};\r\n\r\nmusicShowCaseApp.constant(\"enTranslations\", enTranslations);\r\n","var musicShowCaseApp = angular.module(\"MusicShowCaseApp\");\r\nvar esTranslations = {\r\n  midi: {\r\n    settings: 'Opciones de MIDI',\r\n    inputs: 'Entradas',\r\n    connected: 'Entrada MIDI Conectada',\r\n    disconnected: 'Entrada MIDI Desconectada (Click para configurar)',\r\n    events: 'Eventos',\r\n    octave: 'Octava Base',\r\n    transpose: 'Transposicion'\r\n  },\r\n  open_project: {\r\n    p1: 'Selecciona el proyecto que quieras abrir',\r\n    title: 'Abrir Proyecto'\r\n  },\r\n  array_editor: {\r\n    tooltip: {\r\n      remove_item: 'Elimina el objeto de la coleccion',\r\n      add_item: 'Click para agregar un nuevo objeto a la coleccion',\r\n      edit_item: 'Click para editar este objeto'\r\n    }\r\n  },\r\n  index: {\r\n    not_implemented: 'Disculpa, funcionalidad no implementada',\r\n    filter: 'Tipea aqui las palabras clave para filtrar los objetos',\r\n    tooltip: {\r\n      type: {\r\n        instrument: 'Este es un recurso del tipo instrumento',\r\n        pattern: 'Este es un recurso del tipo patron',\r\n        song: 'Este es un recurso del tipo cancion',\r\n        fx: 'Este es un recurso del tipo fx (efecto)'\r\n      },\r\n      type_p1: 'Para usar este recurso, arrastralo desde aqui hasta tu creacion',\r\n      type_p2: 'Para, en lugar de eso, editarlo, haz doble click en el',\r\n      index: 'Este es el indice de objetos, puedes encontrar tus materiales y productos listados aqui'\r\n    }\r\n  },\r\n  project: {\r\n    basic_info: 'Propiedades del proyecto',\r\n    references: 'Referencias',\r\n    settings: 'Configuracion del Proyecto',\r\n    'new': 'Nuevo Proyecto'\r\n  },\r\n  menu: {\r\n    'new': 'Archivo',\r\n    new_instrument: 'Nuevo Instrumento',\r\n    new_pattern: 'Nuevo Patron',\r\n    new_song: 'Nueva Cancion',\r\n    new_project: 'Nuevo Proyecto...',\r\n    open_project: 'Abrir Proyecto...',\r\n    file_import: 'Importar...',\r\n    tools: 'Herramientas',\r\n    tools_preferences: 'Preferencias',\r\n    help_view_help: 'Ver Pagina de Ayuda',\r\n    help_recipes: 'Recetas',\r\n    help_recipes_intro: 'Recorrido Introductorio',\r\n    help_recipes_howto_create_song: 'Como crear una cancion',\r\n    help_recipes_howto_create_instrument: 'Como crear un instrumento (cuadrada + eco a dos voces)',\r\n    help_contextual_help: 'Ayuda Contextual',\r\n    help_welcome: 'Bienvenido!',\r\n    help_about: 'Acerca de Music.js',\r\n    recycle_bin: 'Papelera de Reciclaje...',\r\n    tooltip: {\r\n      'new': 'Puedes crear nuevos items en blanco desde esta opcion',\r\n      preferences: 'Puedes editar tus preferencias aqui',\r\n      help: 'Menu para acceder a las opciones de ayuda y *Acerca De*'\r\n    },\r\n    project: 'Proyecto',\r\n    project_settings: 'Configuracion...',\r\n    project_remove_project: 'Eliminar Proyecto',\r\n    project_export_project: 'Exportar Proyecto'\r\n  },\r\n  contextual_help: {\r\n    enable: 'Activar Ayuda Contextual',\r\n    disable: 'Desactivar Ayuda Contextual'\r\n  },\r\n  recycle: {\r\n    p1: 'Esta es la papelera de reciclaje, desde aqui puedes restaurar los elementos que han sido eliminados',\r\n    p2: 'Recuerda que los elementos en la papelera se eliminaran permanentemente cuando se agote el espacio disponible',\r\n    p3: '* Haz doble-click en el elemento que quieras RESTAURAR',\r\n    title: 'Papelera de Reciclaje',\r\n    compact_title: 'Papelera de R.',\r\n    compact_hint_restore: '* Haz doble-click en el elemento que quieras RESTAURAR',\r\n    compact_hint_open: '* Haz click aqui para abrir la papelera de reciclaje',\r\n    EMPTY: 'Vacia'\r\n  },\r\n  welcome: {\r\n    title: 'Bienvenido a Music.js: Edicion de 8bit',\r\n    p1: 'Music.js es una aplicacion web que permite componer musica con el poder de javascript (opcional)',\r\n    p2: 'La primera version esta totalmente orientada a la musica retro/8bit mediante osciladores elementales, generadores de ruido y patrones de modulacion',\r\n    p3: 'Quieres realizar un recorrido basico?',\r\n    nevershow: 'Nunca mostrar este mensaje de nuevo'\r\n  },\r\n  about: {\r\n    title: 'Acerca de Music.js: Edicion de 8bit',\r\n    p3: 'A largo plazo, el objetivo de music.js es cubrir todas las capas necesarias entre el API de Web Audio provista pr los navegadores y una solucion completa de composicion musical similar a las mas conocidas como por ej FL Studio',\r\n    authors: 'AUTORES',\r\n    i_am: 'Yo soy Dario Seminara, pero tambien tengo que dar credito a autores de varias librerias que son clave:',\r\n    credit: {\r\n      mohayonao: '@mohayonao (Autor de Timbre.js)',\r\n      higuma: '@higuma (Autor de WebAudioRecorder)',\r\n      kristopolous: '@kristopolous (Autor de la plantilla de bootstrap BOOTSTRA.386)'\r\n    },\r\n    contribute: 'COMO CONTRIBUIR',\r\n    contact_me: 'Contactame a travez de github'\r\n  },\r\n  common: {\r\n    yes: 'Si',\r\n    no: 'No',\r\n    ok: 'Aceptar',\r\n    dismiss: 'Cerrar',\r\n    cancel: 'Cancelar',\r\n    create: 'Crear',\r\n    open: 'Abrir',\r\n    name: 'Nombre',\r\n    loader_error: 'Error al intentar cargar el archivo',\r\n    cantremove_error: 'No se puede eliminar el archivo si esta siendo utilizado',\r\n    cantremove_project_error: 'No se puede eliminar el proyecto si esta siendo usado desde otro proyecto',\r\n    error_title: 'Error',\r\n    language: 'Idioma:',\r\n    HELP: 'AYUDA',\r\n    more: 'mas',\r\n    remove: 'Elimi.',\r\n    'export': 'Exportar',\r\n    reset: 'Fabr.',\r\n    play: 'Reprod.',\r\n    pause: 'Pausar',\r\n    stop: 'Detener',\r\n    record: 'Rec.',\r\n    bpm: 'Ppm',\r\n    bpm_lc: 'ppm',\r\n    add: 'Agreg.',\r\n    tooltip: {\r\n      playing_speed: 'Velocidad de reproduccion, cantidad de pulsos por minuto',\r\n      remove_item: 'Elimina el elemento, puedes restaurarlo desde la papelera de reciclaje',\r\n      modulation: 'Puedes configurar los efectos de modulacion aqui. Si lo dejas vacio, no habra modulacion'\r\n    },\r\n    new_instrument: 'Nuevo Instrumento',\r\n    new_pattern: 'Nuevo Patron',\r\n    new_song: 'Nueva Cancion',\r\n    modulation: 'Modulacion de {{name}}'\r\n  },\r\n  help: {\r\n    FLOW: 'FLUJO DE MUSIC.JS',\r\n    RECIPES: 'RECETAS',\r\n    p1: 'Para crear una cancion, tienes que ensamblarla, asi como sus componentes',\r\n    p2: 'Hay tres tipos de recursos que se pueden crear: instrumentos, patrones y canciones',\r\n    p3: 'Mientras que la seccion de la derecha muestra el elemento que se esta creando, la seccion de la izquierda muestra los materiales que se pueden usar',\r\n    p4: 'Puedes arrastrar y soltar esos materiales en las zonas indicadas',\r\n    p5: 'Para usar algun recurso en algun elemento que estes creando, lo tienes que arrastrar a esas zonas',\r\n    p6: 'Siguiendo este principio, puedes usar instrumentos para componer patrones, y finalmente, los patrones para componer las canciones',\r\n    p7: 'Ademas, puedes crear tus propios instrumentos, combinando varios efectos:',\r\n    p8: 'No te preocupes si no lo entiendes ahora mismo, hay recetas y ayuda contextual que podras usar para familiarizarte con estos conceptos',\r\n    recipes: {\r\n      p1: 'Las recetas, son mini-tutoriales interactivos que explican como crear algo (por ejemplo, una cancion)',\r\n      p2: 'Algunos tutoriales (Como por ejemplo \\'Recorrido Introductorio\\') solo explican algunas cosas de la interfaz principal',\r\n      p3: 'Te recomiendo que sigas estas recetas si no sabes que hacer o como empezar a usar la aplicacion. Puedes acceder a las recetas desde el menu de ayuda (?)'\r\n    },\r\n    CONTEXTUAL_HELP: \"AYUDA CONTEXTUAL\",\r\n    contextual_help: {\r\n      p1: 'Hay una serie de tooltips que explican detalladamente las distintas funcionalidades de la aplicacion. Puedes activar o desactivar estas ayudas clickeando en el recuadro que aparece en la esquina inferior izquierda de la pantalla'\r\n    }\r\n  },\r\n  editor: {\r\n    keyboard_instructions: 'Usa las teclas ZXCVBNM para tocar el instrumento, o pasa el puntero del mouse sobre el teclado virtual',\r\n    tooltip: {\r\n      test_instrument_here: 'Prueba el instrumento aqui, usando el teclado o el mouse',\r\n      type_here_instrument: 'Escribe aqui el nombre para el instrumento'\r\n    }\r\n  },\r\n  pattern: {\r\n    track_muted: 'Apagado',\r\n    track_solo: 'Solo',\r\n    measure_beats: 'Pulsos/compas',\r\n    measure_count: 'Cant. de compases',\r\n    zoom_level: 'Nivel de zoom',\r\n    tracks: 'Pistas',\r\n    drop_instrument: 'Suelta el instrumento aqui',\r\n    tooltip: {\r\n      amount_beats: 'Cantidad de pulsos por compas',\r\n      total_measures: 'Cantidad total de compases en el patron',\r\n      change_name: 'Cambia el nombre del patron',\r\n      zoom_level: 'Nivel de zoom para todas las pistas',\r\n      play: 'Click para reproducir el patron',\r\n      stop: 'Click para detener la reproduccion',\r\n      remove_track: 'Click para eliminar la pista',\r\n      compact_view_p1: 'Vista compacta de la pista: muestra las notas sin necesidad de expandir la pista.',\r\n      compact_view_p2: 'Clickea aqui para expandir la pista',\r\n      drop_zone: 'Area para soltar el instrumento, arrastra aqui instrumentos del panel izquierdo para usarlos en la pista',\r\n      editor_notes_p1: 'Area de notas, puedes agregar las notas aqui:',\r\n      editor_notes_p2: 'Clickea para agregar una nueva nota, y arrastralas para cambiar su valor y su tiempo de inicio en la secuencia',\r\n      editor_notes_p3: 'CTRL+Z para deshacer cambios',\r\n      editor_notes_p4: 'CTRL+Y para rehacer cambios',\r\n      add_track: 'Clickea este boton para agregar una nueva pista vacia',\r\n\r\n      note_event_p1: 'Evento de nota. Arrastra desde el borde derecho para cambiar su duracion, o presiona la tecla SUPR. para eliminarlo',\r\n      note_event_p2: 'Arrastra para cambiar el valor o el tiempo de comienzo en la secuencia',\r\n      note_event_p3: 'Evento de nota. Clickea para seleccionarlo y editarlo',\r\n      muted: 'Desactiva la pista haciendo que no se reproduzca',\r\n      solo: 'Aisla la pista de manera que sea la unica que se reproduzca. Pueden aislarse varias',\r\n      instrument_edit: 'Clickea este boton para editar el instrumento'\r\n    }\r\n  },\r\n  song: {\r\n    drop_pattern: \"Suelta el patron aqui\",\r\n    tooltip: {\r\n      measure_beats: \"Pulsos/Compas. Tiene que coincidir con el de los patrones que se usan\",\r\n      play: \"Click para reproducir/pausar la cancion\",\r\n      stop: \"Click para detener la reproduccion\",\r\n      download: \"Click para grabar la cancion a un archivo de audio y descargarlo\",\r\n      drop_pattern: \"Area para soltar los patrones, arrastra aqui patrones desde el panel izquierdo\",\r\n      remove_block: \"Click aqui para eliminar el patron y dejar el bloque vacio\",\r\n      edit_block: \"Click aqui para saltar a la edicion del patron utilizado en este bloque\"\r\n    }\r\n  },\r\n  stack: {\r\n    drop_elements_here: \"suelta nuevos elementos aqui\",\r\n    tooltip: {\r\n      you_can_drop_new_effects_here: 'Puedes soltar nuevos efectos del indice aqui',\r\n      remove: 'Elimina el efecto de la secuencia',\r\n      up: 'Cambia el orden del elemento, para que se ejecute DESPUES',\r\n      down: 'Cambia el orden del elemento, para que se ejecute ANTES',\r\n      expand: 'Expande/Comprime la vista avanzada del elemento'\r\n    }\r\n  },\r\n  BUTTON_LANG_EN: 'Ingles',\r\n  BUTTON_LANG_ES: 'Espaol'\r\n};\r\n\r\nmusicShowCaseApp.constant(\"esTranslations\", esTranslations);\r\n","var musicShowCaseApp = angular.module(\"MusicShowCaseApp\");\r\n\r\nmusicShowCaseApp.config(['$translateProvider', function ($translateProvider) {\r\n  var getBrowserLanguage = function() {\r\n    if (!$translateProvider.resolveClientLocale()) return 'en'\r\n    var langCode = $translateProvider.resolveClientLocale().split(\"-\")[0];\r\n    if (!langCode) return 'en';\r\n    return $translateProvider.translations()[langCode] ? langCode : 'en';\r\n  };\r\n\r\n  $translateProvider\r\n    .preferredLanguage(getBrowserLanguage());\r\n\r\n  $translateProvider\r\n    .fallbackLanguage('en');\r\n\r\n  $translateProvider.useSanitizeValueStrategy(null);\r\n  $translateProvider.useLoader('translationsLoader');\r\n\r\n}]);\r\n","var musicShowCaseApp = angular.module(\"MusicShowCaseApp\");\r\n\r\nmusicShowCaseApp.config([\"$routeProvider\", \"$locationProvider\", function($routeProvider, $locationProvider) {\r\n  $routeProvider\r\n    .when('/editor/:project/instrument/:id', {\r\n      templateUrl: 'site/templates/editor.html',\r\n      controller: 'EditorController'\r\n    })\r\n    .when('/editor/:project/song/:id', {\r\n      templateUrl: 'site/templates/songEditor.html',\r\n      controller: 'SongEditorController'\r\n    })\r\n    .when('/editor/:project/pattern/:id', {\r\n      templateUrl: 'site/templates/patternEditor.html',\r\n      controller: 'PatternEditorController'\r\n    })\r\n    .when('/editor/:project', {\r\n      templateUrl: 'site/templates/dashboard.html',\r\n      controller: 'ProjectDashboardController'\r\n    })\r\n    .when('/', {\r\n      templateUrl: 'site/templates/dashboard.html',\r\n      controller: 'DashboardController'\r\n    });\r\n\r\n  // configure html5 to get links working on jsfiddle\r\n  //$locationProvider.html5Mode(true);\r\n}]);;\r\n\r\n\r\n\r\n","var musicShowCaseApp = angular.module(\"MusicShowCaseApp\");\r\n\r\nmusicShowCaseApp.directive(\"musicObjectEditor\", [\"$timeout\", \"$http\", \"TypeService\", \"Recipe\", \"MusicObjectFactory\", function($timeout, $http, TypeService, Recipe, MusicObjectFactory) {\r\n  return {\r\n    scope: {\r\n      file: \"=file\"\r\n    },\r\n    templateUrl: \"site/templates/objectEditor.html\",\r\n    link: function(scope, element, attrs) {\r\n      var file;\r\n      var types = TypeService.getTypes();\r\n\r\n      scope.output = {};\r\n\r\n      scope.parameters = [];\r\n      scope.recipe = Recipe.start;\r\n      scope.termschanged = function() {\r\n        scope.$broadcast('termschanged');\r\n      };\r\n\r\n      scope.f_t = function(str, state) {\r\n        try {\r\n          var ret = eval(\"(function(t) { return \" + str + \"; })\");\r\n          delete state.error;\r\n\r\n          return ret;\r\n        } catch(e) {\r\n          state.error = e.toString();\r\n          throw e;\r\n        }\r\n      };\r\n\r\n      scope.oscTermsUpdateFromWaveForm = fn.debounce(function(waveform, terms, resolution) {\r\n\r\n        try {\r\n          var waveform = eval(\"(function(t) { return \" + waveform + \"; })\");\r\n          var count = resolution;\r\n          var values = new Array(count);\r\n          for (var i = 0; i < count; i++) {\r\n            values[i] = waveform(i/count);\r\n            if (isNaN(values[i])) throw \"Not a number: \" + values[i];\r\n          }\r\n\r\n          var ft = new DFT(values.length);\r\n          ft.forward(values);\r\n\r\n          for (var i=0;i<count;i++) {\r\n            terms.cos[i] = ft.real[i];\r\n            terms.sin[i] = ft.imag[i];\r\n          }\r\n          terms.cos.length = ft.real.length/2;\r\n          terms.sin.length = ft.imag.length/2;\r\n\r\n          var f = function(t){\r\n            var ret = 0;\r\n            for (var i=1;i<count/2;i++) {\r\n              var a = terms.sin[i];\r\n              var b = terms.cos[i];\r\n\r\n              ret = ret + a * Math.sin(t*2*Math.PI*i);\r\n              ret = ret + b * Math.cos(t*2*Math.PI*i);\r\n            }\r\n            return ret;\r\n          };\r\n\r\n          var maxvalue = 0;\r\n          var count = terms.sin.length;\r\n          for (var i=0; i<count; i++) {\r\n            var value = f(i/count);\r\n            if (value>maxvalue) {\r\n              maxvalue=value;\r\n            } else if (value<-maxvalue) {\r\n              maxvalue=-value;\r\n            }\r\n          }\r\n\r\n          for (var i=0;i<count;i++) {\r\n            terms.sin[i] = terms.sin[i] / maxvalue;\r\n            terms.cos[i] = terms.cos[i] / maxvalue;\r\n          }\r\n\r\n          $timeout(function() {\r\n            scope.invalidWaveform = false;\r\n          });\r\n          scope.$broadcast('termschanged');\r\n        } catch (err) {\r\n          $timeout(function() {\r\n            scope.invalidWaveform = err.toString();\r\n          });\r\n        }\r\n\r\n      },400);\r\n\r\n      scope.oscTermsUpdate = fn.debounce(function(serie, terms, errVar) {\r\n\r\n        try {\r\n          var serie = eval(\"(function(n) { return \" + serie + \"; })\");\r\n          for (var n=1;n<512;n++) {\r\n            terms[n]=serie(n);\r\n            if (isNaN(terms[n])) throw \"Not a number: \" + terms[n];\r\n  \r\n          }\r\n          scope[errVar] = false;\r\n          $timeout(function() {\r\n            scope.$broadcast('termschanged');\r\n          });\r\n        } catch (err) {\r\n          $timeout(function() {\r\n            scope[errVar] = err.toString();\r\n          });\r\n        }\r\n      },400);\r\n\r\n      scope.range = function(init, end) {\r\n        var x = [];\r\n        for (var i=init;i<=end;i++) {\r\n          x.push(i);\r\n        }\r\n        return x;\r\n      };\r\n\r\n      var truthy = function(x ) { return x; };\r\n      var updateObject = function(newValue) {\r\n        $timeout(function() {\r\n          if (scope.file && scope.file.changed) scope.file.changed();\r\n        });\r\n      };\r\n\r\n      var outputObserver;\r\n      scope.$on(\"$destroy\", function() {\r\n        if (outputObserver) outputObserver.destroy();\r\n      });\r\n\r\n      var updateTemplate = function(file) {\r\n        if (!file) return;\r\n\r\n        if (outputObserver) outputObserver.destroy();\r\n        var outputObserver = MusicObjectFactory().observeOutput(file, function(output) {\r\n          $timeout(function() {\r\n            scope.output = output;\r\n          });\r\n        });\r\n\r\n        types.then(function() {\r\n          $timeout(function() {\r\n            scope.selectedType = file.type;\r\n\r\n            TypeService.getType(file.type, function(type) {\r\n              $timeout(function() {\r\n                scope.templateUrl = type.templateUrl;\r\n                scope.type = type;\r\n\r\n                for (var k in type._default) {\r\n                  if (typeof file.data[k] === \"undefined\") {\r\n                    file.data[k] =type._default[k];\r\n                  }\r\n                }\r\n\r\n                if (type.parameters) {\r\n                  scope.parameters = type.parameters.map(function(parameter) {\r\n                    return {\r\n                      name: parameter.name,\r\n                      data: parameter,\r\n                      value: file.data && typeof file.data[parameter.name] !== \"undefined\" ? file.data[parameter.name] : parameter.value\r\n                    };\r\n                  });\r\n                }\r\n                if (type.components) {\r\n                  scope.modulations = (type.components||[]).map(function(component) {\r\n                    return {\r\n                      name: component,\r\n                      value: (file.data && file.data.modulation && file.data.modulation[component])|| {\r\n                        type: \"stack\",\r\n                        data: {\r\n                          array: []\r\n                        }\r\n                      }\r\n                    };\r\n                  });\r\n                }\r\n\r\n                updateObject(file.data);\r\n              });\r\n            });\r\n          });\r\n        });\r\n      };\r\n      if (scope.file) updateTemplate(scope.file);\r\n\r\n      types.then(function(types) {\r\n        scope.types = types;\r\n      });\r\n      \r\n      var changeType = function(newValue) {\r\n        if (!newValue) return;\r\n        if (!scope.file) return;\r\n        scope.file.type = newValue;\r\n        updateTemplate(scope.file);\r\n      };\r\n\r\n      scope.$watch(\"modulations\", function(newValue) {\r\n        if (!scope.modulations) return;\r\n        scope.modulations.forEach(function(modulation) {\r\n          scope.file.data.modulation = scope.file.data.modulation||{};\r\n          scope.file.data.modulation[modulation.name] = modulation.value;\r\n        }); \r\n        scope.$emit(\"objectChanged\");\r\n      }, true);\r\n\r\n      scope.$watch(\"parameters\", function(newValue) {\r\n        if (!scope.parameters) return;\r\n        scope.parameters.forEach(function(parameter) {\r\n          scope.file.data[parameter.data.name] = parameter.value;\r\n        }); \r\n        scope.$emit(\"objectChanged\");\r\n      }, true);\r\n      scope.$watch(\"selectedType\", changeType)\r\n      scope.$watch(\"file\", updateTemplate);\r\n      //scope.$watch(\"file.data\", fn.debounce(function(newValue) { debugger; },800), true);\r\n    }\r\n  };\r\n}]);\r\n\r\nmusicShowCaseApp.directive(\"arrayEditor\", [\"$timeout\", \"Recipe\", function($timeout, Recipe) {\r\n  return {\r\n    scope: {\r\n      data: \"=data\"\r\n    },\r\n    templateUrl: \"site/templates/arrayEditor.html\",\r\n    link: function(scope, element, attrs) {\r\n      scope.data.subobjects=scope.data.subobjects||[];\r\n      scope.maxElements = attrs.maxelements ? parseInt(attrs.maxelements) : Infinity;\r\n      scope.currentTab = 0;\r\n      scope.recipe = Recipe.start;\r\n\r\n      var addObject = function(newObject) {\r\n        $timeout(function() {\r\n          scope.data.subobjects=scope.data.subobjects||[];\r\n          scope.data.subobjects.push(newObject);\r\n          scope.setCurrentTab(scope.data.subobjects.length-1);\r\n        });\r\n      };\r\n\r\n      scope.setCurrentTab = function(idx) {\r\n        scope.currentTab = idx;\r\n      };\r\n\r\n      scope.removeObject = function(object) {\r\n        scope.data.subobjects = scope.data.subobjects.filter(function(o) {return o !== object; });\r\n      };\r\n\r\n      scope.addObject = function() {\r\n        addObject({data: {array: []}, type: \"stack\"})\r\n      };\r\n\r\n      if (scope.data.subobjects.length === 0) {\r\n        scope.addObject();\r\n      }\r\n    }\r\n  };\r\n}]);\r\n\r\nmusicShowCaseApp.directive(\"musicStack\", [\"$timeout\", \"Recipe\", \"TypeService\", function($timeout, Recipe, TypeService) {\r\n  return {\r\n    scope: {\r\n      initFile: \"=initFile\",\r\n      dropzoneExtraName: \"=dropzoneExtraName\"\r\n    },\r\n    templateUrl: \"site/templates/stack.html\",\r\n    link: function(scope, element, attrs) {\r\n      scope.recipe = Recipe.start;\r\n\r\n      var swap = function(idx1, idx2) {\r\n        scope.$emit(\"stackChanged\");\r\n\r\n        $timeout(function() {\r\n          var tmp = scope.file.array[idx1];\r\n          scope.file.array[idx1] = scope.file.array[idx2];\r\n          scope.file.array[idx2] = tmp;\r\n        });\r\n      };\r\n\r\n      var defaultStackAppend = function(file, data) {\r\n        file.array = [{\r\n          type: data.name,\r\n          data: {}\r\n        }].concat(file.array);\r\n      };\r\n\r\n      scope.onDropComplete = function(data, event) {\r\n        if (data.type === \"fx\") {\r\n          TypeService.getType(data.name)\r\n            .then(function(type) {\r\n              (type.stackAppend ||defaultStackAppend)(scope.file, data);\r\n              scope.$emit(\"stackChanged\");\r\n            });\r\n        }\r\n      };\r\n\r\n      scope.up = function(idx) {\r\n        swap(idx-1, idx);\r\n      };\r\n\r\n      scope.down = function(idx) {\r\n        swap(idx+1, idx);\r\n      };\r\n\r\n      scope.remove = function(idx) {\r\n        scope.$emit(\"stackChanged\");\r\n\r\n        $timeout(function() {\r\n          var oldCollection = scope.file.array;\r\n          scope.file.array = [];\r\n          for (var i=0; i<oldCollection.length; i++) {\r\n            if (i!==idx) scope.file.array.push(oldCollection[i]);\r\n          }\r\n        });\r\n      };\r\n\r\n      scope.add = function() {\r\n        scope.$emit(\"stackChanged\");\r\n\r\n        $timeout(function() {\r\n          scope.file.array.push({data: {}, type: \"null\"});\r\n        });\r\n      };\r\n\r\n      scope.$watch(\"initFile\", function(newFile) {\r\n        if (newFile) {\r\n          scope.file = newFile.data;\r\n        }\r\n      });\r\n    }\r\n  };  \r\n\r\n}]);\r\n\r\nmusicShowCaseApp.directive(\"customOscGraph\", [\"$timeout\", function($timeout) {\r\n  return {\r\n    scope: {\r\n      terms: \"=terms\"\r\n    },\r\n    template: '<function-graph f=\"f\" samples=64 t0=\"0\" tf=\"1\" scaley=\"0.8\"></function-graph>',\r\n    link: function(scope, element, attrs) {\r\n      var termsChanged = function() {\r\n        scope.f = function(t){\r\n          var ret = 0;\r\n          for (var i=1;i<scope.terms.sin.length;i++) {\r\n            var a = scope.terms.sin[i];\r\n            var b = scope.terms.cos[i];\r\n\r\n            ret = ret + a * Math.sin(t*2*Math.PI*i);\r\n            ret = ret + b * Math.cos(t*2*Math.PI*i);\r\n          }\r\n          return ret;\r\n        };\r\n      };\r\n\r\n      scope.f = function() { return 0; };\r\n      scope.$on(\"termschanged\", fn.debounce(termsChanged,10));\r\n\r\n      termsChanged();\r\n    }\r\n  };\r\n}]);\r\n\r\nmusicShowCaseApp.directive(\"showScale\", [\"$timeout\", function($timeout) {\r\n  return {\r\n    scope: {\r\n      scale: \"=scale\"\r\n    },\r\n    template: '<div class=\"note-cell\" ng-repeat=\"note in notes\">{{note}}</div><div class=\"note-cell\" ng-repeat=\"note in notes\">{{note}}</div>',\r\n    link: function(scope, element, attrs) {\r\n      var semitoneToNote = function(n) {\r\n        return [0,[0,1], 1, [1,2], 2, 3, [3,4], 4, [4,5], 5, [5,6], 6][n%12];\r\n      };\r\n\r\n      var noteToSemitone = function(n) {\r\n        return [0,2,4,5,7,9,11][n%7];\r\n      };\r\n\r\n      var notation7 = function(n) {\r\n        return [\"C\",\"D\",\"E\",\"F\",\"G\",\"A\",\"B\"][n % 7];\r\n      };\r\n\r\n      scope.$watch(\"scale\", function(newVal) {\r\n        $timeout(function() {\r\n          var scale = MUSIC.Utils.Scale(newVal);\r\n          var deltas = [0,1,2,3,4,5,6];\r\n\r\n          var initTone = semitoneToNote(newVal);\r\n          if (initTone.length) initTone = initTone[1];\r\n\r\n          scope.notes = deltas.map(function(d) {\r\n            var semitone = scale.add(newVal,d);\r\n            var tone = (initTone + d) % 7;\r\n            var alt = \"\";\r\n\r\n            if (noteToSemitone(tone) > semitone % 12) alt = \"b\";\r\n            if (noteToSemitone(tone) < semitone % 12) alt = \"#\";\r\n            return notation7(tone) + alt;\r\n          });\r\n        });\r\n      });\r\n    }\r\n  };\r\n}]);\r\n\r\nmusicShowCaseApp.directive(\"ngScrollTop\", [\"$parse\", \"$timeout\", function($parse, $timeout) {\r\n  return {\r\n    restrict: 'A',\r\n    link: function(scope, element, attrs) {\r\n      var scrollVarGetter = $parse(attrs.ngScrollTop);\r\n      var scrollVarSetter = scrollVarGetter.assign;\r\n\r\n      scope.$watch(attrs.ngScrollTop, function() {\r\n        $(element).scrollTop(scrollVarGetter(scope));\r\n      });\r\n\r\n      element.on('scroll', function() {\r\n        $timeout(function() {\r\n          scrollVarSetter(scope, $(element).scrollTop());\r\n        });\r\n      });\r\n    }\r\n  };\r\n}]);\r\n\r\nmusicShowCaseApp.directive(\"ngScrollLeft\", [\"$parse\", \"$timeout\", function($parse, $timeout) {\r\n  return {\r\n    restrict: 'A',\r\n    link: function(scope, element, attrs) {\r\n      var scrollVarGetter = $parse(attrs.ngScrollLeft);\r\n      var scrollVarSetter = scrollVarGetter.assign;\r\n\r\n      scope.$watch(attrs.ngScrollLeft, function() {\r\n        $(element).scrollLeft(scrollVarGetter(scope));\r\n      });\r\n\r\n      element.on('scroll', function() {\r\n        $timeout(function() {\r\n          scrollVarSetter(scope, $(element).scrollLeft());\r\n        });\r\n      });\r\n    }\r\n  };\r\n}]);\r\n\r\n","musicShowCaseApp.directive(\"functionGraph\", [\"$timeout\", \"$parse\", function($timeout, $parse) {\r\n  return {\r\n    scope: {},\r\n    replace: true,\r\n    template: '<canvas class=\"wavegraph\"></canvas>',\r\n    link: function(scope, element, attrs) {\r\n      var f;\r\n      var t0 = parseFloat(attrs.t0);\r\n      var tf = parseFloat(attrs.tf);\r\n      var samples = parseInt(attrs.samples);\r\n      var scaley = parseFloat(attrs.scaley);\r\n\r\n      scope.$parent.$watch(attrs.f, function(_f) {\r\n        f = _f;\r\n        if (f) redraw();\r\n      });\r\n\r\n      var redraw = function() {\r\n        var canvas = element[0];\r\n        var context = canvas.getContext('2d');\r\n\r\n        canvas.width = canvas.clientWidth/4;\r\n        canvas.height = canvas.clientHeight/4;\r\n\r\n        var drawLine = function(x0, y0, x1, y1, color) {\r\n          context.save();\r\n          context.beginPath();\r\n          context.moveTo(x0, y0);\r\n          context.lineTo(x1, y1);\r\n          context.strokeStyle = color;\r\n          context.lineWidth = 1;\r\n          context.stroke();\r\n          context.restore(); \r\n        };\r\n\r\n        var drawFunc = function(color) {\r\n          context.save();\r\n          context.save();\r\n          context.translate(0,canvas.height/2);\r\n          context.scale(canvas.width,canvas.height/2);\r\n\r\n          context.moveTo(0, -f(t0)*scaley);\r\n          for (var i=1; i<=samples; i++) {\r\n            var x = i/samples;\r\n            var t = (tf-t0) * x + t0;\r\n            context.lineTo(x, -f(t)*scaley);\r\n          }\r\n          context.restore();\r\n          context.lineJoin = 'round';\r\n          context.lineWidth = 1;\r\n          context.strokeStyle = color;\r\n          context.stroke();\r\n          context.restore();\r\n        };\r\n\r\n        drawLine(0, canvas.height/2, canvas.width, canvas.height/2, 'aqua');\r\n        drawFunc(\"#FFF\");\r\n      };\r\n    }\r\n  };\r\n}]);\r\n\r\n","var musicShowCaseApp = angular.module(\"MusicShowCaseApp\");\r\nmusicShowCaseApp.directive(\"keyboard\", [\"$timeout\", \"$uibModal\", \"Midi\", \"MusicContext\", function($timeout, $uibModal, Midi, MusicContext) {\r\n  return {\r\n    scope: {\r\n      instrument: '=instrument'\r\n    },\r\n    templateUrl: \"site/templates/keyboard.html\",\r\n    link: function(scope, element, attrs) {\r\n      var inputs;\r\n      var onMIDIMessage = function(event) {\r\n        var command = event.data[0];\r\n        var value = event.data[1];\r\n        var velocity = event.data[2];\r\n\r\n        var octaveNumber = Math.floor(value/12);\r\n        if (octaveNumber < 0) return;\r\n\r\n        var oct = scope.octaves[octaveNumber];\r\n        if (!oct) return;\r\n\r\n        if (command === 144) {\r\n          oct.midi[value % 12] = true;\r\n          oct.update();\r\n        } else if (command === 128) {\r\n          oct.midi[value % 12] = false;\r\n          oct.update();\r\n        }\r\n      };\r\n      var listener = Midi.registerEventListener(onMIDIMessage);\r\n      var updateMidiStatus = function() {\r\n        Midi.getStatus()\r\n          .then(function(data) {\r\n            $timeout(function() {\r\n              scope.midiConnected = data.connected;\r\n            });\r\n          });\r\n      };\r\n\r\n      updateMidiStatus();\r\n\r\n      scope.$on(\"$destroy\", function() {\r\n        listener.destroy();\r\n      });\r\n\r\n      var keyCodeToNote = {\r\n              90: 'C', 83: 'C#', 88: 'D',  68: 'D#', 67: 'E',\r\n              86: 'F', 71: 'F#', 66: 'G', 72: 'G#', 78: 'A', \r\n              74: 'A#', 77: 'B'};\r\n\r\n      var stopAll = function(x) {\r\n        return x.stopAll();\r\n      };\r\n\r\n      var update = function(octave) {\r\n        return octave.update();\r\n      };\r\n\r\n      scope.midiSetup = function() {\r\n        var modalIns = $uibModal.open({\r\n          templateUrl: \"site/templates/modal/midiSettings.html\",\r\n          controller: \"midiSettingsModalCtrl\"\r\n        }).result.then(updateMidiStatus);\r\n      };\r\n\r\n      scope.stopAll = function() {\r\n        scope.octaves.forEach(stopAll);\r\n      };\r\n\r\n      var octave = function(base) {\r\n        return {\r\n          mouse: {},\r\n          key: {},\r\n          midi: {},\r\n          note: [],\r\n          play: function(idx) {\r\n            if (this.note[idx]) return;\r\n\r\n            this.note[idx] = scope.instrument.note(base+idx).play();\r\n          },\r\n          stop: function(idx) {\r\n            if (!this.note[idx])return;\r\n            this.note[idx].stop();\r\n            this.note[idx] = undefined;\r\n          },\r\n          update: function() {\r\n            for (var idx=0; idx<12; idx++) {\r\n              if (this.mouse[idx] || this.key[idx] || this.midi[idx]) {\r\n                this.play(idx);\r\n              } else {\r\n                this.stop(idx);\r\n              }\r\n            }\r\n\r\n            $timeout(function(){});\r\n          },\r\n          stopAll: function() {\r\n            this.note.forEach(function(note) {\r\n              if(note && note.stop) note.stop();\r\n            });\r\n            this.note = [];\r\n          }\r\n        };\r\n      };\r\n\r\n      var gesture = function() {\r\n        MusicContext.resumeAudio();\r\n      };\r\n\r\n      var mouseOff = function(octave) {\r\n        gesture();\r\n\r\n        octave.mouse = {};\r\n        octave.update();\r\n      };\r\n\r\n      scope.mouseLeave = function(octave, idx) {\r\n        gesture();\r\n\r\n        octave.mouse[idx] = false;\r\n        octave.update();\r\n      };\r\n\r\n      scope.mouseEnter = function(octave, idx) {\r\n        gesture();\r\n\r\n        scope.octaves.forEach(mouseOff);\r\n        octave.mouse[idx] = true;\r\n\r\n        scope.octaves.forEach(update);\r\n      };\r\n\r\n      var keyDownHandler = function(e) {\r\n        gesture();\r\n\r\n        if (document.activeElement.tagName.toLowerCase() === \"input\") return;\r\n\r\n        var keyCode = e.keyCode;\r\n        var noteName = keyCodeToNote[keyCode];\r\n        if (!noteName) return;\r\n\r\n        var idx = MUSIC.noteToNoteNum(noteName);\r\n        scope.octaves[1].key[idx] = true;\r\n        scope.octaves[1].update();\r\n\r\n        scope.$digest();\r\n      }\r\n\r\n      var keyUpHandler = function(e) {\r\n        gesture();\r\n\r\n        var keyCode = e.keyCode;\r\n        var noteName = keyCodeToNote[keyCode];\r\n        if (!noteName) return;\r\n\r\n        var idx = MUSIC.noteToNoteNum(noteName);\r\n        scope.octaves[1].key[idx] = false;\r\n        scope.octaves[1].update();\r\n\r\n        scope.$digest();\r\n      }\r\n\r\n      $(document).bind(\"keydown\", keyDownHandler);\r\n      $(document).bind(\"keyup\", keyUpHandler);\r\n      \r\n      var pianoFirstRow = $(element).find(\".piano-firstrow .key\");\r\n      var pianoSecondRow = $(element).find(\".piano-secondrow .key\");\r\n      \r\n      pianoFirstRow.bind(\"click\", gesture);\r\n      pianoSecondRow.bind(\"click\", gesture);\r\n\r\n      scope.$on(\"$destroy\", function() {\r\n        $(document).unbind(\"keydown\", keyDownHandler);\r\n        $(document).unbind(\"keyup\", keyUpHandler);\r\n\r\n        pianoFirstRow.unbind(\"click\", gesture);\r\n        pianoSecondRow.unbind(\"click\", gesture);\r\n\r\n        scope.octaves.forEach(function(octave) {\r\n          octave.stopAll();\r\n        });\r\n      });\r\n\r\n      scope.octaves = [24,36,48,60,72].map(octave);\r\n      scope.$watch(\"instrument\", function(instrument) {\r\n        scope.instrument = instrument;\r\n      });\r\n    }\r\n  };\r\n\r\n}]);\r\n","musicShowCaseApp.directive(\"musicEventEditor\", [\"$timeout\", \"TICKS_PER_BEAT\", \"Pattern\", \"MusicContext\", function($timeout, TICKS_PER_BEAT, Pattern, MusicContext) {\r\n  return {\r\n    scope: {\r\n      /* Current pattern */\r\n      pattern: \"=pattern\",\r\n      /* Current track */\r\n      track: \"=track\",\r\n      /* Display params */\r\n      zoomLevel: \"=zoomLevel\",\r\n      beatWidth: \"=beatWidth\",\r\n      /* File params (common to all tracks) */\r\n      measure: \"=measure\",\r\n      measureCount: \"=measureCount\",\r\n      recipe: '=recipe'\r\n    },\r\n    templateUrl: \"site/templates/directives/musicEventEditor.html\",\r\n    link: function(scope, element, attrs) {\r\n      scope.TICKS_PER_BEAT = TICKS_PER_BEAT;\r\n      var defaultL = TICKS_PER_BEAT;\r\n\r\n      var clearShadow = function() {\r\n        scope.shadowEvt = null;\r\n      };\r\n\r\n      var defaultMouseLeave = clearShadow;\r\n\r\n      var defaultMouseMove = function(event) {\r\n        var clipDistance = TICKS_PER_BEAT / scope.zoomLevel;\r\n        if (!event.target.classList.contains(\"event-list\")) {\r\n          return;\r\n        }\r\n\r\n\r\n        scope.shadowEvt = scope.shadowEvt || {};\r\n        scope.shadowEvt.n = Math.floor(upperLimit() - event.offsetY / 20);\r\n        scope.shadowEvt.l = defaultL;\r\n\r\n        if (scope.shadowEvt.s) {\r\n          var exactPosition = Math.floor(event.offsetX / scope.beatWidth / scope.zoomLevel * TICKS_PER_BEAT);\r\n          exactPosition = Math.floor(exactPosition);\r\n          var clipS = Pattern.findClipS(scope.pattern, scope.track, {s: exactPosition, l: defaultL}, exactPosition);\r\n\r\n          if (Math.abs(exactPosition - clipS - clipDistance / 2) < clipDistance) {\r\n            scope.shadowEvt.s = clipS;\r\n\r\n            Pattern.cutEvent(scope.pattern, scope.track, scope.shadowEvt);\r\n            return;\r\n          }\r\n        }\r\n\r\n        scope.shadowEvt.s = Math.floor(Math.floor(event.offsetX / 2 / scope.beatWidth) * 2 / scope.zoomLevel * TICKS_PER_BEAT);\r\n        if (scope.shadowEvt.s < 0) scope.shadowEvt.s = 0;\r\n        Pattern.cutEvent(scope.pattern, scope.track, scope.shadowEvt);\r\n      };\r\n\r\n      var semitoneToNote = function(n) {\r\n        return [0,[0,1], 1, [1,2], 2, 3, [3,4], 4, [4,5], 5, [5,6], 6][n%12];\r\n      };\r\n\r\n      var noteToSemitone = function(n) {\r\n        return [0,2,4,5,7,9,11][n%7];\r\n      };\r\n\r\n      var notation7 = function(n) {\r\n        return [\"C\",\"D\",\"E\",\"F\",\"G\",\"A\",\"B\"][n % 7];\r\n      };\r\n\r\n      scope.raiseEventChanged = function(oldevt, evt, track) {\r\n        scope.$emit('eventChanged', {oldevt: oldevt,evt: evt, track: track})\r\n      };\r\n\r\n      scope.noteName = function(n) {\r\n        var note7 = semitoneToNote(n);\r\n        var octave = Math.floor(n/12);\r\n\r\n        if (Array.isArray(note7)) {\r\n          note7 = note7[0]\r\n          return notation7(note7) + '#' + octave;\r\n        } else {\r\n          return notation7(note7) + octave;\r\n        }\r\n      };\r\n\r\n      var updateGrid = function() {\r\n        scope.mainGridStyle = {\"background-size\": (scope.measure*scope.beatWidth*scope.zoomLevel) + \"px 240px\"};\r\n      };\r\n\r\n      scope.$watch(\"[measure, beatWidth, zoomLevel]\", updateGrid);\r\n      scope.$watch(\"track.scroll\", function() {\r\n        scope.$emit(\"trackChanged\", scope.track);        \r\n      });\r\n\r\n      $timeout(updateGrid);\r\n\r\n      var addNewEvent = function(newEvt) {\r\n        if (scope.track.events.find(function(evt) {\r\n          return newEvt.s === evt.s && newEvt.n === evt.n;\r\n        })) {\r\n          return;\r\n        }\r\n\r\n        newEvt = angular.copy(newEvt);\r\n\r\n        if (Pattern.collision(scope.track, newEvt)) return;\r\n\r\n        scope.$emit(\"patternSelectEvent\", newEvt);\r\n        scope.selected = newEvt;\r\n\r\n        scope.recipe.raise('pattern_note_added');\r\n        scope.track.events.push(newEvt);\r\n\r\n        scope.$emit(\"trackChanged\", scope.track);\r\n        scope.$emit(\"eventChanged\", {oldevt:{}, evt:newEvt, track: scope.track});\r\n\r\n        scope.mouseMove = moveEvent(newEvt, 0);\r\n        scope.mouseMoveEvent = moveEventFromEvent(newEvt, 0);\r\n\r\n        clearShadow();\r\n\r\n        scope.mouseLeave = function() {\r\n          defaultMouseLeave();\r\n          cancelMove();\r\n        };\r\n\r\n        scope.mouseUpResizeEvent = cancelMove;\r\n        scope.mouseUpEvent = cancelMove;\r\n        scope.mouseUp = cancelMove;\r\n      };\r\n\r\n      scope.mouseMoveResizeEvent = function() {\r\n        clearShadow();\r\n      };\r\n\r\n      scope.shadowMouseMove = function(event) {\r\n        var deltaS = Math.floor(event.offsetX / 2 / scope.beatWidth) * 2 / scope.zoomLevel * TICKS_PER_BEAT;\r\n        if (deltaS > 0) scope.shadowEvt.s = scope.shadowEvt.s + deltaS;\r\n\r\n        Pattern.cutEvent(scope.pattern, scope.track, scope.shadowEvt);\r\n      };\r\n\r\n      scope.addFromShadow = function(event) {\r\n        addNewEvent(scope.shadowEvt);\r\n      };\r\n\r\n      scope.mouseUp = function(event) {\r\n        scope.mouseMove = defaultMouseMove;\r\n      };\r\n\r\n      scope.mouseLeave = function() {\r\n        defaultMouseLeave();\r\n        scope.mouseMove = defaultMouseMove;\r\n      };\r\n\r\n      scope.mouseMove = defaultMouseMove;\r\n      scope.mouseMoveEvent = clearShadow;\r\n\r\n      var upperLimit = function() {\r\n        return scope.track.instrument === 'tempo' ? 1024 : 120;\r\n      };\r\n\r\n      var max = function(c1, c2) {\r\n        return c1 > c2 ? c1 : c2;\r\n      };\r\n\r\n      var preventCollision = function(evt, f) {\r\n        return function() {\r\n          var savedEvt = angular.copy(evt);\r\n          var ret = f.apply(null, arguments);\r\n\r\n          if (Pattern.collision(scope.track, evt)) {\r\n            evt.n = savedEvt.n;\r\n            evt.s = savedEvt.s;\r\n            evt.l = savedEvt.l;\r\n            return;\r\n          }\r\n\r\n          if (evt.n !== savedEvt.n || evt.l !== savedEvt.l || evt.s !== savedEvt.s) {\r\n            scope.$emit(\"trackChanged\", scope.track);\r\n            scope.$emit(\"eventChanged\", {oldevt: savedEvt, evt:evt, track: scope.track});\r\n          }\r\n        };\r\n      };\r\n\r\n      var moveEvent = function(evt, offsetX) {\r\n        return function(event) {\r\n          MusicContext.resumeAudio();\r\n\r\n          var clipDistance = TICKS_PER_BEAT / scope.zoomLevel;\r\n          var oldevt = {n:evt.n, s:evt.s, l:evt.l};\r\n\r\n          var exactPosition = Math.floor((event.offsetX - offsetX) / scope.beatWidth / scope.zoomLevel * TICKS_PER_BEAT);\r\n          exactPosition = Math.floor(exactPosition);\r\n          var clipS = Pattern.findClipS(scope.pattern, scope.track, evt, exactPosition);\r\n\r\n          if (!event.target.classList.contains(\"event-list\")) return;\r\n\r\n          if (Math.abs(exactPosition - clipS - clipDistance / 2) < clipDistance) {\r\n            evt.s = clipS;\r\n          } else {\r\n            evt.s = Math.floor((event.offsetX - offsetX) / 2 / scope.beatWidth) * 2 / scope.zoomLevel * TICKS_PER_BEAT;\r\n            evt.s = Math.floor(evt.s);\r\n          }\r\n\r\n          if (evt.s < 0) evt.s = 0;\r\n\r\n          var oldN = evt.n;\r\n          evt.n = Math.floor(upperLimit() - event.offsetY / 20);\r\n        };\r\n      };\r\n\r\n      var moveEventFromEvent = function(evt, offsetX) {\r\n        clearShadow();\r\n        return function(dragevt, event) {\r\n          MusicContext.resumeAudio();\r\n\r\n          var clipDistance = TICKS_PER_BEAT / scope.zoomLevel;\r\n          var oldevt = {n:evt.n, s:evt.s, l:evt.l};\r\n\r\n          var exactPosition = dragevt.s + Math.floor((event.offsetX - offsetX) / scope.beatWidth / scope.zoomLevel * TICKS_PER_BEAT);\r\n          exactPosition = Math.floor(exactPosition);\r\n          var clipS = Pattern.findClipS(scope.pattern, scope.track, evt, exactPosition);\r\n\r\n          if (Math.abs(exactPosition - clipS - clipDistance / 2) < clipDistance) {\r\n            evt.s = clipS;\r\n          } else {\r\n            evt.s = dragevt.s + Math.floor((event.offsetX - offsetX) / 2 / scope.beatWidth) * 2 / scope.zoomLevel * TICKS_PER_BEAT;\r\n            evt.s = Math.floor(evt.s);\r\n          }\r\n\r\n          evt.n = dragevt.n;\r\n          if (evt.s < 0) evt.s = 0;\r\n        };\r\n      };\r\n\r\n      var cancelMove = function() {\r\n        scope.mouseMoveEvent = clearShadow;\r\n        scope.mouseMove = defaultMouseMove;\r\n        scope.mouseLeave = defaultMouseLeave;\r\n      };\r\n\r\n      scope.mouseDown = function(event) {\r\n        MusicContext.resumeAudio();\r\n\r\n        if (!event.target.classList.contains(\"event-list\")) return;\r\n        var newEvt = {\r\n          n: Math.floor(upperLimit() - event.offsetY / 20),\r\n          s: Math.floor(event.offsetX / scope.beatWidth) / scope.zoomLevel * TICKS_PER_BEAT,\r\n          l: defaultL\r\n        };\r\n\r\n        newEvt.s = Math.floor(newEvt.s);\r\n\r\n        Pattern.cutEvent(scope.pattern, scope.track, newEvt);\r\n        addNewEvent(newEvt);\r\n      };\r\n\r\n      var eventSplit = function(evt, ticks) {\r\n        var originalL = evt.l;\r\n        evt.l = ticks;\r\n        var newEvt = {\r\n          n: evt.n,\r\n          s: evt.s + evt.l,\r\n          l: originalL - ticks\r\n        };\r\n        scope.recipe.raise('pattern_note_added');\r\n        scope.track.events.push(newEvt);\r\n      }\r\n\r\n      var eventLeftSplit = function(evt) {\r\n        if (evt.l % 3 === 0) {\r\n          eventSplit(evt, evt.l / 3);\r\n        } else {\r\n          eventCenterSplit(evt);\r\n        }\r\n      };\r\n\r\n      var eventRightSplit = function(evt) {\r\n        if (evt.l % 3 === 0) {\r\n          eventSplit(evt, evt.l * 2 / 3);\r\n        } else {\r\n          eventCenterSplit(evt);\r\n        }\r\n      };\r\n\r\n      var eventCenterSplit = function(evt) {\r\n        if (evt.l % 2 === 0) {\r\n          eventSplit(evt, evt.l / 2);\r\n        }\r\n      };\r\n\r\n      scope.mouseDblClickEvent = function(evt, event) {\r\n        var elementWidth = $(event.target)[0].clientWidth+5;\r\n\r\n        if (event.offsetX < elementWidth/3) {\r\n          eventLeftSplit(evt);\r\n        } else if (event.offsetX > elementWidth*2/3) {\r\n          eventRightSplit(evt);\r\n        } else {\r\n          eventCenterSplit(evt);\r\n        }\r\n      };\r\n\r\n      scope.mouseDownEvent = function(evt, event) {\r\n        MusicContext.resumeAudio();\r\n\r\n        event.preventDefault();\r\n        document.activeElement.blur();\r\n\r\n        scope.$emit(\"eventSelected\", {evt: evt, track: scope.track});\r\n\r\n        scope.$emit(\"patternSelectEvent\", evt);\r\n        scope.selected = evt;\r\n\r\n        scope.mouseMove = preventCollision(evt, moveEvent(evt, event.offsetX));\r\n        scope.mouseMoveEvent = preventCollision(evt, moveEventFromEvent(evt, event.offsetX));\r\n\r\n        clearShadow();\r\n\r\n        scope.mouseLeave = function() {\r\n          defaultMouseLeave();\r\n          cancelMove();\r\n        };\r\n\r\n        var _cancelMove = function() {\r\n          scope.recipe.raise('pattern_note_drag');\r\n          cancelMove();\r\n        };\r\n\r\n        scope.mouseUpResizeEvent = _cancelMove;\r\n        scope.mouseUpEvent = _cancelMove;\r\n        scope.mouseUp = _cancelMove;\r\n      };\r\n\r\n      scope.mouseDownResizeEvent = function(evt, event) {\r\n        MusicContext.resumeAudio();\r\n\r\n        event.preventDefault();\r\n\r\n        scope.$emit(\"patternSelectEvent\", evt);\r\n        scope.selected = evt;\r\n\r\n        scope.mouseMove = preventCollision(evt, function(event) {\r\n          var oldevt = {n:evt.n, s:evt.s, l:evt.l};\r\n          var clipDistance = TICKS_PER_BEAT / scope.zoomLevel;\r\n          var clipL = Pattern.findClipL(scope.pattern, scope.track, evt, evt.s);\r\n\r\n          if (!event.target.classList.contains(\"event-list\")) return;\r\n\r\n          var exactL = Math.floor(event.offsetX / scope.beatWidth / scope.zoomLevel * TICKS_PER_BEAT) - evt.s;\r\n\r\n          if (Math.abs(exactL - clipL - clipDistance) < clipDistance) {\r\n            evt.l = clipL;\r\n          } else {\r\n            var refs = Math.floor(event.offsetX / scope.beatWidth / 2) * 2 / scope.zoomLevel * TICKS_PER_BEAT;\r\n            evt.l = refs - evt.s;\r\n            evt.l = Math.floor(evt.l);\r\n            if (evt.l<TICKS_PER_BEAT/scope.zoomLevel) evt.l=TICKS_PER_BEAT/scope.zoomLevel;\r\n\r\n            defaultL = evt.l;\r\n          }\r\n        });\r\n\r\n        scope.mouseMoveEvent = preventCollision(evt, function(dragevt, event) {\r\n          var oldevt = {n:evt.n, s:evt.s, l:evt.l};\r\n          var clipDistance = TICKS_PER_BEAT / scope.zoomLevel;\r\n          var clipL = Pattern.findClipL(scope.pattern, scope.track, evt, evt.s);\r\n\r\n          var exactL = dragevt.s + \r\n            Math.floor(event.offsetX / scope.beatWidth / scope.zoomLevel * TICKS_PER_BEAT) -\r\n            evt.s;\r\n\r\n          if (Math.abs(exactL - clipL - clipDistance) < clipDistance) {\r\n            evt.l = clipL;\r\n          } else {\r\n            var refs = dragevt.s + Math.floor(event.offsetX / scope.beatWidth / 2) * 2 / scope.zoomLevel * TICKS_PER_BEAT;\r\n            evt.l = refs - evt.s;\r\n            evt.l = Math.floor(evt.l);\r\n\r\n            if (evt.l<TICKS_PER_BEAT/scope.zoomLevel) evt.l=TICKS_PER_BEAT/scope.zoomLevel;\r\n\r\n            defaultL = evt.l;\r\n          }\r\n        });\r\n\r\n        scope.mouseUpResizeEvent = cancelMove;\r\n        scope.mouseUpEvent = cancelMove;\r\n        scope.mouseUp = cancelMove;\r\n      };\r\n\r\n      var keyDownHandler = function(e) {\r\n        if (document.activeElement.tagName.toLowerCase() === \"input\") return;\r\n\r\n        if (e.keyCode == 46) {\r\n          $timeout(function() {\r\n            scope.track.events = scope.track.events.filter(function(evt) { return evt !== scope.selected; });\r\n            scope.$emit(\"trackChanged\", scope.track);\r\n          });\r\n        }\r\n      };\r\n\r\n      $(document).bind(\"keydown\", keyDownHandler);\r\n      scope.$on(\"$destroy\", function() {\r\n        $(document).unbind(\"keydown\", keyDownHandler);\r\n      });\r\n\r\n      scope.$on(\"trackSelectEvent\", function(evt, event) {\r\n        scope.selected = event;\r\n      });\r\n    }\r\n  };\r\n}]);\r\n","var musicShowCaseApp = angular.module(\"MusicShowCaseApp\");\r\nmusicShowCaseApp.directive(\"ngfDrop\", [\"$parse\", function($parse) {\r\n  return {\r\n    restrict: 'A',\r\n    link: function(scope, element, attrs) {\r\n      var ngfDropGetter = $parse(attrs.ngfDrop);\r\n\r\n      var allowDrag = function(e) {\r\n        e.dataTransfer.dropEffect = 'copy';\r\n        e.preventDefault();\r\n      }\r\n\r\n      var onDrop = function(e) {\r\n        ngfDropGetter(scope, {'$files': e.dataTransfer.files});\r\n        e.preventDefault();\r\n      };\r\n\r\n      window.addEventListener('dragenter', allowDrag);\r\n      window.addEventListener('dragover', allowDrag)\r\n      window.addEventListener('drop', onDrop);\r\n\r\n      scope.$on(\"$destroy\", function() {\r\n        window.removeEventListener('dragenter', allowDrag);\r\n        window.removeEventListener('dragover', allowDrag);\r\n        window.removeEventListener('drop', onDrop);\r\n      });\r\n    }\r\n  };\r\n}]);\r\n","var musicShowCaseApp = angular.module(\"MusicShowCaseApp\");\r\nmusicShowCaseApp.directive(\"ngfLoader\", [\"$parse\", function($parse) {\r\n  return {\r\n    restrict: 'A',\r\n    link: function(scope, element, attrs) {\r\n      var ngfLoaderGetter = $parse(attrs.ngfLoader);\r\n      var onChange =  function(e) {\r\n        ngfLoaderGetter(scope, {'$files': e.target.files});\r\n        $(element).val(\"\");\r\n      };\r\n\r\n      $(element).on('change', onChange);\r\n      scope.$on('$destroy', function() {\r\n        $(element).off('change', onChange);\r\n      });\r\n    }\r\n  };\r\n}]);\r\n","musicShowCaseApp.directive(\"patternTrackCompactView\", [\"$timeout\", \"TICKS_PER_BEAT\", \"Recipe\", \"Pattern\", \"MusicContext\", function($timeout, TICKS_PER_BEAT, Recipe, Pattern, MusicContext) {\r\n  return {\r\n    scope: {\r\n      /* Current pattern */\r\n      pattern: \"=pattern\",\r\n      /* Current track */\r\n      track: \"=track\",\r\n      /* Display params */\r\n      zoomLevel: \"=zoomLevel\",\r\n      beatWidth: \"=beatWidth\",\r\n      /* File params (common to all tracks) */\r\n      measure: \"=measure\",\r\n      measureCount: \"=measureCount\"\r\n    },\r\n    templateUrl: \"site/templates/directives/patternTrackCompactView.html\",\r\n    link: function(scope, element) {\r\n      scope.recipe = Recipe.start;\r\n\r\n      scope.TICKS_PER_BEAT = TICKS_PER_BEAT;\r\n      var semitoneToNote = function(n) {\r\n        return [0,[0,1], 1, [1,2], 2, 3, [3,4], 4, [4,5], 5, [5,6], 6][n%12];\r\n      };\r\n      var notation7 = function(n) {\r\n        return [\"C\",\"D\",\"E\",\"F\",\"G\",\"A\",\"B\"][n % 7];\r\n      };\r\n      scope.noteName = function(n) {\r\n        var note7 = semitoneToNote(n);\r\n        var octave = Math.floor(n/12);\r\n\r\n        if (Array.isArray(note7)) {\r\n          note7 = note7[0]\r\n          return notation7(note7) + '#' + octave;\r\n        } else {\r\n          return notation7(note7) + octave;\r\n        }\r\n      };\r\n      \r\n      var updateGrid = function() {\r\n        scope.mainGridStyle = {\r\n          \"background-size\": (scope.measure*scope.beatWidth*scope.zoomLevel) + \"px 240px\",\r\n          \"background-position\": -scope.pattern.scrollLeft + \"px\"\r\n        };\r\n      };\r\n      scope.$watch(\"[measure, beatWidth, zoomLevel, pattern.scrollLeft]\", updateGrid);\r\n      scope.$on(\"trackSelectEvent\", function(evt, event) {\r\n        scope.selected = event;\r\n      });\r\n\r\n\r\n      var mouseUp = function(event) {\r\n        scope.$emit(\"enableTrack\", scope.track);\r\n        scope.mouseMove = function() {};\r\n      };\r\n\r\n      scope.mouseUp = mouseUp;\r\n\r\n      scope.mouseLeave = function() {\r\n        scope.mouseMove = function() {};\r\n      };\r\n\r\n      var cancelMove = function() {\r\n        scope.mouseMoveEvent = function(){};\r\n        scope.mouseMove = function(){};\r\n        scope.mouseLeave = function(){};\r\n      };\r\n\r\n      scope.mouseDownEvent = function(evt, event) {\r\n        var moved = false;\r\n\r\n        var moveEvent = function(evt, offsetX) {\r\n          return function(event) {\r\n            MusicContext.resumeAudio();\r\n\r\n            var clipDistance = TICKS_PER_BEAT / scope.zoomLevel;\r\n            var oldevt = {n:evt.n, s:evt.s, l:evt.l};\r\n\r\n            if (!event.target.parentElement.classList.contains(\"track-compact-view\")) return;\r\n\r\n            var exactPosition = Math.floor((event.offsetX - offsetX) / scope.beatWidth / scope.zoomLevel * TICKS_PER_BEAT);\r\n            exactPosition = Math.floor(exactPosition);\r\n            var clipS = Pattern.findClipS(scope.pattern, scope.track, evt, exactPosition);\r\n\r\n            if (Math.abs(exactPosition - clipS - clipDistance / 2) < clipDistance) {\r\n              evt.s = clipS;\r\n            } else {\r\n              evt.s = Math.floor((event.offsetX - offsetX) / 2 / scope.beatWidth) * 2 / scope.zoomLevel * TICKS_PER_BEAT;\r\n              evt.s = Math.floor(evt.s);\r\n            }\r\n\r\n            if (evt.s < 0) evt.s = 0;\r\n            if (evt.s !== oldevt.s) moved = true;\r\n\r\n            scope.$emit(\"trackChanged\", scope.track);\r\n            scope.$emit(\"eventChanged\", {oldevt: oldevt, evt:evt, track: scope.track});\r\n          };\r\n        };\r\n\r\n        var moveEventFromEvent = function(evt, offsetX) {\r\n          return function(dragevt, event) {\r\n            MusicContext.resumeAudio();\r\n\r\n            var clipDistance = TICKS_PER_BEAT / scope.zoomLevel;\r\n            var oldevt = {n:evt.n, s:evt.s, l:evt.l};\r\n\r\n            var exactPosition = dragevt.s + Math.floor((event.offsetX - offsetX) / scope.beatWidth / scope.zoomLevel * TICKS_PER_BEAT);\r\n            exactPosition = Math.floor(exactPosition);\r\n            var clipS = Pattern.findClipS(scope.pattern, scope.track, evt, exactPosition);\r\n\r\n            if (Math.abs(exactPosition - clipS - clipDistance / 2) < clipDistance) {\r\n              evt.s = clipS;\r\n            } else {\r\n              evt.s = dragevt.s + Math.floor((event.offsetX - offsetX) / 2 / scope.beatWidth) * 2 / scope.zoomLevel * TICKS_PER_BEAT;\r\n              evt.s = Math.floor(evt.s);\r\n            }\r\n\r\n            if (evt.s < 0) evt.s = 0;\r\n            if (evt.s !== oldevt.s) moved = true;\r\n\r\n            scope.$emit(\"trackChanged\", scope.track);\r\n            scope.$emit(\"eventChanged\", {oldevt: oldevt, evt:evt, track: scope.track});\r\n          };\r\n        };\r\n\r\n        event.preventDefault();\r\n        document.activeElement.blur();\r\n\r\n        scope.$emit(\"eventSelected\", {evt: evt, track: scope.track});\r\n\r\n        scope.mouseMove = moveEvent(evt, event.offsetX);\r\n        scope.mouseMoveEvent = moveEventFromEvent(evt, event.offsetX);\r\n\r\n        scope.mouseLeave = function() {\r\n          cancelMove();\r\n        };\r\n\r\n        var _cancelMove = function() {\r\n          scope.recipe.raise('pattern_note_drag');\r\n          cancelMove();\r\n        };\r\n\r\n        scope.mouseUpResizeEvent = _cancelMove;\r\n        scope.mouseUpEvent = _cancelMove;\r\n        scope.mouseUp = function() {\r\n          scope.mouseUp = mouseUp;\r\n\r\n          if (!moved) scope.$emit(\"enableTrack\", scope.track);\r\n\r\n          scope.$emit(\"patternSelectEvent\", evt);\r\n          _cancelMove();\r\n        };\r\n      };\r\n\r\n      scope.mouseDownResizeEvent = function(evt, event) {\r\n        var moved = false;\r\n\r\n        event.preventDefault();\r\n\r\n        scope.mouseMove = function(event) {\r\n          MusicContext.resumeAudio();\r\n\r\n          var oldevt = {n:evt.n, s:evt.s, l:evt.l};\r\n          var clipDistance = TICKS_PER_BEAT / scope.zoomLevel;\r\n          var clipL = Pattern.findClipL(scope.pattern, scope.track, evt, evt.s);\r\n\r\n          if (!event.target.parentElement.classList.contains(\"track-compact-view\")) return;\r\n\r\n          var exactL = Math.floor(event.offsetX / scope.beatWidth / scope.zoomLevel * TICKS_PER_BEAT) - evt.s;\r\n\r\n          if (Math.abs(exactL - clipL - clipDistance) < clipDistance) {\r\n            evt.l = clipL;\r\n          } else {\r\n            var refs = Math.floor(event.offsetX / scope.beatWidth / 2) * 2 / scope.zoomLevel * TICKS_PER_BEAT;\r\n            evt.l = refs - evt.s;\r\n            evt.l = Math.floor(evt.l);\r\n\r\n            if (evt.l<TICKS_PER_BEAT/scope.zoomLevel) evt.l=TICKS_PER_BEAT/scope.zoomLevel;\r\n            defaultL = evt.l;\r\n          }\r\n\r\n          if (evt.l !== oldevt.l) {\r\n            moved = true;\r\n          }\r\n\r\n          scope.$emit(\"trackChanged\", scope.track);\r\n          scope.$emit(\"eventChanged\", {oldevt:oldevt, evt:evt, track: scope.track});\r\n        };\r\n\r\n        scope.mouseMoveEvent = function(dragevt, event) {\r\n          MusicContext.resumeAudio();\r\n\r\n          var oldevt = {n:evt.n, s:evt.s, l:evt.l};\r\n          var clipDistance = TICKS_PER_BEAT / scope.zoomLevel;\r\n          var clipL = Pattern.findClipL(scope.pattern, scope.track, evt, evt.s);\r\n\r\n          var exactL = dragevt.s + \r\n            Math.floor(event.offsetX / scope.beatWidth / scope.zoomLevel * TICKS_PER_BEAT) -\r\n            evt.s;\r\n\r\n          if (Math.abs(exactL - clipL - clipDistance) < clipDistance) {\r\n            evt.l = clipL;\r\n          } else {\r\n            var refs = dragevt.s + Math.floor(event.offsetX / scope.beatWidth / 2) * 2 / scope.zoomLevel * TICKS_PER_BEAT;\r\n            evt.l = refs - evt.s;\r\n            evt.l = Math.floor(evt.l);\r\n\r\n            if (evt.l<TICKS_PER_BEAT/scope.zoomLevel) evt.l=TICKS_PER_BEAT/scope.zoomLevel;\r\n\r\n            defaultL = evt.l;\r\n          }\r\n\r\n          if (evt.l !== oldevt.l) {\r\n            moved = true;\r\n          }          \r\n\r\n          scope.$emit(\"trackChanged\", scope.track);\r\n          scope.$emit(\"eventChanged\", {oldevt:oldevt, evt:evt, track: scope.track});\r\n        };        \r\n\r\n        scope.mouseUpResizeEvent = cancelMove;\r\n        scope.mouseUpEvent = cancelMove;\r\n        scope.mouseUp = function() {\r\n          scope.mouseUp = mouseUp;\r\n\r\n          if (!moved) scope.$emit(\"enableTrack\", scope.track);\r\n\r\n          scope.$emit(\"patternSelectEvent\", evt);\r\n          cancelMove();\r\n        };\r\n      };\r\n\r\n    }\r\n  };\r\n}]);\r\n\r\n","musicShowCaseApp.directive(\"playingLine\", [\"$timeout\", \"$parse\", \"TICKS_PER_BEAT\", function($timeout, $parse, TICKS_PER_BEAT) {\r\n  return {\r\n    scope: {},\r\n    replace: true,\r\n    templateUrl: \"site/templates/directives/playingLine.html\",\r\n    link: function(scope, element, attrs) {\r\n      var t0;\r\n      var timeToTicks;\r\n      var playing = false;\r\n      var getBpm = $parse(attrs.bpm);\r\n      var getZoomLevel = $parse(attrs.zoomLevel);\r\n      var getBeatWidth = $parse(attrs.beatWidth);\r\n\r\n      var bpm, zoomLevel, beatWidth;\r\n\r\n      var ticksToPX = function(ticks) {\r\n        zoomLevel = getZoomLevel(scope.$parent);\r\n        beatWidth = getBeatWidth(scope.$parent);\r\n        return ticks*zoomLevel*beatWidth/TICKS_PER_BEAT;\r\n      };\r\n\r\n      var callback = function() {\r\n        if (bpm && playing) {\r\n          var ticks = timeToTicks((window.performance.now() - t0));\r\n          var displacement = ticksToPX(ticks);\r\n\r\n          element.css(\"left\", (displacement) + \"px\");\r\n        }\r\n        requestAnimationFrame(callback);\r\n      };\r\n\r\n      var playingLine = $(element);\r\n      var requestId = requestAnimationFrame(callback);\r\n\r\n      scope.$on('startClock', function(evt, _timeToTicks) {\r\n        var _t0 = window.performance.now();\r\n\r\n        playing = true;\r\n        bpm = getBpm(scope.$parent);\r\n\r\n        timeToTicks = _timeToTicks;\r\n        t0 = _t0;\r\n      });\r\n\r\n      scope.$on('stopClock', function(evt) {\r\n        playing = false;\r\n      });\r\n\r\n      scope.$on('pauseClock', function(evt) {\r\n        var ticks = timeToTicks((window.performance.now() - t0));\r\n        var displacement = ticksToPX(ticks || 0);\r\n\r\n        playing = false;\r\n        scope.$emit('pausedClock', ticks);\r\n        element.css(\"left\", (displacement) + \"px\");\r\n      });\r\n\r\n      scope.$on('resetClock', function(evt, baseTicks) {\r\n        var displacement = ticksToPX(baseTicks || 0);\r\n\r\n        playing = false;\r\n        element.css(\"left\", (displacement) + \"px\");\r\n      });\r\n\r\n\r\n      scope.$on('$destroy', function() {\r\n        cancelAnimationFrame(requestId);\r\n      });\r\n    }\r\n  };\r\n}]);\r\n\r\n","var musicShowCaseApp = angular.module(\"MusicShowCaseApp\");\r\nmusicShowCaseApp.directive(\"recipeBlink\", [\"$parse\", \"$timeout\", \"Recipe\", function($parse, $timeout, Recipe) {\r\n  return {\r\n    restrict: 'A',\r\n    link: function(scope, element, attrs) {\r\n      var recipeBlinkGetter = $parse(attrs.recipeBlink);\r\n      var blinkElementId = recipeBlinkGetter(scope);\r\n\r\n      if (!Array.isArray(blinkElementId)) {\r\n        blinkElementId = [blinkElementId];\r\n      }\r\n\r\n      var blink = function() {\r\n        $timeout(function() {\r\n          $(element).addClass('blink');\r\n        });\r\n      };\r\n\r\n      var noblink = function() {\r\n        $timeout(function() {\r\n          $(element).removeClass('blink');\r\n        });\r\n      };\r\n\r\n      var registerEvent = function(blinkElementId) {\r\n        if (Recipe.getBlinks().indexOf(blinkElementId) !== -1) {\r\n          blink();\r\n        }\r\n\r\n        scope.$on(\"_blink_enable_\" + blinkElementId, function(event, args) {\r\n          blink();\r\n        });\r\n\r\n        scope.$on(\"_blink_disable_\" + blinkElementId, function() {\r\n          noblink();\r\n        });\r\n\r\n        scope.$on(\"__blink_disable_all\", function() {\r\n          noblink();\r\n        });\r\n      };\r\n\r\n      blinkElementId.forEach(registerEvent);\r\n    }\r\n  };\r\n}]);\r\n\r\n","var musicShowCaseApp = angular.module(\"MusicShowCaseApp\");\r\nmusicShowCaseApp.directive(\"recipeTooltip\", [\"$parse\", \"$timeout\", function($parse, $timeout) {\r\n  return {\r\n    restrict: 'E',\r\n    scope: {},\r\n    template: '<div ng-click=\"onClick($event)\" ng-class=\"{\\'show-recipe-tooltip\\': tooltipEnabled, \\'cap-right\\': capRight}\" class=\"help-tooltip recipe-tooltip\"><p>{{text|translate}}</p></div>',\r\n    link: function(scope, element, attrs) {\r\n      var rtIdGetter = $parse(attrs.rtId);\r\n      var tooltipElementId = rtIdGetter(scope.$parent);\r\n\r\n      scope.tooltipEnabled = false;\r\n      scope.onClick = function(e) {\r\n        scope.$parent.recipe.raise(\"tooltip_click\");\r\n        e.stopImmediatePropagation();\r\n      };\r\n\r\n      scope.$on(\"_tooltip_display_\" + tooltipElementId, function(event, args) {\r\n        $timeout(function() {\r\n          var windowWidth = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);\r\n          var el = element[0];\r\n          var offset = windowWidth - el.getBoundingClientRect().left;\r\n\r\n          scope.capRight = offset < 300;\r\n\r\n          scope.text = args.text;\r\n          scope.tooltipEnabled = true;\r\n        })\r\n      });\r\n\r\n      scope.$on(\"_tooltip_hide_\" + tooltipElementId, function() {\r\n        scope.tooltipEnabled = false;\r\n      });\r\n\r\n      scope.$on(\"__tooltip_hide_all\", function() {\r\n        scope.tooltipEnabled = false;\r\n      });\r\n    }\r\n  };\r\n}]);\r\n\r\n","var musicShowCaseApp = angular.module(\"MusicShowCaseApp\");\r\nmusicShowCaseApp.directive(\"recipeWizard\", [\"$timeout\", function($timeout) {\r\n  return {\r\n    restrict: 'E',\r\n    template: '<div class=\"recipe-wizard\"><p>{{text}}</p></div>',\r\n    link: function(scope, element, attrs) {\r\n    }\r\n  };\r\n}]);\r\n\r\n","var musicShowCaseApp = angular.module(\"MusicShowCaseApp\");\r\nmusicShowCaseApp.directive(\"recycleBinCompactView\", [\"$timeout\", \"$uibModal\", \"FileRepository\", \"ErrMessage\", function($timeout, $uibModal, FileRepository, ErrMessage) {\r\n  return {\r\n    templateUrl: 'site/templates/directives/recycleBinCompactView.html',\r\n    scope: {},\r\n    link: function(scope, element, attrs) {\r\n      var observer = FileRepository.observeRecycled(function() {\r\n        FileRepository.searchRecycled(null, {limit: 10})\r\n          .then(function(result) {\r\n            $timeout(function() {\r\n              scope.files = result.results.slice(0, 4);\r\n            });\r\n          });\r\n      });\r\n\r\n      scope.$on(\"destroy\", observer.destroy);\r\n      \r\n      scope.openRecycleBin = function() {\r\n        // show recycle bin modal\r\n        var modalIns = $uibModal.open({\r\n          templateUrl: \"site/templates/modal/recycleBin.html\",\r\n          controller: \"recycleBinModalCtrl\"\r\n        });\r\n      };\r\n\r\n      scope.restore = function(file) {\r\n        FileRepository.restoreFromRecycleBin(file.id)\r\n          .then(function() {\r\n            if (file.type === 'project') {\r\n              document.location = \"#/editor/\" + file.id;\r\n            } else {\r\n              document.location = \"#/editor/\"+file.project+\"/\"+file.type+\"/\"+file.id;\r\n            }\r\n          });\r\n      };\r\n\r\n      scope.onDropComplete= function(file) {\r\n        FileRepository.moveToRecycleBin(file.id)\r\n          .catch(function(err) {\r\n            if (err.type && err.type === 'cantremove') {\r\n              ErrMessage('common.error_title', 'common.cantremove_error');\r\n            } else {\r\n              throw err;\r\n            }\r\n          });\r\n      };\r\n    }\r\n  };\r\n}]);\r\n\r\n","var musicShowCaseApp = angular.module(\"MusicShowCaseApp\");\r\n\r\nmusicShowCaseApp.filter(\"icon_from_type\", function() {\r\n  return function(type) {\r\n    if (type === \"instrument\") return \"keyboard\";\r\n    if (type === \"tempo\") return \"clock\";\r\n    if (type === \"song\") return \"th\";\r\n    if (type === \"pattern\") return \"music\";\r\n    if (type === \"fx\") return \"magic\";\r\n    if (type === \"project\") return \"folder\";\r\n    return \"question\";\r\n  };\r\n});\r\n\r\nmusicShowCaseApp.directive(\"typeIcon\", [\"$parse\", function($parse) {\r\n  return {\r\n    restrict: 'A',\r\n    scope: {},\r\n    replace: true,\r\n    template: '<span class=\"fa fa-{{typeIcon | icon_from_type}}\">',\r\n    link: function(scope, element, attrs) {\r\n      var iconTypeName = $parse(attrs.typeIcon);\r\n\r\n      scope.$parent.$watch(iconTypeName, function(newValue) {\r\n        scope.typeIcon = iconTypeName(scope.$parent);\r\n      });\r\n    }\r\n  };\r\n}]);\r\n","var musicShowCaseApp = angular.module(\"MusicShowCaseApp\");\r\n\r\nmusicShowCaseApp.factory(\"MusicObjectFactory\", [\"MusicContext\", \"$q\", \"TypeService\", \"pruneWrapper\", function(MusicContext, $q, TypeService, pruneWrapper) {\r\n  var fileOutputMap = new WeakMap();\r\n\r\n  return function(options) {\r\n    var nextId = 0;\r\n\r\n    var _last_type = {};\r\n    var ___cache = {};\r\n\r\n    var monitor = options && options.monitor;\r\n\r\n    var getConstructor = function(descriptor, channel) {\r\n        return TypeService.getType(descriptor.type)\r\n          .then(function(type) {\r\n            if (type.monitor && !monitor) {\r\n              return function(subobjects) {\r\n                var wrapped = subobjects[0];\r\n                return function(music) {\r\n                  return wrapped(music);\r\n                };\r\n              };\r\n            }\r\n\r\n            var ret = function(subobjects) {\r\n              var buildComponents = [];\r\n\r\n              if (type.components) {\r\n                type.components.forEach(function(componentName) {\r\n                  if (!descriptor.data.modulation) return;\r\n\r\n                  var value = descriptor.data.modulation[componentName];\r\n                  if (!value) return;\r\n                  if (!value.data) return;\r\n                  if (!value.data.array) return;\r\n                  if (value.data.array.length === 0) return;\r\n\r\n                  buildComponents.push(\r\n                    createParametric(value)\r\n                      .then(function(obj) {\r\n                        return {\r\n                          name: componentName,\r\n                          obj: obj\r\n                        };\r\n                      })\r\n                  );\r\n\r\n                });\r\n              }\r\n\r\n              return $q.all(buildComponents)\r\n                .then(function(objs) {\r\n                  var components = {};\r\n                  objs.forEach(function(obj) {\r\n                    components[obj.name] = obj.obj;\r\n                  });\r\n\r\n                  _last_type[channel] = _last_type[channel] || new WeakMap();\r\n                  ___cache[channel] = ___cache[channel] || new WeakMap();\r\n                  var last_type = _last_type[channel];\r\n                  var __cache = ___cache[channel];\r\n\r\n/*>                  if (!last_type.has(descriptor)||last_type.get(descriptor) === descriptor.type) {\r\n                    if (subobjects.length === 1) {\r\n                      if (__cache.has(descriptor) && __cache.get(descriptor)[subobjects[0].id]) {\r\n                        return $q(function(resolve) {\r\n                          resolve(__cache.get(descriptor)[subobjects[0].id]\r\n                                .update(descriptor.data, components));\r\n                        });\r\n                      }\r\n                    } else if (subobjects.length === 0) {\r\n                      if (__cache.has(descriptor) && __cache.get(descriptor).noid) {\r\n                        return $q(function(resolve) {\r\n                          resolve(__cache.get(descriptor).noid\r\n                                .update(descriptor.data, components));\r\n                        });\r\n                      }\r\n                    }\r\n                  }*/\r\n\r\n                  last_type.set(descriptor, descriptor.type);\r\n\r\n                  var ret = type.constructor(descriptor.data, subobjects, components);\r\n                  nextId++;\r\n                  ret.id = nextId;\r\n\r\n                  if (subobjects.length === 1) {\r\n                    if (!__cache.has(descriptor)) __cache.set(descriptor, {});\r\n                    __cache.get(descriptor)[subobjects[0].id] = ret;\r\n                  } else if (subobjects.length === 0) {\r\n                    if (!__cache.has(descriptor)) __cache.set(descriptor, {});\r\n                    __cache.get(descriptor).noid = ret;\r\n                  }\r\n\r\n                  return ret;\r\n\r\n                })\r\n            };\r\n\r\n            ret.subobjects = type.subobjects;\r\n\r\n            return ret;\r\n          });\r\n    };\r\n\r\n    var createParametricFromStack = function(array, idx, channel) {\r\n      if (array.length === 0) return $q.when(null);\r\n\r\n      var descriptor = array[idx];\r\n      channel = channel || 0;\r\n\r\n      return getConstructor(descriptor, channel)\r\n        .then(function(constructor) {\r\n          if (constructor.subobjects) {\r\n            var getObject = function(d, index) {\r\n              var newArray = d.data.array.concat(array.slice(idx+1));\r\n              return createParametricFromStack(newArray, 0, channel*16 + index);\r\n            };\r\n\r\n            return $q.all(descriptor.data.subobjects.map(getObject))\r\n              .then(function(objs) {\r\n                return constructor(objs);\r\n              });\r\n          }\r\n\r\n          if (array.length === 1) {\r\n            return constructor([]);\r\n          }\r\n\r\n          return createParametricFromStack(array.slice(idx+1), 0, channel)\r\n            .then(function(obj) {\r\n              return constructor([obj]);\r\n            });\r\n        })\r\n        .then(function(obj) {\r\n          if (obj && obj.dataLink) {\r\n            obj.dataLink(notifyChangeFor(descriptor));\r\n          }\r\n          return obj;\r\n        });\r\n    };\r\n\r\n    var notifyChangeFor = function(descriptor) {\r\n      return function(output) {\r\n        if (fileOutputMap.has(descriptor)) {\r\n          var ee = fileOutputMap.get(descriptor);\r\n          ee.emit('changed', output);\r\n        }\r\n      };\r\n    };\r\n\r\n    var createParametric = function(descriptor) {\r\n      if (descriptor.type === \"stack\") {\r\n        return createParametricFromStack(descriptor.data.array, 0)\r\n      } else {\r\n        return getConstructor(descriptor, 0)\r\n          .then(function(constructor) {\r\n            return constructor([]); \r\n          });\r\n      }\r\n    };\r\n\r\n    var destroyAll = function(obj) {\r\n      for (var channel in _last_type) {\r\n        _last_type[channel] = new WeakMap();\r\n      }\r\n      for (var channel in ___cache) {\r\n        ___cache[channel] = new WeakMap(); \r\n      }\r\n\r\n      bases.forEach(function(base) {\r\n        base.prune();\r\n      });\r\n\r\n      bases = [];\r\n\r\n      return $q.when(null);\r\n    };\r\n\r\n    var bases = [];\r\n    var create = function(descriptor, music) {\r\n      return createParametric(descriptor)\r\n        .then(function(fcn) {\r\n          if (!fcn) return;\r\n\r\n          if (music) {\r\n            var base= music.sfxBase();\r\n            bases.push(base);\r\n            return fcn(base);\r\n          }\r\n          return MusicContext.runFcn(function(music) {\r\n            var base = music.sfxBase();\r\n            bases.push(base);\r\n            return fcn(base);\r\n          });\r\n        });\r\n    };\r\n\r\n    var observeOutput = function(file, listener) {\r\n      var ee;\r\n\r\n      if (fileOutputMap.has(file)) {\r\n        ee = fileOutputMap.get(file);\r\n      } else {\r\n        ee = new EventEmitter();\r\n        fileOutputMap.set(file, ee)\r\n      }\r\n\r\n      ee.on('changed', listener);\r\n\r\n      return {\r\n        destroy: function() {\r\n          ee.removeListener('changed', listener);\r\n        }\r\n      }\r\n    };\r\n\r\n    return {\r\n      create: create,\r\n      destroyAll: destroyAll,\r\n      observeOutput: observeOutput\r\n    };\r\n  };\r\n}]);\r\n\r\nmusicShowCaseApp.service(\"MusicContext\", function() {\r\n  var music;\r\n  var context;\r\n\r\n  var Recordable = function(music, playable, name) {\r\n    this._playable = playable;\r\n    this._music = music;\r\n    this._name = name;\r\n  };\r\n\r\n  Recordable.prototype.record = function() {\r\n    var playable = this._playable;\r\n    var recording = music.record();\r\n    var recordFileName = this._name;\r\n    var playing = playable.play();\r\n\r\n    MUSIC.Utils.FunctionSeq.preciseTimeout(function(){\r\n      recording.stop();\r\n      recording.exportWAV(function(blob) {\r\n        var a = document.createElement(\"a\");\r\n        document.body.appendChild(a);\r\n        a.style = \"display: none\";\r\n\r\n        var url  = window.URL.createObjectURL(blob);\r\n        a.href = url;\r\n        a.download = recordFileName + \".wav\";\r\n        a.click();\r\n        window.URL.revokeObjectURL(url);\r\n      });\r\n    }, playable.duration());\r\n  };\r\n\r\n  return {\r\n    resumeAudio: function() {\r\n      if (!music) {\r\n        context = new MUSIC.Context();\r\n        music = context.sfxBase(); \r\n      }\r\n\r\n      context.resume();\r\n    },\r\n\r\n    runFcn: function(f) {\r\n      if (!music) {\r\n        context = new MUSIC.Context();\r\n        music = context.sfxBase(); \r\n      }\r\n      return f(music);\r\n    },\r\n\r\n    record: function(options, callback) {\r\n      return this.runFcn(function(){\r\n        return context.record(options, callback);\r\n      });\r\n    },\r\n\r\n    run: function(code) {\r\n      if (music) {\r\n        music.prune();\r\n      }\r\n      music = new MUSIC.Context().sfxBase();\r\n\r\n      try {\r\n        return {object: eval(\"(function() {\\n\" + code + \"\\n})\")()};\r\n      } catch(e) {\r\n        return {error: e.toString()};\r\n      }\r\n    }\r\n  };\r\n});\r\n\r\nmusicShowCaseApp.service(\"Historial\", [function() {\r\n  return function() {\r\n    var array = [];\r\n    var currentVersion = 0;\r\n\r\n    var undo = function() {\r\n      if (currentVersion > 0) currentVersion--;\r\n      return array[currentVersion];\r\n    };\r\n\r\n    var redo = function() {\r\n      if (currentVersion < array.length-1) currentVersion++;\r\n      return array[currentVersion];\r\n    };\r\n\r\n    var registerVersion = function(data) {\r\n      array = array.slice(0, currentVersion+1);\r\n      array.push(data);\r\n      if (array.length > 128) array = array.slice(1);\r\n      currentVersion = array.length-1;\r\n    };\r\n\r\n    return {\r\n      registerVersion: registerVersion,\r\n      undo: undo,\r\n      redo: redo\r\n    };\r\n  };\r\n}]);\r\n\r\nmusicShowCaseApp.service(\"Pattern\", [\"MUSIC\", 'TICKS_PER_BEAT', function(MUSIC, TICKS_PER_BEAT) {\r\n\r\n  var schedule = function(noteseq, file, track, eventPreprocessor, onStop, ctx) {\r\n    var events = track.events.sort(function(e1, e2) { return e1.s - e2.s; });\r\n    var scaledEvents = events.map(function(evt) {\r\n      return [evt.n, evt.s, evt.l, {tc: evt.tc}];\r\n    });\r\n\r\n    for (var i=0; i<scaledEvents.length; i++) {\r\n      var evt = scaledEvents[i];\r\n      noteseq.push(eventPreprocessor(evt, scaledEvents), ctx);\r\n    }\r\n\r\n    noteseq.paddingTo(TICKS_PER_BEAT * file.measureCount * file.measure);\r\n    noteseq.pushCallback([TICKS_PER_BEAT*file.measureCount * file.measure, onStop]);\r\n\r\n    var totalBeats = file.measure * file.measureCount;\r\n  };\r\n\r\n  var noteseq = function(file, track, eventPreprocessor, onStop) {\r\n    var noteseq = new MUSIC.NoteSequence();\r\n    schedule(noteseq, file, track, eventPreprocessor, onStop);\r\n    return noteseq;\r\n  };\r\n\r\n  var patternCompose = function(file, instruments, base, onStop, options) {\r\n    var start = (options && options.start) || 0;\r\n    var isTempoTrack = function(track, idx) {\r\n      idx = base + idx;\r\n      var instrument = instruments[track.instrument + '_' + idx];\r\n      return instrument && instrument.tempo;\r\n    };\r\n\r\n    var getEvents = function(track) {\r\n      return track.events;\r\n    };\r\n\r\n    var concat = function(a, b) {\r\n      return a.concat(b);\r\n    };\r\n\r\n    var byStart = function(a, b) {\r\n      return a.s-b.s;\r\n    };\r\n\r\n    var songCtx = {};\r\n    var noteseq = new MUSIC.NoteSequence(null,\r\n    {\r\n      time: MUSIC.Math.ticksToTime({\r\n        bpm: file.bpm,\r\n        ticks_per_beat: TICKS_PER_BEAT,\r\n        bpm_events: file.tracks.filter(isTempoTrack).map(getEvents).reduce(concat, []).sort(byStart),\r\n        start: start\r\n      }),\r\n      songCtx: songCtx\r\n    });\r\n\r\n    file.tracks.forEach(function(track, idx) {\r\n      idx = base + idx;\r\n\r\n      var instrument = instruments[track.instrument + '_' + idx];\r\n\r\n      if (instrument && !instrument.tempo) {\r\n        var eventPreprocessor = instrument.eventPreprocessor || function(x){ return x; };\r\n        var context = MUSIC.NoteSequence.context(instrument, null, songCtx);\r\n        schedule(noteseq, file, track, eventPreprocessor, onStop, context);\r\n      }\r\n    });\r\n\r\n    var ret = noteseq.makePlayable(null);\r\n    ret.schedule = function(noteSequence, songCtx) {\r\n      var contexts = [];\r\n      songCtx = songCtx || {};\r\n\r\n      file.tracks.forEach(function(track, idx) {\r\n        idx = base + idx;\r\n\r\n        var instrument = instruments[track.instrument + '_' + idx];\r\n\r\n        if (instrument) {\r\n          var eventPreprocessor = instrument.eventPreprocessor || function(x){ return x; };\r\n          var context = MUSIC.NoteSequence.context(instrument, null, songCtx);\r\n\r\n          contexts.push(context);\r\n          schedule(noteSequence, file, track, eventPreprocessor, onStop, context);\r\n        }\r\n      });\r\n\r\n      return contexts;\r\n    };\r\n\r\n    ret.timeToTicks = function() {\r\n      return MUSIC.Math.timeToTicks({\r\n        bpm: file.bpm,\r\n        ticks_per_beat: TICKS_PER_BEAT,\r\n        bpm_events: file.tracks.filter(isTempoTrack).map(getEvents).reduce(concat, []).sort(byStart),\r\n        start: start\r\n      });\r\n    }; \r\n\r\n    ret.bpm_events = file.tracks.filter(isTempoTrack).map(getEvents).reduce(concat, []).sort(byStart);\r\n\r\n    return ret;\r\n  };\r\n\r\n  var higher = function(a,b) {\r\n    return a>b ? a : b;\r\n  };\r\n\r\n  var computeMeasureCount = function(file, measure) {\r\n    if (measure<1) measure=1;\r\n    var endTime = file.tracks.map(function(track) {\r\n      return track.events.map(function(evt) {\r\n        return evt.s + evt.l;\r\n      }).reduce(higher, 0)\r\n    }).reduce(higher,0);\r\n\r\n    var measureLength = measure * TICKS_PER_BEAT;\r\n    var measureCount = Math.floor((endTime-1)/measureLength) + 1;\r\n    if (measureCount<1) return 1;\r\n    return measureCount;\r\n  };\r\n\r\n  var getMutedState = function(file) {\r\n    var someSolo = file.tracks.some(function(t) {return t.solo; });\r\n    return file.tracks.map(function(t) {\r\n      if (someSolo) {\r\n        return t.muted || !t.solo;\r\n      } else {\r\n        return t.muted || !t.instrument;\r\n      }\r\n    });\r\n  };\r\n\r\n  var concat = function(a, b) {\r\n    return a.concat(b);\r\n  };\r\n\r\n  var _not = function(self) {\r\n    return function(evt) {\r\n      return evt !== self;\r\n    };\r\n  };\r\n\r\n  var findClipS = function(pattern, track, self, s) {\r\n    var nearest = function(c1, c2) {\r\n      return Math.abs(self.s - c1) < Math.abs(self.s - c2) ? c1 : c2;\r\n    };\r\n\r\n    var allEvents = pattern.tracks.map(function(track) {\r\n      return track.events.filter(_not(self));\r\n    }).reduce(concat);\r\n\r\n    var allOtherEvents = pattern.tracks.map(function(tr) {\r\n      if (track === tr) return [];\r\n      return tr.events.filter(_not(self));\r\n    }).reduce(concat);\r\n\r\n    if (allEvents.length === 0) return 0;\r\n\r\n    var clips = allEvents.map(function(evt) {\r\n      return evt.s + evt.l;\r\n    }).concat(allEvents.map(function(evt) {\r\n      return evt.s - self.l;\r\n    })).concat(allOtherEvents.map(function(evt) {\r\n      return evt.s;\r\n    }));\r\n\r\n    return clips.reduce(nearest);\r\n  };       \r\n\r\n  var findClipL = function(pattern, track, self, s) {\r\n    var nearest = function(c1, c2) {\r\n      return Math.abs(self.s + self.l - c1) < Math.abs(self.s + self.l - c2) ? c1 : c2;\r\n    };\r\n\r\n    var allEvents = pattern.tracks.map(function(track) {\r\n      return track.events.filter(_not(self));\r\n    }).reduce(concat);\r\n\r\n    var allOtherEvents = pattern.tracks.map(function(tr) {\r\n      if (track === tr) return [];\r\n      return tr.events.filter(_not(self));\r\n    }).reduce(concat);\r\n\r\n    if (allEvents.length === 0) return 0;\r\n    var clips = allEvents.map(function(evt) {\r\n      return evt.s;\r\n    }).concat(allOtherEvents.map(function(evt) {\r\n      return evt.s + evt.l;\r\n    }));\r\n\r\n    return clips.reduce(nearest) - self.s;\r\n  };\r\n\r\n  var cutEvent = function(pattern, track, self) {\r\n    var allEvents = track.events.filter(_not(self));\r\n\r\n    allEvents.filter(function(evt) {\r\n      return evt.s > self.s;\r\n    }).forEach(function(evt) {\r\n      if (self.s + self.l > evt.s) {\r\n        self.l = evt.s - self.s;\r\n      }\r\n    });\r\n\r\n    var measureTicks = pattern.measure * TICKS_PER_BEAT;\r\n    if ((self.s + self.l) % measureTicks < self.s % measureTicks) {\r\n      self.l = self.l - (self.s + self.l) % measureTicks;\r\n    }\r\n  };\r\n\r\n  var collision = function(track, self) {\r\n    var allEvents = track.events.filter(_not(self));\r\n    return allEvents.some(function(evt) {\r\n      if (evt.n !== self.n) return false;\r\n      if (evt.s <= self.s && self.s < evt.s + evt.l) return true;\r\n      if (self.s <= evt.s && evt.s < self.s + self.l) return true;\r\n\r\n      return false;\r\n    });\r\n  };\r\n\r\n  return {\r\n    noteseq: noteseq,\r\n    patternCompose: patternCompose,\r\n    computeMeasureCount: computeMeasureCount,\r\n    getMutedState: getMutedState,\r\n    findClipL: findClipL,\r\n    findClipS: findClipS,\r\n    cutEvent: cutEvent,\r\n    collision: collision\r\n  };\r\n}]);\r\n\r\n\r\nmusicShowCaseApp.service(\"InstrumentSet\", [\"FileRepository\", \"MusicObjectFactory\", \"MusicContext\", function(FileRepository, MusicObjectFactory, MusicContext) {\r\n  var ret = function(music) {\r\n    var musicObjectFactory;\r\n    var trackControl = {};\r\n\r\n    var set = {};\r\n    var created = [];\r\n    var load = function(id, trackNo) {\r\n      trackNo = trackNo || 0;\r\n      var _id = id + \"_\" + trackNo;\r\n      if (!set[_id]) {\r\n        trackControl[trackNo] = trackControl[trackNo] || music.gain(1.0);\r\n\r\n        set[_id] = FileRepository.getFile(id)\r\n          .then(function(file) {\r\n            if (file.index.type === 'instrument') {\r\n              if (!musicObjectFactory) musicObjectFactory = MusicObjectFactory();\r\n              return musicObjectFactory.create(file.contents, trackControl[trackNo])\r\n                .then(function(obj){\r\n                  created.push(obj);\r\n                  return obj;\r\n                });\r\n\r\n            } else {\r\n              return {tempo: true};\r\n            }\r\n          });\r\n      } \r\n\r\n      return set[_id];\r\n    };\r\n\r\n    var dispose = function() {\r\n      created.forEach(function(instrument){\r\n        if (instrument.dispose) {\r\n          instrument.dispose();\r\n        }\r\n      });\r\n\r\n      if (musicObjectFactory) {\r\n        return musicObjectFactory.destroyAll();\r\n      }\r\n    };\r\n\r\n    var mute = function(trackNo, muteState) {\r\n      trackControl[trackNo] = trackControl[trackNo] || music.gain(1.0);\r\n      trackControl[trackNo].update(muteState ? 0.0 : 1.0);\r\n    };\r\n\r\n    return {\r\n      load: load,\r\n      mute: mute,\r\n      all: set,\r\n      dispose: dispose\r\n    };\r\n  };\r\n\r\n  return function(music) {\r\n    if (music) return ret(music);\r\n    return MusicContext.runFcn(ret);\r\n  };\r\n}]);\r\n\r\nmusicShowCaseApp.service(\"FileRepository\", [\"$http\", \"$q\", \"TypeService\", \"Historial\", \"Index\", \"_localforage\", function($http, $q, TypeService, Historial, Index, localforage) {\r\n  var createdFilesIndex = [];\r\n  var createdFiles = {};\r\n\r\n  var builtIns = [\r\n    \"site/builtin/defaultProject.json\",\r\n    \"site/builtin/samples.json\",\r\n    \"site/builtin/smb-underworld.json\",\r\n    \"site/builtin/smb-overworld.json\",\r\n    \"site/builtin/bomberman.json\",\r\n    \"site/builtin/entertainer.json\",\r\n    \"site/builtin/eva-thanatos.json\",\r\n    \"site/builtin/bioshock-solace.json\"\r\n  ];\r\n\r\n  var loadBuiltIn = function(uri) {\r\n    return $http.get(uri)\r\n      .then(function(r) {\r\n        r.data.forEach(function(obj) {\r\n          var objectId = obj.id;\r\n\r\n          createdFiles[objectId] = obj.contents;\r\n\r\n          createdFilesIndex.push({\r\n            project: obj.project,\r\n            type: obj.type,\r\n            name: obj.name,\r\n            id: objectId,\r\n            ref: obj.ref,\r\n            builtIn: true\r\n          });\r\n        });\r\n      });\r\n  };\r\n\r\n  var createDefault = function(id, type, name, content) {\r\n    createdFilesIndex.push({\r\n      project: \"default\",\r\n      type: type,\r\n      id: id,\r\n      name: name,\r\n      noExportable: true\r\n    });\r\n\r\n    createdFiles[id] = content;\r\n  };\r\n\r\n  createDefault('tempo', 'tempo', 'Tempo', {})\r\n\r\n  var builtInLoaded = $q.all(builtIns.map(loadBuiltIn));\r\n\r\n  var createId = function() {\r\n    var array = [];\r\n    for (var i = 0; i < 32; i++) {\r\n      var value = [0,1,2,3,4,5,6,7,8,9,'a','b','c','d','e','f'][Math.floor(Math.random()*16)];\r\n      array.push(value);\r\n    }\r\n\r\n    return array.join(\"\");\r\n  };\r\n\r\n  var genericStateEmmiter = new EventEmitter();\r\n  var recycledEmmiter = new EventEmitter();\r\n\r\n  var defaultFile = {\r\n    instrument: {\r\n      type: \"stack\",\r\n      data: {\r\n        array: []\r\n      }\r\n    },\r\n    song: {\r\n      measure: 4,\r\n      bpm: 140,\r\n      tracks: [\r\n        {blocks: [{},{},{}]},\r\n        {blocks: [{},{},{}]}\r\n      ]\r\n    },\r\n    pattern: {\r\n      measure: 4,\r\n      measureCount: 1,\r\n      bpm: 140,\r\n      selectedTrack: 0,\r\n      tracks:[\r\n        {scroll: 1000, events: []}\r\n      ],\r\n      scrollLeft: 0\r\n    }\r\n  };\r\n\r\n  var hist = new WeakMap();\r\n\r\n  var updateFile = function(id, contents, options) {\r\n    return $q.when()\r\n      .then(function() {\r\n        var localFile = createdFilesIndex.filter(function(x) {return x.id === id; })[0];\r\n        if (localFile) return localFile;\r\n\r\n        return storageIndex.getEntry(id);\r\n      })\r\n      .then(function(localFile) {\r\n        if (localFile) {\r\n          var serialized = MUSIC.Formats.MultiSerializer.serialize(localFile.type, contents);\r\n\r\n          if (!options || !options.noHistory) {\r\n            hist[id] = hist[id] || Historial();\r\n            hist[id].registerVersion(JSON.stringify(contents));\r\n          }\r\n\r\n          return localforage.setItem(id, serialized);\r\n        }\r\n      })\r\n      .then(function() {\r\n        return recycleIndex.reload();\r\n      })\r\n      .then(function() {\r\n        recycledEmmiter.emit(\"changed\");\r\n      });\r\n  };\r\n\r\n  var destroyFile = function(id) {\r\n    return localforage.removeItem(id)\r\n      .then(function() {\r\n        return $q.all({r: recycleIndex.removeEntry(id), l: storageIndex.removeEntry(id)});\r\n      })\r\n  };\r\n\r\n  var purgeFromRecycleBin = function(id) {\r\n    return recycleIndex.removeEntry(id);\r\n  };\r\n\r\n  var restoreFromRecycleBin = function(id) {\r\n    return _restoreFromRecycleBin(id)\r\n      .then(function() {\r\n        genericStateEmmiter.emit(\"changed\");\r\n        recycledEmmiter.emit(\"changed\");\r\n      });\r\n  };\r\n\r\n  var _restoreFromRecycleBin = function(id) {\r\n    return recycleIndex.getEntry(id)\r\n      .then(function(localFile) {\r\n        if (localFile) {\r\n          return recycleIndex.removeEntry(id)\r\n            .then(function() {\r\n              return storageIndex.createEntry(localFile);\r\n            })\r\n            .then(function() {\r\n              var refs = (localFile.ref||[])\r\n              if (localFile.project) refs.push(localFile.project);\r\n\r\n              return $q.all(refs.map(_restoreFromRecycleBin));\r\n            });\r\n        }\r\n      });\r\n  };\r\n\r\n  var moveToRecycleBin = function(id) {\r\n    return _moveToRecycleBin(id)\r\n      .then(function() {\r\n        genericStateEmmiter.emit(\"changed\");\r\n        recycledEmmiter.emit(\"changed\");\r\n      })\r\n  };\r\n\r\n  var _moveToRecycleBin = function(id) {\r\n    var getId = function(x){ return x.id; };\r\n    var isProjectType = function(file) {\r\n      return file.type === 'project';\r\n    };\r\n\r\n    return storageIndex.willRemove(id)\r\n      .then(function() {\r\n        return storageIndex.getEntry(id)\r\n          .then(function(localFile) {\r\n            if (localFile) {\r\n              return recycleIndex.getAll()\r\n                .then(function(idx) {\r\n                  if (idx && idx.length >= 100) {\r\n                    return recycleIndex.getFreeItems()\r\n                      .then(function(idx) {\r\n                        if (!idx[0]) return;\r\n\r\n                        return recycleIndex.removeEntry(idx[0].id)\r\n                          .then(function() {\r\n                            return localforage.removeItem(id);\r\n                          });\r\n                      });\r\n                  }\r\n                })\r\n                .then(function() {\r\n                  return storageIndex.removeEntry(id);\r\n                })\r\n                .then(function() {\r\n                  return recycleIndex.createEntry(localFile);\r\n                });\r\n            }\r\n          });\r\n      })\r\n      .then(function() {\r\n        return storageIndex.getOrphan(\r\n          createdFilesIndex.map(getId),\r\n          createdFilesIndex.filter(isProjectType).map(getId));\r\n      })\r\n      .then(function(orphanFiles) {\r\n        return $q.all(orphanFiles.map(getId).map(_moveToRecycleBin))\r\n          .catch(function(e) {\r\n            console.error(e);\r\n          });\r\n      });\r\n  };\r\n\r\n  var getPatternSongs = function(options) {\r\n    var byProject = function(file) {\r\n      return file.project === options.project;\r\n    };\r\n\r\n    var byType = function(file) {\r\n      return file.type === 'pattern' || file.type === 'song';\r\n    };\r\n\r\n    var typeSong = function(file) {\r\n      return file.type === 'song';\r\n    };\r\n\r\n    var loadFile = function(file) {\r\n      return getFile(file.id);\r\n    };\r\n\r\n    return $q.all({\r\n        storage: storageIndex.getAll(),\r\n        builtin: createdFilesIndex\r\n      }).then(function(result) {\r\n        var files = result.storage.concat(result.builtin);\r\n        var fileIndexes = files.filter(byProject).filter(byType);\r\n\r\n        if (fileIndexes.some(typeSong)) {\r\n          fileIndexes = fileIndexes.filter(typeSong);\r\n        }\r\n\r\n        return $q.all(fileIndexes.map(loadFile));\r\n      });\r\n  };\r\n\r\n  var mode = function(files, fcn) {\r\n    var obj = {};\r\n    files.forEach(function(file) {\r\n      var value = fcn(file);\r\n      obj[value] = (obj[value] || 0) + 1;\r\n    });\r\n\r\n    var maxcount = 0;\r\n    var _m;\r\n    for (var k in obj) {\r\n      var count = obj[k];\r\n      if (count > maxcount) {\r\n        _m = k;\r\n        maxcount = count;\r\n      }\r\n    };\r\n\r\n    return _m;\r\n  };\r\n\r\n  var getDefaultMeasure = function(options) {\r\n    return getPatternSongs(options)\r\n      .then(function(files) {\r\n        if (!files.length) return 4;\r\n\r\n        return mode(files, function(file) {\r\n          return file.contents.measure;\r\n        });\r\n      });\r\n  };\r\n\r\n  var getDefaultBPM = function(options) {\r\n    return getPatternSongs(options)\r\n      .then(function(files) {\r\n        if (!files.length) return 140;\r\n\r\n        return mode(files, function(file) {\r\n          return file.contents.bpm;\r\n        });\r\n      });\r\n  };\r\n\r\n  var getFile = function(id) {\r\n      var builtIn = false;\r\n      var changed = false;\r\n      return builtInLoaded\r\n        .then(function() {\r\n          var localFile = createdFilesIndex.filter(function(x) {return x.id === id; })[0];\r\n          if (localFile) {\r\n            builtIn = true;\r\n            return localFile;\r\n          }\r\n\r\n          return storageIndex.getEntry(id);\r\n        })\r\n        .then(function(localFile) {\r\n          return localforage.getItem(id)\r\n            .then(function(serialized) {\r\n              if (serialized) {\r\n                var contents = MUSIC.Formats.MultiSerializer.deserialize(localFile.type, serialized);\r\n                return {\r\n                  index: {\r\n                    name: localFile.name,\r\n                    id: localFile.id,\r\n                    builtIn: builtIn,\r\n                    type: localFile.type,\r\n                    ref: localFile.ref||getRefs(localFile.type, contents),\r\n                    updated: true,\r\n                    project: localFile.project\r\n                  },\r\n                  contents: contents\r\n                };\r\n              } else {\r\n                if (localFile) {\r\n                  return {\r\n                    index: {\r\n                      name: localFile.name,\r\n                      id: localFile.id,\r\n                      builtIn: builtIn,\r\n                      type: localFile.type,\r\n                      ref: localFile.ref,\r\n                      project: localFile.project,\r\n                      noExportable: localFile.noExportable\r\n                    },\r\n                    contents: JSON.parse(JSON.stringify(createdFiles[id]))\r\n                  };\r\n                };\r\n              }\r\n            });\r\n        });\r\n    };  \r\n\r\n  var createFile = function(options) {\r\n    var newid = options.id || createId();\r\n\r\n    var contents = options.contents || defaultFile[options.type] || {};\r\n\r\n    return $q.all({\r\n      defaultMeasure: getDefaultMeasure(options),\r\n      defaultBPM: getDefaultBPM(options)\r\n    }).then(function(value) {\r\n      contents.measure = parseInt(value.defaultMeasure);\r\n      contents.bpm = parseInt(value.defaultBPM);\r\n    }).then(function() {\r\n      hist[newid] = hist[newid] || Historial();\r\n      hist[newid].registerVersion(JSON.stringify(contents));\r\n\r\n      var serialized = MUSIC.Formats.MultiSerializer.serialize(options.type, contents);\r\n      return localforage.setItem(newid, serialized)\r\n    }).then(function() {\r\n        return storageIndex.createEntry({\r\n          type: options.type,\r\n          name: options.name,\r\n          project: options.project,\r\n          id: newid,\r\n          ref: options.ref\r\n        });\r\n    })\r\n    .then(function() {\r\n      return recycleIndex.reload();\r\n    })\r\n    .then(function() {\r\n        genericStateEmmiter.emit(\"changed\");\r\n        recycledEmmiter.emit(\"changed\");\r\n        return newid;\r\n    })\r\n    .catch(function(err) {\r\n      debugger;\r\n    });\r\n  };\r\n\r\n\r\n  var s0 = MUSIC.Formats.JSONSerializer;\r\n  var s1 = MUSIC.Formats.CachedSerializer(MUSIC.Formats.PackedJSONSerializer);\r\n  var s2 = MUSIC.Formats.HuffmanSerializerWrapper(s0);\r\n  var s3 = MUSIC.Formats.HuffmanSerializerWrapper(s1);\r\n  var s4 = MUSIC.Formats.CachedSerializer(MUSIC.Formats.PackedJSONSerializerB);\r\n  var s5 = MUSIC.Formats.HuffmanSerializerWrapper(s4);\r\n\r\n  MUSIC.Formats.MultiSerializer.setSerializers([\r\n    {serializer: s0, base: '0'},\r\n    {serializer: s1, base: '1'},\r\n    {serializer: s2, base: '2'},\r\n    {serializer: s3, base: '3'},\r\n    {serializer: s4, base: '4'},\r\n    {serializer: s5, base: '5'}\r\n  ]);\r\n\r\n  var storageIndex = Index(\"index\");\r\n  var recycleIndex = Index(\"recycle\");\r\n\r\n  recycleIndex.getAll().then(function() {\r\n    recycledEmmiter.emit(\"changed\");\r\n  });\r\n\r\n  var changed = function() {\r\n    genericStateEmmiter.emit(\"changed\");\r\n    recycledEmmiter.emit(\"changed\");\r\n  };\r\n\r\n  var getRefs = function(type, contents) {\r\n    var ref = [];\r\n    if (type === 'song') {\r\n      contents.tracks.forEach(function(track) {\r\n        for (var i=0;i<track.blocks.length;i++) {\r\n          var blockId = track.blocks[i].id;\r\n          if (blockId && ref.indexOf(blockId) === -1) ref.push(blockId);\r\n        }\r\n      });\r\n    } else if (type === 'pattern') {\r\n      contents.tracks.forEach(function(track) {\r\n        if (track.instrument && ref.indexOf(track.instrument) === -1) ref.push(track.instrument);\r\n      });\r\n    }\r\n\r\n    return ref;\r\n  };\r\n\r\n  var getProjectFiles = function(projectId) {\r\n    return storageIndex.getAll()\r\n      .then(function(idx) {\r\n        return idx.concat(createdFilesIndex).filter(function(file) {\r\n          return file.project === projectId || file.id === projectId;\r\n        });\r\n      });\r\n  };\r\n\r\n  return {\r\n    getRefs: getRefs,\r\n    getProjectFiles: getProjectFiles,\r\n    undo: function(id) {\r\n      var oldVer = hist[id].undo();\r\n      if (!oldVer) return;\r\n\r\n      return updateFile(id, JSON.parse(oldVer), {noHistory: true});\r\n    },\r\n    redo: function(id) {\r\n      var nextVer = hist[id].redo();\r\n      if (!nextVer) return;\r\n\r\n      return updateFile(id, JSON.parse(nextVer), {noHistory: true});\r\n    },\r\n    purgeFromRecycleBin: purgeFromRecycleBin,\r\n    moveToRecycleBin: moveToRecycleBin,\r\n    restoreFromRecycleBin: restoreFromRecycleBin,\r\n    destroyFile: destroyFile,\r\n    createFile: createFile,\r\n    changed: changed,\r\n    updateIndex: function(id, attributes) {\r\n      var localFile = createdFilesIndex.filter(function(x) { return x.id === id; })[0];\r\n      if (localFile) {\r\n        localFile.name = attributes.name;\r\n        genericStateEmmiter.emit(\"changed\");\r\n        return $q.when(localFile);\r\n      }\r\n\r\n      return storageIndex.updateEntry(id, attributes)\r\n        .then(function() {\r\n          genericStateEmmiter.emit(\"changed\");\r\n        });\r\n    },\r\n    getIndex: function(id) {\r\n      var localFile = createdFilesIndex.filter(function(x) { return x.id === id; })[0];\r\n      if (localFile) return $q.when(localFile);\r\n\r\n      return storageIndex.getEntry(id);\r\n    },\r\n    updateFile: updateFile,\r\n    getFile: getFile,\r\n    observeRecycled: function(callback) {\r\n      recycleIndex.reload()\r\n        .then(function() {\r\n          recycledEmmiter.emit(\"changed\");\r\n        });\r\n\r\n      recycledEmmiter.addListener(\"changed\", callback);\r\n\r\n      return {\r\n        destroy: function() {\r\n          recycledEmmiter.removeListener(\"changed\", callback);\r\n        }\r\n      };\r\n    },\r\n    searchRecycled: function(keyword, options) {\r\n      options = options || {};\r\n      var limit = typeof options.limit === 'undefined' ? 10 : options.limit;\r\n      var hasKeyword = function() { return true };\r\n      if (keyword && keyword.length > 0) {\r\n        keyword = keyword.toLowerCase();\r\n        hasKeyword = function(x) { return x.name.toLowerCase().indexOf(keyword) !== -1 };\r\n      }\r\n\r\n      return recycleIndex.getAll().then(function(index) {\r\n        var filtered = (index||[]).filter(hasKeyword).reverse();\r\n        return {\r\n          results: limit ? filtered.slice(0,limit) : filtered,\r\n          total: filtered.length\r\n        };\r\n      });\r\n    },\r\n    search: function(keyword, options) {\r\n      options = options || {};\r\n\r\n      var hasKeyword = function() { return true };\r\n      if (keyword && keyword.length > 0) {\r\n        keyword = keyword.toLowerCase();\r\n        hasKeyword = function(x) { return x.name.toLowerCase().indexOf(keyword) !== -1 };\r\n      }\r\n\r\n      var byProject = function() { return true };\r\n      if (options.project) {\r\n        byProject = function(x) {\r\n          if (options.type) {\r\n            if (options.type.indexOf(x.type) === -1) return false;\r\n          }\r\n          return x.type === 'tempo' || options.project.indexOf(x.project) !== -1;\r\n        };\r\n      } else {\r\n        if (options.type) {\r\n          byProject = function(x) {\r\n            if (options.type.indexOf(x.type) === -1) return false;\r\n            return true\r\n          };\r\n        }\r\n      }\r\n\r\n      var ee = new EventEmitter();\r\n      var updateSearch = function() {\r\n        builtInLoaded\r\n          .then(function() {\r\n            $q.all([\r\n              storageIndex.getAll(),\r\n              createdFilesIndex,\r\n              TypeService.getTypes(keyword)\r\n            ]).then(function(result) {\r\n              var notInRes = function(item) {\r\n                return true;\r\n//                return ids.indexOf(item.id) === -1;\r\n              };\r\n\r\n              var res = result[0]||[];\r\n              var ids = res.map(function(x){ return x.id; });\r\n              if (result[1]) res = res.concat(result[1].filter(notInRes));\r\n              res = res.concat(result[2].map(convertType));\r\n              res = res.filter(hasKeyword).filter(byProject);\r\n\r\n              ee.emit(\"changed\", {\r\n                results: res.slice(0,15),\r\n                total: res.length\r\n              });\r\n            });\r\n          });\r\n      };\r\n\r\n      return {\r\n        observe: function(cb) {\r\n          ee.addListener(\"changed\", cb);\r\n          genericStateEmmiter.addListener(\"changed\", updateSearch);\r\n          updateSearch();\r\n\r\n          return {\r\n            close: function() {\r\n              ee.removeListener(\"changed\", cb);\r\n              genericStateEmmiter.removeListener(\"changed\", updateSearch);\r\n            }\r\n          };\r\n        }\r\n      };\r\n    }\r\n  };\r\n}]);\r\n\r\nvar convertType = function(type) {\r\n  return {\r\n    type: \"fx\",\r\n    name: type.name,\r\n    id: \"type\"+ type.name,\r\n    project: 'core'\r\n  };\r\n};\r\n\r\nmusicShowCaseApp.factory(\"pruneWrapper\", function() {\r\n  return function(fcn) {\r\n    if (!fcn._wrapper) {\r\n      fcn._wrapper = function(music, modWrapper) {\r\n        var sfxBase = music.sfxBase();\r\n        var obj = fcn(sfxBase, modWrapper);\r\n        var originalDispose;\r\n\r\n        if (obj.dispose) {\r\n          originalDispose = obj.dispose.bind(obj); \r\n          obj.dispose = function() {\r\n            originalDispose();\r\n            sfxBase.prune();\r\n          };\r\n        } else {\r\n          obj.dispose = function() {\r\n            sfxBase.prune();\r\n          };\r\n        }\r\n\r\n        return obj;\r\n      };\r\n    }\r\n    return fcn._wrapper;\r\n  };\r\n});\r\n\r\nmusicShowCaseApp.factory(\"sfxBaseOneEntryCacheWrapper\", function() {\r\n    return function(fcn){\r\n      var _lastmusic;\r\n      var _lastinstance;\r\n      var ret = function(music, options) {\r\n        options = options ||{};\r\n\r\n        if (!options.nowrap) {\r\n          if (_lastmusic && _lastmusic === music) {\r\n            return _lastinstance;\r\n          }\r\n        }\r\n\r\n        _lastmusic = music;\r\n        _lastinstance = fcn(music, options);\r\n\r\n        return _lastinstance;\r\n      };\r\n\r\n      ret.update = function() {\r\n        fcn.update.bind(fcn).apply(null, arguments);\r\n        return ret;\r\n      };\r\n      return ret;\r\n    };\r\n});\r\n","var musicShowCaseApp = angular.module(\"MusicShowCaseApp\");\r\nmusicShowCaseApp.factory(\"ErrMessage\", ['$uibModal', '$translate', function($uibModal, $translate) {\r\n  return function(title, text) {\r\n    var modalIns = $uibModal.open({\r\n      templateUrl: \"site/templates/modal/error.html\",\r\n      controller: \"errorModalCtrl\",\r\n      windowClass: 'error',\r\n      resolve: {\r\n        text: function() {\r\n          return $translate(text);\r\n        },\r\n        title: function() {\r\n          return $translate(title);\r\n        }\r\n      }\r\n    });\r\n\r\n    return modalIns;\r\n  };\r\n}]);\r\n","var musicShowCaseApp = angular.module(\"MusicShowCaseApp\");\r\nmusicShowCaseApp.factory(\"Export\", ['$q', 'FileRepository', function($q, FileRepository) {\r\n  var exportContents = function(name, contents) {\r\n    var a = document.createElement(\"a\");\r\n    document.body.appendChild(a);\r\n    a.style = \"display: none\";\r\n\r\n    var blob = new Blob([JSON.stringify(contents)]);\r\n    var url  = window.URL.createObjectURL(blob);\r\n    a.href = url;\r\n    a.download = name + \".json\";\r\n    a.click();\r\n    window.URL.revokeObjectURL(url);\r\n  };\r\n\r\n  var getRelatedIds = function(file) {\r\n    if (file.index.type === 'project') {\r\n      return (file.index.ref||[]);\r\n    } else {\r\n      var ret = FileRepository.getRefs(file.index.type, file.contents);\r\n      if (file.index.project) ret.push(file.index.project);\r\n      return ret;\r\n    }\r\n  };\r\n\r\n  var concat = function(x, y) {return x.concat(y); };\r\n  var getFileWithRelated = function(id) {\r\n    var ret = [];\r\n    return FileRepository.getFile(id)\r\n      .then(function(file) {\r\n        if (!file) return [];\r\n        if (file.index.noExportable) {\r\n          return [];\r\n        }\r\n\r\n        ret.push({\r\n          name: file.index.name,\r\n          type: file.index.type,\r\n          id: file.index.id,\r\n          contents: file.contents,\r\n          project: file.index.project,\r\n          ref: file.index.ref\r\n        });\r\n\r\n        return $q.all(getRelatedIds(file).map(getFileWithRelated))\r\n          .then(function(relarray) {\r\n            relarray.forEach(function(rel) {\r\n              ret = ret.concat(rel);\r\n            });\r\n            return ret;\r\n          });\r\n      });\r\n  };\r\n\r\n  var uniq = function(array) {\r\n    var files = {};\r\n    array.forEach(function(file) {\r\n      files[file.id] = file;\r\n    });\r\n\r\n    return Object.keys(files).map(function(id) {\r\n      return files[id];\r\n    });\r\n  };\r\n\r\n  var exportProject = function(name, id) {\r\n    var getId = function(x) { return x.id; };\r\n\r\n    FileRepository.getProjectFiles(id)\r\n      .then(function(files) {\r\n        return $q.all(files.map(getId).map(getFileWithRelated));\r\n      })\r\n      .then(function(array){\r\n        array = array.reduce(concat, []);\r\n        exportContents(name, uniq(array));\r\n      });\r\n  };\r\n\r\n  var exportFile = function(name, id) {\r\n    return getFileWithRelated(id)\r\n      .then(function(array) {\r\n        exportContents(name, uniq(array));\r\n      });\r\n  };\r\n\r\n  var importFile = function(contents) {\r\n    var importItem = function(item) {\r\n      return function() {\r\n        return FileRepository.getIndex(item.id)\r\n          .then(function(index) {\r\n            if (index) {\r\n              return FileRepository.updateFile(item.id, item.contents)\r\n                .then(function() {\r\n                  return FileRepository.updateIndex(item.id, {\r\n                    name: item.name,\r\n                    project: item.project\r\n                  });\r\n                });\r\n            } else {\r\n              return FileRepository.purgeFromRecycleBin(item.id)\r\n                .then(function() {\r\n                  return FileRepository.createFile({\r\n                    id: item.id,\r\n                    contents: item.contents,\r\n                    type: item.type,\r\n                    name: item.name,\r\n                    project: item.project,\r\n                    ref: item.ref\r\n                  });\r\n                });\r\n            }\r\n          });\r\n      };\r\n    };\r\n\r\n    return $q.when()\r\n      .then(function() {\r\n        var p = null;\r\n        var parsed = JSON.parse(contents);\r\n        var firstItem = parsed[0];\r\n\r\n        parsed.forEach(function(item) {\r\n          if (p) {\r\n            p = p.then(importItem(item));\r\n          } else {\r\n            p = importItem(item)();\r\n          }\r\n        });\r\n\r\n        return p.then(function() {\r\n          return {id: firstItem.id, type: firstItem.type, project: firstItem.project};\r\n        });\r\n      });\r\n  };\r\n\r\n  return {\r\n    exportContents: exportContents,\r\n    exportFile: exportFile,\r\n    exportProject: exportProject,\r\n    importFile: importFile\r\n  };\r\n}]);\r\n","var musicShowCaseApp = angular.module(\"MusicShowCaseApp\");\r\nmusicShowCaseApp.factory(\"Index\", ['$q', '$timeout', 'Sync', '_localforage', function($q, $timeout, Sync, localforage) {\r\n  function CantRemove(id, file) {\r\n      this.id = id;\r\n      this.file = file;\r\n      this.stack = (new Error()).stack;\r\n      this.type = \"cantremove\";\r\n  }\r\n  CantRemove.prototype = new Error\r\n\r\n  var IndexFactory = function(indexName) {\r\n    var entryChange = new Sync();\r\n\r\n    var reload = function() {\r\n      // load stoargeIndex\r\n      var storageIndex;\r\n      storageIndex = localforage.getItem(indexName)\r\n        .then(function(array){\r\n          return array||[];\r\n        });\r\n      return storageIndex;\r\n    };\r\n\r\n    var clearItem = function(data) {\r\n      var ret = {id: data.id, name: data.name, type: data.type, project: data.project, ref: data.ref};\r\n      if (data.c) ret.c=data.c;\r\n      return ret;\r\n    };\r\n\r\n    var removeEntry = entryChange.sync(function(id) {\r\n      return reload()\r\n        .then(function(index) {\r\n          if (!index) return;\r\n          index = index.filter(function(x) { return x.id !== id; });\r\n          return localforage.setItem(indexName, index.map(clearItem));\r\n        })\r\n        .then(reload);\r\n    });\r\n\r\n    var getEntry = function(id) {\r\n      return reload()\r\n        .then(function(index) {\r\n          if (!index) return null;\r\n          return index.filter(function(x) { return x.id === id; })[0];\r\n        });\r\n    };\r\n\r\n    var createEntry = entryChange.sync(function(data) {\r\n      return reload()\r\n        .then(function(index) {\r\n          index = index || [];\r\n\r\n          if (IndexFactory.isolatedContext) {\r\n            data.c = IndexFactory.isolatedContext;\r\n          }\r\n\r\n          index.push(data);\r\n          return localforage.setItem(indexName, index.map(clearItem));\r\n        })\r\n        .then(reload);\r\n    });\r\n\r\n    var updateEntry = entryChange.sync(function(id, attributes) {\r\n      return reload()\r\n        .then(function(index) {\r\n          var localFile = index.filter(function(x) { return x.id === id; })[0];\r\n          localFile.name = attributes.name;\r\n          localFile.ref = attributes.ref;\r\n\r\n          if (IndexFactory.isolatedContext) {\r\n            localFile.c = IndexFactory.isolatedContext;\r\n          }\r\n\r\n          return localforage.setItem(indexName, index.map(clearItem));\r\n        })\r\n        .then(reload);\r\n    });\r\n\r\n    var getAll = function() {\r\n      return reload()\r\n        .then(function(index) {\r\n          var ic = IndexFactory.isolatedContext;\r\n          if (ic) {\r\n            return index.filter(function(entry) {return entry.c === ic; });\r\n          }\r\n          return index;\r\n        });\r\n    };\r\n\r\n    var refs = function(index, id) {\r\n      return index.filter(function(file) {\r\n        return (file.ref||[]).indexOf(id) !== -1;\r\n      });\r\n    };\r\n\r\n    var isProjectType = function(file) {\r\n      return file.type === 'project';\r\n    };\r\n\r\n    var getId = function(file) {\r\n      return file.id;\r\n    };\r\n\r\n    var willRemove = function(id) {\r\n      return reload()\r\n        .then(function(index) {\r\n          var localFile = index.filter(function(x) { return x.id === id; })[0];\r\n\r\n          if (!localFile) return;\r\n\r\n          var r = refs(index, id);\r\n          // if the item has no references, it can be removed!\r\n          if (r.length === 0) return;\r\n\r\n          if (localFile.type === 'project') {\r\n            if (r.some(isProjectType)) {\r\n              throw new CantRemove(id, localFile);\r\n            }\r\n          } else {\r\n            throw new CantRemove(id, localFile);\r\n          }\r\n\r\n          return $q.all(r.map(getId).map(willRemove));\r\n        });\r\n    };\r\n\r\n    var getOrphan = function(extraIds, extraProjectIds) {\r\n      return reload()\r\n        .then(function(index) {\r\n          var projectIds = index.filter(isProjectType).map(getId).concat(extraProjectIds);\r\n          var ids = index.map(getId).concat(extraIds||[]);\r\n          var isOrphan = function(file) {\r\n            if (file.project) {\r\n              if (projectIds.indexOf(file.project) === -1) {\r\n                return true;\r\n              }\r\n            }\r\n            return (file.ref||[]).some(function(id) {\r\n              return ids.indexOf(id) === -1;\r\n            });\r\n          };\r\n\r\n          return index.filter(isOrphan);\r\n        });\r\n    };\r\n\r\n    var getFreeItems = function() {\r\n      return reload()\r\n        .then(function(index) {\r\n          var referenced = {};\r\n          index.forEach(function(file) {\r\n            (file.ref||[]).forEach(function(r) {\r\n              referenced[r]=true;\r\n            });\r\n          });\r\n\r\n          return index.filter(function(file) {\r\n            return !referenced[file.id];\r\n          });\r\n        });\r\n    };\r\n\r\n    reload();\r\n\r\n    return {\r\n      willRemove: willRemove,\r\n      reload: reload,\r\n      removeEntry: removeEntry,\r\n      getOrphan: getOrphan,\r\n      getEntry: getEntry,\r\n      getFreeItems: getFreeItems,\r\n      createEntry: createEntry,\r\n      updateEntry: updateEntry,\r\n      getAll: getAll\r\n    };\r\n  };\r\n\r\n  return IndexFactory;\r\n}]);\r\n","var musicJs = angular.module(\"MusicShowCaseApp\");\r\nmusicJs.factory(\"Midi\", ['$q', 'Sync', '_localforage', function($q, Sync, localforage) {\r\n  var setupStore = new Sync();\r\n  var midiSetupRequested;\r\n  var midiLoaded;\r\n  var storeInputEnabled = setupStore.sync(function(inputId, enabled) {\r\n    return localforage.getItem(\"midiSetup\")\r\n      .then(function(midiSetup) {\r\n        midiSetup = midiSetup || {};\r\n        midiSetup.inputs = midiSetup.inputs || {};\r\n        midiSetup.inputs[inputId] = enabled;\r\n\r\n        return localforage.setItem(\"midiSetup\", midiSetup);\r\n      });\r\n  });\r\n\r\n  var midiAccessRequested;\r\n  if (navigator.requestMIDIAccess) {\r\n      midiAccessRequested = navigator.requestMIDIAccess({ sysex: false });\r\n  }\r\n\r\n  var wrapInput = function(input) {\r\n    var enable = function() {\r\n      input.onmidimessage = onMIDIMessage;\r\n      input.enabled = true;\r\n\r\n      storeInputEnabled(input.id, true);\r\n    };\r\n\r\n    var disable = function() {\r\n      input.onmidimessage = null;\r\n      input.enabled = false;\r\n\r\n      storeInputEnabled(input.id, false);\r\n    };\r\n\r\n    var update = function() {\r\n      if (this.enabled) {\r\n        enable()\r\n      } else {\r\n        disable();\r\n      }\r\n    };\r\n\r\n    var ret = {\r\n      enabled: !!input.onmidimessage,\r\n      enable: enable,\r\n      disable: disable,\r\n      update: update,\r\n      name: input.name,\r\n      id: input.id\r\n    };\r\n\r\n    return ret;\r\n  };\r\n\r\n  var getStatus = function() {\r\n    return midiLoaded\r\n      .then(function() {\r\n        return midiAccessRequested\r\n      })\r\n      .then(function(midiAccess) {\r\n        var data = {connected: false};\r\n        var inputs = midiAccess.inputs.values();\r\n\r\n        for (var input = inputs.next(); input && !input.done; input = inputs.next()) {\r\n          if (input.value.onmidimessage) {\r\n            data.connected = true;\r\n          }\r\n        }\r\n        return data;\r\n      });\r\n  };\r\n\r\n  var getInputs = function() {\r\n    return midiAccessRequested\r\n      .then(function(midiAccess) {\r\n        var retInputs = [];\r\n        var inputs = midiAccess.inputs.values();\r\n\r\n        for (var input = inputs.next(); input && !input.done; input = inputs.next()) {\r\n            retInputs.push(wrapInput(input.value));\r\n        }\r\n        return retInputs;\r\n      });\r\n  };\r\n\r\n  var eventListeners = [];\r\n  var registerEventListener = function(callback) {\r\n    var destroy = function() {\r\n      eventListeners = eventListeners.filter(function(c) { return c !== callback; });\r\n    };\r\n\r\n    eventListeners.push(callback);\r\n\r\n    return {\r\n      destroy: destroy\r\n    };\r\n  };\r\n\r\n  var onMIDIMessage = function(event) {\r\n    midiSetupRequested.then(function(cfg) {\r\n      event.data[1] = event.data[1] - cfg.octave*12 + cfg.transpose;\r\n      eventListeners.forEach(function(callback) {\r\n        callback(event);\r\n      });\r\n    });\r\n  };\r\n\r\n  var reloadConfig = function() {\r\n    midiSetupRequested = localforage.getItem(\"midiSetup\")\r\n      .then(function(midiSetup) {\r\n        if (!midiSetup) midiSetup = {};\r\n        if (typeof midiSetup.octave === 'undefined') midiSetup.octave = 3;\r\n        if (typeof midiSetup.transpose === 'undefined') midiSetup.transpose = 0;\r\n\r\n        return midiSetup;\r\n      });\r\n  };\r\n\r\n  reloadConfig();\r\n\r\n  midiLoaded = $q.all({\r\n    inputs: getInputs(),\r\n    midiSetup: midiSetupRequested\r\n  }).then(function(result) {\r\n    var midiSetup = result.midiSetup;\r\n\r\n    if (midiSetup && midiSetup.inputs) {\r\n      result.inputs.forEach(function(input) {\r\n        if (midiSetup.inputs[input.id]) {\r\n          input.enable();\r\n        }\r\n      });\r\n    }\r\n  });\r\n\r\n  var getConfig = function() {\r\n    return midiSetupRequested;\r\n  };\r\n\r\n  var setConfig = setupStore.sync(function(cfg) {\r\n    return localforage.getItem(\"midiSetup\")\r\n      .then(function(midiSetup) {\r\n        midiSetup = midiSetup || {};\r\n        midiSetup.inputs = midiSetup.inputs || {};\r\n        midiSetup.octave = cfg.octave;\r\n        midiSetup.transpose = cfg.transpose;\r\n\r\n        return localforage.setItem(\"midiSetup\", midiSetup);\r\n      })\r\n      .then(reloadConfig);\r\n  });\r\n\r\n  return {\r\n    getInputs: getInputs,\r\n    registerEventListener: registerEventListener,\r\n    getStatus: getStatus,\r\n    getConfig: getConfig,\r\n    setConfig: setConfig\r\n  };\r\n}]);\r\n","var musicShowCaseApp = angular.module(\"MusicShowCaseApp\");\r\nmusicShowCaseApp.factory(\"Recipe\", ['$q', '$timeout', '$rootScope', '$http', 'Index', 'FileRepository', function($q, $timeout, $rootScope, $http, Index, FileRepository) {\r\n\r\n    var recipeList = ['intro', 'create_a_song', 'create_an_instrument'];\r\n    var blinks = [];\r\n\r\n    var currentRecipe = {\r\n      steps: [],\r\n      currentStep: 0\r\n    };\r\n\r\n    var handleEvent = function(event, args) {\r\n      var step = currentRecipe.steps[currentRecipe.currentStep];\r\n\r\n      if (!step) return;\r\n      if (step.eventHandler) step.eventHandler(event, args);\r\n    };\r\n\r\n    var runRecipeStep = function(currentStep) {\r\n      currentStep = currentStep||currentRecipe.currentStep;\r\n\r\n      var step = currentRecipe.steps[currentStep];\r\n\r\n      blinks = [];\r\n\r\n      $rootScope.$broadcast(\"__blink_disable_all\");\r\n      $rootScope.$broadcast(\"__tooltip_hide_all\");\r\n      if (!step) {\r\n        // recipe ends\r\n        Index.isolatedContext = null;\r\n        FileRepository.changed();\r\n\r\n        return;\r\n      }\r\n\r\n      (step.blink||[]).forEach(function(blink_id) {\r\n        blinks.push(blink_id);\r\n        $rootScope.$broadcast(\"_blink_enable_\" + blink_id);\r\n      });\r\n\r\n      for (var tooltip_id in step.tooltip||{}) {\r\n        $rootScope.$broadcast(\"_tooltip_display_\" + tooltip_id, {text: step.tooltip[tooltip_id]});\r\n      }\r\n\r\n      if (step.duration) {\r\n        $timeout(function() {\r\n          if (currentRecipe.currentStep <= currentStep) {\r\n            currentRecipe.currentStep = currentStep + 1;\r\n            runRecipeStep();\r\n          }\r\n        }, step.duration*1000);\r\n      }\r\n    };\r\n\r\n    var next_step_on = function(eventName) {\r\n      return function(event, args) {\r\n        if (event === eventName) {\r\n          currentRecipe.currentStep++;\r\n          runRecipeStep();\r\n        }\r\n      }\r\n    };\r\n\r\n    var delay = function(fcn, ms) {\r\n      return function(event, args) {\r\n        $timeout(function() {\r\n          fcn(event, args);\r\n        }, ms);\r\n      };\r\n    };\r\n\r\n    var getLocaleName = function(stepIndex, tooltipName) {\r\n       return \"s\"+stepIndex+\"_tooltip_\" + tooltipName;\r\n    };\r\n\r\n    var start = function(name) {\r\n      var loadEventHandler = function(eventHandlerData) {\r\n        if (eventHandlerData.next_step_on) {\r\n          return next_step_on(eventHandlerData.next_step_on);\r\n        } else if (eventHandlerData.delay) {\r\n          return delay(loadEventHandler(eventHandlerData.inner), eventHandlerData.delay);\r\n        }\r\n      };\r\n\r\n      var loadStep = function(stepData, stepIndex) {\r\n\r\n        var tr = {};\r\n        for (var k in stepData.tooltip) {\r\n          tr[k] = \"recipe\" + \".\" + name + \".\" + getLocaleName(stepIndex, k);\r\n        }\r\n\r\n        return {\r\n          blink: stepData.blink,\r\n          tooltip: tr,\r\n          eventHandler: loadEventHandler(stepData.eventHandler),\r\n          duration: stepData.duration\r\n        };\r\n      };\r\n\r\n      var createFile = function(file) {\r\n        return FileRepository.destroyFile(file.index.id)\r\n          .then(function() {\r\n            return FileRepository.createFile({\r\n              id: file.index.id,\r\n              type: file.index.type,\r\n              project: file.index.project,\r\n              name: file.index.name,\r\n              contents: file.contents\r\n            });\r\n          });\r\n      };\r\n\r\n      var createFiles = function(result) {\r\n        return $q.all((result.data.files||[]).map(createFile))\r\n          .then(function() {\r\n            return result;\r\n          });\r\n      };\r\n\r\n      var switchProject = function(result) {\r\n        if (result.data.project) {\r\n          document.location = \"#/editor/\"+ result.data.project;\r\n        }\r\n\r\n        return result;\r\n      };\r\n\r\n      return $http.get(\"recipes/\" + name +\".json\")\r\n        .then(createFiles)\r\n        .then(switchProject)\r\n        .then(function(result) {\r\n          var recipeData = result.data;\r\n\r\n          if (result.data.isolatedContext) {\r\n            Index.isolatedContext = result.data.isolatedContext + Math.floor(Date.now() / 1000);\r\n            FileRepository.changed();\r\n          }\r\n\r\n          currentRecipe.steps = recipeData.steps.map(loadStep);\r\n          currentRecipe.currentStep = 0;\r\n          runRecipeStep();     \r\n        });\r\n    };\r\n\r\n    start.raise = function(name) {\r\n      handleEvent(name);\r\n    };\r\n\r\n    var loadTranslations = function(options) {\r\n      var key = options.key;\r\n\r\n      var loadRecipeTranslation = function(name) {\r\n        return $http.get(\"recipes/\" + name +\".json\")\r\n          .then(function(result) {\r\n            var recipeData = result.data;\r\n            if (!recipeData.lang) return {};\r\n\r\n            var langIndex = recipeData.lang.indexOf(key);\r\n            if (langIndex === -1) return {}\r\n\r\n            var data = {};\r\n            recipeData.steps.forEach(function(step, stepIndex) {\r\n              if (step.tooltip) {\r\n                for (var k in step.tooltip) {\r\n                  var tp = step.tooltip[k];\r\n                  var localeName = getLocaleName(stepIndex, k);\r\n                  if (Array.isArray(tp)) {\r\n                    data[localeName] = tp[langIndex];\r\n                  } else {\r\n                    if (langIndex===0) {\r\n                      data[localeName] = tp;\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            });\r\n\r\n            return data;\r\n          });\r\n      };\r\n\r\n      var actions = {};\r\n      recipeList.forEach(function(recipeId) {\r\n        actions[recipeId] = loadRecipeTranslation(recipeId);\r\n      });\r\n\r\n      return $q.all(actions)\r\n        .then(function(recipeTranslationData) {\r\n          return {\r\n            recipe: recipeTranslationData\r\n          };\r\n        })\r\n    };\r\n\r\n    var getBlinks = function() {\r\n      return blinks;\r\n    };\r\n\r\n    return {\r\n      start: start,\r\n      step: runRecipeStep,\r\n      handleEvent: handleEvent,\r\n      loadTranslations: loadTranslations,\r\n      getBlinks: getBlinks\r\n    };\r\n}]);\r\n","var musicJs = angular.module(\"MusicShowCaseApp\");\r\nmusicJs.factory(\"Sync\", ['$q', function($q) {\r\n  return function() {\r\n    var promise = $q.when();\r\n    this.sync = function(f) {\r\n      return function() {\r\n        var _args = arguments;\r\n        var _self = this;\r\n        var defer = $q.defer();\r\n\r\n        promise = promise.then(function() {\r\n          return f.apply(_self, _args)\r\n            .then(function(value) {\r\n              defer.resolve(value);\r\n            })\r\n            .catch(function(err) {\r\n              defer.reject(err);\r\n            });\r\n        });\r\n        return defer.promise;\r\n      };\r\n    };\r\n  };\r\n}]);\r\n","var musicShowCaseApp = angular.module(\"MusicShowCaseApp\");\r\nmusicShowCaseApp.factory(\"translationsLoader\", ['$q', 'TypeService', 'esTranslations', 'enTranslations', 'Recipe', function($q, TypeService, esTranslations, enTranslations, Recipe) {\r\n    return function(options) {\r\n      var baseTranslation = {}\r\n\r\n      if (options.key==='es') {\r\n        baseTranslation = esTranslations;\r\n      }\r\n\r\n      if (options.key==='en') {\r\n        baseTranslation = enTranslations;\r\n      }\r\n\r\n      var addTranslations = function(tr) {\r\n        for (var k in tr) {\r\n          baseTranslation[k] = tr[k];\r\n        }\r\n      };\r\n\r\n      return $q.all({\r\n        typeTranslations: TypeService.loadTranslations(options),\r\n        recipeTranslations: Recipe.loadTranslations(options)\r\n      })\r\n        .then(function(result) {\r\n          addTranslations(result.typeTranslations);\r\n          addTranslations(result.recipeTranslations);\r\n\r\n          return baseTranslation;\r\n        })\r\n    };\r\n}]);\r\n","var musicShowCaseApp = angular.module(\"MusicShowCaseApp\");\r\n\r\nvar ObjectCache = function() {\r\n  var wm = new WeakMap();\r\n  this.get = function(music, object) {\r\n    var array = wm.get(music);\r\n    var strobj = JSON.stringify(object);\r\n\r\n    if (!array) return undefined;\r\n\r\n    var elem = array.filter(function(x) {\r\n      return x.obj === strobj;\r\n    })[0];\r\n\r\n    return elem && elem.value;\r\n  };\r\n\r\n  this.set = function(music, object, value) {\r\n    var array = wm.get(music);\r\n    var strobj = JSON.stringify(object);\r\n\r\n    if (!array) {\r\n      array = [];\r\n    }\r\n\r\n    var elem = array.filter(function(x) {\r\n      return x.obj === strobj;\r\n    })[0];\r\n\r\n    if (elem) {\r\n      elem.value = value;\r\n    } else {\r\n      array.push({obj: strobj, value: value});\r\n    }\r\n\r\n    if (array.length > 8) array = array.slice(1);\r\n\r\n    wm.set(music, array);\r\n  };\r\n};\r\n\r\nmusicShowCaseApp.service(\"TypeService\", [\"$http\", \"$q\", function($http, $q) {\r\n  var make_mutable = function(fcn, options) {\r\n    var cacheData = new ObjectCache();\r\n\r\n    var cacheWrap = function(object, baseMusic) {\r\n      var originalPrune = baseMusic.prune;\r\n      baseMusic.prune = function() {\r\n        cacheData = new ObjectCache();\r\n\r\n        if (originalPrune) {\r\n          return originalPrune.apply(this, arguments);\r\n        }\r\n      };\r\n\r\n      return function(constructor) {\r\n        return function(music, params){\r\n          var key = baseMusic;\r\n          if (key.getOriginal) key = key.getOriginal();\r\n          cacheData.set(key, object, music)\r\n\r\n          return constructor(music, params);\r\n        };\r\n      };\r\n    };\r\n\r\n    return function(object, subobjects, components) {\r\n      var current;\r\n      var instances = [];\r\n\r\n      if (options && options.reusableNode) {\r\n        current = function(music, params) {\r\n          var wrapped = subobjects[0];\r\n          var constructor = fcn(object, subobjects.map(cacheWrap(object, music)), components); \r\n          var key = music;\r\n          if (key.getOriginal) key = key.getOriginal();\r\n\r\n          var newBase = cacheData.get(key, object);\r\n          if (newBase) {\r\n            return wrapped(newBase);\r\n          } else {\r\n            return constructor(music, params);\r\n          }\r\n        }\r\n      } else {\r\n        current = fcn(object, subobjects, components);\r\n      }\r\n\r\n      if (current.update) {\r\n        return current;\r\n      }\r\n\r\n      var ret = function(music, options) {\r\n        var r;\r\n        var wrapped = {};\r\n        var lastCurrent = current;\r\n        var proxy = function(name) {\r\n          wrapped[name] = function() {\r\n            if (lastCurrent != current) update();\r\n            return r[name].apply(r, arguments);\r\n          };\r\n        };\r\n\r\n        var update = function() {\r\n            var newr = current(music, options);\r\n            if (newr !== r && r && r.dispose) r.dispose();\r\n            r = newr;\r\n\r\n            instances.push(newr);\r\n\r\n            lastCurrent = current;\r\n            for (var k in r) proxy(k);\r\n        };\r\n\r\n        update();\r\n\r\n        return wrapped;\r\n      };\r\n\r\n      var lastObjData;\r\n      ret.update = function(newobject, _components) {\r\n        components = _components\r\n        if (JSON.stringify(newobject) === lastObjData) return ret;\r\n        lastObjData = JSON.stringify(newobject);\r\n\r\n        instances.forEach(function(instance) {\r\n          if(instance.dispose) instance.dispose();\r\n        });\r\n        instances = [];\r\n\r\n        current = fcn(newobject, subobjects, components);\r\n        return ret;\r\n      };\r\n\r\n      return ret;\r\n    };\r\n  };\r\n\r\n\r\n  var plugins = [\"core\"];\r\n  var types = [];\r\n  var translation = {};\r\n  var m = function(pluginName) {\r\n    return {\r\n      lang: function(key, translateData) {\r\n        translation[key] =translation[key]||{};\r\n        translation[key][pluginName] = translateData;\r\n      },\r\n      type: function(typeName, options, constructor) {\r\n        types.push({\r\n          templateUrl: \"site/plugin/\" + pluginName + \"/\" + options.template + \".html\",\r\n          parameters: options.parameters,\r\n          constructor: make_mutable(constructor, {reusableNode: options.reusableNode}),\r\n          name: typeName,\r\n          composition: options.composition,\r\n          components: options.components,\r\n          description: options.description,\r\n          _default: options._default,\r\n          subobjects: options.subobjects,\r\n          stackAppend: options.stackAppend,\r\n          monitor: options.monitor\r\n        })\r\n      }\r\n    };\r\n  };\r\n\r\n  var loadPlugin = function(pluginName) {\r\n    return $http.get(\"site/plugin/\" + pluginName + \"/index.js\")\r\n      .then(function(result) {\r\n        var runnerCode = result.data;\r\n        var module = {export: function(){}};\r\n        eval(runnerCode);\r\n\r\n        module.export(m(pluginName));\r\n      });\r\n  };\r\n\r\n  var pluginsLoaded = $q.all(plugins.map(loadPlugin));\r\n\r\n  var getTypes = function(keyword) {\r\n      var hasKeyword = function() {\r\n        return true;\r\n      };\r\n\r\n      if (keyword) {\r\n        keyword = keyword.toLowerCase();\r\n        hasKeyword = function(x) {\r\n          return x.name.toLowerCase().indexOf(keyword) !== -1;\r\n        };\r\n      }\r\n\r\n      return pluginsLoaded.then(function() {\r\n        return types.filter(hasKeyword);\r\n      });\r\n  };\r\n\r\n  var getType = function(typeName, callback) {\r\n    return pluginsLoaded\r\n      .then(function() {\r\n        var ret = types.filter(function(type) { return type.name === typeName; })[0]; \r\n        if (callback) callback(ret);\r\n        return ret;\r\n      });\r\n  };\r\n\r\n  var loadTranslations = function(options) {\r\n    return pluginsLoaded\r\n      .then(function() {\r\n        return translation[options.key]||{};\r\n      });\r\n  };\r\n\r\n  return {\r\n    getTypes: getTypes,\r\n    getType: getType,\r\n    loadTranslations: loadTranslations\r\n  };\r\n\r\n}]);\r\n\r\n","var musicShowCaseApp = angular.module(\"MusicShowCaseApp\");\r\nmusicShowCaseApp.factory(\"WelcomeMessage\", ['localforage', function(localforage) {\r\n    var skip = function() {\r\n      return localforage.getItem(\"welcome_skip\")\r\n        .then(function(result) {\r\n          return !!result;\r\n        });\r\n    };\r\n\r\n    var setSkip = function(value) {\r\n      if (value) {\r\n        return localforage.setItem(\"welcome_skip\", value);\r\n      } else {\r\n        return localforage.removeItem(\"welcome_skip\");\r\n      }\r\n    };\r\n\r\n    return {\r\n      setSkip: setSkip,\r\n      skip: skip\r\n    };\r\n}]);\r\n","var musicShowCaseApp = angular.module(\"MusicShowCaseApp\");\r\nmusicShowCaseApp.factory(\"_localforage\", ['$q', 'localforage', function($q, localforage) {\r\n  var getItem = localforage.getItem.bind(localforage);\r\n\r\n  var releaseWithIndex = function(index, bytes) {\r\n    if (index.length === 0) return $q.when(index);\r\n    if (bytes <= 0) return $q.when(index);\r\n\r\n    var nextEntry = index.shift();\r\n    return localforage.getItem(nextEntry.id)\r\n      .then(function(value) {\r\n        return localforage.removeItem(nextEntry.id)\r\n          .then(function() {\r\n             return releaseWithIndex(index, bytes - (value ? value.length : 0));\r\n          });\r\n      });\r\n  };\r\n\r\n  var clearItem = function(data) {\r\n    return {id: data.id, name: data.name, type: data.type};\r\n  };\r\n\r\n  var release = function(bytes) {\r\n    return localforage.getItem(\"recycle\")\r\n      .then(function(index) {\r\n        return releaseWithIndex(index, bytes);\r\n      })\r\n      .then(function(newIndex) {\r\n        return localforage.setItem(\"recycle\", newIndex.map(clearItem));\r\n      });\r\n  };\r\n\r\n  var setItem = function(key, object, isretry) {\r\n    return localforage.setItem(key, object)\r\n      .catch(function(err) {\r\n        if (!isretry) {\r\n          return release(object.length)\r\n            .then(function() {\r\n              return setItem(key, object, true);\r\n            });\r\n        }\r\n\r\n        throw err;\r\n      });\r\n  };\r\n\r\n\r\n  var removeItem = localforage.removeItem.bind(localforage);\r\n\r\n  return {\r\n    getItem: getItem,\r\n    setItem: setItem,\r\n    removeItem: removeItem\r\n  };\r\n}]);\r\n","var musicShowCaseApp = angular.module(\"MusicShowCaseApp\");\r\n\r\nmusicShowCaseApp.filter(\"instrument_name\", function() {\r\n  return function(instrumentId, instrumentMap) {\r\n    return instrumentMap[instrumentId] && instrumentMap[instrumentId] ? instrumentMap[instrumentId].name : instrumentId;\r\n  };\r\n});\r\n\r\nmusicShowCaseApp.filter(\"instrument_type\", function() {\r\n  return function(instrumentId, instrumentMap) {\r\n    return instrumentMap[instrumentId] && instrumentMap[instrumentId] ? instrumentMap[instrumentId].type : 'instrument';\r\n  };\r\n});\r\n\r\nmusicShowCaseApp.filter(\"block_name\", function() {\r\n  return function(block, indexMap) {\r\n    return indexMap[block.id] && indexMap[block.id].index ? indexMap[block.id].index.name : block.id;\r\n  };\r\n});\r\n\r\nmusicShowCaseApp.filter(\"block_length\", [\"Pattern\", function(Pattern) {\r\n  return function(block, indexMap, measure) {\r\n    if (!block.id) return 1;\r\n    if (!indexMap[block.id]) return 1;\r\n    if (!indexMap[block.id].contents) return 1;\r\n\r\n    return Pattern.computeMeasureCount(indexMap[block.id].contents, measure);\r\n  };\r\n}]);\r\n\r\nmusicShowCaseApp.controller(\"recordOptionsCtrl\", [\"$scope\", \"$uibModalInstance\", \"Recipe\", function($scope, $uibModalInstance, Recipe) {\r\n  $scope.numChannels = 2;\r\n  $scope.encoding = \"wav\";\r\n  $scope.recipe = Recipe.start;\r\n\r\n  $scope.cancel = function() {\r\n    $uibModalInstance.dismiss();\r\n  };\r\n\r\n  $scope.start = function() {\r\n    $scope.recipe.raise(\"song_rec_confirm\");\r\n\r\n    $uibModalInstance.close({\r\n      encoding: $scope.encoding,\r\n      numChannels: $scope.numChannels\r\n    });\r\n  };\r\n}]);\r\n\r\nmusicShowCaseApp.controller(\"DashboardController\", [\"$scope\", function($scope) {\r\n  $scope.$emit('switchProject', \"default\");\r\n}]);\r\n\r\nmusicShowCaseApp.controller(\"ProjectDashboardController\", [\"$scope\", \"$routeParams\", function($scope, $routeParams) {\r\n  $scope.$emit('switchProject', $routeParams.project);\r\n}]);\r\n\r\nmusicShowCaseApp.controller(\"SongEditorController\", [\"$scope\", \"$uibModal\", \"$q\", \"$timeout\", \"$routeParams\", \"$http\", \"MusicContext\", \"FileRepository\", \"InstrumentSet\", \"Pattern\", \"Export\", \"TICKS_PER_BEAT\", \"SONG_MAX_TRACKS\", \r\n    function($scope, $uibModal, $q, $timeout, $routeParams, $http, MusicContext, FileRepository, InstrumentSet, Pattern, Export, TICKS_PER_BEAT, SONG_MAX_TRACKS) {\r\n\r\n  $scope.indexMap = {};\r\n  var id = $routeParams.id;\r\n  var instSet = InstrumentSet();\r\n  var playingStartOffset = 0;\r\n\r\n  $scope.$emit('switchProject', $routeParams.project);\r\n\r\n  var pxToTicks = function(px) {\r\n    var beatWidth = 154 / $scope.file.measure;\r\n    var zoomLevel = 1;\r\n    return TICKS_PER_BEAT*px/zoomLevel/beatWidth;\r\n  };\r\n\r\n  $scope.seek = function(event) {\r\n    if ($scope.currentRec) return;\r\n\r\n    playingStartOffset = pxToTicks(event.offsetX);\r\n    $scope.$broadcast(\"resetClock\", playingStartOffset);\r\n\r\n    if ($scope.playing) {\r\n      $scope.playing.stop();\r\n      $scope.playing = null;\r\n      $scope.replay();\r\n    }\r\n  };\r\n\r\n  $scope.patternEdit = function(block) {\r\n    document.location = \"#/editor/\" + $routeParams.project + \"/pattern/\" + block.id;\r\n  };\r\n\r\n  $scope.exportItem = function() {\r\n    Export.exportFile($scope.fileIndex.name, $scope.fileIndex.id);\r\n  };\r\n\r\n  $scope.removeItem = function() {\r\n    if ($scope.fileIndex.builtIn) {\r\n      $scope.file = null;\r\n      $scope.fileIndex = null;\r\n      FileRepository.destroyFile(id)\r\n        .then(function() {\r\n          reloadFromRepo();\r\n        });\r\n      return;\r\n    }\r\n\r\n    FileRepository.moveToRecycleBin(id)\r\n      .then(function() {\r\n        document.location = \"#/editor/\" + $routeParams.project;\r\n      });\r\n  };\r\n\r\n  $scope.remove = function(block) {\r\n    delete block.id;\r\n    checkPayload();\r\n    $scope.fileChanged();\r\n  };\r\n\r\n  $scope.currentRec = null;\r\n\r\n  $scope.record = function() {\r\n    if ($scope.playing) {\r\n      $scope.playing.stop();\r\n      $scope.playing = null;\r\n\r\n      $scope.$broadcast(\"pauseClock\");\r\n    }\r\n\r\n    var modalIns = $uibModal.open({\r\n      templateUrl: \"site/templates/modal/recordOptions.html\",\r\n      controller: \"recordOptionsCtrl\"\r\n    });\r\n\r\n    modalIns.result.then(function(encodingOptions) {\r\n      $scope.currentRec = MusicContext.record({\r\n        encoding: encodingOptions.encoding, \r\n        numChannels: encodingOptions.numChannels\r\n      }, function(blob) {\r\n        var a = document.createElement(\"a\");\r\n        document.body.appendChild(a);\r\n        a.style = \"display: none\";\r\n\r\n        var url  = window.URL.createObjectURL(blob);\r\n        a.href = url;\r\n        a.download = $scope.fileIndex.name + \".\" + encodingOptions.encoding;\r\n        a.click();\r\n        window.URL.revokeObjectURL(url);\r\n\r\n        $scope.recipe.raise('song_rec_stop');\r\n      });\r\n\r\n      $scope.play();\r\n    });\r\n  };\r\n\r\n  $scope.stop = function() {\r\n    playingStartOffset = 0;\r\n\r\n    $scope.$broadcast(\"stopClock\");\r\n    $scope.$broadcast(\"resetClock\", playingStartOffset);\r\n\r\n    if ($scope.playing) $scope.playing.stop();\r\n    $scope.recipe.raise(\"song_play_stopped\");\r\n    $scope.playing = null;\r\n  };\r\n\r\n  $scope.playing = null;\r\n\r\n  $scope.$on('pausedClock', function(evt, ticks) {\r\n    playingStartOffset = ticks;    \r\n  });\r\n\r\n  $scope.play = function() {\r\n    if ($scope.playing) {\r\n      $scope.playing.stop();\r\n      $scope.playing = null;\r\n\r\n      $scope.$broadcast(\"pauseClock\");\r\n      return;\r\n    }\r\n\r\n    $scope.replay();\r\n  };\r\n\r\n  $scope.replay = function() {\r\n    MusicContext.resumeAudio();\r\n\r\n    $q.all(instSet.all)\r\n      .then(function(instruments){\r\n        var patterns = {};\r\n\r\n        var createPattern = function(id, songTrackIdx) {\r\n          if (!id) return null;\r\n          if (patterns[id]) return patterns[id];\r\n\r\n          var pattern = $scope.indexMap[id].contents;\r\n          var changedBpm = Object.create(pattern);\r\n          changedBpm.bpm = $scope.file.bpm;\r\n\r\n          patterns[id] = Pattern.patternCompose(changedBpm, instruments, songTrackIdx*SONG_MAX_TRACKS, function() {});\r\n          return patterns[id];\r\n        };        \r\n\r\n        var song = new MUSIC.Song(\r\n          $scope.file.tracks.map(function(track, songTrackIdx) {\r\n            return track.blocks.map(function(block) {\r\n              return createPattern(block.id, songTrackIdx);\r\n            });\r\n          })\r\n        , {\r\n            measure: $scope.file.measure,\r\n            bpm: $scope.file.bpm,\r\n            ticks_per_beat: TICKS_PER_BEAT,\r\n            start: playingStartOffset\r\n          });\r\n\r\n        $scope.$broadcast(\"startClock\", song.timeToTicks());\r\n        $scope.playing = song.play({\r\n          onStop: function() {\r\n            $scope.$broadcast(\"stopClock\");\r\n            $scope.$broadcast(\"resetClock\", playingStartOffset);\r\n\r\n            $scope.recipe.raise(\"song_play_stopped\");\r\n            $scope.playing = null;\r\n            if ($scope.currentRec) $scope.currentRec.stop();\r\n            $scope.currentRec = null;\r\n            $timeout(function() {});\r\n          }\r\n        });\r\n\r\n      });\r\n  };\r\n\r\n  $scope.indexChanged = function() {\r\n    $scope.fileIndex.ref = FileRepository.getRefs(\"song\", $scope.file);\r\n    FileRepository.updateIndex(id, $scope.fileIndex);\r\n  };\r\n\r\n  $scope.fileChanged = fn.debounce(function() {\r\n    FileRepository.updateFile(id, $scope.file)\r\n      .then(function() {\r\n        $scope.indexChanged();\r\n      });\r\n  },100);\r\n\r\n  var checkPayload = function() {\r\n    var maxblocks = 0;\r\n    var maxTrackIndex = 0;\r\n\r\n    if (!$scope.file) return;\r\n    if (!$scope.file.tracks) return;\r\n\r\n    $scope.file.tracks.forEach(function(track, trackIndex) {\r\n      for (var i=0;i<track.blocks.length;i++) {\r\n        if (track.blocks[i].id){\r\n          var mCount = Pattern.computeMeasureCount($scope.indexMap[track.blocks[i].id].contents, $scope.file.measure);\r\n          if (i+mCount>maxblocks) maxblocks=i+mCount;\r\n          if (trackIndex > maxTrackIndex) maxTrackIndex = trackIndex;\r\n        }\r\n      }\r\n    });\r\n\r\n    if ($scope.file.tracks.length < maxTrackIndex+2 && $scope.file.tracks.length < SONG_MAX_TRACKS) {\r\n      $scope.file.tracks.push({\r\n        blocks: $scope.file.tracks[0].blocks.map(function() {return {};})\r\n      });\r\n    } else {\r\n      $scope.file.tracks = $scope.file.tracks.slice(0,maxTrackIndex+2);\r\n    }\r\n\r\n    var target = maxblocks + 1;\r\n    $scope.file.tracks.forEach(function(track) {\r\n      if (target > track.blocks.length) {\r\n        var payload = target-track.blocks.length;\r\n        for (var i=0;i<payload;i++) {\r\n          track.blocks.push({});\r\n        }\r\n      } else {\r\n        track.blocks = track.blocks.slice(0, target);\r\n      }\r\n    });\r\n    $scope.fileChanged();\r\n  };\r\n  $scope.$watch(\"file.measure\", checkPayload);\r\n\r\n  $scope.onDropComplete = function($data,$event,block,songTrackIdx) {\r\n    if ($data.fromBlock) {\r\n\r\n      var swapId = block.id;\r\n      block.id = $data.fromBlock.id;\r\n      $data.fromBlock.id = swapId;\r\n\r\n      checkPayload();\r\n      return;\r\n    }\r\n    if ($data.type !== 'pattern') return;\r\n\r\n    block.id = $data.id;\r\n    FileRepository.getFile($data.id)\r\n      .then(function(f) {\r\n        f.contents.tracks.forEach(function(track, idx) {\r\n          if (track.instrument) instSet.load(track.instrument, songTrackIdx*SONG_MAX_TRACKS + idx);\r\n        });\r\n\r\n        $scope.indexMap[$data.id] = f;\r\n        checkPayload();\r\n        $scope.fileChanged();\r\n\r\n        $scope.recipe.raise('song_pattern_dropped');\r\n      });\r\n    \r\n  };\r\n\r\n  var reloadFromRepo = function() {\r\n    var block_ids = {};\r\n\r\n    FileRepository.getFile(id).then(function(file) {\r\n      if (file) {\r\n        file.contents.tracks.forEach(function(track, idx) {\r\n          track.blocks.forEach(function(block){\r\n            if (block && block.id) {\r\n              if (!block_ids[block.id]){\r\n                block_ids[block.id] = FileRepository.getFile(block.id)\r\n                  .then(function(file) {\r\n                    return {\r\n                      file: file,\r\n                      idx: idx\r\n                    };\r\n                  });\r\n              }\r\n            }\r\n          })\r\n        });\r\n      };\r\n\r\n      return $q.all(block_ids)\r\n        .then(function(indexMap) {\r\n          $scope.indexMap = {};\r\n\r\n          for (var blockId in indexMap) {\r\n            var pattern = indexMap[blockId].file.contents;\r\n            var songTrackIdx = indexMap[blockId].idx;\r\n\r\n            $scope.indexMap[blockId] = indexMap[blockId].file;\r\n            pattern.tracks.forEach(function(track, idx) {\r\n              if (track.instrument) instSet.load(track.instrument, songTrackIdx*SONG_MAX_TRACKS + idx);\r\n            });\r\n          }\r\n        })\r\n        .then(function() {\r\n          $timeout(function() {\r\n            var outputFile = {};\r\n            $scope.fileIndex = file.index;\r\n            $scope.file = file.contents;\r\n          });\r\n        });\r\n    });\r\n  };\r\n\r\n  reloadFromRepo();\r\n\r\n  var keyDownHandler = function(evt) {\r\n    if (document.activeElement.tagName.toLowerCase() === \"input\") return;\r\n    \r\n    if (evt.keyCode === 90 && evt.ctrlKey) {\r\n      FileRepository.undo(id).then(reloadFromRepo);\r\n    }\r\n\r\n    if (evt.keyCode === 89 && evt.ctrlKey) {\r\n      FileRepository.redo(id).then(reloadFromRepo);\r\n    }\r\n  };\r\n\r\n  $(document).bind(\"keydown\", keyDownHandler);\r\n  $scope.$on(\"$destroy\", function() {\r\n    $(document).unbind(\"keydown\", keyDownHandler);\r\n    instSet.dispose();\r\n  });  \r\n}]);\r\n\r\nmusicShowCaseApp.controller(\"PatternEditorController\", [\"$q\", \"$translate\", \"$scope\", \"$timeout\", \"$routeParams\", \"$http\", \"TICKS_PER_BEAT\", \"MusicContext\", \"FileRepository\", \"Pattern\", \"InstrumentSet\", 'Export', 'ErrMessage',\r\n  function($q, $translate, $scope, $timeout, $routeParams, $http, TICKS_PER_BEAT, MusicContext, FileRepository, Pattern, InstrumentSet, Export, ErrMessage) {\r\n  var id = $routeParams.id;\r\n  var playingStartOffset = 0;\r\n\r\n  $scope.exportItem = function() {\r\n    Export.exportFile($scope.fileIndex.name, $scope.fileIndex.id);\r\n  };\r\n\r\n  $scope.$emit('switchProject', $routeParams.project); \r\n\r\n  $scope.instrumentEdit = function(track) {\r\n    document.location = \"#/editor/\" + $routeParams.project + \"/instrument/\" + track.instrument;\r\n  };\r\n\r\n  $scope.instrumentMap = {};\r\n  $scope.beatWidth = 10;\r\n  $scope.zoomLevel = 8;\r\n  $scope.selectedTrack = 0;\r\n  $scope.mutedState = [];\r\n\r\n  var instSet = InstrumentSet();\r\n\r\n  var pxToTicks = function(px) {\r\n    var beatWidth = 10;\r\n    return TICKS_PER_BEAT*px/$scope.zoomLevel/beatWidth;\r\n  };\r\n\r\n  $scope.seek = function(event) {\r\n    playingStartOffset = pxToTicks(event.offsetX + $scope.file.scrollLeft);\r\n    $scope.$broadcast(\"resetClock\", playingStartOffset);\r\n\r\n    if ($scope.playing) {\r\n      $scope.playing.stop();\r\n      $scope.playing = null;\r\n      $scope.replay();\r\n    }\r\n  };\r\n\r\n  $scope.updateMuted = function() {\r\n    $scope.mutedState = Pattern.getMutedState($scope.file);\r\n    $scope.fileChanged();\r\n\r\n    $scope.file.tracks.forEach(function(track, idx) {\r\n      instSet.mute(idx, $scope.mutedState[idx]);\r\n    });\r\n  };\r\n\r\n  $scope.removeItem = function() {\r\n    if ($scope.fileIndex.builtIn) {\r\n      $scope.file = null;\r\n      $scope.fileIndex = null;\r\n      FileRepository.destroyFile(id)\r\n        .then(function() {\r\n          reloadFromRepo();\r\n        });\r\n      return;\r\n    }\r\n\r\n    FileRepository.moveToRecycleBin(id)\r\n      .then(function() {\r\n        document.location = \"#/editor/\" + $routeParams.project;\r\n      })\r\n      .catch(function(err) {\r\n        if (err.type && err.type === 'cantremove') {\r\n          ErrMessage('common.error_title', 'common.cantremove_error');\r\n        } else {\r\n          throw err;\r\n        }\r\n      });\r\n  };\r\n\r\n  $scope.removeTrack = function(trackIdx) {\r\n    $scope.file.tracks = \r\n      $scope.file.tracks.slice(0, trackIdx)\r\n        .concat($scope.file.tracks.slice(trackIdx+1));\r\n\r\n    $scope.file.selectedTrack = $scope.file.selectedTrack % $scope.file.tracks.length;\r\n\r\n    $scope.updateMuted();\r\n    $scope.fileChanged();\r\n  };\r\n\r\n  $scope.addTrack = function() {\r\n    $scope.file.tracks.push({\r\n      events: [],\r\n      scroll: 1000\r\n    });\r\n\r\n    $scope.file.selectedTrack = $scope.file.tracks.length - 1;\r\n    $scope.updateMuted();\r\n    $scope.fileChanged();\r\n  };\r\n\r\n\r\n  $scope.stop = function() {\r\n    playingStartOffset = 0;\r\n\r\n    $scope.$broadcast(\"stopClock\");\r\n    $scope.$broadcast(\"resetClock\", playingStartOffset);\r\n\r\n    if ($scope.playing) $scope.playing.stop();\r\n    $scope.recipe.raise(\"song_play_stopped\");\r\n    $scope.playing = null;\r\n  };\r\n\r\n  $scope.$on('pausedClock', function(evt, ticks) {\r\n    playingStartOffset = ticks;    \r\n  });\r\n\r\n  $scope.play = function() {\r\n    if ($scope.playing) {\r\n      $scope.playing.stop();\r\n      $scope.playing = null;\r\n\r\n      $scope.$broadcast(\"pauseClock\");\r\n      return;\r\n    }\r\n\r\n    $scope.replay();\r\n  };\r\n\r\n  $scope.replay = function() {\r\n    MusicContext.resumeAudio();\r\n\r\n    var playingLine = $(\".playing-line\");\r\n\r\n    $q.all(instSet.all)\r\n      .then(function(instruments) {\r\n        if ($scope.playing) $scope.playing.stop();\r\n\r\n        var onStop = function() {\r\n          $scope.$broadcast(\"stopClock\");\r\n          $scope.$broadcast(\"resetClock\");\r\n          $scope.recipe.raise(\"pattern_play_stopped\");\r\n\r\n          $timeout(function() {\r\n            $scope.playing = null;\r\n          });\r\n\r\n          playingStartOffset = 0;\r\n        };\r\n\r\n        var pattern = Pattern.patternCompose($scope.file, instruments, 0, onStop, {\r\n          start: playingStartOffset\r\n        });\r\n\r\n        $scope.playing = pattern.play();\r\n\r\n        var timeToTicks = pattern.timeToTicks();\r\n        $scope.$broadcast(\"startClock\", timeToTicks);\r\n      });\r\n  };\r\n\r\n  $scope.zoomIn = function() {\r\n    $scope.zoomLevel = $scope.zoomLevel * 2;\r\n    if ($scope.zoomLevel > 32) $scope.zoomLevel = 32;\r\n  };\r\n\r\n  $scope.zoomOut = function() {\r\n    $scope.zoomLevel = $scope.zoomLevel / 2;\r\n    if ($scope.zoomLevel < 1) $scope.zoomLevel = 1;\r\n  };\r\n\r\n  $scope.indexChanged = function() {\r\n    $scope.fileIndex.ref = FileRepository.getRefs(\"pattern\", $scope.file);\r\n    FileRepository.updateIndex(id, $scope.fileIndex);\r\n  };\r\n\r\n  $scope.fileChanged = fn.debounce(function() {\r\n    FileRepository.updateFile(id, $scope.file)\r\n      .then($scope.indexChanged);\r\n  },100);\r\n\r\n  $scope.$on(\"trackChanged\", function(track) {\r\n    computeMeasureCount();\r\n    $scope.fileChanged();\r\n  });\r\n\r\n  var beep = function(instrument, n) {\r\n      if (!instrument) return;\r\n      if (!instrument.note) return;\r\n\r\n      if (lastPlaying) lastPlaying.stop();\r\n      lastPlaying = instrument.note(n).play();\r\n\r\n      setTimeout(function(){\r\n        if (lastPlaying) lastPlaying.stop();\r\n        lastPlaying = null;\r\n      },50);\r\n  };\r\n\r\n  var computeMeasureCount = function() {\r\n    if (!$scope.file) return;\r\n    if (!$scope.file.tracks[0]) return;\r\n\r\n    $scope.file.measureCount = Pattern.computeMeasureCount($scope.file, $scope.file.measure);\r\n  };\r\n\r\n  var lastPlaying;\r\n  var trackMuted = function(track) {\r\n    return $scope.mutedState[$scope.file.tracks.indexOf(track)];\r\n  };\r\n\r\n  $scope.$on(\"eventChanged\", function(evt, data) {\r\n    computeMeasureCount();\r\n\r\n    if (data.oldevt.n !== data.evt.n && !trackMuted(data.track)) beep(instrument.get(data.track), data.evt.n);\r\n\r\n    $scope.fileChanged();\r\n  });\r\n\r\n  $scope.$on(\"eventSelected\", function(evt, data) {\r\n    if (!trackMuted(data.track)) beep(instrument.get(data.track), data.evt.n);\r\n  });\r\n\r\n  $scope.$watch(\"file.measure\", computeMeasureCount);\r\n\r\n  var instrument = new WeakMap();\r\n\r\n  $scope.updateInstrument = function(trackNo) {\r\n    if (!$scope.file.tracks[trackNo]) return;\r\n    if (!$scope.file.tracks[trackNo].instrument) return;\r\n\r\n    return $q.all({\r\n      musicObject: instSet.load($scope.file.tracks[trackNo].instrument, trackNo),\r\n      index: FileRepository.getIndex($scope.file.tracks[trackNo].instrument)\r\n    }).then(function(result) {\r\n        $scope.instrumentMap[$scope.file.tracks[trackNo].instrument] = result.index;\r\n        if (result.musicObject) instrument.set($scope.file.tracks[trackNo], result.musicObject);\r\n        return result.musicObject;\r\n    });\r\n  };\r\n\r\n  $scope.onDropComplete = function(instrument,event) {\r\n    MusicContext.resumeAudio();\r\n\r\n    if (\r\n      instrument.type !== 'instrument' &&\r\n      instrument.type !== 'tempo'\r\n    ) return;\r\n\r\n    var trackNo = $scope.file.selectedTrack;\r\n\r\n    $scope.file.tracks = $scope.file.tracks || [];\r\n    $scope.file.tracks[trackNo] = $scope.file.tracks[trackNo] || {};\r\n    $scope.file.tracks[trackNo].instrument = instrument.id;\r\n\r\n    FileRepository.updateFile(id, $scope.file);\r\n    $scope.updateInstrument(trackNo)\r\n      .then(function(musicObject) {\r\n        $scope.updateMuted();\r\n        if (!$scope.mutedState[trackNo]) beep(musicObject, 36);\r\n      });\r\n  };\r\n\r\n  var reloadFromRepo = function() {\r\n    FileRepository.getFile(id).then(function(file) {\r\n      $timeout(function() {\r\n        var outputFile = {};\r\n        $scope.fileIndex = file.index;\r\n        $scope.file = file.contents;\r\n        $scope.mutedState = Pattern.getMutedState($scope.file);\r\n        $scope.updateMuted();\r\n\r\n        if (!$scope.file.tracks) $scope.file.tracks=[{}];\r\n\r\n        $scope.file.tracks.forEach(function(track, idx) {\r\n          track.events = track.events || [];\r\n          $scope.updateInstrument(idx);\r\n        });\r\n      });\r\n    });\r\n  };\r\n\r\n  reloadFromRepo();\r\n\r\n  // undo & redo\r\n\r\n  var keyDownHandler = function(evt) {\r\n    if (document.activeElement.tagName.toLowerCase() === \"input\") return;\r\n\r\n    if (evt.keyCode === 90 && evt.ctrlKey) {\r\n      FileRepository.undo(id).then(reloadFromRepo);\r\n    }\r\n\r\n    if (evt.keyCode === 89 && evt.ctrlKey) {\r\n      FileRepository.redo(id).then(reloadFromRepo);\r\n    }\r\n  };\r\n\r\n  var playButton = $(\"button.play-button\");\r\n\r\n  playButton.bind(\"click\", MusicContext.resumeAudio);\r\n  $(document).bind(\"keydown\", keyDownHandler);\r\n  $scope.$on(\"$destroy\", function() {\r\n    playButton.unbind(\"click\", MusicContext.resumeAudio);\r\n    $(document).unbind(\"keydown\", keyDownHandler);\r\n\r\n    instSet.dispose();\r\n  });\r\n\r\n  $scope.$on(\"enableTrack\", function(evt, track) {\r\n    $scope.file.selectedTrack = $scope.file.tracks.indexOf(track);\r\n  });\r\n\r\n  $scope.$on(\"patternSelectEvent\", function(evt, event) {\r\n    $timeout(function() {\r\n      $scope.$broadcast(\"trackSelectEvent\", event);\r\n    });\r\n  });\r\n}]);\r\n\r\nmusicShowCaseApp.controller(\"EditorController\", [\"$scope\", \"$q\", \"$timeout\", \"$routeParams\", \"$http\", \"MusicContext\", \"FileRepository\", \"MusicObjectFactory\", \"Export\", function($scope, $q, $timeout, $routeParams, $http, MusicContext, FileRepository, MusicObjectFactory, Export) {\r\n  var id = $routeParams.id;\r\n  $scope.$emit('switchProject', $routeParams.project);\r\n\r\n  $scope.exportItem = function() {\r\n    Export.exportFile($scope.fileIndex.name, $scope.fileIndex.id);\r\n  };\r\n\r\n  $scope.removeItem = function() {\r\n    destroyAll();\r\n\r\n    if ($scope.fileIndex.builtIn) {\r\n      $scope.file = null;\r\n      $scope.fileIndex = null;\r\n      FileRepository.destroyFile(id)\r\n        .then(function() {\r\n          reloadFromRepo();\r\n        });\r\n      return;\r\n    } else {\r\n      FileRepository.moveToRecycleBin(id)\r\n        .then(function() {\r\n          document.location = \"#/editor/\" + $routeParams.project;\r\n        })\r\n        .catch(function(err) {\r\n          if (err.type && err.type === 'cantremove') {\r\n            ErrMessage('common.error_title', 'common.cantremove_error');\r\n          } else {\r\n            throw err;\r\n          }\r\n        });\r\n    }\r\n  };\r\n\r\n  var lastObj;\r\n  var musicObjectFactory = MusicObjectFactory({monitor: true});\r\n\r\n  var destroyAll = function() {\r\n    ($scope.instruments||[]).forEach(function(instrument) {\r\n      if (instrument.dispose) instrument.dispose();\r\n    });\r\n\r\n    ($scope.playables||[]).forEach(function(playable) {\r\n      $scope.stopPlay(playable);\r\n    });    \r\n\r\n    return musicObjectFactory.destroyAll();\r\n  };\r\n\r\n  var lazyLoadInstrument = function(f) {\r\n    var callStop = function(p) { return p.stop(); };\r\n    var callPlay = function(p) { return p.play(); };\r\n\r\n    var instrumentPromise;\r\n    var innerInstrument;\r\n\r\n    var note = function(n) {\r\n      if (innerInstrument) return innerInstrument.note(n);\r\n      var innerNote;\r\n\r\n      if (!instrumentPromise) {\r\n        instrumentPromise = f();\r\n      }\r\n\r\n      innerNote = instrumentPromise.then(function(inst) {\r\n        innerInstrument = inst;\r\n        return inst.note(n);\r\n      });\r\n\r\n      var play = function() {\r\n        var playing = innerNote.then(callPlay);\r\n\r\n        var stop = function() {\r\n          return playing.then(callStop);\r\n        };\r\n\r\n        return {stop: stop};\r\n      };\r\n\r\n      return {play: play};\r\n    };\r\n\r\n    return MUSIC.instrumentExtend({\r\n      note: note\r\n    }).stopDelay(10);\r\n  };\r\n\r\n  var createInstrumentFromFile = function() {\r\n    return musicObjectFactory.create($scope.file);\r\n  };\r\n\r\n  var fileChanged = fn.debounce(function(newFile, oldFile) {\r\n    if (!$scope.file) return;\r\n   \r\n    $q.when(null)\r\n      .then(function() {\r\n        return destroyAll();\r\n      })\r\n      .then(function() {\r\n        return lazyLoadInstrument(createInstrumentFromFile);\r\n      })    \r\n      .then(function(obj) {\r\n          if (!obj) {\r\n            $scope.instruments = [];\r\n            $scope.playables = [];\r\n            return;\r\n          }\r\n\r\n          if (obj !== lastObj) {\r\n            $scope.instruments = [];\r\n            $scope.playables = [];\r\n            if (obj.note) {\r\n              // instrument\r\n              $scope.instruments.push(obj);\r\n            } else if (obj.play) {\r\n              $scope.playables.push(obj);\r\n            }\r\n          }\r\n\r\n          if (oldFile) {\r\n            FileRepository.updateFile(id, $scope.file);\r\n            $scope.fileIndex.updated = true;\r\n          }\r\n          lastObj = obj;\r\n      });\r\n  }, 250);\r\n  $scope.$watch('file', fileChanged, true);\r\n\r\n  $scope.indexChanged = function() {\r\n    FileRepository.updateIndex(id, $scope.fileIndex);\r\n  };\r\n\r\n  var reloadFromRepo = function() {\r\n    FileRepository.getFile(id).then(function(file) {\r\n      $timeout(function() {\r\n        var outputFile = {};\r\n\r\n        $scope.outputFile = outputFile;\r\n        $scope.file = file.contents;\r\n        $scope.fileIndex = file.index;\r\n        $scope.observer = {};\r\n\r\n        $scope.observer.notify = function() {\r\n          $timeout(function() {\r\n            $scope.instruments = [];\r\n            $scope.playables = [];\r\n          });\r\n        };\r\n\r\n      });\r\n    });\r\n  };\r\n\r\n  reloadFromRepo();\r\n\r\n  $scope.$on(\"stackChanged\", function() {\r\n    $scope.resetStack = true;\r\n    fileChanged();\r\n  });\r\n\r\n  $scope.$on(\"$destroy\", destroyAll);\r\n\r\n  $scope.startPlay = function(playable) {\r\n    playable.playing = playable.play();\r\n  };\r\n\r\n  $scope.stopPlay = function(playable) {\r\n    if (!playable.playing) return;\r\n    playable.playing.stop();\r\n    playable.playing = undefined;\r\n  };\r\n\r\n}]);\r\n\r\nmusicShowCaseApp.controller(\"MainController\", \r\n  [\"$q\", \"$scope\", \"$timeout\", \"$uibModal\", \"$translate\", \"MusicContext\", \"FileRepository\", \"Recipe\", \"WelcomeMessage\", \"localforage\", \"Export\", \"ErrMessage\",\r\n  function($q, $scope, $timeout, $uibModal, $translate, MusicContext, FileRepository, Recipe, WelcomeMessage, localforage, Export, ErrMessage) {\r\n  var music;\r\n\r\n  $scope.$on(\"switchProject\", function(evt, id) {\r\n    switchProject(id);\r\n  });\r\n\r\n  var concat = function(a, b) {\r\n    return a.concat(b);\r\n  };\r\n\r\n  var switchProject = function(projectId) {\r\n    var pFilter = [projectId];\r\n\r\n    return FileRepository.getFile(projectId).then(function(file) {\r\n      $scope.project = file;\r\n\r\n      return (file.index.ref||[]).concat([projectId]);\r\n    }).then(function(filter) {\r\n      $scope.projectFilter = filter.concat(['core']);\r\n      if (filter.indexOf('default') !== -1) $scope.projectFilter.push(undefined);\r\n    })\r\n    .then(updateSearch)\r\n    .catch(function() {\r\n      document.location = \"#\";\r\n    });\r\n  };\r\n\r\n  var updateSearch = fn.debounce(function() {\r\n    if (currentObserver) currentObserver.close();\r\n    currentObserver = FileRepository.search(null, {\r\n      project: $scope.projectFilter, type: ['instrument', 'pattern', 'song', 'fx']\r\n    }).observe(function(files) {\r\n      $timeout(function() {\r\n        $scope.filesTotal = files.total;\r\n        $scope.files = files.results;\r\n      }); \r\n    });\r\n  },100);\r\n\r\n  var currentObserver;\r\n  $scope.fileInputClick = function() {\r\n    $timeout(function() {\r\n      $(\".choose-file-import-container input[type=file]\").click();\r\n    });\r\n  };\r\n\r\n  $scope.fileImport = function(files) {\r\n    var readTextFile = function(file) {\r\n      return $q(function(resolve, reject) {\r\n        var fileReader = new FileReader();\r\n        fileReader.onload = function(e) {\r\n          resolve(e.target.result);\r\n        };\r\n\r\n        fileReader.onerror = function(err) {\r\n          reject(err);\r\n        };\r\n\r\n        fileReader.readAsText(file);\r\n      });\r\n    };\r\n\r\n    var nextLocation;\r\n    var importFile = function(file) {\r\n      return function(options) {\r\n        return readTextFile(file)\r\n          .then(function(json) {\r\n            return Export.importFile(json)\r\n              .then(function(file) {\r\n                if (options && options.first) {\r\n                  if (file.type === 'project') {\r\n                    nextLocation = \"#/editor/\"+ file.id;\r\n                  } else {\r\n                    nextLocation = \"#/editor/\"+ file.project + \"/\"+ file.type + \"/\" +file.id;\r\n                  }\r\n                }\r\n              });\r\n          });\r\n      };\r\n    };\r\n\r\n    var p = null;\r\n    for (var i=0; i<files.length; i++) {\r\n      if (p) {\r\n        p = p.then(importFile(files[i]));\r\n      } else {\r\n        p = importFile(files[i])({first: true});\r\n      }\r\n    }\r\n\r\n    if (p) {\r\n      p.then(function(index) {\r\n        if (nextLocation) document.location = nextLocation;\r\n      }).catch(function(err) {\r\n        var modalIns = $uibModal.open({\r\n          templateUrl: \"site/templates/modal/error.html\",\r\n          controller: \"errorModalCtrl\",\r\n          windowClass: 'error',\r\n          resolve: {\r\n            text: function() {\r\n              return $translate('common.loader_error');\r\n            },\r\n            title: function() {\r\n              return $translate('common.error_title');\r\n            }\r\n          }\r\n        });\r\n      });\r\n    }\r\n  };\r\n\r\n  $scope.changeLanguage = function (langKey) {\r\n    localforage.setItem('lang', langKey);\r\n    $translate.use(langKey);\r\n  };\r\n\r\n  localforage.getItem(\"lang\")\r\n    .then(function(currentLanguage) {\r\n      if (currentLanguage) $scope.changeLanguage(currentLanguage);\r\n\r\n      $timeout(function() {\r\n        $scope.langLoaded = true;\r\n      });\r\n    });\r\n\r\n  $scope.welcome = function() {\r\n    // show welcome modal\r\n    var modalIns = $uibModal.open({\r\n      templateUrl: \"site/templates/modal/welcome.html\",\r\n      controller: \"welcomeModalCtrl\",\r\n      resolve: {\r\n        dontshowagain: [\"WelcomeMessage\", function(WelcomeMessage) {\r\n          return WelcomeMessage.skip();\r\n        }]\r\n      }\r\n    });\r\n  };\r\n     \r\n  $scope.openRecycleBin = function() {\r\n    // show recycle bin modal\r\n    var modalIns = $uibModal.open({\r\n      templateUrl: \"site/templates/modal/recycleBin.html\",\r\n      controller: \"recycleBinModalCtrl\"\r\n    });\r\n  };\r\n\r\n\r\n  WelcomeMessage.skip()\r\n    .then(function(skip) {\r\n      if (!skip) $scope.welcome();\r\n    });\r\n\r\n  $scope.recipe = Recipe.start;\r\n\r\n  $scope.activate = function(example) {\r\n    if (example.type === \"instrument\"||example.type === \"song\"||example.type === \"pattern\") {\r\n      document.location = \"#/editor/\" + $scope.project.index.id + \"/\" +example.type+\"/\"+example.id;\r\n    }\r\n    if (example.type === \"project\") {\r\n      document.location = \"#/editor/\" + example.id;\r\n    }\r\n  };\r\n\r\n  $scope.keywordUpdated = fn.debounce(function() {\r\n    if (currentObserver) currentObserver.close();\r\n    currentObserver = FileRepository.search($scope.searchKeyword, {\r\n      project: $scope.projectFilter, type: ['instrument', 'pattern', 'song', 'fx', 'tempo']\r\n    }).observe(function(files) {\r\n      $scope.filesTotal = files.total;\r\n      $scope.files = files.results;\r\n    });\r\n  },200);\r\n\r\n  $scope.removeProject = function() {\r\n    FileRepository.moveToRecycleBin($scope.project.index.id)\r\n      .then(function() {\r\n        document.location = \"#\";\r\n      })\r\n      .catch(function(err) {\r\n        if (err.type && err.type === 'cantremove') {\r\n          ErrMessage('common.error_title', 'common.cantremove_project_error');\r\n        } else {\r\n          throw err;\r\n        }\r\n      });\r\n  };\r\n\r\n  $scope.exportProject = function() {\r\n    Export.exportProject($scope.project.index.name, $scope.project.index.id);\r\n  };\r\n\r\n  $scope.projectSettings = function() {\r\n    $uibModal.open({\r\n      templateUrl: \"site/templates/modal/projectSettings.html\",\r\n      controller: \"projectSettingsModalCtrl\",\r\n      resolve: {\r\n        project: {\r\n          name: $scope.project.index.name,\r\n          ref: $scope.project.index.ref\r\n        },\r\n        buttonText: function() { return 'common.ok'; }\r\n      }\r\n    }).result.then(function(project) {\r\n      $scope.project.index.name = project.name;\r\n      FileRepository.updateIndex($scope.project.index.id, {\r\n        type: 'project', \r\n        name: project.name,\r\n        ref: project.ref\r\n      })\r\n      .then(function() {\r\n        switchProject($scope.project.index.id);\r\n      });\r\n    });\r\n  };\r\n\r\n  $scope.newProject = function() {\r\n    // open \"project settings\" modal\r\n    $translate('project.new').then(function(projectName) {\r\n      $uibModal.open({\r\n        templateUrl: \"site/templates/modal/projectSettings.html\",\r\n        controller: \"projectSettingsModalCtrl\",\r\n        resolve: {\r\n          project: {name: projectName},\r\n          buttonText: function() { return 'common.create'; }\r\n        }\r\n      }).result.then(function(project) {\r\n        FileRepository.createFile({type: 'project', name: project.name, ref: project.ref})\r\n          .then(function(id) {\r\n            document.location=\"#/editor/\" + id;\r\n          });\r\n      });\r\n    });\r\n  };\r\n\r\n  $scope.openProject = function() {\r\n    $uibModal.open({\r\n      templateUrl: \"site/templates/modal/openProject.html\",\r\n      controller: \"openProjectModalCtrl\"\r\n    }).result.then(function(id) {\r\n      var moreImportant = function(file1, file2) {\r\n        if (file1.type !== file2.type) {\r\n          if (file1.type==='song') return file1;\r\n          if (file2.type==='song') return file2;\r\n\r\n          if (file1.type==='pattern') return file1;\r\n          if (file2.type==='pattern') return file2;\r\n        } else {\r\n          return (file1.ref||[]).length > (file2.ref||[]).length ? file1 : file2;\r\n        }\r\n\r\n        return file2;\r\n      };\r\n\r\n      // switch to main object\r\n      return FileRepository.getProjectFiles(id)\r\n        .then(function(files) {\r\n          if (files.length > 0) {\r\n            var better = files.reduce(moreImportant, files[0]);\r\n            if (better && better.type !== 'project') {\r\n              document.location = \"#/editor/\" + id + \"/\" + better.type+\"/\"+better.id;\r\n            } else {\r\n              document.location = \"#/editor/\" + id;\r\n            }\r\n          } else {\r\n            document.location = \"#/editor/\" + id;\r\n          }\r\n        });\r\n    });\r\n  };\r\n\r\n  $scope.newInstrument = function() {\r\n    $translate(\"common.new_instrument\")\r\n      .then(function(name) {\r\n        return FileRepository.createFile({\r\n          type: \"instrument\",\r\n          name: name,\r\n          project: $scope.project.index.id\r\n        });\r\n      })\r\n      .then(function(id) {\r\n        document.location = \"#/editor/\" + $scope.project.index.id + \"/instrument/\" + id;\r\n      })\r\n      .catch(function(err) {\r\n        debugger;\r\n      });\r\n  };\r\n\r\n  $scope.newSong = function() {\r\n    $translate(\"common.new_song\")\r\n      .then(function(name) {\r\n        return FileRepository.createFile({\r\n          type: \"song\", \r\n          name: name,\r\n          project: $scope.project.index.id\r\n        });\r\n      })\r\n      .then(function(id) {\r\n        document.location = \"#/editor/\" + $scope.project.index.id + \"/song/\"+id;\r\n      });\r\n  };\r\n\r\n  $scope.newPattern = function() {\r\n    $translate(\"common.new_pattern\")\r\n      .then(function(name) {\r\n        return FileRepository.createFile({\r\n          type: \"pattern\",\r\n          name: name,\r\n          project: $scope.project.index.id\r\n        });\r\n      })\r\n      .then(function(id) {\r\n        document.location = \"#/editor/\" + $scope.project.index.id + \"/pattern/\"+id;\r\n      });\r\n  };\r\n\r\n\r\n  $scope.about = function() {\r\n    $uibModal.open({\r\n      templateUrl: \"site/templates/modal/about.html\",\r\n      controller: \"infoModalCtrl\"\r\n    });\r\n  };\r\n\r\n  $scope.help = function() {\r\n    $uibModal.open({\r\n      templateUrl: \"site/templates/modal/help.html\",\r\n      controller: \"infoModalCtrl\"\r\n    });\r\n  };\r\n\r\n  $scope.todo = function() {\r\n    $uibModal.open({\r\n      templateUrl: \"todoModal.html\",\r\n      controller: \"todoModalCtrl\"\r\n    });\r\n  };\r\n}]);\r\n\r\nmusicShowCaseApp.controller(\"todoModalCtrl\", [\"$scope\", \"$uibModalInstance\", function($scope, $uibModalInstance) {\r\n  $scope.dismiss = function() {\r\n    $uibModalInstance.dismiss();\r\n  };\r\n}]);\r\n\r\n","var musicShowCaseApp = angular.module(\"MusicShowCaseApp\");\r\nmusicShowCaseApp.controller(\"errorModalCtrl\", [\"$scope\", \"$uibModalInstance\", \"text\", \"title\", function($scope, $uibModalInstance, text, title) {\r\n  $scope.text = text;\r\n  $scope.title = title;\r\n  $scope.dismiss = function() {\r\n    $uibModalInstance.dismiss();\r\n  };\r\n}]);\r\n\r\n","var musicShowCaseApp = angular.module(\"MusicShowCaseApp\");\r\nmusicShowCaseApp.controller(\"infoModalCtrl\", [\"$scope\", \"$uibModalInstance\", function($scope, $uibModalInstance) {\r\n  $scope.dismiss = function() {\r\n    $uibModalInstance.dismiss();\r\n  };\r\n}]);\r\n","var musicShowCaseApp = angular.module(\"MusicShowCaseApp\");\r\nmusicShowCaseApp.controller(\"midiSettingsModalCtrl\", [\"$scope\", \"$q\", \"$timeout\", \"$uibModalInstance\", \"Midi\", function($scope, $q, $timeout, $uibModalInstance, Midi) {\r\n  Midi.getInputs().then(function(inputs) {\r\n    $scope.inputs = inputs;\r\n  });\r\n\r\n  Midi.getConfig().then(function(config) {\r\n    $scope.config = config;\r\n  });\r\n\r\n  $scope.updateConfig = function() {\r\n    Midi.setConfig($scope.config);\r\n  };\r\n\r\n  $scope.done = function() {\r\n    $uibModalInstance.close();\r\n  };\r\n}]);\r\n","var musicShowCaseApp = angular.module(\"MusicShowCaseApp\");\r\nmusicShowCaseApp.controller(\"openProjectModalCtrl\", [\"$q\", \"$scope\", \"$uibModalInstance\", 'FileRepository', function($q, $scope, $uibModalInstance, FileRepository) {\r\n  var currentObserver;\r\n  var immediateUpdateSearch = function() {\r\n    if (currentObserver) currentObserver.close();\r\n    currentObserver = FileRepository.search($scope.searchKeyword, {type: ['project']})\r\n      .observe(function(files) {\r\n        $scope.filesTotal = files.total;\r\n        $scope.files = files.results;\r\n      });\r\n  };\r\n\r\n  $scope.updateSearch = fn.debounce(immediateUpdateSearch,250);\r\n  $scope.cancel = function() {\r\n    $uibModalInstance.dismiss();\r\n  };\r\n\r\n  $scope.select = function(projectId) {\r\n    $scope.selected = projectId;\r\n  };\r\n\r\n  $scope.open = function(projectId) {\r\n    $uibModalInstance.close(projectId);\r\n  };\r\n\r\n  immediateUpdateSearch();\r\n}]);\r\n","var musicShowCaseApp = angular.module(\"MusicShowCaseApp\");\r\nmusicShowCaseApp.controller(\"projectSettingsModalCtrl\", [\"$q\", \"$scope\", \"$uibModalInstance\", \"FileRepository\", \"project\", \"buttonText\", function($q, $scope, $uibModalInstance, FileRepository, project, buttonText) {\r\n  var currentObserver;\r\n  var immediateUpdateSearch = function() {\r\n    if (currentObserver) currentObserver.close();\r\n    currentObserver = FileRepository.search($scope.searchKeyword, {type: ['project']})\r\n      .observe(function(files) {\r\n        $scope.filesTotal = files.total;\r\n        $scope.files = files.results;\r\n      });\r\n  };\r\n\r\n  $scope.project = project;\r\n  $scope.buttonText = buttonText;\r\n\r\n  var getIndex = function(id) {\r\n    return FileRepository.getFile(id)\r\n      .then(function(file) {\r\n        return file.index;\r\n      });\r\n  };\r\n\r\n  $scope.refs = [];\r\n  $q.all(($scope.project.ref||[]).map(getIndex))\r\n    .then(function(refs) {\r\n      $scope.refs = refs\r\n    });\r\n\r\n  $scope.updateSearch = fn.debounce(immediateUpdateSearch,250);\r\n  $scope.cancel = function() {\r\n    $uibModalInstance.dismiss();\r\n  };\r\n\r\n  $scope.done = function() {\r\n    $scope.project.ref = $scope.refs.map(getId);\r\n    $uibModalInstance.close($scope.project);\r\n  };\r\n\r\n  var getId = function(x) { return x.id; };\r\n  $scope.remove = function(file) {\r\n    $scope.refs = $scope.refs.filter(function(f) {\r\n      return f.id !== file.id;\r\n    });\r\n  };\r\n\r\n  $scope.add = function(file) {\r\n    if ($scope.refs.map(getId).indexOf(file.id) === -1) {\r\n      $scope.refs.push(file);\r\n    }\r\n  };\r\n\r\n  immediateUpdateSearch();\r\n}]);\r\n","var musicShowCaseApp = angular.module(\"MusicShowCaseApp\");\r\nmusicShowCaseApp.controller(\"recycleBinModalCtrl\", [\"$scope\", \"$timeout\", \"$uibModalInstance\", \"FileRepository\", function($scope, $timeout, $uibModalInstance, FileRepository) {\r\n  $scope.dismiss = function() {\r\n    $uibModalInstance.dismiss();\r\n  };\r\n\r\n  var immediateUpdateSearch = function() {\r\n    FileRepository.searchRecycled($scope.searchKeyword, {limit: 10})\r\n      .then(function(results) {\r\n        $timeout(function() {\r\n          $scope.files = results.results;\r\n          $scope.filesTotal = results.total;\r\n        });\r\n      })\r\n  };\r\n\r\n  $scope.updateSearch = fn.debounce(immediateUpdateSearch,250);\r\n\r\n  $scope.restoreFromRecycleBin = function(file) {\r\n    FileRepository.restoreFromRecycleBin(file.id).then(immediateUpdateSearch);\r\n  };\r\n\r\n  immediateUpdateSearch();\r\n}]);\r\n\r\n","var musicShowCaseApp = angular.module(\"MusicShowCaseApp\");\r\nmusicShowCaseApp.controller(\"welcomeModalCtrl\", [\"$q\", \"$scope\", \"$uibModalInstance\", \"Recipe\", \"WelcomeMessage\", \"dontshowagain\", function($q, $scope, $uibModalInstance, Recipe, WelcomeMessage, dontshowagain) {\r\n  $scope.dontshowagain = dontshowagain;\r\n\r\n  var skipUpdated = $q.when(null);\r\n  $scope.updateSkip = function() {\r\n    skipUpdated = WelcomeMessage.setSkip($scope.dontshowagain);\r\n  };\r\n\r\n  $scope.dismiss = function() {\r\n    skipUpdated\r\n      .then(function() {\r\n        $uibModalInstance.dismiss();\r\n      });\r\n\r\n  };\r\n\r\n  $scope.tutorial = function() {\r\n    skipUpdated\r\n      .then(function() {\r\n        $uibModalInstance.dismiss();\r\n        Recipe.start('intro');\r\n      });\r\n  };\r\n}]);\r\n"],"sourceRoot":"site"}