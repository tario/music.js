!function(){var t=function(t){var n=[];this.add=function(t){n.push(t)},this.cast=function(e){for(var i=0;i<n.length;i++){var o=n[i],r=o(e);if(r)return r}throw"Can't convert "+e+" to "+t}};TypeCast=function(){var n={};this.register=function(e,i){var o;n[e]||(n[e]=new t(e)),o=n[e],o.add(i)},this.cast=function(t,e){var i=n[t];if(!i)throw"unkown type "+t;return i.cast(e)}}}(),MUSIC={},function(){MUSIC.SoundLib=MUSIC.SoundLib||{},MUSIC.Effects=MUSIC.Effects||{},MUSIC.Types=new TypeCast;MUSIC.playablePipeExtend=function(t){return t.during=function(t){var n=this;return MUSIC.playablePipeExtend({play:function(){var e=!1,i=n.play(),o={stop:function(){e||i.stop(),e=!0}};return setTimeout(o.stop,t),o},duration:function(){return t}})},t.stopDelay=function(t){var n=this;return MUSIC.playablePipeExtend({play:function(e){var i=n.play(e);return{stop:function(){setTimeout(i.stop.bind(i),t)}}}})},t.onStop=function(t){var n=this;return MUSIC.playablePipeExtend({play:function(e){var i=n.play(e);return{stop:function(){i.stop(),t(e)}}}})},t},MUSIC.Types.register("playable",function(t){return t.play?t:void 0}),MUSIC.Types.register("playable",function(t){return"function"==typeof t?{play:t}:void 0}),MUSIC.EffectsPipeline=function(t,n){this._audio=t,this._audioDestination=n};var t=function(t){return t},n=function(t,n){return function(e){return n(t(e))}};MUSIC.EffectsPipeline.prototype={_wrapFcn:t,wrap:function(e){var i=new MUSIC.DummyNode(this);return this._wrapFcn!==t&&(e=n(e,this._wrapFcn)),i._wrapFcn=function(t){var n=e(t);return n._wrapFcn=i._wrapFcn,n},i},sfxBase:function(){var t=[],n=function(t){t.dispose()},e=function(n){if(!n.dispose)return n;var e=function(t){return t!=n},i=n.dispose;return t.push(n),n.dispose=function(){t=t.filter(e),i.call(n)},n},i=function(){t.forEach(n)},o=this.wrap(e);return o.prune=i,o},oscillator:function(t){return this._wrapFcn(new MUSIC.SoundLib.Oscillator(this._audio,this._audioDestination,t))},soundfont:function(t){return this._wrapFcn(new MUSIC.SoundfontInstrument(t,this._audio,this._audioDestination))},sound:function(t){var n=this._audio,e=this._audioDestination,i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer";var o;return i.onerror=function(t){console.error(t)},i.onload=function(t){n.audio.decodeAudioData(i.response,function(t){o=t})},i.send(),MUSIC.playablePipeExtend({play:function(){var t=n.audio.createBufferSource();return t.buffer=o,t.connect(e._destination),t.start(n.audio.currentTime),{stop:function(){t.stop(),t.disconnect(e._destination)}}}})},formulaGenerator:function(t){return this._wrapFcn(new MUSIC.SoundLib.FormulaGenerator(this._audio,this._audioDestination,t))},T:function(){return this._wrapFcn(new MUSIC.T(arguments,this._audio,this._audioDestination))},noise:function(){return this._wrapFcn(new MUSIC.SoundLib.Noise(this._audio,this._audioDestination))}},MUSIC.DummyNode=function(t){MUSIC.EffectsPipeline.apply(this,[t._audio,t._audioDestination])},MUSIC.DummyNode.prototype=Object.create(MUSIC.EffectsPipeline.prototype),MUSIC.T=function(t,n,e){var i=T("WebAudioAPI:recv",n.audio),o=i.context,r=o.createGain(1);i.recv(r),setTimeout(function(){r.connect(e._destination)});for(var u=[],a=0;a<t.length;a++)u.push(t[a]);u.push(i);var c=T.apply(null,u);T("WebAudioAPI:send",c,n.audio).send(e._destination);this.output=function(){return r};var s=!1;this.disconnect=function(){s||(s=!0,r.disconnect(e._destination),i.cancel())},this.dispose=this.disconnect,this._destination=r,this.next=function(){return e},MUSIC.EffectsPipeline.bind(this)(n,this)},MUSIC.T.prototype=Object.create(MUSIC.EffectsPipeline.prototype),MUSIC.Effects.register=function(t,n){MUSIC.EffectsPipeline.prototype[t]=function(t){return this._wrapFcn(n(this._audio,this._audioDestination,t))}};var e=new(window.AudioContext||window.webkitAudioContext);MUSIC.Context=function(t){var n=e,i=this,o=n.createGain();t=t||{},o.gain.value=1,t.nooutput||o.connect(n.destination),this._destination=o,this.audio=n,this.record=function(){var t=new Recorder(o,{workerPath:"lib/recorder/recorderWorker.js"});return t.record(),t},this.audio=n,MUSIC.EffectsPipeline.bind(this)(i,this)},MUSIC.Context.prototype=new MUSIC.EffectsPipeline,MUSIC.SoundLib.FormulaGenerator=function(t,n,e){this.play=function(i){var o=new MUSIC.Effects.Formula(t,n,function(t,n){return e(n)});return{stop:function(){o.disconnect(n._destination)}}},MUSIC.playablePipeExtend(this)},MUSIC.SoundLib.Noise=function(t,n){this.play=function(e){var i=new MUSIC.Effects.Formula(t,n,function(){return Math.random()});return{stop:function(){i.disconnect(n._destination)}}},MUSIC.playablePipeExtend(this)},MUSIC.SoundLib.Wave=function(t,n){var e=new MUSIC.Context({nooutput:!0}),i=e.sound(t),o=Math.floor(n*e.audio.sampleRate/1e3),r=[];setTimeout(function(){var t=e.record();i.play(),setTimeout(function(){t.stop(),t.getBuffer(function(t){for(var n=t[0],e=0;o>e;e++)r.push(n[e])})},n+100)},500),this.f=function(t){if(0>t)return 0;var n=r[Math.floor(t*o)];return n}},MUSIC.SoundLib.Oscillator=function(t,n,e){e=e||{};var i=(e.effects,e.frequency);if(this.freq=function(i){var o={type:e.type,wave:e.wave,f:e.f,frequency:i};return new MUSIC.SoundLib.Oscillator(t,n,o)},e.f)this.play=function(i){var o,r=e.wtPosition||0,u=e.f,a=0,c=e.frequency;o=c.at?c.at.bind(c):function(t){return c};var s,f=0,p=0;if(r.at)var l=new MUSIC.Effects.Formula(t,n,function(t,n){return f=n-p,a+=f*o(n),a%=1,s=a+r.at(n),s%=1,0>s&&s++,p=n,u(s)});else var l=new MUSIC.Effects.Formula(t,n,function(t,n){return f=n-p,a+=f*o(n),a%=1,s=a+r,s%=1,0>s&&s++,p=n,u(s)});return{stop:function(){l.disconnect(n._destination)}}};else if(e.wave){var o=Object.create(e);o.f=e.wave.f,MUSIC.SoundLib.Oscillator.bind(this)(t,n,o)}else this.play=function(o){var r,u,a,c;return r=t.audio.createOscillator(),i.apply?i.apply(t.audio.currentTime,r.frequency):r.frequency.value=i,r.type=e.type,u=n,c=u._destination,a=function(){r.disconnect(c)},r.connect(c),r.start(0),{stop:function(){r.stop(0),a()}}};MUSIC.playablePipeExtend(this)},MUSIC.Loop=function(t,n){var e=t.duration();return{play:function(){var i,o=window.performance.now(),r=0;i=t.play();var u=function(){var u=window.performance.now();u-o>r*e&&(setTimeout(function(){i=t.play()},(r+1)*e-u),r++,r==n-1&&clearInterval(a))},a=setInterval(u,e);return{stop:function(){clearInterval(a),i&&i.stop()}}}}},MUSIC.Silence=function(t){return{play:function(){return{stop:function(){}}},duration:function(){return t}}}}(),MUSIC.Effects=MUSIC.Effects||{};var effectsObject={};MUSIC.Effects.forEach=function(t){for(var n in effectsObject)t(n,effectsObject[n])},MUSIC.Effects.WebAudioNodeWrapper=function(t,n,e){this._destination=n,setTimeout(function(){n.connect(e._destination)}),this.next=function(){return e};var i=!1;this.disconnect=function(){i||(i=!0,n.disconnect(e._destination))},this.dispose=this.disconnect,this.output=function(){return n},this.setParam=function(e,i){i.apply(t.audio.currentTime,n[e])},this.record=function(){var t=new Recorder(n,{workerPath:"lib/recorder/recorderWorker.js"});return t.record(),t},MUSIC.EffectsPipeline.bind(this)(t,this)},MUSIC.Effects.WebAudioNodeWrapper.prototype=Object.create(MUSIC.EffectsPipeline.prototype),MUSIC.Effects.Formula=function(t,n,e){var i=t.audio.createScriptProcessor(1024,1,1),o=0,r=t.audio.sampleRate;i.onaudioprocess=function(t){for(var n=t.inputBuffer,i=t.outputBuffer,u=0;u<i.numberOfChannels;u++)for(var a=n.getChannelData(u),c=i.getChannelData(u),s=0;s<n.length;s++)c[s]=e(a[s],(n.length*o+s)/r);o++},setTimeout(function(){i.connect(n._destination)}),this._destination=i,MUSIC.EffectsPipeline.bind(this)(t,this),this.next=function(){return n};var u=!1;this.disconnect=function(){u||(u=!0,i.disconnect(n._destination))},this.dispose=this.disconnect,this.update=function(t){e=t},this.output=function(){return i}},MUSIC.Effects.Formula.prototype=Object.create(MUSIC.EffectsPipeline.prototype),MUSIC.Effects.register("formula",function(t,n,e){return new MUSIC.Effects.Formula(t,n,e)}),MUSIC.Effects.BiQuad=function(t,n,e){var i=t.audio.createBiquadFilter();this.update=function(n){i.type=n.type,n.frequency.apply?n.frequency.apply(t.audio.currentTime,i.frequency):i.frequency.value=n.frequency,n.Q&&(i.Q.value=n.Q),n.gain&&(i.gain.value=n.gain)},this.update(e),MUSIC.Effects.WebAudioNodeWrapper.bind(this)(t,i,n)},MUSIC.Effects.BiQuad.prototype=Object.create(MUSIC.Effects.WebAudioNodeWrapper.prototype),MUSIC.Effects.register("biquad",MUSIC.Effects.BiQuad),["lowpass","highpass","bandpass","lowshelf","highshelf","peaking","notch","allpass"].forEach(function(t){MUSIC.Effects.register(t,function(n,e,i){return new MUSIC.Effects.BiQuad(n,e,{type:t,frequency:i.frequency})})});var canMutate=function(t,n){return t.update=function(e){return n(e),t},t};MUSIC.Effects.register("gain",function(t,n,e){var i=t.audio.createGain();return canMutate(new MUSIC.Effects.WebAudioNodeWrapper(t,i,n),function(t){i.gain.value=t}).update(e)}),MUSIC.Effects.register("delay",function(t,n,e){var i=t.audio.createDelay(60);return canMutate(new MUSIC.Effects.WebAudioNodeWrapper(t,i,n),function(t){i.delayTime.value=t}).update(e)});var Echo=function(t,n,e){this.update=function(t){i.delayTime.value=t.delay||.02,u.gain.value=t.gain||.2,i.delayTime.value<.01&&(i.delayTime.value=.01),i.delayTime.value>1&&(i.delayTime.value=1),u.gain.value>.99&&(u.gain.value=.99),u.gain.value<0&&(u.gain.value=0)};var i=t.audio.createDelay(60),o=t.audio.createGain(),r=t.audio.createGain();o.gain.value=1,r.gain.value=1;var u=t.audio.createGain();this.update(e),setTimeout(function(){o.connect(r),o.connect(i),i.connect(r),r.connect(n._destination),r.connect(u),u.connect(i)}),this._destination=o,this.next=function(){return n};var a=!1;this.disconnect=function(){a||(a=!0,o.disconnect(r),o.disconnect(i),i.disconnect(r),r.disconnect(n._destination),r.disconnect(u),u.disconnect(i))},this.dispose=this.disconnect,this.output=function(){return audioNode},this.setParam=function(n,e){e.apply(t.audio.currentTime,audioNode[n])},MUSIC.EffectsPipeline.bind(this)(t,this)};Echo.prototype=Object.create(MUSIC.EffectsPipeline.prototype),MUSIC.Effects.register("echo",function(t,n,e){return new Echo(t,n,e)}),MUSIC.Curve=function(t){this.during=during(t)},MUSIC.Curve.concat=function(t,n,e,i,o){var r=n+i;o||(o=Math.floor(100*r)+1);for(var u=function(i){return n>i?t.at(i):e.at(i-n)},a=new Float32Array(o+1),c=0;o+1>c;c++)a[c]=u(r*(c/o));return{apply:function(t,n){n.setValueCurveAtTime(a,t,r)},at:u}};var during=function(t,n){return function(e){n||(n=Math.floor(100*e)+1);for(var i=new Float32Array(n+1),o=0;n+1>o;o++)i[o]=t(o/n);return{apply:function(t,n){n.setValueCurveAtTime(i,t,e)},at:function(n){return t(n/e)}}}};MUSIC.Curve.Formula=function(t,n){this.during=during(t,n)},MUSIC.Curve.Ramp=function(t,n,e){MUSIC.Curve.Formula.bind(this)(function(e){return t+(n-t)*e},e)},MUSIC.Curve.Periodic=function(t,n){var e,i=0,o=0,r=1/n;n.at?this.at=function(r){return e=r-o,i+=e*n.at(r),i%=1,o=r,t(i)}:this.at=function(n){return i=n%r/r,0>i&&i++,t(i)}},MUSIC.Effects.register("ADSR",function(t,n,e){e=e||{};var i=e.samples||100,o=e.attackTime,r=e.decayTime,u=e.sustainLevel,a=e.releaseTime;void 0===o&&(o=.1),void 0===r&&(r=.1),void 0===u&&(u=.8),void 0===a&&(a=.1);var c=e.node,s=new MUSIC.Curve.Ramp(0,1,i).during(o),f=new MUSIC.Curve.Ramp(1,u,i).during(r),p=MUSIC.Curve.concat(s,o,f,r),l=n.gain(u);return l.setParam("gain",p),c(l).onStop(function(){l.dispose()}).stopDelay(1e3*a).onStop(function(){var t=l._destination.gain.value,n=new MUSIC.Curve.Ramp(t,0,i).during(a);l.setParam("gain",n)})}),MUSIC.Effects.register("stopCurve",function(t,n,e){e=e||{};var i=e.samples||100,o=e.duration||.4,r=e.node,u=new MUSIC.Curve.Ramp(1,0,i).during(o),a=n.gain(1);return r(a).onStop(function(){a.dispose()}).stopDelay(1e3*o).onStop(function(){a.setParam("gain",u)})}),function(){var t=function(t){return 16.35*Math.pow(2,t/12)},n={C:0,D:2,E:4,F:5,G:7,A:9,B:11},e=function(t){var n=function(t,n){return{stop:function(){setTimeout(t.stop.bind(t),n)}}},i=function(t,e){return{play:function(i){var o=t.play(i);return n(o,e)}}};return t.stopDelay=function(n){return e({note:function(e){return i(t.note(e),n)}})},t.perNoteWrap=function(n){return e({note:function(e){return n(t.note(e))}})},t.mapNote=function(n){return e({note:function(e){return t.note(n(e))}})},t};MUSIC.noteToNoteNum=function(t){var e;return e=n[t.charAt(0)],void 0!==e?("#"===t.charAt(1)&&e++,"b"===t.charAt(1)&&e--,""!==t.charAt(2)&&(e+=12*parseInt(t.charAt(2))),e):void 0},MUSIC.Instrument=function(n){this.note=function(e){if(void 0!==e){var i=t(e);return MUSIC.playablePipeExtend({play:function(t){var e=n.freq(i).play(t);return{stop:function(){e.stop()}}}})}},e(this)},MUSIC.instrumentExtend=e,MUSIC.Instrument.frequency=t,MUSIC.MultiInstrument=function(t){var n=function(t){return t.play()},i=function(t){return t.stop()},o=function(t){this.play=function(){var e=t.map(n);return{stop:function(){e.forEach(i)}}}};this.note=function(n){return MUSIC.playablePipeExtend(new o(t.map(function(t){return t.note(n)})))},e(this)};var i=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],o=function(t){var n=i[t%12],e=Math.floor(t/12+1);return n+e};MUSIC.PatchInstrument=function(t){var n,i=[];for(var o in t){var r=MUSIC.Types.cast("playable",t[o]);n=MUSIC.noteToNoteNum(o),i[n]=r}this.note=function(t){var n=i[t];return n?MUSIC.playablePipeExtend({play:n.play}):n},e(this)},MUSIC.SoundfontInstrument=function(t,n,i){function r(t){for(var n=window.atob(t),e=n.length,i=new Uint8Array(e),o=0;e>o;o++){var r=n.charCodeAt(o);i[o]=r}return i.buffer}var u=[];n=n.audio;for(var a=0;72>a;a++)!function(){var e=a,i=(new XMLHttpRequest,o(a)),c=t[i],s=c.split(",")[1];n.decodeAudioData(r(s),function(t){u[e]=t},function(t){console.error("error "+t+" loading "+e)})}();this.note=function(t){n.createBufferSource();return MUSIC.playablePipeExtend({play:function(){var e=n.createBufferSource();return e.buffer=u[t],e.connect(i._destination),e.start(0),{stop:function(){e.stop(0),e.disconnect(i._destination)}}}})},e(this)},MUSIC.Types.register("instrument",function(t){return t.note?t:void 0}),MUSIC.Types.register("instrument",function(t){return t.freq?new MUSIC.Instrument(t):void 0}),MUSIC.Types.register("instrument",function(t){return t.play?{note:function(){return t}}:void 0});var r={play:function(){return{stop:function(){}}}};MUSIC.Types.register("instrument",function(t){return"function"==typeof t?{note:function(n){return t(n)||r}}:void 0}),MUSIC.Types.register("instrument",function(t){return t instanceof Array?new MUSIC.MultiInstrument(t):void 0}),MUSIC.Types.register("instrument",function(t){return"object"==typeof t&&t.constructor===Object?new MUSIC.PatchInstrument(t):void 0}),MUSIC.StopEvent=function(){return function(t){return MUSIC.playablePipeExtend({play:function(){var n={onplay:function(){},onstop:function(){}},e=t.play(n);return n.onplay(),{stop:function(){n.onstop(),e.stop()}}}})}}}(),MUSIC.Effects=MUSIC.Effects||{};var LemonadePlayable=function(t,n,e,i){this._destination=n,this._music=t,this._ops=i,this._output=e};LemonadePlayable.prototype.play=function(){for(var t=this._destination,n=this._ops,e=n.length,i=[],o=[],r=0;e>r;r++)i[r]=0,o[r]=0,n[r].wave=MUSIC.Types.cast("function",n[r].wave);var u=0,a=this._output,c=new MUSIC.Effects.Formula(this._music,t,function(t,r){for(var c=r-u,s=0;e>s;s++){u=r,o[s]=o[s]+c*n[s].frequency.apply(null,i);var f=o[s]%1;0>f&&f++,i[s]=n[s].wave(f)}return a.apply(null,i)});return{stop:function(){c.disconnect(t._destination)}}},MUSIC.playablePipeExtend(LemonadePlayable.prototype),MUSIC.Effects.register("lemonade",function(t,n,e){return new LemonadePlayable(t,n._audioDestination,e.output,e.ops)}),function(){MUSIC.NoteSequence=function(t){var n;t||(n=MUSIC.Utils.Clock(window.performance.now.bind(window.performance),setInterval,clearInterval,500),t=MUSIC.Utils.FunctionSeq(n,setTimeout,clearTimeout)),this._funseq=t,this._totalduration=0,this._noteid=0},MUSIC.NoteSequence.Playable=function(t,n,e){this._noteseq=t,this._context=n,this._duration=e},MUSIC.NoteSequence.Playable.prototype.loop=function(t){return MUSIC.Loop(this,t)},MUSIC.NoteSequence.Playable.prototype.duration=function(){return this._duration},MUSIC.NoteSequence.Playable.prototype.play=function(){return this._runningFunSeq=this._noteseq._funseq.start(this._context),new MUSIC.NoteSequence.Playing(this._runningFunSeq,this._context)},MUSIC.NoteSequence.Playing=function(t,n){this._runningFunSeq=t,this._context=n},MUSIC.NoteSequence.Playing.prototype.stop=function(){this._context.playing&&this._context.playing.stop(),this._runningFunSeq.stop(),this._context.stop()},MUSIC.NoteSequence.prototype.push=function(t){var n=t[0],e=t[1],i=t[2];this._noteid++;var o=this._noteid;this._funseq.push({t:e,f:function(t){var e;e=t.instrument.note(n),t.setPlaying(o,e)}}),this._funseq.push({t:e+i,f:function(t){t.unsetPlaying(o)}}),e+i>this._totalduration&&(this._totalduration=e+i)},MUSIC.NoteSequence.prototype.makePlayable=function(t){return new MUSIC.NoteSequence.Playable(this,MUSIC.NoteSequence.context(t),this._totalduration)},MUSIC.NoteSequence.context=function(t){var n=[],e=function(t,e){n[t]=e.play()},i=function(t){var e=n[t];e&&(e.stop(),n[t]=void 0)},o=function(){for(var t=0;t<n.length;t++)n[t]&&n[t].stop()};return{setPlaying:e,unsetPlaying:i,instrument:t,stop:o}}}(),function(){var t=function(t){return t.play()},n=function(t){t.stop()};MUSIC.MultiPlayable=function(t){this._playableArray=t,MUSIC.playablePipeExtend(this)},MUSIC.MultiPlayable.prototype.play=function(){var e=this._playableArray.map(t);return{stop:function(){e.forEach(n)}}};var e=function(t,n){return t>n?t:n},i=function(t){return t.duration()};MUSIC.MultiPlayable.prototype.duration=function(){return this._playableArray.map(i).reduce(e,0)},MUSIC.ChangeTimeWrapper=function(t,n){this._noteseq=t,this._extensionTime=n},MUSIC.ChangeTimeWrapper.prototype.push=function(t){this._noteseq.push([t[0],t[1]*this._extensionTime,t[2]*this._extensionTime])},MUSIC.Pattern=function(t,n){var e=[];return n=n||{},n.pulseTime=n.pulseTime||50,e=t.map(function(t){var e=t[0],i=MUSIC.Types.cast("instrument",t[1]),o=new MUSIC.NoteSequence;return MUSIC.SequenceParser.parse(e,new MUSIC.ChangeTimeWrapper(o,n.pulseTime)),o.makePlayable(i)}),new MUSIC.MultiPlayable(e)}}(),function(){MUSIC.SequenceParser={};var t={Cb:-1,C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,"E#":5,Fb:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11,"B#":12},n=function(t){return-1!=="CDEFGAB".indexOf(t)},e=function(t){for(var e=[],i="",o=0;o<t.length;o++)n(t[o])&&(""!==i&&e.push(i),i=""),(" "===t[o]||"."===t[o])&&(""!==i&&e.push(i),i=""),i+=t[o];return""!==i&&e.push(i),e},i=new RegExp("\\|","g");MUSIC.SequenceParser.parse=function(n,o){var r;if(""!==n){n=n.replace(i,"");for(var u=e(n),a=0,c=0;c<u.length;c++){var s=u[c],f=s.length,p=s.indexOf("=");-1!=p&&(s=s.slice(0,p));var l=s.slice(-1),d=parseInt(l);isNaN(d)?d=0:s=s.slice(0,s.length-1);var r=t[s];void 0!==r&&o.push([r+12*d,a,f]),a+=f}}}}(),function(){var t=function(t){this._context={playing:[]},this._funseqHandler=t.start(this._context)};t.prototype.stop=function(){this._context.playing.forEach(function(t){t.stop()}),this._funseqHandler.stop()};var n=function(t){return function(n){return t[n]}};MUSIC.Song=function(t,e,i){i=i||{};var o,r=i.measure||500;if(!o){var u=MUSIC.Utils.Clock(window.performance.now.bind(window.performance),setInterval,clearInterval,500);o=MUSIC.Utils.FunctionSeq(u,setTimeout,clearTimeout)}var a=t[0].length,c=n(e);this._funseq=o,this._duration=a*r;for(var s=0;a>s;s++)!function(){for(var n=[],e=0;e<t.length;e++)n.push(t[e][s]);var i,u=n.map(c),a=new MUSIC.MultiPlayable(u);o.push({t:s*r,f:function(t){i=a.play(),t.playing.push(i)}}),o.push({t:(s+1)*r,f:function(t){i.stop(),t.playing=t.playing.filter(function(t){return t!=i})}})}()},MUSIC.Song.prototype.duration=function(){return this._duration},MUSIC.Song.prototype.play=function(){return new t(this._funseq)}}(),function(){MUSIC.Utils=MUSIC.Utils||{},MUSIC.Utils.Scale=function(t){var n,e;n={},e=[0,2,5,7,9];for(var i=0;i<e.length;i++)n[(t+e[i])%12]=!0;return{add:function(t,e){for(var i=t;e>0;)i+=n[i%12]?2:1,e--;return i}}},MUSIC.Utils.Clock=function(t,n,e,i){var o=function(o){var r=t();o(0);var u=n(function(){var n=t();o(n-r)},i);return{stop:function(){e(u)}}};return{start:o}},MUSIC.Utils.FunctionSeq=function(t,n,e){var i=[],o=function(t){return function(n){return t!=n}},r=function(r){var u=i.slice(0),a=[],c=u.length,s=t.start(function(t){for(var e,i=function(n){return n.t-t<1e3&&n.t-t>=0},f=function(e){var i=n(function(){a=a.filter(o(i)),e.f(r),c--,0===c&&s.stop()},e.t-t);a.push(i)};;){if(!(u.length>0))break;if(e=u[0],!i(e))break;f(e),u.shift()}});return{stop:function(){for(var t=0;t<a.length;t++)e(a[t]);s.stop()}}},u=i.push.bind(i);return{start:r,push:u}},MUSIC.Utils.FunctionSeq.preciseTimeout=function(t,n){var e;clock=MUSIC.Utils.Clock(window.performance.now.bind(window.performance),setInterval,clearInterval,500),e=MUSIC.Utils.FunctionSeq(clock,setTimeout,clearTimeout);var i;e.push({f:function(){i&&i.stop(),t()},t:n}),i=e.start()}}(),function(){MUSIC=MUSIC||{},MUSIC.Types.register("function",function(t){return"function"==typeof t.at?t.at.bind(t):void 0}),MUSIC.Types.register("function",function(t){return"function"==typeof t?t:void 0}),MUSIC.Types.register("wave",function(t){return"function"==typeof t?new MUSIC.Wave.FunctionWave(t):void 0}),MUSIC.Types.register("wave",function(t){return"function"==typeof t.at?t:void 0});var t=2*Math.PI;MUSIC.Wave={};var n=function(t){return function(){var n=this;return{at:function(e){n.at(t(e))}}}},e={reverse:n(function(t){return t-1}),scale:function(t){var n=this;return new MUSIC.Wave.FunctionWave(function(e){return n.at(e*t)})},translate:function(t){var n=this;return new MUSIC.Wave.FunctionWave(function(e){return n.at(e+t)})},table:function(t){return new MUSIC.Wave.Table(this,t)},combine:function(t,n){var e=this;n=n||.5;var i=1-n;return t=MUSIC.Types.cast("wave",t),new MUSIC.Wave.FunctionWave(function(o){return t.at(o)*n+e.at(o)*i})}},i=function(t){t.length;return function(n){var e=Math.floor(n*t.length);return t[e]}};MUSIC.Wave.Table=function(t,n){n=n||{};for(var e=n.samples||100,o=n.interpolation||i,r=[],u=0;e>u;u++)r[u]=t.at(u/e);this.at=o(r)},MUSIC.Wave.Table.prototype=e,MUSIC.Wave.FunctionWave=function(t){this.at=t},MUSIC.Wave.FunctionWave.prototype=e,MUSIC.Wave.sine=function(){return new MUSIC.Wave.FunctionWave(function(n){return Math.sin(t*n)})},MUSIC.Wave.square=function(t){t=t||{};var n=t.dutyCycle||.5,e=t.dutyLevel||1,i=t.offLevel||-1;return new MUSIC.Wave.FunctionWave(function(t){return n>t?e:i})},MUSIC.Wave.triangle=function(){return new MUSIC.Wave.FunctionWave(function(t){var n=t-.25;return 0>n&&n++,.5>n?1-4*n:-1+4*(n-.5)})},MUSIC.Wave.sawtooth=function(){return new MUSIC.Wave.FunctionWave(function(t){return 2*t-1})}}();
//# sourceMappingURL=music.min.js.map
