!function(t){var e="recorderWorker.js",n=function(t,n){var i=n||{},r=i.bufferLen||4096;this.context=t.context,this.node=(this.context.createScriptProcessor||this.context.createJavaScriptNode).call(this.context,r,2,2);var s=new Worker(i.workerPath||e);s.postMessage({command:"init",config:{sampleRate:this.context.sampleRate}});var a,o=!1;this.node.onaudioprocess=function(t){o&&s.postMessage({command:"record",buffer:[t.inputBuffer.getChannelData(0),t.inputBuffer.getChannelData(1)]})},this.configure=function(t){for(var e in t)t.hasOwnProperty(e)&&(i[e]=t[e])},this.record=function(){o=!0},this.stop=function(){o=!1},this.clear=function(){s.postMessage({command:"clear"})},this.getBuffer=function(t){a=t||i.callback,s.postMessage({command:"getBuffer"})},this.exportWAV=function(t,e){if(a=t||i.callback,e=e||i.type||"audio/wav",!a)throw new Error("Callback not set");s.postMessage({command:"exportWAV",type:e})},s.onmessage=function(t){var e=t.data;a(e)},t.connect(this.node),this.node.connect(this.context.destination)};n.forceDownload=function(e,n){var i=(t.URL||t.webkitURL).createObjectURL(e),r=t.document.createElement("a");r.href=i,r.download=n||"output.wav";var s=document.createEvent("Event");s.initEvent("click",!0,!0),r.dispatchEvent(s)},t.Recorder=n}(window),!function(t){"use strict";var e=function(){return g.apply(null,arguments)},n=Array.prototype.slice,i=0,r=1,s=2,a=3,o=[8e3,11025,12e3,16e3,22050,24e3,32e3,44100,48e3],u=[32,64,128,256],c="14.10.12",h=null,f={},l={},p="undefined"!=typeof window?"browser":"undefined"!=typeof module&&module.exports?"node":"unknown",d="browser"===p&&/(iPhone|iPad|iPod|Android)/i.test(navigator.userAgent),v=!1,m=120,g=function(){var e,i,r=n.call(arguments),s=r[0];switch(typeof s){case"string":f[s]?e=new f[s](r.slice(1)):l[s]?e=l[s](r.slice(1)):(i=/^(.+?)(?:\.(ar|kr))?$/.exec(s),i&&(s=i[1],f[s]?e=new f[s](r.slice(1)):l[s]&&(e=l[s](r.slice(1))),e&&i[2]&&e[i[2]]()));break;case"number":e=new C(r);break;case"boolean":e=new R(r);break;case"function":e=new D(r);break;case"object":if(null!==s){if(s instanceof M)return s;if(s.context instanceof M)return s.context;w(s)?e=new P(r):_(s)&&(e=new O(r))}}e===t&&(e=new T(r.slice(1)),console.warn('T("'+s+'") is not defined.'));var a=e._;return a.originkey=s,a.meta=b(e),a.emit("init"),e},b=function(t){for(var e,n,i=t._.meta,r=t;null!==r&&r.constructor!==Object;){e=Object.getOwnPropertyNames(r);for(var s=0,a=e.length;a>s;++s)i[e[s]]||(/^(constructor$|process$|_)/.test(e[s])?i[e[s]]="ignore":(n=Object.getOwnPropertyDescriptor(r,e[s]),"function"==typeof n.value?i[e[s]]="function":(n.get||n.set)&&(i[e[s]]="property")));r=Object.getPrototypeOf(r)}return i};Object.defineProperties(e,{version:{value:c},envtype:{value:p},envmobile:{value:d},env:{get:function(){return h.impl.env}},samplerate:{get:function(){return h.samplerate}},channels:{get:function(){return h.channels}},cellsize:{get:function(){return h.cellsize}},currentTime:{get:function(){return h.currentTime}},isPlaying:{get:function(){return h.status===r}},isRecording:{get:function(){return h.status===a}},amp:{set:function(t){"number"==typeof t&&(h.amp=t)},get:function(){return h.amp}},bpm:{set:function(t){"number"==typeof t&&t>=5&&300>=t&&(m=t)},get:function(){return m}}}),e.bind=function(t,n){return h.bind(t,n),e},e.setup=function(t){return h.setup(t),e},e.play=function(){return h.play(),e},e.pause=function(){return h.pause(),e},e.reset=function(){return h.reset(),h.events.emit("reset"),e},e.on=e.addListener=function(t,n){return h.on(t,n),e},e.once=function(t,n){return h.once(t,n),e},e.off=e.removeListener=function(t,n){return h.off(t,n),e},e.removeAllListeners=function(t){return h.removeAllListeners(t),e},e.listeners=function(t){return h.listeners(t)},e.rec=function(){return h.rec.apply(h,arguments)},e.timevalue=function(){var t=function(t){var e,n=m;return(e=/^bpm(\d+(?:\.\d+)?)/i.exec(t))&&(n=Math.max(5,Math.min(300,+(e[1]||0)))),n};return function(n){var i,r,s;if(i=/^(\d+(?:\.\d+)?)Hz$/i.exec(n))return 0===+i[1]?0:1e3/+i[1];if(i=/L(\d+)?(\.*)$/i.exec(n))return r=60/t(n)*(4/(i[1]||4))*1e3,r*=[1,1.5,1.75,1.875][(i[2]||"").length]||1;if(i=/^(\d+(?:\.\d+)?|\.(?:\d+))(min|sec|m)s?$/i.exec(n))switch(i[2]){case"min":return 60*+(i[1]||0)*1e3;case"sec":return 1e3*+(i[1]||0);case"m":return+(i[1]||0)}return(i=/^(?:([0-5]?[0-9]):)?(?:([0-5]?[0-9]):)(?:([0-5]?[0-9]))(?:\.([0-9]{1,3}))?$/.exec(n))?(s=3600*(i[1]||0)+60*(i[2]||0)+(i[3]||0),s=1e3*s+(0|((i[4]||"")+"00").substr(0,3))):(i=/(\d+)\.(\d+)\.(\d+)$/i.exec(n))?(s=480*(4*i[1]+ +i[2])+ +i[3],60/t(n)*(s/480)*1e3):(i=/(\d+)ticks$/i.exec(n))?60/t(n)*(i[1]/480)*1e3:(i=/^(\d+)samples(?:\/(\d+)Hz)?$/i.exec(n))?1e3*i[1]/(i[2]||e.samplerate):0}}();var y=e.fn={SignalArray:Float32Array,currentTimeIncr:0,emptycell:null,FINISHED_STATE:i,PLAYING_STATE:r,UNSCHEDULED_STATE:s,SCHEDULED_STATE:a},_=y.isArray=Array.isArray,w=y.isDictionary=function(t){return"object"==typeof t&&t.constructor===Object};y.nop=function(){return this},y.isSignalArray=function(t){return t instanceof y.SignalArray?!0:Array.isArray(t)&&t.__klass&&2===t.__klass.type?!0:!1},y.extend=function(t,e){function n(){this.constructor=t}e=e||M;for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},y.constructorof=function(t,e){for(var n=t&&t.prototype;n;){if(n===e.prototype)return!0;n=Object.getPrototypeOf(n)}return!1},y.register=function(t,e){y.constructorof(e,M)?f[t]=e:l[t]=e},y.alias=function(t,e){f[e]?f[t]=f[e]:l[e]&&(l[t]=l[e])},y.getClass=function(t){return f[t]},y.pointer=function(t,e,n){return e=t.byteOffset+e*t.constructor.BYTES_PER_ELEMENT,"number"==typeof n?new t.constructor(t.buffer,e,n):new t.constructor(t.buffer,e)},y.nextTick=function(t){return h.nextTick(t),e},y.fixAR=function(t){t._.ar=!0,t._.aronly=!0},y.fixKR=function(t){t._.ar=!1,t._.kronly=!0},y.changeWithValue=function(){var t=this._,e=t.value*t.mul+t.add;isNaN(e)&&(e=0);for(var n=this.cells[0],i=0,r=n.length;r>i;++i)n[i]=e},y.changeWithValue.unremovable=!0,y.clone=function(t){var e=new t.constructor([]);return e._.ar=t._.ar,e._.mul=t._.mul,e._.add=t._.add,e._.bypassed=t._.bypassed,e},y.timer=function(){var t=function(t){return function(){-1===h.timers.indexOf(t)&&(h.timers.push(t),h.events.emit("addObject"),t._.emit("start"),y.buddies_start(t))}},e=function(t){return function(){var e=h.timers.indexOf(t);-1!==e&&(h.timers.splice(e,1),t._.emit("stop"),h.events.emit("removeObject"),y.buddies_stop(t))}};return function(n){var i=t(n),r=e(n);return n.nodeType=M.TIMER,n.start=function(){return h.nextTick(i),n},n.stop=function(){return h.nextTick(r),n},n}}(),y.listener=function(){var t=function(t){return function(){-1===h.listeners.indexOf(t)&&(h.listeners.push(t),h.events.emit("addObject"),t._.emit("listen"),y.buddies_start(t))}},e=function(t){return function(){var e=h.listeners.indexOf(t);-1!==e&&(h.listeners.splice(e,1),t._.emit("unlisten"),h.events.emit("removeObject"),y.buddies_stop(t))}};return function(n){var i=t(n),r=e(n);return n.nodeType=M.LISTENER,n.listen=function(){return arguments.length&&n.append.apply(n,arguments),n.nodes.length&&h.nextTick(i),n},n.unlisten=function(){return arguments.length&&n.remove.apply(n,arguments),n.nodes.length||h.nextTick(r),n},n}}(),y.make_onended=function(t,e){return function(){if(t.playbackState=i,"number"==typeof e)for(var n=t.cells[0],r=t.cells[1],s=t.cells[2],a=0,o=r.length;o>a;++a)n[0]=r[a]=s[a]=e;t._.emit("ended")}},y.inputSignalAR=function(t){var e,n,i,s,a,o,u=t.cells[0],c=t.cells[1],h=t.cells[2],f=t.nodes,l=f.length,p=u.length,d=t.tickID;if(2===t.numChannels){if(i=!0,0!==l){for(e=0;l>e;++e)if(f[e].playbackState===r){f[e].process(d),c.set(f[e].cells[1]),h.set(f[e].cells[2]),i=!1,++e;break}for(;l>e;++e)if(f[e].playbackState===r)for(f[e].process(d),a=f[e].cells[1],o=f[e].cells[2],n=p;n;)n-=8,c[n]+=a[n],h[n]+=o[n],c[n+1]+=a[n+1],h[n+1]+=o[n+1],c[n+2]+=a[n+2],h[n+2]+=o[n+2],c[n+3]+=a[n+3],h[n+3]+=o[n+3],c[n+4]+=a[n+4],h[n+4]+=o[n+4],c[n+5]+=a[n+5],h[n+5]+=o[n+5],c[n+6]+=a[n+6],h[n+6]+=o[n+6],c[n+7]+=a[n+7],h[n+7]+=o[n+7]}i&&(c.set(y.emptycell),h.set(y.emptycell))}else{if(i=!0,0!==l){for(e=0;l>e;++e)if(f[e].playbackState===r){f[e].process(d),u.set(f[e].cells[0]),i=!1,++e;break}for(;l>e;++e)if(f[e].playbackState===r)for(s=f[e].process(d).cells[0],n=p;n;)n-=8,u[n]+=s[n],u[n+1]+=s[n+1],u[n+2]+=s[n+2],u[n+3]+=s[n+3],u[n+4]+=s[n+4],u[n+5]+=s[n+5],u[n+6]+=s[n+6],u[n+7]+=s[n+7]}i&&u.set(y.emptycell)}},y.inputSignalKR=function(t){var e,n=t.nodes,i=n.length,s=t.tickID,a=0;for(e=0;i>e;++e)n[e].playbackState===r&&(a+=n[e].process(s).cells[0][0]);return a},y.outputSignalAR=function(t){var e,n=t.cells[0],i=t.cells[1],r=t.cells[2],s=t._.mul,a=t._.add;if(2===t.numChannels)for(e=n.length;e;)e-=8,i[e]=i[e]*s+a,r[e]=r[e]*s+a,i[e+1]=i[e+1]*s+a,r[e+1]=r[e+1]*s+a,i[e+2]=i[e+2]*s+a,r[e+2]=r[e+2]*s+a,i[e+3]=i[e+3]*s+a,r[e+3]=r[e+3]*s+a,i[e+4]=i[e+4]*s+a,r[e+4]=r[e+4]*s+a,i[e+5]=i[e+5]*s+a,r[e+5]=r[e+5]*s+a,i[e+6]=i[e+6]*s+a,r[e+6]=r[e+6]*s+a,i[e+7]=i[e+7]*s+a,r[e+7]=r[e+7]*s+a,n[e]=.5*(i[e]+r[e]),n[e+1]=.5*(i[e+1]+r[e+1]),n[e+2]=.5*(i[e+2]+r[e+2]),n[e+3]=.5*(i[e+3]+r[e+3]),n[e+4]=.5*(i[e+4]+r[e+4]),n[e+5]=.5*(i[e+5]+r[e+5]),n[e+6]=.5*(i[e+6]+r[e+6]),n[e+7]=.5*(i[e+7]+r[e+7]);else if(1!==s||0!==a)for(e=n.length;e;)e-=8,n[e]=n[e]*s+a,n[e+1]=n[e+1]*s+a,n[e+2]=n[e+2]*s+a,n[e+3]=n[e+3]*s+a,n[e+4]=n[e+4]*s+a,n[e+5]=n[e+5]*s+a,n[e+6]=n[e+6]*s+a,n[e+7]=n[e+7]*s+a},y.outputSignalKR=function(t){var e,n=t.cells[0],i=t.cells[1],r=t.cells[2],s=t._.mul,a=t._.add,o=n[0]*s+a;if(2===t.numChannels)for(e=n.length;e;)e-=8,n[e]=n[e+1]=n[e+2]=n[e+3]=n[e+4]=n[e+5]=n[e+6]=n[e+7]=i[e]=i[e+1]=i[e+2]=i[e+3]=i[e+4]=i[e+5]=i[e+6]=i[e+7]=r[e]=r[e+1]=r[e+2]=r[e+3]=r[e+4]=r[e+5]=r[e+6]=r[e+7]=o;else for(e=n.length;e;)e-=8,n[e]=n[e+1]=n[e+2]=n[e+3]=n[e+4]=n[e+5]=n[e+6]=n[e+7]=o},y.buddies_start=function(t){var e,n,i,r=t._.buddies;for(n=0,i=r.length;i>n;++n)switch(e=r[n],e.nodeType){case M.DSP:e.play();break;case M.TIMER:e.start();break;case M.LISTENER:e.listen()}},y.buddies_stop=function(t){var e,n,i,r=t._.buddies;for(n=0,i=r.length;i>n;++n)switch(e=r[n],e.nodeType){case M.DSP:e.pause();break;case M.TIMER:e.stop();break;case M.LISTENER:e.unlisten()}},y.fix_iOS6_1_problem=function(t){h.fix_iOS6_1_problem(t)};var S,I=e.modules={},x=I.EventEmitter=function(){function t(t){this.context=t,this.events={}}var e=t.prototype;return e.emit=function(t){var e=this.events[t];if(!e)return!1;var i;if("function"==typeof e){switch(arguments.length){case 1:e.call(this.context);break;case 2:e.call(this.context,arguments[1]);break;case 3:e.call(this.context,arguments[1],arguments[2]);break;default:i=n.call(arguments,1),e.apply(this.context,i)}return!0}if(_(e)){i=n.call(arguments,1);for(var r=e.slice(),s=0,a=r.length;a>s;++s)r[s]instanceof M?r[s].bang.apply(r[s],i):r[s].apply(this.context,i);return!0}return e instanceof M?(i=n.call(arguments,1),void e.bang.apply(e,i)):!1},e.on=function(t,e){if("function"!=typeof e&&!(e instanceof M))throw new Error("addListener takes instances of Function or timbre.Object");var n=this.events;return n[t]?_(n[t])?n[t].push(e):n[t]=[n[t],e]:n[t]=e,this},e.once=function(t,e){var n,i=this;if("function"==typeof e)n=function(){i.off(t,n),e.apply(i.context,arguments)};else{if(!(e instanceof M))throw new Error("once takes instances of Function or timbre.Object");n=function(){i.off(t,n),e.bang.apply(e,arguments)}}return n.listener=e,i.on(t,n),this},e.off=function(t,e){if("function"!=typeof e&&!(e instanceof M))throw new Error("removeListener takes instances of Function or timbre.Object");var n=this.events;if(!n[t])return this;var i=n[t];if(_(i)){for(var r=-1,s=0,a=i.length;a>s;++s)if(i[s]===e||i[s].listener&&i[s].listener===e){r=s;break}if(0>r)return this;i.splice(r,1),0===i.length&&(n[t]=null)}else(i===e||i.listener&&i.listener===e)&&(n[t]=null);return this},e.removeAllListeners=function(t){var e=this.events,n=!1,i=e[t];if(_(i))for(var r=i.length;r--;){var s=i[r];s.unremovable?n=!0:this.off(t,s)}else i&&(i.unremovable?n=!0:this.off(t,i));return n||(e[t]=null),this},e.listeners=function(t){var e,n=this.events;if(!n[t])return[];if(n=n[t],!_(n))return n.unremovable?[]:[n];n=n.slice(),e=[];for(var i=0,r=n.length;r>i;++i)n[i].unremovable||e.push(n[i]);return e},t}(),k=I.Deferred=function(){function t(t){this.context=t||this,this._state="pending",this._doneList=[],this._failList=[],this._promise=new e(this)}function e(t){this.context=t.context,this.then=t.then,this.done=function(){return t.done.apply(t,arguments),this},this.fail=function(){return t.fail.apply(t,arguments),this},this.pipe=function(){return t.pipe.apply(t,arguments)},this.always=function(){return t.always.apply(t,arguments),this},this.promise=function(){return this},this.isResolved=function(){return t.isResolved()},this.isRejected=function(){return t.isRejected()}}var i=t.prototype,r=function(t,e,n,i){if("pending"===this._state){this._state=t;for(var r=0,s=e.length;s>r;++r)e[r].apply(n,i);this._doneList=this._failList=null}},s=function(t){return t&&"function"==typeof t.promise};return i.resolve=function(){var t=n.call(arguments,0);return r.call(this,"resolved",this._doneList,this.context||this,t),this},i.resolveWith=function(t){var e=n.call(arguments,1);return r.call(this,"resolved",this._doneList,t,e),this},i.reject=function(){var t=n.call(arguments,0);return r.call(this,"rejected",this._failList,this.context||this,t),this},i.rejectWith=function(t){var e=n.call(arguments,1);return r.call(this,"rejected",this._failList,t,e),this},i.promise=function(){return this._promise},i.done=function(){for(var t=n.call(arguments),e="resolved"===this._state,i="pending"===this._state,r=this._doneList,s=0,a=t.length;a>s;++s)"function"==typeof t[s]&&(e?t[s]():i&&r.push(t[s]));return this},i.fail=function(){for(var t=n.call(arguments),e="rejected"===this._state,i="pending"===this._state,r=this._failList,s=0,a=t.length;a>s;++s)"function"==typeof t[s]&&(e?t[s]():i&&r.push(t[s]));return this},i.always=function(){return this.done.apply(this,arguments),this.fail.apply(this,arguments),this},i.then=function(t,e){return this.done(t).fail(e)},i.pipe=function(e,i){var r=this,a=new t(this.context);return this.done(function(){var t=e.apply(r.context,arguments);s(t)?t.then(function(){var e=n.call(arguments);a.resolveWith.apply(a,[t].concat(e))}):a.resolveWith(r,t)}),this.fail(function(){if("function"==typeof i){var t=i.apply(r.context,arguments);s(t)&&t.fail(function(){var e=n.call(arguments);a.rejectWith.apply(a,[t].concat(e))})}else a.reject.apply(a,arguments)}),a.promise()},i.isResolved=function(){return"resolved"===this._state},i.isRejected=function(){return"rejected"===this._state},i.state=function(){return this._state},t.when=function(e){var i=0,r=n.call(arguments),a=r.length,o=a;1!==a||s(e)||(o=0);var u=1===o?e:new t,c=function(t,e){return function(i){e[t]=arguments.length>1?n.call(arguments):i,--o||u.resolve.apply(u,e)}};if(a>1)for(var h=new Array(a),f=function(){u.reject()};a>i;++i)r[i]&&s(r[i])?r[i].promise().done(c(i,h)).fail(f):(h[i]=r[i],--o);return o||u.resolve.apply(u,r),u.promise()},t}(),M=e.Object=function(){function i(t,n){this._={};var s=this._.events=new x(this);if(this._.emit=function(){return s.emit.apply(s,arguments)},w(n[0])){var a=n.shift(),o=a["in"];this.once("init",function(){this.set(a),o&&(_(o)?this.append.apply(this,o):o instanceof i&&this.append(o))})}switch(this.tickID=-1,this.nodes=n.map(e),this.cells=[],this.numChannels=t,t){case 0:this.L=this.R=new A(null),this.cells[0]=this.cells[1]=this.cells[2]=this.L.cell;break;case 1:this.L=this.R=new A(this),this.cells[0]=this.cells[1]=this.cells[2]=this.L.cell;break;case 2:this.L=new A(this),this.R=new A(this),this.cells[0]=new y.SignalArray(h.cellsize),this.cells[1]=this.L.cell,this.cells[2]=this.R.cell}this.playbackState=r,this.nodeType=i.DSP,this._.ar=!0,this._.mul=1,this._.add=0,this._.dac=null,this._.bypassed=!1,this._.meta={},this._.samplerate=h.samplerate,this._.cellsize=h.cellsize,this._.buddies=[]}i.DSP=1,i.TIMER=2,i.LISTENER=3;var s=i.prototype;return Object.defineProperties(s,{isAr:{get:function(){return this._.ar}},isKr:{get:function(){return!this._.ar}},isBypassed:{get:function(){return this._.bypassed}},isEnded:{get:function(){return!(1&this.playbackState)}},mul:{set:function(t){"number"==typeof t&&(this._.mul=t,this._.emit("setMul",t))},get:function(){return this._.mul}},add:{set:function(t){"number"==typeof t&&(this._.add=t,this._.emit("setAdd",t))},get:function(){return this._.add}},buddies:{set:function(t){_(t)||(t=[t]),this._.buddies=t.filter(function(t){return t instanceof i})},get:function(){return this._.buddies}}}),s.toString=function(){return this.constructor.name},s.valueOf=function(){return h.tickID!==this.tickID&&this.process(h.tickID),this.cells[0][0]},s.append=function(){if(arguments.length>0){var t=n.call(arguments).map(e);this.nodes=this.nodes.concat(t),this._.emit("append",t)}return this},s.appendTo=function(t){return t.append(this),this},s.remove=function(){if(arguments.length>0){for(var t,e=this.nodes,n=[],i=0,r=arguments.length;r>i;++i)-1!==(t=e.indexOf(arguments[i]))&&(n.push(e[t]),e.splice(t,1));n.length>0&&this._.emit("remove",n)}return this},s.removeFrom=function(t){return t.remove(this),this},s.removeAll=function(){var t=this.nodes.slice();return this.nodes=[],t.length>0&&this._.emit("remove",t),this},s.removeAtIndex=function(t){var e=this.nodes[t];return e&&(this.nodes.splice(t,1),this._.emit("remove",[e])),this},s.postMessage=function(t){return this._.emit("message",t),this},s.to=function(t){if(t instanceof i)t.append(this);else{var e=n.call(arguments);w(e[1])?e.splice(2,0,this):e.splice(1,0,this),t=g.apply(null,e)}return t},s.splice=function(t,e,n){var r;return e?e instanceof i&&(r=e.nodes.indexOf(n),-1!==r&&e.nodes.splice(r,1),t instanceof i?(t.nodes.push(this),e.nodes.push(t)):e.nodes.push(this)):this._.dac&&(t instanceof i?n instanceof i?n._.dac&&(n._.dac._.node=t,t._.dac=n._.dac,n._.dac=null,t.nodes.push(this)):this._.dac&&(this._.dac._.node=t,t._.dac=this._.dac,this._.dac=null,t.nodes.push(this)):n instanceof i&&n._.dac&&(n._.dac._.node=this,this._.dac=n._.dac,n._.dac=null)),this},s.on=s.addListener=function(t,e){return this._.events.on(t,e),this},s.once=function(t,e){return this._.events.once(t,e),this},s.off=s.removeListener=function(t,e){return this._.events.off(t,e),this},s.removeAllListeners=function(t){return this._.events.removeAllListeners(t),this},s.listeners=function(t){return this._.events.listeners(t)},s.set=function(t,e){var n,i,r=this._.meta;switch(typeof t){case"string":switch(r[t]){case"property":this[t]=e;break;case"function":this[t](e);break;default:for(n=this;null!==n;)i=Object.getOwnPropertyDescriptor(n,t),i&&("function"==typeof i.value?(r[t]="function",this[t](e)):(i.get||i.set)&&(r[t]="property",this[t]=e)),n=Object.getPrototypeOf(n)}break;case"object":for(n in t)this.set(n,t[n])}return this},s.get=function(t){return"property"===this._.meta[t]?this[t]:void 0},s.bang=function(){return this._.emit.apply(this,["bang"].concat(n.call(arguments))),this},s.process=y.nop,s.bypass=function(){return this._.bypassed=0===arguments.length?!0:!!arguments[0],this},s.play=function(){var t=this._.dac;return null===t&&(t=this._.dac=new L(this)),t.play()&&this._.emit.apply(this,["play"].concat(n.call(arguments))),y.buddies_start(this),this},s.pause=function(){var t=this._.dac;return t&&t.playbackState===r&&(t.pause(),this._.dac=null,this._.emit("pause")),y.buddies_stop(this),this},s.start=s.stop=s.listen=s.unlisten=function(){return this},s.ar=function(){return(0===arguments.length?0:!arguments[0])?this.kr(!0):this._.kronly||(this._.ar=!0,this._.emit("ar",!0)),this},s.kr=function(){return(0===arguments.length?0:!arguments[0])?this.ar(!0):this._.aronly||(this._.ar=!1,this._.emit("ar",!1)),this},s.plot="browser"===p?function(e){var n=this._,i=e.target;if(!i)return this;var r,s=e.width||i.width||320,a=e.height||i.height||240,o=(e.x||0)+.5,u=e.y||0,c=i.getContext("2d");r=e.foreground!==t?e.foreground:n.plotForeground||"rgb(  0, 128, 255)";var h;h=e.background!==t?e.background:n.plotBackground||"rgb(255, 255, 255)";var f,l,p,d,v,m=e.lineWidth||n.plotLineWidth||1,g=!!n.plotCyclic,b=n.plotData||this.cells[0],y=e.range||n.plotRange||[-1.2,1.2],_=y[0],w=a/(y[1]-_),S=s/b.length,I=b.length;if(c.save(),c.rect(o,u,s,a),null!==h&&(c.fillStyle=h,c.fillRect(o,u,s,a)),n.plotBefore&&n.plotBefore.call(this,c,o,u,s,a),n.plotBarStyle)for(c.fillStyle=r,f=0,v=0;I>v;++v)p=(b[v]-_)*w,l=a-p,c.fillRect(f+o,l+u,S,p),f+=S;else{for(c.strokeStyle=r,c.lineWidth=m,c.beginPath(),f=0,d=a-(b[0]-_)*w,c.moveTo(f+o,d+u),v=1;I>v;++v)f+=S,l=a-(b[v]-_)*w,c.lineTo(f+o,l+u);g?c.lineTo(f+S+o,d+u):c.lineTo(f+S+o,l+u),c.stroke()}n.plotAfter&&n.plotAfter.call(this,c,o,u,s,a);var x=e.border||n.plotBorder;return x&&(c.strokeStyle="string"==typeof x?x:"#000",c.lineWidth=1,c.strokeRect(o,u,s,a)),c.restore(),this}:y.nop,i}(),A=e.ChannelObject=function(){function t(t){e.Object.call(this,-1,[]),y.fixAR(this),this._.parent=t,this.cell=new y.SignalArray(h.cellsize),this.L=this.R=this,this.cells[0]=this.cells[1]=this.cells[2]=this.cell,this.numChannels=1}return y.extend(t),t.prototype.process=function(t){return this.tickID!==t&&(this.tickID=t,this._.parent&&this._.parent.process(t)),this},t}(),T=function(){function t(t){M.call(this,2,t)}return y.extend(t),t.prototype.process=function(t){var e=this._;return this.tickID!==t&&(this.tickID=t,e.ar?(y.inputSignalAR(this),y.outputSignalAR(this)):(this.cells[0][0]=y.inputSignalKR(this),y.outputSignalKR(this))),this},y.register("+",t),t}(),C=function(){function t(t){if(M.call(this,1,[]),y.fixKR(this),this.value=t[0],w(t[1])){var e=t[1];this.once("init",function(){this.set(e)})}this.on("setAdd",y.changeWithValue),this.on("setMul",y.changeWithValue)}y.extend(t);var e=t.prototype;return Object.defineProperties(e,{value:{set:function(t){"number"==typeof t&&(this._.value=isNaN(t)?0:t,y.changeWithValue.call(this))},get:function(){return this._.value}}}),t}(),R=function(){function t(t){if(M.call(this,1,[]),y.fixKR(this),this.value=t[0],w(t[1])){var e=t[1];this.once("init",function(){this.set(e)})}this.on("setAdd",y.changeWithValue),this.on("setMul",y.changeWithValue)}y.extend(t);var e=t.prototype;return Object.defineProperties(e,{value:{set:function(t){this._.value=t?1:0,y.changeWithValue.call(this)},get:function(){return!!this._.value}}}),t}(),D=function(){function t(t){if(M.call(this,1,[]),y.fixKR(this),this.func=t[0],this._.value=0,w(t[1])){var e=t[1];this.once("init",function(){this.set(e)})}this.on("setAdd",y.changeWithValue),this.on("setMul",y.changeWithValue)}y.extend(t);var e=t.prototype;return Object.defineProperties(e,{func:{set:function(t){"function"==typeof t&&(this._.func=t)},get:function(){return this._.func}},args:{set:function(t){this._.args=_(t)?t:[t]},get:function(){return this._.args}}}),e.bang=function(){var t=this._,e=n.call(arguments).concat(t.args),i=t.func.apply(this,e);return"number"==typeof i&&(t.value=i,y.changeWithValue.call(this)),this._.emit("bang"),this},t}(),O=function(){function t(t){M.call(this,1,[]);var e,n;for(e=0,n=t[0].length;n>e;++e)this.append(t[0][e]);if(w(t[1])){var i=t[1];this.once("init",function(){this.set(i)})}}y.extend(t);var e=t.prototype;return Object.defineProperties(e,{}),e.bang=function(){var t,e,i=["bang"].concat(n.call(arguments)),r=this.nodes;for(t=0,e=r.length;e>t;++t)r[t].bang.apply(r[t],i);return this},e.postMessage=function(t){var e,n,i=this.nodes;for(e=0,n=i.length;n>e;++e)i[e].postMessage(t);return this},e.process=function(t){var e=this._;return this.tickID!==t&&(this.tickID=t,e.ar?(y.inputSignalAR(this),y.outputSignalAR(this)):(this.cells[0][0]=y.inputSignalKR(this),y.outputSignalKR(this))),this},t}(),P=function(){function t(t){if(M.call(this,1,[]),y.fixKR(this),w(t[1])){var e=t[1];this.once("init",function(){this.set(e)})}}y.extend(t);var e=t.prototype;return Object.defineProperties(e,{}),t}(),L=function(){function t(t){M.call(this,2,[]),this.playbackState=i;var r=this._;r.node=t,r.onplay=e(this),r.onpause=n(this)}y.extend(t);var e=function(t){return function(){-1===h.inlets.indexOf(t)&&(h.inlets.push(t),h.events.emit("addObject"),t.playbackState=r,t._.emit("play"))}},n=function(t){return function(){var e=h.inlets.indexOf(t);-1!==e&&(h.inlets.splice(e,1),t.playbackState=i,t._.emit("pause"),h.events.emit("removeObject"))}},s=t.prototype;return s.play=function(){return h.nextTick(this._.onplay),-1===h.inlets.indexOf(this)},s.pause=function(){h.nextTick(this._.onpause)},s.process=function(t){var e=this._.node;1&e.playbackState?(e.process(t),this.cells[1].set(e.cells[1]),this.cells[2].set(e.cells[2])):(this.cells[1].set(y.emptycell),this.cells[2].set(y.emptycell))},t}(),j=function(){function t(){this.context=this,this.tickID=0,this.impl=null,this.amp=.8,this.status=i,this.samplerate=44100,this.channels=2,this.cellsize=64,this.streammsec=20,this.streamsize=0,this.currentTime=0,this.nextTicks=[],this.inlets=[],this.timers=[],this.listeners=[],this.deferred=null,this.recStart=0,this.recBuffers=null,this.delayProcess=e(this),this.events=null,y.currentTimeIncr=1e3*this.cellsize/this.samplerate,y.emptycell=new y.SignalArray(this.cellsize),this.reset(!0)}var e=function(t){return function(){t.recStart=Date.now(),t.process()}},s=t.prototype;s.bind=function(t,e){if("function"==typeof t){var n=new t(this,e);this.impl=n,this.impl.defaultSamplerate&&(this.samplerate=this.impl.defaultSamplerate)}return this},s.setup=function(t){return"object"==typeof t&&(-1!==o.indexOf(t.samplerate)&&(this.samplerate=t.samplerate<=this.impl.maxSamplerate?t.samplerate:this.impl.maxSamplerate),-1!==u.indexOf(t.cellsize)&&(this.cellsize=t.cellsize),"undefined"!=typeof Float64Array&&"undefined"!=typeof t.f64&&(v=!!t.f64,y.SignalArray=v?Float64Array:Float32Array)),y.currentTimeIncr=1e3*this.cellsize/this.samplerate,y.emptycell=new y.SignalArray(this.cellsize),this},s.getAdjustSamples=function(t){var e,n;return t=t||this.samplerate,e=this.streammsec/1e3*t,n=Math.ceil(Math.log(e)*Math.LOG2E),n=8>n?8:n>14?14:n,1<<n},s.play=function(){return this.status===i&&(this.status=r,this.streamsize=this.getAdjustSamples(),this.strmL=new y.SignalArray(this.streamsize),this.strmR=new y.SignalArray(this.streamsize),this.impl.play(),this.events.emit("play")),this},s.pause=function(){return this.status===r&&(this.status=i,this.impl.pause(),this.events.emit("pause")),this},s.reset=function(t){return t&&(this.events=new x(this).on("addObject",function(){this.status===i&&this.play()}).on("removeObject",function(){this.status===r&&this.inlets.length+this.timers.length+this.listeners.length===0&&this.pause()})),this.currentTime=0,this.nextTicks=[],this.inlets=[],this.timers=[],this.listeners=[],this},s.process=function(){var t,e,n,i,r,s,o,u,c=this.tickID,h=this.strmL,f=this.strmR,l=this.amp,p=this.streamsize,d=0,v=this.cellsize,m=this.streamsize/this.cellsize,g=this.timers,b=this.inlets,_=this.listeners,w=y.currentTimeIncr;for(i=0;p>i;++i)h[i]=f[i]=0;for(;m--;){for(++c,r=0,s=g.length;s>r;++r)1&g[r].playbackState&&g[r].process(c);for(r=0,s=b.length;s>r;++r)if(t=b[r],t.process(c),1&t.playbackState)for(e=t.cells[1],n=t.cells[2],o=0,i=d;v>o;++o,++i)h[i]+=e[o],f[i]+=n[o];for(d+=v,r=0,s=_.length;s>r;++r)1&_[r].playbackState&&_[r].process(c);for(this.currentTime+=w,u=this.nextTicks.splice(0),r=0,s=u.length;s>r;++r)u[r]()}for(i=0;p>i;++i)t=h[i]*l,-1>t?t=-1:t>1&&(t=1),h[i]=t,t=f[i]*l,-1>t?t=-1:t>1&&(t=1),f[i]=t;this.tickID=c;var S=this.currentTime;if(this.status===a){if(2===this.recCh)this.recBuffers.push(new y.SignalArray(h)),this.recBuffers.push(new y.SignalArray(f));else{var I=new y.SignalArray(h.length);for(i=0,p=I.length;p>i;++i)I[i]=.5*(h[i]+f[i]);this.recBuffers.push(I)}if(S>=this.maxDuration)this.deferred.sub.reject();else if(S>=this.recDuration)this.deferred.sub.resolve();else{var x=Date.now();x-this.recStart>20?setTimeout(this.delayProcess,10):this.process()}}},s.nextTick=function(t){this.status===i?t():this.nextTicks.push(t)},s.rec=function(){y.fix_iOS6_1_problem(!0);var t=new k(this);if(this.deferred)return console.warn("rec deferred is exists??"),t.reject().promise();if(this.status!==i)return console.log("status is not none",this.status),t.reject().promise();var e=0,r=arguments,s=w(r[e])?r[e++]:{},o=r[e];if("function"!=typeof o)return console.warn("no function"),t.reject().promise();this.deferred=t,this.status=a,this.reset();var u=new g("+"),h=new k(this),f={done:function(){h.resolve.apply(h,n.call(arguments))},send:function(){u.append.apply(u,arguments)}},l=this;return h.then(c,function(){y.fix_iOS6_1_problem(!1),c.call(l,!0)}),this.deferred.sub=h,this.savedSamplerate=this.samplerate,this.samplerate=s.samplerate||this.samplerate,this.recDuration=s.recDuration||1/0,this.maxDuration=s.maxDuration||6e5,this.recCh=s.ch||1,2!==this.recCh&&(this.recCh=1),this.recBuffers=[],this.streamsize=this.getAdjustSamples(),this.strmL=new y.SignalArray(this.streamsize),this.strmR=new y.SignalArray(this.streamsize),this.inlets.push(u),o(f),setTimeout(this.delayProcess,10),t.promise()};var c=function(){this.status=i,this.reset();var t,e=this.recBuffers,n=this.samplerate,r=this.streamsize;this.samplerate=this.savedSamplerate,t=1/0!==this.recDuration?this.recDuration*n*.001|0:(e.length>>this.recCh-1)*r;var s,a,o=t/r|0,u=0,c=0,h=t;if(2===this.recCh){var f=new y.SignalArray(t),l=new y.SignalArray(t),p=new y.SignalArray(t);for(a=0;o>a;++a)if(f.set(e[u++],c),l.set(e[u++],c),c+=r,h-=r,h>0&&r>h){f.set(e[u++].subarray(0,h),c),l.set(e[u++].subarray(0,h),c);break}for(a=0,o=t;o>a;++a)p[a]=.5*(f[a]+l[a]);s={samplerate:n,channels:2,buffer:[p,f,l]}}else{var d=new y.SignalArray(t);for(a=0;o>a;++a)if(d.set(e[u++],c),c+=r,h-=r,h>0&&r>h){d.set(e[u++].subarray(0,h),c);break}s={samplerate:n,channels:1,buffer:[d]}}var v=[].concat.apply([s],arguments);this.deferred.resolve.apply(this.deferred,v),this.deferred=null};return s.on=function(t,e){this.events.on(t,e)},s.once=function(t,e){this.events.once(t,e)},s.off=function(t,e){this.events.off(t,e)},s.removeAllListeners=function(t){this.events.removeListeners(t)},s.listeners=function(t){return this.events.listeners(t)},s.fix_iOS6_1_problem=function(t){this.impl.fix_iOS6_1_problem&&this.impl.fix_iOS6_1_problem(t)},t}(),U=null;"undefined"!=typeof window&&(S=window.AudioContext||window.webkitAudioContext),U="undefined"!=typeof S?function(t){var e,n,i=new S;y._audioContext=i,this.maxSamplerate=i.sampleRate,this.defaultSamplerate=i.sampleRate,this.env="webkit";var r=navigator.userAgent;if(r.match(/linux/i)?t.streammsec*=8:r.match(/win(dows)?\s*(nt 5\.1|xp)/i)&&(t.streammsec*=4),this.play=function(){var r,s,a,o=t.getAdjustSamples(i.sampleRate),u=t.streamsize;t.samplerate===i.sampleRate?r=function(e){var n=e.outputBuffer;t.process(),n.getChannelData(0).set(t.strmL),n.getChannelData(1).set(t.strmR)}:2*t.samplerate===i.sampleRate?r=function(e){var n,i,r=t.strmL,s=t.strmR,a=e.outputBuffer,o=a.getChannelData(0),u=a.getChannelData(1),c=a.length;for(t.process(),n=i=0;c>n;n+=2,++i)o[n]=o[n+1]=r[i],u[n]=u[n+1]=s[i]}:(s=u,a=t.samplerate/i.sampleRate,r=function(e){var n,i=t.strmL,r=t.strmR,o=e.outputBuffer,c=o.getChannelData(0),h=o.getChannelData(1),f=o.length;for(n=0;f>n;++n)s>=u&&(t.process(),s-=u),c[n]=i[0|s],h[n]=r[0|s],s+=a}),e=i.createBufferSource(),n=i.createScriptProcessor(o,2,t.channels),n.onaudioprocess=r,e.noteOn&&e.noteOn(0),e.connect(n),n.connect(i.destination)},this.pause=function(){e.disconnect(),n.disconnect()},d){var s=0,a=i.createBufferSource();this.fix_iOS6_1_problem=function(t){s+=t?1:-1,1===s?(a.noteOn(0),a.connect(i.destination)):0===s&&a.disconnect()}}}:function(){this.maxSamplerate=48e3,this.defaultSamplerate=44100,this.env="nop",this.play=function(){},this.pause=function(){}},h=(new j).bind(U);var E=e;"node"===p||"undefined"!=typeof module&&module.exports?module.exports=global.timbre=E:"browser"===p&&(E.noConflict=function(){var t=window.timbre,e=window.T;return function(n){return window.T===E&&(window.T=e),n&&window.timbre===E&&(window.timbre=t),E}}(),window.timbre=window.T=E),function(){function t(t){try{return e.plugins&&e.mimeTypes&&e.mimeTypes.length?e.plugins["Shockwave Flash"].description.match(/([0-9]+)/)[t]:new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version").match(/([0-9]+)/)[t];
}catch(n){return-1}}if("nop"===h.impl.env&&"browser"===p&&!d){var e=navigator;if(!(t(0)<10)){var n,i="TimbreFlashPlayerDiv",r=function(){var t=document.getElementsByTagName("script");if(t&&t.length)for(var e,n=0,i=t.length;i>n;++n)if(e=/^(.*\/)timbre(?:\.dev)?\.js$/i.exec(t[n].src))return e[1]+"timbre.swf"}();window.timbrejs_flashfallback_init=function(){function t(t){var e=0;this.maxSamplerate=44100,this.defaultSamplerate=44100,this.env="flash",this.play=function(){var i,s=new Array(t.streamsize*t.channels),a=t.streammsec,o=0,u=t.streamsize/t.samplerate*1e3,c=Date.now();i=function(){if(!(o>Date.now()-c)){var e=t.strmL,i=t.strmR,r=s.length,a=e.length;for(t.process();a--;)s[--r]=32768*i[a]|0,s[--r]=32768*e[a]|0;n.writeAudio(s.join(" ")),o+=u}},n.setup?(n.setup(t.channels,t.samplerate),e=setInterval(i,a)):console.warn("Cannot find "+r)},this.pause=function(){0!==e&&(n.cancel(),clearInterval(e),e=0)}}h.bind(t),delete window.timbrejs_flashfallback_init};var s,a,o=r,u=o+"?"+ +new Date,c="TimbreFlashPlayer",f=document.createElement("div");f.id=i,f.style.display="inline",f.width=f.height=1,e.plugins&&e.mimeTypes&&e.mimeTypes.length?(s=document.createElement("object"),s.id=c,s.classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",s.width=s.height=1,s.setAttribute("data",u),s.setAttribute("type","application/x-shockwave-flash"),a=document.createElement("param"),a.setAttribute("name","allowScriptAccess"),a.setAttribute("value","always"),s.appendChild(a),f.appendChild(s)):f.innerHTML='<object id="'+c+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="1" height="1"><param name="movie" value="'+u+'" /><param name="bgcolor" value="#FFFFFF" /><param name="quality" value="high" /><param name="allowScriptAccess" value="always" /></object>',window.addEventListener("load",function(){document.body.appendChild(f),n=document[c]})}}}()}(),function(t){"use strict";function e(t){this.samplerate=t,this.frequency=340,this.Q=1,this.gain=0,this.x1L=this.x2L=this.y1L=this.y2L=0,this.x1R=this.x2R=this.y1R=this.y2R=0,this.b0=this.b1=this.b2=this.a1=this.a2=0,this.setType("lpf")}var n=e.prototype;n.process=function(t,e){var n,i,r,s,a,o,u=this.x1L,c=this.x2L,h=this.y1L,f=this.y2L,l=this.x1R,p=this.x2R,d=this.y1R,v=this.y2R,m=this.b0,g=this.b1,b=this.b2,y=this.a1,_=this.a2;for(a=0,o=t.length;o>a;++a)n=t[a],r=m*n+g*u+b*c-y*h-_*f,c=u,u=n,f=h,h=r,i=e[a],s=m*i+g*l+b*p-y*d-_*v,p=l,l=i,v=d,d=s,t[a]=r,e[a]=s;this.x1L=u,this.x2L=c,this.y1L=h,this.y2L=f,this.x1R=l,this.x2R=p,this.y1R=d,this.y2R=v},n.setType=function(t){var e;(e=i[t])&&(this.type=t,e.call(this,this.frequency,this.Q,this.gain))},n.setParams=function(t,e,n){this.frequency=t,this.Q=e,this.gain=n;var r=i[this.type];return r&&r.call(this,t,e,n),this};var i={lowpass:function(t,e){if(t/=.5*this.samplerate,t>=1)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else if(0>=t)this.b0=this.b1=this.b2=this.a1=this.a2=0;else{e=0>e?0:e;var n=Math.pow(10,.05*e),i=Math.sqrt(.5*(4-Math.sqrt(16-16/(n*n)))),r=Math.PI*t,s=.5*i*Math.sin(r),a=.5*(1-s)/(1+s),o=(.5+a)*Math.cos(r),u=.25*(.5+a-o);this.b0=2*u,this.b1=4*u,this.b2=this.b0,this.a1=2*-o,this.a2=2*a}},highpass:function(t,e){if(t/=.5*this.samplerate,t>=1)this.b0=this.b1=this.b2=this.a1=this.a2=0;else if(0>=t)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else{e=0>e?0:e;var n=Math.pow(10,.05*e),i=Math.sqrt((4-Math.sqrt(16-16/(n*n)))/2),r=Math.PI*t,s=.5*i*Math.sin(r),a=.5*(1-s)/(1+s),o=(.5+a)*Math.cos(r),u=.25*(.5+a+o);this.b0=2*u,this.b1=-4*u,this.b2=this.b0,this.a1=2*-o,this.a2=2*a}},bandpass:function(t,e){if(t/=.5*this.samplerate,t>0&&1>t)if(e>0){var n=Math.PI*t,i=Math.sin(n)/(2*e),r=Math.cos(n),s=1/(1+i);this.b0=i*s,this.b1=0,this.b2=-i*s,this.a1=-2*r*s,this.a2=(1-i)*s}else this.b0=this.b1=this.b2=this.a1=this.a2=0;else this.b0=this.b1=this.b2=this.a1=this.a2=0},lowshelf:function(t,e,n){t/=.5*this.samplerate;var i=Math.pow(10,n/40);if(t>=1)this.b0=i*i,this.b1=this.b2=this.a1=this.a2=0;else if(0>=t)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else{var r=Math.PI*t,s=1,a=.5*Math.sin(r)*Math.sqrt((i+1/i)*(1/s-1)+2),o=Math.cos(r),u=2*Math.sqrt(i)*a,c=i+1,h=i-1,f=1/(c+h*o+u);this.b0=i*(c-h*o+u)*f,this.b1=2*i*(h-c*o)*f,this.b2=i*(c-h*o-u)*f,this.a1=-2*(h+c*o)*f,this.a2=(c+h*o-u)*f}},highshelf:function(t,e,n){t/=.5*this.samplerate;var i=Math.pow(10,n/40);if(t>=1)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else if(0>=t)this.b0=i*i,this.b1=this.b2=this.a1=this.a2=0;else{var r=Math.PI*t,s=1,a=.5*Math.sin(r)*Math.sqrt((i+1/i)*(1/s-1)+2),o=Math.cos(r),u=2*Math.sqrt(i)*a,c=i+1,h=i-1,f=1/(c-h*o+u);this.b0=i*(c+h*o+u)*f,this.b1=-2*i*(h+c*o)*f,this.b2=i*(c+h*o-u)*f,this.a1=2*(h-c*o)*f,this.a2=(c-h*o-u)*f}},peaking:function(t,e,n){if(t/=.5*this.samplerate,t>0&&1>t){var i=Math.pow(10,n/40);if(e>0){var r=Math.PI*t,s=Math.sin(r)/(2*e),a=Math.cos(r),o=1/(1+s/i);this.b0=(1+s*i)*o,this.b1=-2*a*o,this.b2=(1-s*i)*o,this.a1=this.b1,this.a2=(1-s/i)*o}else this.b0=i*i,this.b1=this.b2=this.a1=this.a2=0}else this.b0=1,this.b1=this.b2=this.a1=this.a2=0},notch:function(t,e){if(t/=.5*this.samplerate,t>0&&1>t)if(e>0){var n=Math.PI*t,i=Math.sin(n)/(2*e),r=Math.cos(n),s=1/(1+i);this.b0=s,this.b1=-2*r*s,this.b2=s,this.a1=this.b1,this.a2=(1-i)*s}else this.b0=this.b1=this.b2=this.a1=this.a2=0;else this.b0=1,this.b1=this.b2=this.a1=this.a2=0},allpass:function(t,e){if(t/=.5*this.samplerate,t>0&&1>t)if(e>0){var n=Math.PI*t,i=Math.sin(n)/(2*e),r=Math.cos(n),s=1/(1+i);this.b0=(1-i)*s,this.b1=-2*r*s,this.b2=(1+i)*s,this.a1=this.b1,this.a2=this.b0}else this.b0=-1,this.b1=this.b2=this.a1=this.a2=0;else this.b0=1,this.b1=this.b2=this.a1=this.a2=0}};i.lpf=i.lowpass,i.hpf=i.highpass,i.bpf=i.bandpass,i.bef=i.notch,i.brf=i.notch,i.apf=i.allpass,t.modules.Biquad=e}(timbre),function(t){"use strict";function e(e){this.samplerate=e;var n=Math.round(Math.log(.1*e)*Math.LOG2E);this.buffersize=1<<n,this.bufferL=new t.fn.SignalArray(this.buffersize+1),this.bufferR=new t.fn.SignalArray(this.buffersize+1),this.wave=null,this._wave=null,this.writeIndex=this.buffersize>>1,this.readIndex=0,this.delayTime=20,this.rate=4,this.depth=20,this.feedback=.2,this.wet=.5,this.phase=0,this.phaseIncr=0,this.phaseStep=4,this.setWaveType("sin"),this.setDelayTime(this.delayTime),this.setRate(this.rate)}var n=e.prototype,i=[];i[0]=function(){for(var t=new Float32Array(512),e=0;512>e;++e)t[e]=Math.sin(2*Math.PI*(e/512));return t}(),i[1]=function(){for(var t,e=new Float32Array(512),n=0;512>n;++n)t=n/512-.25,e[n]=1-4*Math.abs(Math.round(t)-t);return e}(),n.setWaveType=function(t){"sin"===t?(this.wave=t,this._wave=i[0]):"tri"===t&&(this.wave=t,this._wave=i[1])},n.setDelayTime=function(t){this.delayTime=t;for(var e=this.writeIndex-(t*this.samplerate*.001|0);0>e;)e+=this.buffersize;this.readIndex=e},n.setRate=function(t){this.rate=t,this.phaseIncr=512*this.rate/this.samplerate*this.phaseStep},n.process=function(t,e){var n,i,r,s,a,o=this.bufferL,u=this.bufferR,c=this.buffersize,h=c-1,f=this._wave,l=this.phase,p=this.phaseIncr,d=this.writeIndex,v=this.readIndex,m=this.depth,g=this.feedback,b=this.wet,y=1-b,_=t.length,w=this.phaseStep;for(s=0;_>s;){for(r=f[0|l]*m,l+=p;l>512;)l-=512;for(a=0;w>a;++a,++s)i=v+c+r&h,n=.5*(o[i]+o[i+1]),o[d]=t[s]-n*g,t[s]=t[s]*y+n*b,n=.5*(u[i]+u[i+1]),u[d]=e[s]-n*g,e[s]=e[s]*y+n*b,d=d+1&h,v=v+1&h}this.phase=l,this.writeIndex=d,this.readIndex=v},t.modules.Chorus=e}(timbre),function(t){"use strict";function e(e,i){this.samplerate=e,this.channels=i,this.lastPreDelayFrames=0,this.preDelayReadIndex=0,this.preDelayWriteIndex=r,this.ratio=-1,this.slope=-1,this.linearThreshold=-1,this.dbThreshold=-1,this.dbKnee=-1,this.kneeThreshold=-1,this.kneeThresholdDb=-1,this.ykneeThresholdDb=-1,this.K=-1,this.attackTime=.003,this.releaseTime=.25,this.preDelayTime=.006,this.dbPostGain=0,this.effectBlend=1,this.releaseZone1=.09,this.releaseZone2=.16,this.releaseZone3=.42,this.releaseZone4=.98,this.detectorAverage=0,this.compressorGain=1,this.meteringGain=1,this.delayBufferL=new t.fn.SignalArray(n),this.delayBufferR=2===i?new t.fn.SignalArray(n):this.delayBufferL,this.preDelayTime=6,this.preDelayReadIndex=0,this.preDelayWriteIndex=r,this.maxAttackCompressionDiffDb=-1,this.meteringReleaseK=1-Math.exp(-1/(.325*this.samplerate)),this.setAttackTime(this.attackTime),this.setReleaseTime(this.releaseTime),this.setPreDelayTime(this.preDelayTime),this.setParams(-24,30,12)}var n=1024,i=n-1,r=256,s=5,a=e.prototype;a.clone=function(){var t=new e(this.samplerate,this.channels);return t.setAttackTime(this.attackTime),t.setReleaseTime(this.releaseTime),t.setPreDelayTime(this.preDelayTime),t.setParams(this.dbThreshold,this.dbKnee,this.ratio),t},a.setAttackTime=function(t){this.attackTime=Math.max(.001,t),this._attackFrames=this.attackTime*this.samplerate},a.setReleaseTime=function(t){this.releaseTime=Math.max(.001,t);var e=this.releaseTime*this.samplerate,n=.0025;this._satReleaseFrames=n*this.samplerate;var i=e*this.releaseZone1,r=e*this.releaseZone2,s=e*this.releaseZone3,a=e*this.releaseZone4;this._kA=.9999999999999998*i+1.8432219684323923e-16*r-1.9373394351676423e-16*s+8.824516011816245e-18*a,this._kB=-1.5788320352845888*i+2.3305837032074286*r-.9141194204840429*s+.1623677525612032*a,this._kC=.5334142869106424*i-1.272736789213631*r+.9258856042207512*s-.18656310191776226*a,this._kD=.08783463138207234*i-.1694162967925622*r+.08588057951595272*s-.00429891410546283*a,this._kE=-.042416883008123074*i+.1115693827987602*r-.09764676325265872*s+.028494263462021576*a},a.setPreDelayTime=function(t){this.preDelayTime=t;var e=t*this.samplerate;if(e>n-1&&(e=n-1),this.lastPreDelayFrames!==e){this.lastPreDelayFrames=e;for(var i=0,r=this.delayBufferL.length;r>i;++i)this.delayBufferL[i]=this.delayBufferR[i]=0;this.preDelayReadIndex=0,this.preDelayWriteIndex=e}},a.setParams=function(t,e,n){this._k=this.updateStaticCurveParameters(t,e,n);var i=this.saturate(1,this._k),r=1/i;r=Math.pow(r,.6),this._masterLinearGain=Math.pow(10,.05*this.dbPostGain)*r},a.kneeCurve=function(t,e){return t<this.linearThreshold?t:this.linearThreshold+(1-Math.exp(-e*(t-this.linearThreshold)))/e},a.saturate=function(t,e){var n;if(t<this.kneeThreshold)n=this.kneeCurve(t,e);else{var i=t?20*Math.log(t)*Math.LOG10E:-1e3,r=this.ykneeThresholdDb+this.slope*(i-this.kneeThresholdDb);n=Math.pow(10,.05*r)}return n},a.slopeAt=function(t,e){if(t<this.linearThreshold)return 1;var n=1.001*t,i=t?20*Math.log(t)*Math.LOG10E:-1e3,r=n?20*Math.log(n)*Math.LOG10E:-1e3,s=this.kneeCurve(t,e),a=this.kneeCurve(n,e),o=s?20*Math.log(s)*Math.LOG10E:-1e3,u=a?20*Math.log(a)*Math.LOG10E:-1e3;return(u-o)/(r-i)},a.kAtSlope=function(t){for(var e=this.dbThreshold+this.dbKnee,n=Math.pow(10,.05*e),i=.1,r=1e4,s=5,a=0;15>a;++a){var o=this.slopeAt(n,s);t>o?r=s:i=s,s=Math.sqrt(i*r)}return s},a.updateStaticCurveParameters=function(t,e,n){this.dbThreshold=t,this.linearThreshold=Math.pow(10,.05*t),this.dbKnee=e,this.ratio=n,this.slope=1/this.ratio,this.kneeThresholdDb=t+e,this.kneeThreshold=Math.pow(10,.05*this.kneeThresholdDb);var i=this.kAtSlope(1/this.ratio),r=this.kneeCurve(this.kneeThreshold,i);return this.ykneeThresholdDb=r?20*Math.log(r)*Math.LOG10E:-1e3,this._k=i,this._k},a.process=function(t,e){for(var n=1-this.effectBlend,r=this.effectBlend,a=this._k,o=this._masterLinearGain,u=this._satReleaseFrames,c=this._kA,h=this._kB,f=this._kC,l=this._kD,p=this._kE,d=64,v=t.length/d,m=0,g=this.detectorAverage,b=this.compressorGain,y=this.maxAttackCompressionDiffDb,_=1/this._attackFrames,w=this.preDelayReadIndex,S=this.preDelayWriteIndex,I=this.detectorAverage,x=this.delayBufferL,k=this.delayBufferR,M=this.meteringGain,A=this.meteringReleaseK,T=0;v>T;++T){var C,R=Math.asin(g)/(.5*Math.PI),D=R>b,O=b/R,P=O?20*Math.log(O)*Math.LOG10E:-1e3;if((1/0===P||isNaN(P))&&(P=-1),D){y=-1,O=P,O=-12>O?0:O>0?3:.25*(O+12);var L=O*O,j=L*O,U=L*L,E=c+h*O+f*L+l*j+p*U,F=s/E;C=Math.pow(10,.05*F)}else{(-1===y||P>y)&&(y=P);var q=Math.max(.5,y);O=.25/q,C=1-Math.pow(O,_)}for(var B=d;B--;){var N=0,W=.5*(t[m]+e[m]);x[S]=t[m],k[S]=e[m],0>W&&(W*=-1),W>N&&(N=W);var z=N;0>z&&(z*=-1);var G=this.saturate(z,a),V=1e-4>=z?1:G/z,K=V?-20*Math.log(V)*Math.LOG10E:1e3;2>K&&(K=2);var Q=K/u,H=Math.pow(10,.05*Q)-1,$=V>I,Y=$?H:1;I+=(V-I)*Y,I>1&&(I=1),1>C?b+=(R-b)*C:(b*=C,b>1&&(b=1));var Z=Math.sin(.5*Math.PI*b),X=n+r*o*Z,J=20*Math.log(Z)*Math.LOG10E;M>J?M=J:M+=(J-M)*A,t[m]=x[w]*X,e[m]=k[w]*X,m++,w=w+1&i,S=S+1&i}1e-6>I&&(I=1e-6),1e-6>b&&(b=1e-6)}this.preDelayReadIndex=w,this.preDelayWriteIndex=S,this.detectorAverage=I,this.compressorGain=b,this.maxAttackCompressionDiffDb=y,this.meteringGain=M},a.reset=function(){this.detectorAverage=0,this.compressorGain=1,this.meteringGain=1;for(var t=0,e=this.delayBufferL.length;e>t;++t)this.delayBufferL[t]=this.delayBufferR[t]=0;this.preDelayReadIndex=0,this.preDelayWriteIndex=r,this.maxAttackCompressionDiffDb=-1},t.modules.Compressor=e}(timbre),function(t){"use strict";function e(){}e.prototype.decode=function(t,n,i){if("string"==typeof t){if(/\.wav$/.test(t))return e.wav_decode(t,n,i);if(e.ogg_decode&&/\.ogg$/.test(t))return e.ogg_decode(t,n,i);if(e.mp3_decode&&/\.mp3$/.test(t))return e.mp3_decode(t,n,i)}else if("object"==typeof t){if("wav"===t.type)return e.wav_decode(t.data,n,i);if(e.ogg_decode&&"ogg"===t.type)return e.ogg_decode(t.data,n,i);if(e.mp3_decode&&"mp3"===t.type)return e.mp3_decode(t.data,n,i)}return e.webkit_decode?"object"==typeof t?e.webkit_decode(t.data||t,n,i):e.webkit_decode(t,n,i):e.moz_decode?e.moz_decode(t,n,i):void n(!1)},t.modules.Decoder=e,e.getBinaryWithPath="browser"===t.envtype?function(e,n){t.fn.fix_iOS6_1_problem(!0);var i=new XMLHttpRequest;i.open("GET",e),i.responseType="arraybuffer",i.onreadystatechange=function(){4===i.readyState&&(i.response?n(new Uint8Array(i.response)):void 0!==i.responseBody&&n(new Uint8Array(VBArray(i.responseBody).toArray())),t.fn.fix_iOS6_1_problem(!1))},i.send()}:function(t,e){e("no support")};var n=function(t){for(var e,n,i,r,s,a=new Int32Array(t.length/3),o=0,u=t.length,c=0;u>o;)e=t[o++],n=t[o++],i=t[o++],r=e+(n<<8)+(i<<16),s=8388608&r?r-16777216:r,a[c++]=s;return a};e.wav_decode=function(){var t=function(t,e,i){if("RIFF"!==String.fromCharCode(t[0],t[1],t[2],t[3]))return e(!1);var r=t[4]+(t[5]<<8)+(t[6]<<16)+(t[7]<<24);if(r+8!==t.length)return e(!1);if("WAVE"!==String.fromCharCode(t[8],t[9],t[10],t[11]))return e(!1);if("fmt "!==String.fromCharCode(t[12],t[13],t[14],t[15]))return e(!1);for(var s=t[22]+(t[23]<<8),a=t[24]+(t[25]<<8)+(t[26]<<16)+(t[27]<<24),o=t[34]+(t[35]<<8),u=36;u<t.length&&"data"!==String.fromCharCode(t[u],t[u+1],t[u+2],t[u+3]);)u+=1;if(u>=t.length)return e(!1);u+=4;var c=t[u]+(t[u+1]<<8)+(t[u+2]<<16)+(t[u+3]<<24),h=(c/s>>1)/a;if(u+=4,c>t.length-u)return e(!1);var f,l,p;f=new Float32Array(h*a|0),2===s&&(l=new Float32Array(f.length),p=new Float32Array(f.length)),e({samplerate:a,channels:s,buffer:[f,l,p],duration:h}),8===o?t=new Int8Array(t.buffer,u):16===o?t=new Int16Array(t.buffer,u):32===o?t=new Int32Array(t.buffer,u):24===o&&(t=n(new Uint8Array(t.buffer,u)));var d,v,m,g=1/((1<<o-1)-1);if(2===s)for(u=v=0,d=f.length;d>u;++u)m=l[u]=t[v++]*g,m+=p[u]=t[v++]*g,f[u]=.5*m;else for(u=0,d=f.length;d>u;++u)f[u]=t[u]*g;i()};return function(n,i,r){"string"==typeof n?e.getBinaryWithPath(n,function(e){t(e,i,r)}):t(n,i,r)}}(),e.webkit_decode=function(){if("undefined"!=typeof t.fn._audioContext){var n=t.fn._audioContext,i=function(t,e,i){var r,s,a,o,u;if("string"==typeof t)return i(!1);var c;try{c=n.createBuffer(t.buffer,!1)}catch(h){return e(!1)}r=n.sampleRate,s=c.numberOfChannels,2===s?(a=c.getChannelData(0),o=c.getChannelData(1)):a=o=c.getChannelData(0),u=a.length/r;for(var f=new Float32Array(a),l=0,p=f.length;p>l;++l)f[l]=.5*(f[l]+o[l]);e({samplerate:r,channels:s,buffer:[f,a,o],duration:u}),i()};return function(t,n,r){if(t instanceof File){var s=new FileReader;s.onload=function(t){i(new Uint8Array(t.target.result),n,r)},s.readAsArrayBuffer(t)}else"string"==typeof t?e.getBinaryWithPath(t,function(t){i(t,n,r)}):i(t,n,r)}}}(),e.moz_decode=function(){return"function"==typeof Audio&&"function"==typeof(new Audio).mozSetup?function(t,e,n){var i,r,s,a,o,u,c=0,h=new Audio(t);h.volume=0,h.addEventListener("loadedmetadata",function(){i=h.mozSampleRate,r=h.mozChannels,u=h.duration,s=new Float32Array(h.duration*i|0),2===r&&(a=new Float32Array(h.duration*i|0),o=new Float32Array(h.duration*i|0)),2===r?h.addEventListener("MozAudioAvailable",function(t){for(var e,n=t.frameBuffer,i=0,r=n.length;r>i;i+=2)e=a[c]=n[i],e+=o[c]=n[i+1],s[c]=.5*e,c+=1},!1):h.addEventListener("MozAudioAvailable",function(t){for(var e=t.frameBuffer,n=0,i=e.length;i>n;++n)s[n]=e[n],c+=1},!1),h.play(),setTimeout(function(){e({samplerate:i,channels:r,buffer:[s,a,o],duration:u})},1e3)},!1),h.addEventListener("ended",function(){n()},!1),h.load()}:void 0}()}(timbre),function(t){"use strict";function e(t){this.samplerate=t||44100,this.value=i,this.status=l,this.curve="linear",this.step=1,this.releaseNode=null,this.loopNode=null,this.emit=null,this._envValue=new n(t),this._table=[],this._initValue=i,this._curveValue=0,this._defaultCurveType=s,this._index=0,this._counter=0}function n(t){this.samplerate=t,this.value=i,this.step=1,this._curveType=s,this._curveValue=0,this._grow=0,this._a2=0,this._b1=0,this._y1=0,this._y2=0}var i=e.ZERO=1e-6,r=e.CurveTypeSet=0,s=e.CurveTypeLin=1,a=e.CurveTypeExp=2,o=e.CurveTypeSin=3,u=e.CurveTypeWel=4,c=e.CurveTypeCurve=5,h=e.CurveTypeSqr=6,f=e.CurveTypeCub=7,l=e.StatusWait=0,p=e.StatusGate=1,d=e.StatusSustain=2,v=e.StatusRelease=3,m=e.StatusEnd=4,g={set:r,lin:s,linear:s,exp:a,exponential:a,sin:o,sine:o,wel:u,welch:u,sqr:h,squared:h,cub:f,cubed:f};e.CurveTypeDict=g;var b=e.prototype;b.clone=function(){var t=new e(this.samplerate);return t._table=this._table,t._initValue=this._initValue,t.setCurve(this.curve),null!==this.releaseNode&&t.setReleaseNode(this.releaseNode+1),null!==this.loopNode&&t.setLoopNode(this.loopNode+1),t.setStep(this.step),t.reset(),t},b.setTable=function(t){this._initValue=t[0],this._table=t.slice(1),this.value=this._envValue.value=this._initValue,this._index=0,this._counter=0,this.status=l},b.setCurve=function(t){"number"==typeof t?(this._defaultCurveType=c,this._curveValue=t,this.curve=t):(this._defaultCurveType=g[t]||null,this.curve=t)},b.setReleaseNode=function(t){"number"==typeof t&&t>0&&(this.releaseNode=t-1)},b.setLoopNode=function(t){"number"==typeof t&&t>0&&(this.loopNode=t-1)},b.setStep=function(t){this.step=this._envValue.step=t},b.reset=function(){this.value=this._envValue.value=this._initValue,this._index=0,this._counter=0,this.status=l},b.release=function(){null!==this.releaseNode&&this._index<=this.releaseNode&&(this._counter=0,this._index=this.releaseNode,this.status=v)},b.getInfo=function(t){var e,n,i=this._table,r=0,s=1/0,a=1/0,o=!1;for(e=0,n=i.length;n>e;++e){this.loopNode===e&&(s=r),this.releaseNode===e&&(t>r?r+=t:r=t,a=r);var u=i[e];Array.isArray(u)&&(r+=u[1])}return 1/0!==s&&1/0===a&&(r+=t,o=!0),{totalDuration:r,loopBeginTime:s,releaseBeginTime:a,isEndlessLoop:o}},b.calcStatus=function(){var t,e,n,i,a=this.status,o=this._table,u=this._index,h=this._counter,f=this._curveValue,g=this._defaultCurveType,b=this.loopNode,y=this.releaseNode,_=this._envValue,w=null;switch(a){case l:case m:break;case p:case v:for(;0>=h;)if(u>=o.length){if(a===p&&null!==b){u=b;continue}a=m,h=1/0,i=r,w="ended"}else if(a!==p||u!==y)t=o[u++],e=t[0],i=null===t[2]?g:t[2],i===c&&(f=t[3],Math.abs(f)<.001&&(i=s)),n=t[1],h=_.setNext(e,n,i,f);else{if(null!==b&&y>b){u=b;continue}a=d,h=1/0,i=r,w="sustained"}}return this.status=a,this.emit=w,this._index=u,this._counter=h,a},b.next=function(){return 1&this.calcStatus()&&(this.value=this._envValue.next()||i),this._counter-=1,this.value},b.process=function(t){var e,n=this._envValue,r=t.length;if(1&this.calcStatus())for(e=0;r>e;++e)t[e]=n.next()||i;else{var s=this.value||i;for(e=0;r>e;++e)t[e]=s}this.value=t[r-1],this._counter-=t.length},n.prototype.setNext=function(t,e,n,i){var l,p,d,v,m,g,b,_=this.step,w=this.value,S=.001*e*this.samplerate/_|0;switch(1>S&&(S=1,n=r),n){case r:this.value=t;break;case s:l=(t-w)/S;break;case a:l=0!==w?Math.pow(t/w,1/S):0;break;case o:p=Math.PI/S,v=.5*(t+w),m=2*Math.cos(p),g=.5*(t-w),b=g*Math.sin(.5*Math.PI-p),w=v-g;break;case u:p=.5*Math.PI/S,m=2*Math.cos(p),t>=w?(v=w,g=0,b=-Math.sin(p)*(t-w)):(v=t,g=w-t,b=Math.cos(p)*(w-t)),w=v+g;break;case c:d=(t-w)/(1-Math.exp(i)),v=w+d,m=d,l=Math.exp(i/S);break;case h:g=Math.sqrt(w),b=Math.sqrt(t),l=(b-g)/S;break;case f:g=Math.pow(w,.33333333),b=Math.pow(t,.33333333),l=(b-g)/S}return this.next=y[n],this._grow=l,this._a2=v,this._b1=m,this._y1=g,this._y2=b,S};var y=[];y[r]=function(){return this.value},y[s]=function(){return this.value+=this._grow,this.value},y[a]=function(){return this.value*=this._grow,this.value},y[o]=function(){var t=this._b1*this._y1-this._y2;return this.value=this._a2-t,this._y2=this._y1,this._y1=t,this.value},y[u]=function(){var t=this._b1*this._y1-this._y2;return this.value=this._a2+t,this._y2=this._y1,this._y1=t,this.value},y[c]=function(){return this._b1*=this._grow,this.value=this._a2-this._b1,this.value},y[h]=function(){return this._y1+=this._grow,this.value=this._y1*this._y1,this.value},y[f]=function(){return this._y1+=this._grow,this.value=this._y1*this._y1*this._y1,this.value},n.prototype.next=y[r],t.modules.Envelope=e,t.modules.EnvelopeValue=n}(timbre),function(t){"use strict";function e(e){e="number"==typeof e?e:512,e=1<<Math.ceil(Math.log(e)*Math.LOG2E),this.length=e,this.buffer=new t.fn.SignalArray(e),this.real=new t.fn.SignalArray(e),this.imag=new t.fn.SignalArray(e),this._real=new t.fn.SignalArray(e),this._imag=new t.fn.SignalArray(e),this.mag=new t.fn.SignalArray(e>>1),this.minDecibels=-30,this.maxDecibels=-100;var n=i.get(e);this._bitrev=n.bitrev,this._sintable=n.sintable,this._costable=n.costable}var n=e.prototype;n.setWindow=function(e){if("string"==typeof e){var n=/([A-Za-z]+)(?:\(([01]\.?\d*)\))?/.exec(e);if(null!==n){var i=n[1].toLowerCase(),s=void 0!==n[2]?+n[2]:.25,a=r[i];if(a){this._window||(this._window=new t.fn.SignalArray(this.length));var o=this._window,u=0,c=this.length;for(s=0>s?0:s>1?1:s;c>u;++u)o[u]=a(u,c,s);this.windowName=e}}}},n.forward=function(t){var e,n,i,r,s,a,o,u,c,h,f,l=this.buffer,p=this.real,d=this.imag,v=this._window,m=this._bitrev,g=this._sintable,b=this._costable,y=l.length;if(v)for(e=0;y>e;++e)l[e]=t[e]*v[e];else l.set(t);for(e=0;y>e;++e)p[e]=l[m[e]],d[e]=0;for(i=1;y>i;i=r)for(s=0,r=i+i,a=y/r,n=0;i>n;n++){for(o=b[s],u=g[s],e=n;y>e;e+=r)c=e+i,h=u*d[c]+o*p[c],f=o*d[c]-u*p[c],p[c]=p[e]-h,p[e]+=h,d[c]=d[e]-f,d[e]+=f;s+=a}var _,w,S=this.mag;for(e=0;y>e;++e)_=p[e],w=d[e],S[e]=Math.sqrt(_*_+w*w);return{real:p,imag:d}},n.inverse=function(t,e){var n,i,r,s,a,o,u,c,h,f,l,p=this.buffer,d=this._real,v=this._imag,m=this._bitrev,g=this._sintable,b=this._costable,y=p.length;for(n=0;y>n;++n)i=m[n],d[n]=+t[i],v[n]=-e[i];for(r=1;y>r;r=s)for(a=0,s=r+r,o=y/s,i=0;r>i;i++){for(u=b[a],c=g[a],n=i;y>n;n+=s)h=n+r,f=c*v[h]+u*d[h],l=u*v[h]-c*d[h],d[h]=d[n]-f,d[n]+=f,v[h]=v[n]-l,v[n]+=l;a+=o}for(n=0;y>n;++n)p[n]=d[n]/y;return p},n.getFrequencyData=function(t){var e,n=this.minDecibels,i=Math.min(this.mag.length,t.length);if(i){var r,s=this.mag,a=0;for(e=0;i>e;++e)r=s[e],t[e]=r?20*Math.log(r)*Math.LOG10E:n,a<t[e]&&(a=t[e])}return t};var i={get:function(e){return i[e]||function(){var n,r,s=function(){var t,n,i,r,s;for(t=new Int16Array(e),s=e>>1,n=i=0;t[n]=i,!(++n>=e);){for(r=s;i>=r;)i-=r,r>>=1;i+=r}return t}(),a=Math.floor(Math.log(e)/Math.LN2),o=new t.fn.SignalArray((1<<a)-1),u=new t.fn.SignalArray((1<<a)-1),c=2*Math.PI;for(n=0,r=o.length;r>n;++n)o[n]=Math.sin(c*(n/e)),u[n]=Math.cos(c*(n/e));return i[e]={bitrev:s,sintable:o,costable:u},i[e]}()}},r=function(){var t=Math.PI,e=2*Math.PI,n=Math.abs,i=Math.pow,r=Math.cos,s=Math.sin,a=function(e){return s(t*e)/(t*e)},o=Math.E;return{rectangular:function(){return 1},hann:function(t,n){return.5*(1-r(e*t/(n-1)))},hamming:function(t,n){return.54-.46*r(e*t/(n-1))},tukery:function(e,n,i){return i*(n-1)/2>e?.5*(1+r(t*(2*e/(i*(n-1))-1))):e>(n-1)*(1-i/2)?.5*(1+r(t*(2*e/(i*(n-1))-2/i+1))):1},cosine:function(e,n){return s(t*e/(n-1))},lanczos:function(t,e){return a(2*t/(e-1)-1)},triangular:function(t,e){return 2/(e+1)*((e+1)/2-n(t-(e-1)/2))},bartlett:function(t,e){return 2/(e-1)*((e-1)/2-n(t-(e-1)/2))},gaussian:function(t,e,n){return i(o,-.5*i((t-(e-1)/2)/(n*(e-1)/2),2))},bartlettHann:function(t,i){return.62-.48*n(t/(i-1)-.5)-.38*r(e*t/(i-1))},blackman:function(n,i,s){var a=(1-s)/2,o=.5,u=s/2;return a-o*r(e*n/(i-1))+u*r(4*t*n/(i-1))}}}();t.modules.FFT=e}(timbre),function(t){"use strict";function e(t){this.samplerate=t||44100,this.wave=null,this.step=1,this.frequency=0,this.value=0,this.phase=0,this.feedback=!1,this._x=0,this._lastouts=0,this._coeff=s/this.samplerate,this._radtoinc=s/(2*Math.PI)}function n(t,e,n,i){var r,s,a,o,u,c=h[e];if(void 0!==c){switch("function"==typeof c&&(c=c()),n){case"@1":for(s=512;1024>s;++s)c[s]=0;break;case"@2":for(s=512;1024>s;++s)c[s]=Math.abs(c[s]);break;case"@3":for(s=256;512>s;++s)c[s]=0;for(s=512;768>s;++s)c[s]=Math.abs(c[s]);for(s=768;1024>s;++s)c[s]=0;break;case"@4":for(r=new Float32Array(1024),s=0;512>s;++s)r[s]=c[s<<1];c=r;break;case"@5":for(r=new Float32Array(1024),s=0;512>s;++s)r[s]=Math.abs(c[s<<1]);c=r}if(void 0!==i&&50!==i){for(i*=.01,i=0>i?0:i>1?1:i,r=new Float32Array(1024),a=1024*i|0,s=0;a>s;++s)r[s]=c[s/a*512|0];for(u=1024-a,o=0;1024>s;++s,++o)r[s]=c[o/u*512+512|0];c=r}if("+"===t)for(s=0;1024>s;++s)c[s]=.5*c[s]+.5;else if("-"===t)for(s=0;1024>s;++s)c[s]*=-1;return c}}function i(t){var e=new Float32Array(1024),n=t.length>>1;if(-1!==[2,4,8,16,32,64,128,256,512,1024].indexOf(n))for(var i=0,r=0;n>i;++i){var s=parseInt(t.substr(2*i,2),16);s=128&s?(s-256)/128:s/127;for(var a=0,o=1024/n;o>a;++a)e[r++]=s}return e}function r(t){var e=new Float32Array(1024);if(8===t.length){var n,i,r=parseInt(t,16),s=new Float32Array(8);for(s[0]=1,n=0;7>n;++n)s[n+1]=.0625*(15&r),r>>=4;for(n=0;8>n;++n){var a=0,o=(n+1)/1024;for(i=0;1024>i;++i)e[i]+=Math.sin(2*Math.PI*a)*s[n],a+=o}var u,c=0;for(n=0;1024>n;++n)c<(u=Math.abs(e[n]))&&(c=u);if(c>0)for(n=0;1024>n;++n)e[n]/=c}return e}var s=1024,a=s-1,o=e.prototype;o.setWave=function(e){var n,i,r=this.wave;if(this.wave||(this.wave=new Float32Array(s+1)),"function"==typeof e)for(n=0;s>n;++n)r[n]=e(n/s);else if(t.fn.isSignalArray(e))if(e.length===r.length)r.set(e);else for(i=e.length/s,n=0;s>n;++n)r[n]=e[n*i|0];else"string"==typeof e&&void 0!==(i=u(e))&&this.wave.set(i);this.wave[s]=this.wave[0]},o.clone=function(){var t=new e(this.samplerate);return t.wave=this.wave,t.step=this.step,t.frequency=this.frequency,t.value=this.value,t.phase=this.phase,t.feedback=this.feedback,t},o.reset=function(){this._x=0},o.next=function(){var t=this._x,e=t+this.phase*this._radtoinc|0;return this.value=this.wave[e&a],t+=this.frequency*this._coeff*this.step,t>s&&(t-=s),this._x=t,this.value},o.process=function(t){var e,n,i,r,o,u,c=this.wave,h=this._radtoinc,f=this._x,l=this.frequency*this._coeff,p=this.step;if(this.feedback){var d=this._lastouts;for(h*=this.phase,u=0;p>u;++u)e=f+d*h,n=0|e,i=e-n,n&=a,r=c[n],o=c[n+1],t[u]=d=r+i*(o-r),f+=l;this._lastouts=d}else{var v=this.phase*h;for(u=0;p>u;++u)e=f+v,n=0|e,i=e-n,n&=a,r=c[n],o=c[n+1],t[u]=r+i*(o-r),f+=l}f>s&&(f-=s),this._x=f,this.value=t[t.length-1]},o.processWithFreqArray=function(t,e){var n,i,r,o,u,c,h=this.wave,f=this._radtoinc,l=this._x,p=this._coeff,d=this.step;if(this.feedback){var v=this._lastouts;for(f*=this.phase,c=0;d>c;++c)n=l+v*f,i=0|n,r=n-i,i&=a,o=h[i],u=h[i+1],t[c]=v=o+r*(u-o),l+=e[c]*p;this._lastouts=v}else{var m=this.phase*this._radtoinc;for(c=0;d>c;++c)n=l+m,i=0|n,r=n-i,i&=a,o=h[i],u=h[i+1],t[c]=o+r*(u-o),l+=e[c]*p}l>s&&(l-=s),this._x=l,this.value=t[t.length-1]},o.processWithPhaseArray=function(t,e){var n,i,r,o,u,c,h=this.wave,f=this._radtoinc,l=this._x,p=this.frequency*this._coeff,d=this.step;if(this.feedback){var v=this._lastouts;for(f*=this.phase,c=0;d>c;++c)n=l+v*f,i=0|n,r=n-i,i&=a,o=h[i],u=h[i+1],t[c]=v=o+r*(u-o),l+=p;this._lastouts=v}else for(c=0;d>c;++c)n=l+e[c]*f,i=0|n,r=n-i,i&=a,o=h[i],u=h[i+1],t[c]=o+r*(u-o),l+=p;l>s&&(l-=s),this._x=l,this.value=t[t.length-1]},o.processWithFreqAndPhaseArray=function(t,e,n){var i,r,o,u,c,h,f=this.wave,l=this._radtoinc,p=this._x,d=this._coeff,v=this.step;if(this.feedback){var m=this._lastouts;for(l*=this.phase,h=0;v>h;++h)i=p+m*l,r=0|i,o=i-r,r&=a,u=f[r],c=f[r+1],t[h]=m=u+o*(c-u),p+=e[h]*d;this._lastouts=m}else for(h=0;v>h;++h)i=p+n[h]*s,r=0|i,o=i-r,r&=a,u=f[r],c=f[r+1],t[h]=u+o*(c-u),p+=e[h]*d;p>s&&(p-=s),this._x=p,this.value=t[t.length-1]};var u=function(t){var e=h[t];if(void 0!==e)return"function"==typeof e&&(e=e()),e;var s;if(s=/^([\-+]?)(\w+)(?:\((@[0-7])?:?(\d+)?\))?$/.exec(t),null!==s){var a=s[1],o=s[2],u=s[3],c=s[4];if(e=n(a,o,u,c),void 0!==e)return h[t]=e,e}return s=/^wavb\(((?:[0-9a-fA-F][0-9a-fA-F])+)\)$/.exec(t),null!==s?i(s[1]):(s=/^wavc\(([0-9a-fA-F]{8})\)$/.exec(t),null!==s?r(s[1]):void 0)};e.getWavetable=u;var c=function(e,n){var i,r,s=new Float32Array(1024);if("function"==typeof n)for(r=0;1024>r;++r)s[r]=n(r/1024);else if(t.fn.isSignalArray(n))if(n.length===s.length)s.set(n);else for(i=n.length/1024,r=0;1024>r;++r)s[r]=n[r*i|0];h[e]=s};e.setWavetable=c;var h={sin:function(){for(var t=new Float32Array(1024),e=0;1024>e;++e)t[e]=Math.sin(2*Math.PI*(e/1024));return t},cos:function(){for(var t=new Float32Array(1024),e=0;1024>e;++e)t[e]=Math.cos(2*Math.PI*(e/1024));return t},pulse:function(){for(var t=new Float32Array(1024),e=0;1024>e;++e)t[e]=512>e?1:-1;return t},tri:function(){for(var t,e=new Float32Array(1024),n=0;1024>n;++n)t=n/1024-.25,e[n]=1-4*Math.abs(Math.round(t)-t);return e},saw:function(){for(var t,e=new Float32Array(1024),n=0;1024>n;++n)t=n/1024,e[n]=2*(t-Math.round(t));return e},fami:function(){for(var t=[0,.125,.25,.375,.5,.625,.75,.875,.875,.75,.625,.5,.375,.25,.125,0,-.125,-.25,-.375,-.5,-.625,-.75,-.875,-1,-1,-.875,-.75,-.625,-.5,-.375,-.25,-.125],e=new Float32Array(1024),n=0;1024>n;++n)e[n]=t[n/1024*t.length|0];return e},konami:function(){for(var t=[-.625,-.875,-.125,.75,.5,.125,.5,.75,.25,-.125,.5,.875,.625,0,.25,.375,-.125,-.75,0,.625,.125,-.5,-.375,-.125,-.75,-1,-.625,0,-.375,-.875,-.625,-.25],e=new Float32Array(1024),n=0;1024>n;++n)e[n]=t[n/1024*t.length|0];return e}};t.modules.Oscillator=e}(timbre),function(t){"use strict";function e(e,a){this.samplerate=e;var o,u,c=e/44100;for(u=2*r.length,this.comb=new Array(u),this.combout=new Array(u),o=0;u>o;++o)this.comb[o]=new n(r[o%r.length]*c),this.combout[o]=new t.fn.SignalArray(a);for(u=2*s.length,this.allpass=new Array(u),o=0;u>o;++o)this.allpass[o]=new i(s[o%s.length]*c);this.outputs=[new t.fn.SignalArray(a),new t.fn.SignalArray(a)],this.damp=0,this.wet=.33,this.setRoomSize(.5),this.setDamp(.5)}function n(e){this.buffer=new t.fn.SignalArray(0|e),this.buffersize=this.buffer.length,this.bufidx=0,this.feedback=0,this.filterstore=0,this.damp=0}function i(e){this.buffer=new t.fn.SignalArray(0|e),this.buffersize=this.buffer.length,this.bufidx=0}var r=[1116,1188,1277,1356,1422,1491,1557,1617],s=[225,556,441,341],a=e.prototype;a.setRoomSize=function(t){var e=this.comb,n=.28*t+.7;this.roomsize=t,e[0].feedback=e[1].feedback=e[2].feedback=e[3].feedback=e[4].feedback=e[5].feedback=e[6].feedback=e[7].feedback=e[8].feedback=e[9].feedback=e[10].feedback=e[11].feedback=e[12].feedback=e[13].feedback=e[14].feedback=e[15].feedback=n},a.setDamp=function(t){var e=this.comb,n=.4*t;this.damp=t,e[0].damp=e[1].damp=e[2].damp=e[3].damp=e[4].damp=e[5].damp=e[6].damp=e[7].damp=e[8].damp=e[9].damp=e[10].damp=e[11].damp=e[12].damp=e[13].damp=e[14].damp=e[15].damp=n},a.process=function(t,e){var n,i=this.comb,r=this.combout,s=this.allpass,a=this.outputs[0],o=this.outputs[1],u=this.wet,c=1-u,h=t.length;for(i[0].process(t,r[0]),i[1].process(t,r[1]),i[2].process(t,r[2]),i[3].process(t,r[3]),i[4].process(t,r[4]),i[5].process(t,r[5]),i[6].process(t,r[6]),i[7].process(t,r[7]),i[8].process(e,r[8]),i[9].process(e,r[9]),i[10].process(e,r[10]),i[11].process(e,r[11]),i[12].process(e,r[12]),i[13].process(e,r[13]),i[14].process(e,r[14]),i[15].process(e,r[15]),n=0;h>n;++n)a[n]=r[0][n]+r[1][n]+r[2][n]+r[3][n]+r[4][n]+r[5][n]+r[6][n]+r[7][n],
o[n]=r[8][n]+r[9][n]+r[10][n]+r[11][n]+r[12][n]+r[13][n]+r[14][n]+r[15][n];for(s[0].process(a,a),s[1].process(a,a),s[2].process(a,a),s[3].process(a,a),s[4].process(o,o),s[5].process(o,o),s[6].process(o,o),s[7].process(o,o),n=0;h>n;++n)t[n]=a[n]*u+t[n]*c,e[n]=o[n]*u+e[n]*c},n.prototype.process=function(t,e){var n,i,r,s=this.buffer,a=this.buffersize,o=this.bufidx,u=this.filterstore,c=this.feedback,h=this.damp,f=1-h,l=t.length;for(r=0;l>r;++r)n=.015*t[r],i=s[o],u=i*f+u*h,s[o]=n+u*c,++o>=a&&(o=0),e[r]=i;this.bufidx=o,this.filterstore=u},i.prototype.process=function(t,e){var n,i,r,s,a=this.buffer,o=this.buffersize,u=this.bufidx,c=t.length;for(s=0;c>s;++s)n=t[s],r=a[u],i=-n+r,a[u]=n+.5*r,++u>=o&&(u=0),e[s]=i;this.bufidx=u},t.modules.Reverb=e}(timbre),function(t){"use strict";function e(t){return new n(t)}function n(t){if(this.fragments=[],t){var e=t.samplerate||44100,n=t.buffer[0].length/e;this.fragments.push(new i(t,0,n))}}function i(t,e,n,i,r,s,o){t||(t=a),this.buffer=t.buffer[0],this.samplerate=t.samplerate||44100,this.start=e,this._duration=n,this.reverse=i||!1,this.pitch=r||100,this.stretch=s||!1,this.pan=o||50}function r(t,e){this.tape=t,this.fragments=t.fragments,this.samplerate=e||44100,this.isEnded=!1,this.buffer=null,this.bufferIndex=0,this.bufferIndexIncr=0,this.bufferBeginIndex=0,this.bufferEndIndex=0,this.fragment=null,this.fragmentIndex=0,this.panL=.5,this.panR=.5}var s=new Float32Array(60),a={buffer:s,samplerate:1};e.silence=function(t){return new e(a).slice(0,1).fill(t)},e.join=function(t){for(var e=new n,i=0;i<t.length;i++)t[i]instanceof n&&e.add_fragments(t[i].fragments);return e},e.Tape=n,n.prototype.add_fragment=function(t){return this.fragments.push(t),this},n.prototype.add_fragments=function(t){for(var e=0;e<t.length;e++)this.fragments.push(t[e]);return this},n.prototype.duration=function(){for(var t=0,e=0;e<this.fragments.length;e++)t+=this.fragments[e].duration();return t},n.prototype.slice=function(t,e){var i=this.duration();t+e>i&&(e=i-t);for(var r=new n,s=t,a=e,o=0;o<this.fragments.length;o++){var u=this.fragments[o],c=u.create(s,a),h=c[0];if(s=c[1],a=c[2],h&&r.add_fragment(h),0===a)break}return r},n.prototype.cut=n.prototype.slice,n.prototype.concat=function(t){var e=new n;return e.add_fragments(this.fragments),e.add_fragments(t.fragments),e},n.prototype.loop=function(t){var e,i=[];for(e=0;e<this.fragments.length;e++)i.push(this.fragments[e].clone());var r=new n;for(e=0;t>e;e++)r.add_fragments(i);return r},n.prototype.times=n.prototype.loop,n.prototype.split=function(t){for(var e=this.duration()/t,n=[],i=0;t>i;i++)n.push(this.slice(i*e,e));return n},n.prototype.fill=function(t){var e=this.duration();if(0===e)throw"EmptyFragment";var n=t/e|0,i=t%e;return this.loop(n).plus(this.slice(0,i))},n.prototype.replace=function(t,i,r){var s=new n,a=t+i;s=s.plus(this.slice(0,t));var o=s.duration();t>o&&(s=s.plus(e.silence(t-o))),s=s.plus(r);var u=this.duration();return u>a&&(s=s.plus(this.slice(a,u-a))),s},n.prototype.reverse=function(){for(var t=new n,e=this.fragments.length;e--;){var i=this.fragments[e].clone();i.reverse=!i.isReversed(),t.add_fragment(i)}return t},n.prototype.pitch=function(t,e){var i=new n;e=e||!1;for(var r=0;r<this.fragments.length;r++){var s=this.fragments[r].clone();s.pitch*=.01*t,s.stretch=e,i.add_fragment(s)}return i},n.prototype.stretch=function(t){var e=1/(.01*t)*100;return this.pitch(e,!0)},n.prototype.pan=function(t){var e=new n;t>100?t=100:0>t&&(t=0);for(var i=0;i<this.fragments.length;i++){var r=this.fragments[i].clone();r.pan=t,e.add_fragment(r)}return e},n.prototype.silence=function(){return e.silence(this.duration())},n.prototype.join=function(t){for(var e=new n,i=0;i<t.length;i++)t[i]instanceof n&&e.add_fragments(t[i].fragments);return e},n.prototype.getBuffer=function(){var t=44100;this.fragments.length>0&&(t=this.fragments[0].samplerate);var e=new r(this,t),n=this.duration()*t|0;return{samplerate:t,buffer:e.fetch(n)}},i.prototype.duration=function(){return this._duration*(100/this.pitch)},i.prototype.original_duration=function(){return this._duration},i.prototype.isReversed=function(){return this.reverse},i.prototype.isStretched=function(){return this.stretched},i.prototype.create=function(t,e){var n=this.duration();if(t>=n)return[null,t-n,e];var i,r=t+e>=n;r?(i=n-t,e-=i):(i=e,e=0);var s=this.clone();return s.start=this.start+t*this.pitch*.01,s._duration=i*this.pitch*.01,s.reverse=!1,[s,0,e]},i.prototype.clone=function(){var t=new i;return t.buffer=this.buffer,t.samplerate=this.samplerate,t.start=this.start,t._duration=this._duration,t.reverse=this.reverse,t.pitch=this.pitch,t.stretch=this.stretch,t.pan=this.pan,t},e.Fragment=i,e.TapeStream=r,r.prototype.reset=function(){return this.isEnded=!1,this.buffer=null,this.bufferIndex=0,this.bufferIndexIncr=0,this.bufferBeginIndex=0,this.bufferEndIndex=0,this.fragment=null,this.fragmentIndex=0,this.panL=.5,this.panR=.5,this.isLooped=!1,this},r.prototype.fetch=function(e){var n=new t.fn.SignalArray(e),i=new t.fn.SignalArray(e),r=this.fragments;if(0===r.length)return[n,i];for(var a,o=100*this.samplerate,u=this.buffer,c=this.bufferIndex,h=this.bufferIndexIncr,f=this.bufferBeginIndex,l=this.bufferEndIndex,p=this.fragment,d=this.fragmentIndex,v=this.panL,m=this.panR,g=0;e>g;g++){for(;!u||f>c||c>=l;)if(!p||d<r.length)p=r[d++],u=p.buffer,h=p.samplerate/o*p.pitch,f=p.start*p.samplerate,l=f+p.original_duration()*p.samplerate,a=.01*p.pan,v=1-a,m=a,p.reverse?(h*=-1,c=l+h):c=f;else{if(!this.isLooped){this.isEnded=!0,u=s,h=0,c=0;break}u=null,c=0,h=0,f=0,l=0,p=null,d=0}n[g]=u[0|c]*v,i[g]=u[0|c]*m,c+=h}return this.buffer=u,this.bufferIndex=c,this.bufferIndexIncr=h,this.bufferBeginIndex=f,this.bufferEndIndex=l,this.fragment=p,this.fragmentIndex=d,this.panL=v,this.panR=m,[n,i]},t.modules.Scissor=e}(timbre),function(t){"use strict";function e(e){this.samplerate=e;var n=Math.ceil(Math.log(1.5*e)*Math.LOG2E);this.buffersize=1<<n,this.buffermask=this.buffersize-1,this.writeBufferL=new t.fn.SignalArray(this.buffersize),this.writeBufferR=new t.fn.SignalArray(this.buffersize),this.readBufferL=this.writeBufferL,this.readBufferR=this.writeBufferR,this.delaytime=null,this.feedback=null,this.cross=null,this.mix=null,this.prevL=0,this.prevR=0,this.readIndex=0,this.writeIndex=0,this.setParams(125,.25,!1,.45)}var n=e.prototype;n.setParams=function(t,e,n,i){if(this.delaytime!==t){this.delaytime=t;var r=.001*t*this.samplerate|0;r>this.buffermask&&(r=this.buffermask),this.writeIndex=this.readIndex+r&this.buffermask}this.feedback!==e&&(this.feedback=e),this.cross!==n&&(this.cross=n,n?(this.readBufferL=this.writeBufferR,this.readBufferR=this.writeBufferL):(this.readBufferL=this.writeBufferL,this.readBufferR=this.writeBufferR)),this.mix!==i&&(this.mix=i)},n.process=function(t,e){var n,i,r=this.readBufferL,s=this.readBufferR,a=this.writeBufferL,o=this.writeBufferR,u=this.readIndex,c=this.writeIndex,h=this.buffermask,f=this.feedback,l=this.mix,p=1-l,d=this.prevL,v=this.prevR,m=t.length;for(i=0;m>i;++i)n=r[u],a[c]=t[i]-n*f,t[i]=d=.5*(t[i]*p+n*l+d),n=s[u],o[c]=e[i]-n*f,e[i]=v=.5*(e[i]*p+n*l+v),u+=1,c=c+1&h;this.readIndex=u&this.buffermask,this.writeIndex=c,this.prevL=d,this.prevR=v},t.modules.StereoDelay=e}(timbre),function(t){"use strict";var e=t.fn,n=t.modules;e.register("audio",function(t){var n=e.getClass("buffer"),s=new n(t);return s.playbackState=e.FINISHED_STATE,s._.isLoaded=!1,Object.defineProperties(s,{isLoaded:{get:function(){return this._.isLoaded}}}),s.load=i,s.loadthis=r,s});var i=function(i){var r=this,s=this._,a=new n.Deferred(this),o=arguments,u=1;a.done(function(){r._.emit("done")}),"function"==typeof o[u]&&(a.done(o[u++]),"function"==typeof o[u]&&a.fail(o[u++])),s.loadedTime=0;var c=function(n,i){var s=r._;n?(r.playbackState=e.PLAYING_STATE,s.samplerate=n.samplerate,s.channels=n.channels,s.bufferMix=null,s.buffer=n.buffer,s.phase=0,s.phaseIncr=n.samplerate/t.samplerate,s.duration=1e3*n.duration,s.currentTime=0,s.isReversed&&(s.phaseIncr*=-1,s.phase=n.buffer[0].length+s.phaseIncr),r._.emit("loadedmetadata")):a.reject(i)},h=function(){r._.isLoaded=!0,r._.plotFlush=!0,r._.emit("loadeddata"),a.resolveWith(r)};return(new n.Decoder).decode(i,c,h),a.promise()},r=function(){return i.apply(this,arguments),this}}(timbre),function(t){"use strict";function e(e){t.Object.call(this,2,e),n.fixAR(this);var i=this._;i.biquad=new r(i.samplerate),i.freq=t(340),i.band=t(1),i.gain=t(0),i.plotBefore=a,i.plotRange=[-18,18],i.plotFlush=!0}var n=t.fn,i=t.modules.FFT,r=t.modules.Biquad,s=20;n.extend(e);var a=function(t,e,n,i,r){t.lineWidth=1,t.strokeStyle="rgb(192, 192, 192)";for(var a=.5*this._.samplerate,o=1;10>=o;++o)for(var u=1;4>=u;u++){var c=o*Math.pow(10,u);if(!(s>=c||c>=a)){t.beginPath();var h=Math.log(c/s)/Math.log(a/s);h=(h*i+e|0)+.5,t.moveTo(h,n),t.lineTo(h,n+r),t.stroke()}}var f=r/6;for(o=1;6>o;o++){t.beginPath();var l=(n+o*f|0)+.5;t.moveTo(e,l),t.lineTo(e+i,l),t.stroke()}},o=e.prototype;Object.defineProperties(o,{type:{set:function(t){var e=this._;t!==e.biquad.type&&(e.biquad.setType(t),e.plotFlush=!0)},get:function(){return this._.biquad.type}},freq:{set:function(e){this._.freq=t(e)},get:function(){return this._.freq}},cutoff:{set:function(e){this._.freq=t(e)},get:function(){return this._.freq}},res:{set:function(e){this._.band=t(e)},get:function(){return this._.band}},Q:{set:function(e){this._.band=t(e)},get:function(){return this._.band}},band:{set:function(e){this._.band=t(e)},get:function(){return this._.band}},gain:{set:function(e){this._.gain=t(e)},get:function(){return this._.gain}}}),o.process=function(t){var e=this._;if(this.tickID!==t){this.tickID=t,n.inputSignalAR(this);var i=e.freq.process(t).cells[0][0],r=e.band.process(t).cells[0][0],s=e.gain.process(t).cells[0][0];(e.prevFreq!==i||e.prevband!==r||e.prevGain!==s)&&(e.prevFreq=i,e.prevband=r,e.prevGain=s,e.biquad.setParams(i,r,s),e.plotFlush=!0),e.bypassed||e.biquad.process(this.cells[1],this.cells[2]),n.outputSignalAR(this)}return this};var u=new i(2048),c=t.Object.prototype.plot;o.plot=function(t){if(this._.plotFlush){var e=new r(this._.samplerate);e.setType(this.type),e.setParams(this.freq.valueOf(),this.band.valueOf(),this.gain.valueOf());var n=new Float32Array(u.length);n[0]=1,e.process(n,n),u.forward(n);var i,a,o,h,f,l,p,d,v=512,m=new Float32Array(v),g=.5*this._.samplerate,b=new Float32Array(v);for(u.getFrequencyData(b),i=0;v>i;++i)o=Math.pow(g/s,i/v)*s,a=o/(g/b.length),h=0|a,f=a-h,0===h?p=l=d=b[h]:(l=b[h-1],p=b[h],d=(1-f)*l+f*p),m[i]=d;this._.plotData=m,this._.plotFlush=null}return c.call(this,t)},n.register("biquad",e),n.register("lowpass",function(t){return new e(t).set("type","lowpass")}),n.register("highpass",function(t){return new e(t).set("type","highpass")}),n.register("bandpass",function(t){return new e(t).set("type","bandpass")}),n.register("lowshelf",function(t){return new e(t).set("type","lowshelf")}),n.register("highshelf",function(t){return new e(t).set("type","highshelf")}),n.register("peaking",function(t){return new e(t).set("type","peaking")}),n.register("notch",function(t){return new e(t).set("type","notch")}),n.register("allpass",function(t){return new e(t).set("type","allpass")}),n.alias("lpf","lowpass"),n.alias("hpf","highpass"),n.alias("bpf","bandpass"),n.alias("bef","notch"),n.alias("brf","notch"),n.alias("apf","allpass")}(timbre),function(t){"use strict";function e(e){t.Object.call(this,1,e),n.fixAR(this);var i=this._;i.pitch=t(1),i.samplerate=44100,i.channels=0,i.bufferMix=null,i.buffer=[],i.isLooped=!1,i.isReversed=!1,i.duration=0,i.currentTime=0,i.currentTimeObj=null,i.phase=0,i.phaseIncr=0,i.onended=n.make_onended(this,0),i.onlooped=s(this)}var n=t.fn,i=t.modules.Scissor.Tape,r=function(t){return n.isSignalArray(t)||t instanceof Float32Array};n.extend(e);var s=function(t){return function(){var e=t._;e.phase>=e.buffer[0].length?e.phase=0:e.phase<0&&(e.phase=e.buffer[0].length+e.phaseIncr),t._.emit("looped")}},a=e.prototype,o=function(e){var n=this._;if("object"==typeof e){var s,a,o=[];r(e)?(o[0]=e,a=1):"object"==typeof e&&(e instanceof t.Object?e=e.buffer:e instanceof i&&(e=e.getBuffer()),Array.isArray(e.buffer)?r(e.buffer[0])&&(r(e.buffer[1])&&r(e.buffer[2])?(a=2,o=e.buffer):(a=1,o=[e.buffer[0]])):r(e.buffer)&&(a=1,o=[e.buffer]),"number"==typeof e.samplerate&&(s=e.samplerate)),o.length&&(s>0&&(n.samplerate=e.samplerate),n.bufferMix=null,n.buffer=o,n.phase=0,n.phaseIncr=n.samplerate/t.samplerate,n.duration=1e3*n.buffer[0].length/n.samplerate,n.currentTime=0,n.plotFlush=!0,this.reverse(n.isReversed))}};Object.defineProperties(a,{buffer:{set:o,get:function(){var t=this._;return{samplerate:t.samplerate,channels:t.channels,buffer:t.buffer}}},pitch:{set:function(e){this._.pitch=t(e)},get:function(){return this._.pitch}},isLooped:{get:function(){return this._.isLooped}},isReversed:{get:function(){return this._.isReversed}},samplerate:{get:function(){return this._.samplerate}},duration:{get:function(){return this._.duration}},currentTime:{set:function(e){if("number"==typeof e){var n=this._;e>=0&&e<=n.duration&&(n.phase=e/1e3*n.samplerate,n.currentTime=e)}else e instanceof t.Object?this._.currentTimeObj=e:null===e&&(this._.currentTimeObj=null)},get:function(){return this._.currentTimeObj?this._.currentTimeObj:this._.currentTime}}}),a.clone=function(){var t=this._,e=n.clone(this);return t.buffer.length&&o.call(e,{buffer:t.buffer,samplerate:t.samplerate,channels:t.channels}),e.loop(t.isLooped),e.reverse(t.isReversed),e},a.slice=function(e,i){var r=this._,s=t(r.originkey),a=r.isReversed;if(r.buffer.length){if(e="number"==typeof e?.001*e*r.samplerate|0:0,i="number"==typeof i?.001*i*r.samplerate|0:r.buffer[0].length,e>i){var u=e;e=i,i=u,a=!a}2===r.channels?o.call(s,{buffer:[n.pointer(r.buffer[0],e,i-e),n.pointer(r.buffer[1],e,i-e),n.pointer(r.buffer[2],e,i-e)],samplerate:r.samplerate}):o.call(s,{buffer:n.pointer(r.buffer[0],e,i-e),samplerate:r.samplerate}),s.playbackState=n.PLAYING_STATE}return s.loop(r.isLooped),s.reverse(r.isReversed),s},a.reverse=function(t){var e=this._;return e.isReversed=!!t,e.isReversed?(e.phaseIncr>0&&(e.phaseIncr*=-1),0===e.phase&&e.buffer.length&&(e.phase=e.buffer[0].length+e.phaseIncr)):e.phaseIncr<0&&(e.phaseIncr*=-1),this},a.loop=function(t){return this._.isLooped=!!t,this},a.bang=function(t){return this.playbackState=t===!1?n.FINISHED_STATE:n.PLAYING_STATE,this._.phase=0,this._.emit("bang"),this},a.process=function(t){var e=this._;if(!e.buffer.length)return this;if(this.tickID!==t){this.tickID=t;var i,r,s,a=this.cells[1],o=this.cells[2],u=e.phase,c=e.cellsize;if(2===e.channels?(r=e.buffer[1],s=e.buffer[2]):r=s=e.buffer[0],e.currentTimeObj){var h,f=e.currentTimeObj.process(t).cells[0],l=.001*e.samplerate;for(i=0;c>i;++i)h=f[i],u=h*l,a[i]=r[0|u]||0,o[i]=s[0|u]||0;e.phase=u,e.currentTime=h}else{var p=e.pitch.process(t).cells[0][0],d=e.phaseIncr*p;for(i=0;c>i;++i)a[i]=r[0|u]||0,o[i]=s[0|u]||0,u+=d;u>=r.length?n.nextTick(e.isLooped?e.onlooped:e.onended):0>u&&n.nextTick(e.isLooped?e.onlooped:e.onended),e.phase=u,e.currentTime+=n.currentTimeIncr}n.outputSignalAR(this)}return this};var u=t.Object.prototype.plot;a.plot=function(t){var e,n,i=this._;if(i.plotFlush){2===i.channels?(e=i.buffer[1],n=i.buffer[2]):e=n=i.buffer[0];for(var r=new Float32Array(2048),s=0,a=e.length/2048,o=0;2048>o;o++)r[o]=.5*(e[0|s]+n[0|s]),s+=a;i.plotData=r,i.plotFlush=null}return u.call(this,t)},n.register("buffer",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,2,e),n.fixAR(this);var r=new i(this._.samplerate);r.setDelayTime(20),r.setRate(4),r.depth=20,r.feedback=.2,r.mix=.33,this._.chorus=r}var n=t.fn,i=t.modules.Chorus;n.extend(e);var r=e.prototype;Object.defineProperties(r,{type:{set:function(t){this._.chorus.setDelayTime(t)},get:function(){return this._.chorus.wave}},delay:{set:function(t){t>=.5&&80>=t&&this._.chorus.setDelayTime(t)},get:function(){return this._.chorus.delayTime}},rate:{set:function(t){"number"==typeof t&&t>0&&this._.chorus.setRate(t)},get:function(){return this._.chorus.rate}},depth:{set:function(t){"number"==typeof t&&t>=0&&100>=t&&(t*=this._.samplerate/44100,this._.chorus.depth=t)},get:function(){return this._.chorus.depth}},fb:{set:function(t){"number"==typeof t&&t>=-1&&1>=t&&(this._.chorus.feedback=.99996*t)},get:function(){return this._.chorus.feedback}},mix:{set:function(e){this._.mix=t(e)},get:function(){return this._.mix}}}),r.process=function(t){var e=this._;return this.tickID!==t&&(this.tickID=t,n.inputSignalAR(this),e.bypassed||e.chorus.process(this.cells[1],this.cells[2]),n.outputSignalAR(this)),this},n.register("chorus",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,2,e);var n=this._;n.min=-.8,n.max=.8}var n=t.fn;n.extend(e);var i=e.prototype;Object.defineProperties(i,{minmax:{set:function(t){var e=this._;"number"==typeof t&&(e.min=-Math.abs(t),e.max=-e.min)},get:function(){return this._.max}},min:{set:function(t){var e=this._;"number"==typeof t&&(e.max<t?e.max=t:e.min=t)},get:function(){return this._.min}},max:{set:function(t){var e=this._;"number"==typeof t&&(t<e.min?e.min=t:e.max=t)},get:function(){return this._.max}}}),i.process=function(t){var e=this._;if(this.tickID!==t){this.tickID=t;var i,r,s=this.cells[1],a=this.cells[2],o=s.length,u=e.min,c=e.max;if(e.ar){for(n.inputSignalAR(this),i=0;o>i;++i)r=s[i],u>r?r=u:r>c&&(r=c),s[i]=r,r=a[i],u>r?r=u:r>c&&(r=c),a[i]=r;n.outputSignalAR(this)}else r=n.inputSignalKR(this),u>r?r=u:r>c&&(r=c),this.cells[0][0]=r,n.outputSignalKR(this)}return this},n.register("clip",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,2,e),n.fixAR(this);var i=this._;i.prevThresh=-24,i.prevKnee=30,i.prevRatio=12,i.thresh=t(i.prevThresh),i.knee=t(i.prevKnee),i.ratio=t(i.prevRatio),i.postGain=6,i.reduction=0,i.attack=3,i.release=25,i.comp=new r(i.samplerate),i.comp.dbPostGain=i.postGain,i.comp.setAttackTime(.001*i.attack),i.comp.setReleaseTime(.001*i.release),i.comp.setPreDelayTime(6),i.comp.setParams(i.prevThresh,i.prevKnee,i.prevRatio)}var n=t.fn,i=t.timevalue,r=t.modules.Compressor;n.extend(e);var s=e.prototype;Object.defineProperties(s,{thresh:{set:function(e){this._.thresh=t(e)},get:function(){return this._.thresh}},thre:{set:function(e){this._.thresh=t(e)},get:function(){return this._.thre}},knee:{set:function(e){this._.kne=t(e)},get:function(){return this._.knee}},ratio:{set:function(e){this._.ratio=t(e)},get:function(){return this._.ratio}},gain:{set:function(t){"number"==typeof t&&(this._.comp.dbPostGain=t)},get:function(){return this._.comp.dbPostGain}},attack:{set:function(t){"string"==typeof t&&(t=i(t)),"number"==typeof t&&(t=0>t?0:t>1e3?1e3:t,this._.attack=t,this._.comp.setAttackTime(.001*t))},get:function(){return this._.attack}},release:{set:function(t){"string"==typeof t&&(t=i(t)),"number"==typeof t&&(t=0>t?0:t>1e3?1e3:t,this._.release=t,this._.comp.setReleaseTime(.001*t))},get:function(){return this._.release}},reduction:{get:function(){return this._.reduction}}}),s.process=function(t){var e=this._;if(this.tickID!==t){this.tickID=t,n.inputSignalAR(this);var i=e.thresh.process(t).cells[0][0],r=e.knee.process(t).cells[0][0],s=e.ratio.process(t).cells[0][0];(e.prevThresh!==i||e.prevKnee!==r||e.prevRatio!==s)&&(e.prevThresh=i,e.prevKnee=r,e.prevRatio=s,e.comp.setParams(i,r,s)),e.bypassed||(e.comp.process(this.cells[1],this.cells[2]),e.reduction=e.comp.meteringGain),n.outputSignalAR(this)}return this},n.register("comp",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,2,e),n.fixAR(this);var i=this._;i.time=t(100),i.fb=t(.2),i.cross=t(!1),i.mix=.33,i.delay=new r(i.samplerate)}var n=t.fn,i=t.timevalue,r=t.modules.StereoDelay;n.extend(e);var s=e.prototype;Object.defineProperties(s,{time:{set:function(e){"string"==typeof e&&(e=i(e)),this._.time=t(e)},get:function(){return this._.time}},fb:{set:function(e){this._.fb=t(e)},get:function(){return this._.fb}},cross:{set:function(e){this._.cross=t(e)},get:function(){return this._.cross}},mix:{set:function(t){"number"==typeof t&&(t=t>1?1:0>t?0:t,this._.mix=t)},get:function(){return this._.mix}}}),s.process=function(t){var e=this._;if(this.tickID!==t){this.tickID=t;var i=e.time.process(t).cells[0][0],r=e.fb.process(t).cells[0][0],s=0!==e.cross.process(t).cells[0][0],a=e.mix;(e.prevTime!==i||e.prevFb!==r||e.prevCross!==s||e.prevMix!==a)&&(e.prevTime=i,e.prevFb=r,e.prevCross=s,e.prevMix=a,e.delay.setParams(i,r,s,a)),n.inputSignalAR(this),e.bypassed||e.delay.process(this.cells[1],this.cells[2]),n.outputSignalAR(this)}return this},n.register("delay",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,2,e),n.fixAR(this);var i=this._;i.pre=t(60),i.post=t(-18),i.x1L=i.x2L=i.y1L=i.y2L=0,i.x1R=i.x2R=i.y1R=i.y2R=0,i.b0=i.b1=i.b2=i.a1=i.a2=0,i.cutoff=0,i.Q=1,i.preScale=0,i.postScale=0}var n=t.fn;n.extend(e);var i=e.prototype;Object.defineProperties(i,{cutoff:{set:function(t){"number"==typeof t&&t>0&&(this._.cutoff=t)},get:function(){return this._.cutoff}},pre:{set:function(e){this._.pre=t(e)},get:function(){return this._.pre}},post:{set:function(e){this._.post=t(e)},get:function(){return this._.post}}}),i.process=function(t){var e=this._;if(this.tickID!==t){this.tickID=t,n.inputSignalAR(this);var i=-e.pre.process(t).cells[0][0],s=-e.post.process(t).cells[0][0];if((e.prevPreGain!==i||e.prevPostGain!==s)&&(e.prevPreGain=i,e.prevPostGain=s,e.preScale=Math.pow(10,.05*-i),e.postScale=Math.pow(10,.05*-s)),!e.bypassed){var a,o,u,c,h,f=this.cells[1],l=this.cells[2],p=e.preScale,d=e.postScale;if(e.cutoff){e.prevCutoff!==e.cutoff&&(e.prevCutoff=e.cutoff,r(e));var v=e.x1L,m=e.x2L,g=e.y1L,b=e.y2L,y=e.x1R,_=e.x2R,w=e.y1R,S=e.y2R,I=e.b0,x=e.b1,k=e.b2,M=e.a1,A=e.a2;for(a=0,o=f.length;o>a;++a)c=f[a]*p,h=I*c+x*v+k*m-M*g-A*b,u=h*d,-1>u?u=-1:u>1&&(u=1),f[a]=u,m=v,v=c,b=g,g=h,c=l[a]*p,h=I*c+x*y+k*_-M*w-A*S,u=h*d,-1>u?u=-1:u>1&&(u=1),l[a]=u,_=y,y=c,S=w,w=h;e.x1L=v,e.x2L=m,e.y1L=g,e.y2L=b,e.x1R=y,e.x2R=_,e.y1R=w,e.y2R=S}else for(a=0,o=f.length;o>a;++a)u=f[a]*p*d,-1>u?u=-1:u>1&&(u=1),f[a]=u,u=l[a]*p*d,-1>u?u=-1:u>1&&(u=1),l[a]=u}n.outputSignalAR(this)}return this};var r=function(t){var e=2*Math.PI*t.cutoff/t.samplerate,n=Math.cos(e),i=Math.sin(e),r=i/(2*t.Q),s=1/(1+r);t.b0=.5*(1-n)*s,t.b1=1-n*s,t.b2=.5*(1-n)*s,t.a1=-2*n*s,t.a2=1-r*s};n.register("dist",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,2,e),this._.ar=!1}var n=t.fn;n.extend(e);var i=e.prototype;i.process=function(t){var e=this._;if(this.tickID!==t){this.tickID=t;var i,r,s,a,o,u,c=this.nodes,h=this.cells[0],f=this.cells[1],l=this.cells[2],p=c.length,d=h.length;if(e.ar){if(c.length>0)for(c[0].process(t),a=c[0].cells[1],o=c[0].cells[2],f.set(a),l.set(o),i=1;p>i;++i)for(c[i].process(t),a=c[i].cells[1],o=c[i].cells[2],r=0;d>r;++r)u=a[r],f[r]=0===u?0:f[r]/u,u=o[r],l[r]=0===u?0:l[r]/u;else for(r=0;d>r;++r)f[r]=l[i]=0;n.outputSignalAR(this)}else{if(c.length>0)for(s=c[0].process(t).cells[0][0],i=1;p>i;++i)u=c[i].process(t).cells[0][0],s=0===u?0:s/u;else s=0;h[0]=s,n.outputSignalKR(this)}}return this},n.register("/",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,2,e);var n=this._;n.env=new s(n.samplerate),n.env.setStep(n.cellsize),n.tmp=new i.SignalArray(n.cellsize),n.ar=!1,n.plotFlush=!0,n.onended=u(this),this.on("ar",o)}function n(t,e,n,i,r,s){var a=n;return"number"==typeof t[i]?a=t[i]:"number"==typeof t[r]?a=t[r]:s&&("string"==typeof t[i]?a=s(t[i]):"string"==typeof t[r]&&(a=s(t[r]))),e>a&&(a=e),a}var i=t.fn,r=t.timevalue,s=t.modules.Envelope,a=i.isDictionary;i.extend(e);var o=function(t){this._.env.setStep(t?1:this._.cellsize)},u=function(t){return function(){t._.emit("ended")}},c=e.prototype;Object.defineProperties(c,{table:{set:function(t){Array.isArray(t)&&(h.call(this,t),this._.plotFlush=!0)},get:function(){return this._.env.table}},curve:{set:function(t){this._.env.setCurve(t)},get:function(){return this._.env.curve}},releaseNode:{set:function(t){this._.env.setReleaseNode(t),this._.plotFlush=!0},get:function(){return this._.env.releaseNode+1}},loopNode:{set:function(t){this._.env.setLoopNode(t),this._.plotFlush=!0},get:function(){return this._.env.loopNode+1}}}),c.clone=function(){var t=i.clone(this);return t._.env=this._.env.clone(),t},c.reset=function(){return this._.env.reset(),this},c.release=function(){var t=this._;return t.env.release(),t.emit("released"),this},c.bang=function(){var t=this._;return t.env.reset(),t.env.status=s.StatusGate,t.emit("bang"),this},c.process=function(t){var e=this._;if(this.tickID!==t){this.tickID=t;var n,r=this.cells[1],s=this.cells[2],a=e.cellsize;if(this.nodes.length)i.inputSignalAR(this);else for(n=0;a>n;++n)r[n]=s[n]=1;var o,u=null;if(e.ar){var c=e.tmp;for(e.env.process(c),n=0;a>n;++n)r[n]*=c[n],s[n]*=c[n];u=e.env.emit}else{for(o=e.env.next(),n=0;a>n;++n)r[n]*=o,s[n]*=o;u=e.env.emit}i.outputSignalAR(this),u&&("ended"===u?i.nextTick(e.onended):this._.emit(u,e.value))}return this};var h=function(t){for(var e,n,i,a,o=this._.env,u=[t[0]||l],c=1,h=t.length;h>c;++c)e=t[c][0]||l,n=t[c][1],i=t[c][2],"number"!=typeof n&&(n="string"==typeof n?r(n):10),10>n&&(n=10),"number"==typeof i?(a=i,i=s.CurveTypeCurve):(i=s.CurveTypeDict[i]||null,a=0),u.push([e,n,i,a]);o.setTable(u)},f=t.Object.prototype.plot;c.plot=function(t){if(this._.plotFlush){var e,n,i=this._.env.clone(),r=i.getInfo(1e3),a=r.totalDuration,o=r.loopBeginTime,u=r.releaseBeginTime,c=new Float32Array(256),h=0,l=a/c.length,p=!1,d=.001*a*this._.samplerate|0;for(d/=c.length,i.setStep(d),i.status=s.StatusGate,e=0,n=c.length;n>e;++e)c[e]=i.next(),h+=l,!p&&h>=u&&(i.release(),p=!0);this._.plotData=c,this._.plotBefore=function(t,e,n,i,r){var s,c;1/0!==o&&1/0!==u&&(s=e+i*(o/a),c=e+i*(u/a),c-=s,t.fillStyle="rgba(224, 224, 224, 0.8)",t.fillRect(s,0,c,r)),1/0!==u&&(s=e+i*(u/a),c=i-s,t.fillStyle="rgba(212, 212, 212, 0.8)",t.fillRect(s,0,c,r))};var v=1/0,m=-1/0;for(e=0;n>e;++e)c[e]<v?v=c[e]:c[e]>m&&(m=c[e]);1>m&&(m=1),this._.plotRange=[v,m],this._.plotData=c,this._.plotFlush=null}return f.call(this,t)},i.register("env",e);var l=s.ZERO;i.register("perc",function(t){a(t[0])||t.unshift({});var i=t[0],s=n(i,10,10,"a","attackTime",r),o=n(i,10,1e3,"r","releaseTime",r),u=n(i,l,1,"lv","level");return i.table=[l,[u,s],[l,o]],new e(t)}),i.register("adsr",function(t){a(t[0])||t.unshift({});var i=t[0],s=n(i,10,10,"a","attackTime",r),o=n(i,10,300,"d","decayTime",r),u=n(i,l,.5,"s","sustainLevel"),c=n(i,10,1e3,"r","decayTime",r),h=n(i,l,1,"lv","level");return i.table=[l,[h,s],[u,o],[l,c]],i.releaseNode=3,new e(t)}),i.register("adshr",function(t){a(t[0])||t.unshift({});var i=t[0],s=n(i,10,10,"a","attackTime",r),o=n(i,10,300,"d","decayTime",r),u=n(i,l,.5,"s","sustainLevel"),c=n(i,10,500,"h","holdTime",r),h=n(i,10,1e3,"r","decayTime",r),f=n(i,l,1,"lv","level");return i.table=[l,[f,s],[u,o],[u,c],[l,h]],new e(t)}),i.register("asr",function(t){a(t[0])||t.unshift({});var i=t[0],s=n(i,10,10,"a","attackTime",r),o=n(i,l,.5,"s","sustainLevel"),u=n(i,10,1e3,"r","releaseTime",r);return i.table=[l,[o,s],[l,u]],i.releaseNode=2,new e(t)}),i.register("dadsr",function(t){a(t[0])||t.unshift({});var i=t[0],s=n(i,10,100,"dl","delayTime",r),o=n(i,10,10,"a","attackTime",r),u=n(i,10,300,"d","decayTime",r),c=n(i,l,.5,"s","sustainLevel"),h=n(i,10,1e3,"r","relaseTime",r),f=n(i,l,1,"lv","level");return i.table=[l,[l,s],[f,o],[c,u],[l,h]],i.releaseNode=4,new e(t)}),i.register("ahdsfr",function(t){a(t[0])||t.unshift({});var i=t[0],s=n(i,10,10,"a","attackTime",r),o=n(i,10,10,"h","holdTime",r),u=n(i,10,300,"d","decayTime",r),c=n(i,l,.5,"s","sustainLevel"),h=n(i,10,5e3,"f","fadeTime",r),f=n(i,10,1e3,"r","relaseTime",r),p=n(i,l,1,"lv","level");return i.table=[l,[p,s],[p,o],[c,u],[l,h],[l,f]],i.releaseNode=5,new e(t)}),i.register("linen",function(t){a(t[0])||t.unshift({});var i=t[0],s=n(i,10,10,"a","attackTime",r),o=n(i,10,1e3,"s","sustainTime",r),u=n(i,10,1e3,"r","releaseTime",r),c=n(i,l,1,"lv","level");return i.table=[l,[c,s],[c,o],[l,u]],new e(t)}),i.register("env.tri",function(t){a(t[0])||t.unshift({});var i=t[0],s=n(i,20,1e3,"dur","duration",r),o=n(i,l,1,"lv","level");return s*=.5,i.table=[l,[o,s],[l,s]],new e(t)}),i.register("env.cutoff",function(t){a(t[0])||t.unshift({});var i=t[0],s=n(i,10,100,"r","relaseTime",r),o=n(i,l,1,"lv","level");return i.table=[o,[l,s]],new e(t)})}(timbre),function(t){"use strict";function e(e){t.Object.call(this,2,e),n.fixAR(this);var i=this._;i.biquads=new Array(7),i.plotBefore=o,i.plotRange=[-18,18],i.plotFlush=!0}var n=t.fn,i=t.modules.FFT,r=t.modules.Biquad,s=20,a={hpf:0,lf:1,lmf:2,mf:3,hmf:4,hf:5,lpf:6};n.extend(e);var o=function(t,e,n,i,r){t.lineWidth=1,t.strokeStyle="rgb(192, 192, 192)";for(var a=.5*this._.samplerate,o=1;10>=o;++o)for(var u=1;4>=u;u++){var c=o*Math.pow(10,u);if(!(s>=c||c>=a)){t.beginPath();var h=Math.log(c/s)/Math.log(a/s);h=(h*i+e|0)+.5,t.moveTo(h,n),t.lineTo(h,n+r),t.stroke()}}var f=r/6;for(o=1;6>o;o++){t.beginPath();var l=(n+o*f|0)+.5;t.moveTo(e,l),t.lineTo(e+i,l),t.stroke()}},u=e.prototype;Object.defineProperties(u,{params:{set:function(t){if("object"==typeof t)for(var e=Object.keys(t),n=0,i=e.length;i>n;++n){var r=t[e[n]];Array.isArray(r)?this.setParams(e[n],r[0],r[1],r[2]):this.setParams(e[n])}}}}),u.setParams=function(t,e,n,i){var s=this._;if("string"==typeof t&&(t=a[t]),t>=0&&t<s.biquads.length){if(t|=0,"number"==typeof e&&"number"==typeof n){"number"!=typeof i&&(i=0);var o=s.biquads[t];if(!o)switch(o=s.biquads[t]=new r(s.samplerate),t){case 0:o.setType("highpass");break;case s.biquads.length-1:o.setType("lowpass");break;default:o.setType("peaking")}o.setParams(e,n,i)}else s.biquads[t]=void 0;s.plotFlush=!0}return this},u.getParams=function(t){var e=this._,n=e.biquads[0|t];return n?{freq:n.frequency,Q:n.Q,gain:n.gain}:void 0},u.process=function(t){var e=this._;if(this.tickID!==t){if(this.tickID=t,n.inputSignalAR(this),!e.bypassed)for(var i=this.cells[1],r=this.cells[2],s=e.biquads,a=0,o=s.length;o>a;++a)s[a]&&s[a].process(i,r);n.outputSignalAR(this)}return this};var c=new i(2048),h=t.Object.prototype.plot;u.plot=function(t){if(this._.plotFlush){var e=this._,n=new Float32Array(c.length);n[0]=1;for(var i=0,a=e.biquads.length;a>i;++i){var o=this.getParams(i);if(o){var u=new r(e.samplerate);u.setType(0===i?"highpass":i===a-1?"lowpass":"peaking"),u.setParams(o.freq,o.Q,o.gain),u.process(n,n)}}c.forward(n);var f,l,p,d,v,m,g,b=512,y=new Float32Array(b),_=.5*e.samplerate,w=new Float32Array(b);for(c.getFrequencyData(w),i=0;b>i;++i)l=Math.pow(_/s,i/b)*s,f=l/(_/w.length),p=0|f,d=f-p,0===p?m=v=g=w[p]:(v=w[p-1],m=w[p],g=(1-d)*v+d*m),y[i]=g;this._.plotData=y,this._.plotFlush=null}return h.call(this,t)},n.register("eq",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,2,e),n.listener(this),n.fixAR(this),this.real=new t.ChannelObject(this),this.imag=new t.ChannelObject(this),this.cells[3]=this.real.cell,this.cells[4]=this.imag.cell;var r=this._;r.fft=new i(2*r.cellsize),r.fftCell=new n.SignalArray(r.fft.length),r.prevCell=new n.SignalArray(r.cellsize),r.freqs=new n.SignalArray(r.fft.length>>1),r.plotFlush=!0,r.plotRange=[0,32],r.plotBarStyle=!0}var n=t.fn,i=t.modules.FFT;n.extend(e);var r=e.prototype;Object.defineProperties(r,{window:{set:function(t){this._.fft.setWindow(t)},get:function(){return this._.fft.windowName}},spectrum:{get:function(){return this._.fft.getFrequencyData(this._.freqs)}}}),r.process=function(t){var e=this._;if(this.tickID!==t){this.tickID=t,n.inputSignalAR(this),n.outputSignalAR(this);var i=this.cells[0],r=e.cellsize;e.fftCell.set(e.prevCell),e.fftCell.set(i,r),e.fft.forward(e.fftCell),e.prevCell.set(i),e.plotFlush=!0,this.cells[3].set(e.fft.real.subarray(0,r)),this.cells[4].set(e.fft.imag.subarray(0,r))}return this};var s=t.Object.prototype.plot;r.plot=function(t){return this._.plotFlush&&(this._.plotData=this.spectrum,this._.plotFlush=null),s.call(this,t)},n.register("fft",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,1,e),n.fixAR(this);var i=this._;i.freq=t(440),i.reg=32768,i.shortFlag=!1,i.phase=0,i.lastValue=0}var n=t.fn;n.extend(e);var i=e.prototype;Object.defineProperties(i,{shortFlag:{set:function(t){this._.shortFlag=!!t},get:function(){
return this._.shortFlag}},freq:{set:function(e){this._.freq=t(e)},get:function(){return this._.freq}}}),i.process=function(t){var e=this._,n=this.cells[0];if(this.tickID!==t){this.tickID=t;var i,r,s=e.lastValue,a=e.phase,o=e.freq.process(t).cells[0][0]/e.samplerate,u=e.reg,c=e.mul,h=e.add;if(e.shortFlag)for(i=0,r=n.length;r>i;++i)a>=1&&(u>>=1,u|=(1&(u^u>>6))<<15,s=(1&u)-.5,a-=1),n[i]=s*c+h,a+=o;else for(i=0,r=n.length;r>i;++i)a>=1&&(u>>=1,u|=(1&(u^u>>1))<<15,s=(1&u)-.5,a-=1),n[i]=s*c+h,a+=o;e.reg=u,e.phase=a,e.lastValue=s}return this},n.register("fnoise",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,2,e),n.fixAR(this),this._.selected=0,this._.outputs=[]}var n=t.fn,i=function(){function e(e){t.Object.call(this,2,[]),n.fixAR(this),this._.parent=e}return n.extend(e),e.prototype.process=function(t){return this.tickID!==t&&(this.tickID=t,this._.parent.process(t)),this},e}();n.extend(e);var r=e.prototype;Object.defineProperties(r,{selected:{set:function(t){var e=this._;if("number"==typeof t){e.selected=t;for(var i=e.outputs,r=0,s=i.length;s>r;++r)i[r]&&(i[r].cells[0].set(n.emptycell),i[r].cells[1].set(n.emptycell),i[r].cells[2].set(n.emptycell))}},get:function(){return this._.selected}}}),r.at=function(t){var e=this._,n=e.outputs[t];return n||(e.outputs[t]=n=new i(this)),n},r.process=function(t){var e=this._;if(this.tickID!==t){this.tickID=t,n.inputSignalAR(this),n.outputSignalAR(this);var i=e.outputs[e.selected];i&&(i.cells[0].set(this.cells[0]),i.cells[1].set(this.cells[1]),i.cells[2].set(this.cells[2]))}return this},n.register("gate",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,1,e),n.fixAR(this);var r=this._;r.fft=new i(2*r.cellsize),r.fftCell=new n.SignalArray(this._.fft.length),r.realBuffer=new n.SignalArray(this._.fft.length),r.imagBuffer=new n.SignalArray(this._.fft.length)}var n=t.fn,i=t.modules.FFT;n.extend(e);var r=e.prototype;Object.defineProperties(r,{real:{set:function(e){this._.real=t(e)},get:function(){return this._.real}},imag:{set:function(e){this._.imag=t(e)},get:function(){return this._.imag}}}),r.process=function(t){var e=this._;if(this.tickID!==t&&(this.tickID=t,e.real&&e.imag)){var i=this.cells[0],r=e.realBuffer,s=e.imagBuffer,a=e.real.process(t).cells[0],o=e.imag.process(t).cells[0];r.set(a),s.set(o),i.set(e.fft.inverse(r,s).subarray(0,e.cellsize)),n.outputSignalAR(this)}return this},n.register("ifft",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,1,e),n.timer(this),n.fixKR(this);var i=this._;i.interval=t(1e3),i.count=0,i.delay=0,i.timeout=1/0,i.currentTime=0,i.delaySamples=0,i.countSamples=0,i.onended=n.make_onended(this),this.on("start",r)}var n=t.fn,i=t.timevalue;n.extend(e);var r=function(){var t=this._;this.playbackState=n.PLAYING_STATE,t.delaySamples=.001*t.samplerate*t.delay|0,t.countSamples=t.count=t.currentTime=0};Object.defineProperty(r,"unremovable",{value:!0,writable:!1});var s=e.prototype;Object.defineProperties(s,{interval:{set:function(e){"string"==typeof e&&(e=i(e),0>=e&&(e=0)),this._.interval=t(e)},get:function(){return this._.interval}},delay:{set:function(t){"string"==typeof t&&(t=i(t)),"number"==typeof t&&t>=0&&(this._.delay=t,this._.delaySamples=.001*this._.samplerate*t|0)},get:function(){return this._.delay}},count:{set:function(t){"number"==typeof t&&(this._.count=t)},get:function(){return this._.count}},timeout:{set:function(t){"string"==typeof t&&(t=i(t)),"number"==typeof t&&t>=0&&(this._.timeout=t)},get:function(){return this._.timeout}},currentTime:{get:function(){return this._.currentTime}}}),s.bang=function(){var t=this._;return this.playbackState=n.PLAYING_STATE,t.delaySamples=.001*t.samplerate*t.delay|0,t.countSamples=t.count=t.currentTime=0,t.emit("bang"),this},s.process=function(t){var e=this.cells[0],i=this._;if(this.tickID!==t){this.tickID=t,i.delaySamples>0&&(i.delaySamples-=e.length);var r=i.interval.process(t).cells[0][0];if(i.delaySamples<=0&&(i.countSamples-=e.length,i.countSamples<=0)){i.countSamples+=i.samplerate*r*.001|0;for(var s=this.nodes,a=i.count,o=a*i.mul+i.add,u=0,c=e.length;c>u;++u)e[u]=o;for(var h=0,f=s.length;f>h;++h)s[h].bang(a);i.count+=1}i.currentTime+=n.currentTimeIncr,i.currentTime>=i.timeout&&n.nextTick(i.onended)}return this},n.register("interval",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,1,e),n.fixAR(this);var i=this._,r=Math.ceil(Math.log(i.samplerate)*Math.LOG2E);i.buffersize=1<<r,i.buffermask=i.buffersize-1,i.buffer=new n.SignalArray(i.buffersize),i.time=0,i.readIndex=0,i.writeIndex=0}var n=t.fn,i=t.timevalue;n.extend(e);var r=e.prototype;Object.defineProperties(r,{time:{set:function(t){if("string"==typeof t&&(t=i(t)),"number"==typeof t&&t>0){var e=this._;e.time=t;var n=.001*t*e.samplerate|0;n>e.buffermask&&(n=e.buffermask),e.writeIndex=e.readIndex+n&e.buffermask}},get:function(){return this._.time}}}),r.process=function(t){var e=this._;if(this.tickID!==t){this.tickID=t,n.inputSignalAR(this);var i,r=this.cells[0],s=e.buffer,a=e.buffermask,o=e.readIndex,u=e.writeIndex,c=r.length;for(i=0;c>i;++i)s[u]=r[i],r[i]=s[o],o+=1,u=u+1&a;e.readIndex=o&a,e.writeIndex=u,n.outputSignalAR(this)}return this},n.register("lag",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,1,e);var n=this._;n.input=0,n.value=0,n.prev=null,n.ar=!1,n.map=i}var n=t.fn;n.extend(e);var i=function(t){return t},r=e.prototype;Object.defineProperties(r,{input:{set:function(t){"number"==typeof t&&(this._.input=t)},get:function(){return this._.input}},map:{set:function(t){"function"==typeof t&&(this._.map=t)},get:function(){return this._.map}}}),r.bang=function(){return this._.prev=null,this._.emit("bang"),this},r.at=function(t){return this._.map?this._.map(t):0},r.process=function(t){var e=this.cells[0],i=this._;if(this.tickID!==t){this.tickID=t;var r,s=this.nodes.length,a=e.length;if(i.ar&&s){n.inputSignalAR(this);var o=i.map;if(o)for(r=0;a>r;++r)e[r]=o(e[r]);i.value=e[a-1],n.outputSignalAR(this)}else{var u=s?n.inputSignalKR(this):i.input;i.map&&i.prev!==u&&(i.prev=u,i.value=i.map(u));var c=i.value*i.mul+i.add;for(r=0;a>r;++r)e[r]=c}}return this},n.register("map",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,1,e)}var n=t.fn;n.extend(e);var i=e.prototype;i.process=function(t){var e=this.cells[0],i=this._;if(this.tickID!==t){this.tickID=t;var r,s,a,o,u=this.nodes,c=u.length,h=e.length;if(i.ar){if(u.length>0)for(a=u[0].process(t).cells[0],e.set(a),r=1;c>r;++r)for(a=u[r].process(t).cells[0],s=0;h>s;++s)o=a[s],e[s]<o&&(e[s]=o);else for(s=0;h>s;++s)e[s]=0;n.outputSignalAR(this)}else{if(u.length>0)for(a=u[0].process(t).cells[0][0],r=1;c>r;++r)o=u[r].process(t).cells[0][0],o>a&&(a=o);else a=0;e[0]=a,n.outputSignalKR(this)}}return this},n.register("max",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,2,e),n.fixAR(this);var r=this._;r.src=r.func=null,r.bufferL=new n.SignalArray(i),r.bufferR=new n.SignalArray(i),r.readIndex=0,r.writeIndex=0,r.totalRead=0,r.totalWrite=0}if("browser"===t.envtype){var n=t.fn,i=4096,r=i-1;n.extend(e);var s=e.prototype;s.listen=function(e){var n=a[t.env];n&&(n.set.call(this,e),n.listen.call(this))},s.unlisten=function(){var e=a[t.env];e&&e.unlisten.call(this),this.cells[0].set(n.emptycell),this.cells[1].set(n.emptycell),this.cells[2].set(n.emptycell);for(var i=this._,r=i.bufferL,s=i.bufferR,o=0,u=r.length;u>o;++o)r[o]=s[o]=0},s.process=function(t){var e=this._;if(null===e.src)return this;if(this.tickID!==t){this.tickID=t;var i=e.cellsize;if(e.totalWrite>e.totalRead+i){var s=e.readIndex,a=s+i;this.cells[1].set(e.bufferL.subarray(s,a)),this.cells[2].set(e.bufferR.subarray(s,a)),e.readIndex=a&r,e.totalRead+=i}n.outputSignalAR(this)}return this};var a={};a.webkit={set:function(t){var e=this._;if(t instanceof HTMLMediaElement){var i=n._audioContext;e.src=i.createMediaElementSource(t)}},listen:function(){var t=this._,e=n._audioContext;t.gain=e.createGainNode(),t.gain.gain.value=0,t.node=e.createJavaScriptNode(1024,2,2),t.node.onaudioprocess=o(this),t.src.connect(t.node),t.node.connect(t.gain),t.gain.connect(e.destination)},unlisten:function(){var t=this._;t.src&&t.src.disconnect(),t.gain&&t.gain.disconnect(),t.node&&t.node.disconnect()}};var o=function(t){return function(e){var n=t._,i=e.inputBuffer,s=i.length,a=n.writeIndex;n.bufferL.set(i.getChannelData(0),a),n.bufferR.set(i.getChannelData(1),a),n.writeIndex=a+s&r,n.totalWrite+=s}};a.moz={set:function(t){var e=this._;t instanceof HTMLAudioElement&&(e.src=t,e.istep=e.samplerate/t.mozSampleRate)},listen:function(){var t=this._,e=t.bufferL,n=t.bufferR,i=0,s=0;2===t.src.mozChannels?(t.x=0,t.func=function(a){var o,u,c=t.writeIndex,h=t.totalWrite,f=a.frameBuffer,l=t.istep,p=f.length;for(o=t.x,u=0;p>u;u+=2){for(o+=l;o>0;)e[c]=.5*(f[u]+i),n[c]=.5*(f[u+1]+s),c=c+1&r,++h,o-=1;i=f[u],s=f[u+1]}t.x=o,t.writeIndex=c,t.totalWrite=h}):(t.x=0,t.func=function(s){var a,o,u=t.writeIndex,c=t.totalWrite,h=s.frameBuffer,f=t.istep,l=h.length;for(a=t.x,o=0;l>o;++o){for(a+=f;a>=0;)e[u]=n[u]=.5*(h[o]+i),u=u+1&r,++c,a-=1;i=h[o]}t.x=a,t.writeIndex=u,t.totalWrite=c}),t.src.addEventListener("MozAudioAvailable",t.func)},unlisten:function(){var t=this._;t.func&&(t.src.removeEventListener("MozAudioAvailable",t.func),t.func=null)}},n.register("mediastream",e)}}(timbre),function(t){"use strict";function e(e){t.Object.call(this,1,e);var n=this._;n.midi=0,n.value=0,n.prev=null,n.a4=440,n.ar=!1}var n=t.fn;n.extend(e);var i=e.prototype;Object.defineProperties(i,{midi:{set:function(t){"number"==typeof t&&(this._.midi=t)},get:function(){return this._.midi}},a4:{set:function(t){"number"==typeof t&&(this._.a4=t,this._.prev=null)},get:function(){return this._.a4}}}),i.bang=function(){return this._.prev=null,this._.emit("bang"),this},i.at=function(t){var e=this._;return e.a4*Math.pow(2,(t-69)/12)},i.process=function(t){var e=this._;if(this.tickID!==t){this.tickID=t;var i,r=this.cells[0],s=this.nodes.length,a=r.length;if(e.ar&&s){n.inputSignalAR(this);var o=e.a4;for(i=0;a>i;++i)r[i]=o*Math.pow(2,(r[i]-69)/12);e.value=r[a-1],n.outputSignalAR(this)}else{var u=s?n.inputSignalKR(this):e.midi;e.prev!==u&&(e.prev=u,e.value=e.a4*Math.pow(2,(u-69)/12)),r[0]=e.value,n.outputSignalKR(this)}}return this},n.register("midicps",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,1,e);var n=this._;n.midi=0,n.value=0,n.prev=null,n.range=12,n.ar=!1}var n=t.fn;n.extend(e);var i=e.prototype;Object.defineProperties(i,{midi:{set:function(t){"number"==typeof t&&(this._.midi=t)},get:function(){return this._.midi}},range:{set:function(t){"number"==typeof t&&t>0&&(this._.range=t)},get:function(){return this._.range}}}),i.bang=function(){return this._.prev=null,this._.emit("bang"),this},i.at=function(t){var e=this._;return Math.pow(2,t/e.range)},i.process=function(t){var e=this.cells[0],i=this._;if(this.tickID!==t){this.tickID=t;var r,s=this.nodes.length,a=e.length;if(i.ar&&s){n.inputSignalAR(this);var o=i.range;for(r=0;a>r;++r)e[r]=Math.pow(2,e[r]/o);i.value=e[a-1],n.outputSignalAR(this)}else{var u=this.nodes.length?n.inputSignalKR(this):i.midi;i.prev!==u&&(i.prev=u,i.value=Math.pow(2,u/i.range));var c=i.value*i.mul+i.add;for(r=0;a>r;++r)e[r]=c}}return this},n.register("midiratio",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,1,e)}var n=t.fn;n.extend(e);var i=e.prototype;i.process=function(t){var e=this.cells[0],i=this._;if(this.tickID!==t){this.tickID=t;var r,s,a,o,u=this.nodes,c=u.length,h=e.length;if(i.ar){if(u.length>0)for(a=u[0].process(t).cells[0],e.set(a),r=1;c>r;++r)for(a=u[r].process(t).cells[0],s=0;h>s;++s)o=a[s],e[s]>o&&(e[s]=o);else for(s=0;h>s;++s)e[s]=0;n.outputSignalAR(this)}else{if(u.length>0)for(a=u[0].process(t).cells[0][0],r=1;c>r;++r)o=u[r].process(t).cells[0][0],a>o&&(a=o);else a=0;e[0]=a,n.outputSignalKR(this)}}return this},n.register("min",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,0,e),n.timer(this),n.fixKR(this);var r=this._;r.tracks=[],r.onended=n.make_onended(this),r.currentTime=0,this.on("start",i)}var n=t.fn;n.extend(e);var i=function(){var t=this,e=this._,i=e.mml;"string"==typeof i&&(i=[i]),e.tracks=i.map(function(e,n){return new s(t,n,e)}),e.currentTime=0,this.playbackState=n.PLAYING_STATE};Object.defineProperty(i,"unremoved",{value:!0,writable:!1});var r=e.prototype;Object.defineProperties(r,{mml:{set:function(t){var e=this._;("string"==typeof t||Array.isArray(t))&&(e.mml=t)},get:function(){return this._.mml}},currentTime:{get:function(){return this._.currentTime}}}),r.on=r.addListener=function(t,e){return"mml"===t&&(t="data",console.warn("A 'mml' event listener was deprecated in ~v13.03.01. use 'data' event listener.")),this._.events.on(t,e),this},r.once=function(t,e){return"mml"===t&&(t="data",console.warn("A 'mml' event listener was deprecated in ~v13.03.01. use 'data' event listener.")),this._.events.once(t,e),this},r.off=r.removeListener=function(t,e){return"mml"===t&&(t="data",console.warn("A 'mml' event listener was deprecated in ~v13.03.01. use 'data' event listener.")),this._.events.off(t,e),this},r.removeAllListeners=function(t){return"mml"===t&&(console.warn("A 'mml' event listener was deprecated in ~v13.03.01. use 'data' event listener."),t="data"),this._.events.removeAllListeners(t),this},r.listeners=function(t){return"mml"===t&&(console.warn("A 'mml' event listener was deprecated in ~v13.03.01. use 'data' event listener."),t="data"),this._.events.listeners(t)},r.process=function(t){var e=this._;if(this.tickID!==t){this.tickID=t;var i,r,s=e.tracks;for(i=0,r=s.length;r>i;++i)s[i].process();for(;i--;)s[i].ended&&s.splice(i,1);0===s.length&&n.nextTick(e.onended),e.currentTime+=n.currentTimeIncr}return this},n.register("mml",e);var s=function(){function t(t,e,n){var i=this._={};i.sequencer=t,i.trackNum=e,i.commands=h(n),i.status={t:120,l:4,o:4,v:12,q:6,dot:0,tie:!1},i.index=0,i.queue=[],i.currentTime=0,i.queueTime=0,i.segnoIndex=-1,i.loopStack=[],i.prevNote=0,i.remain=1/0,this.ended=!1,c(this)}var e=0,i=1,r=2,s=3;t.prototype.process=function(){var t=this._,h=t.sequencer,f=t.trackNum,l=t.queue,p=!1;if(l.length)for(;l[0][0]<=t.currentTime;){var d=t.queue.shift();switch(d[1]){case i:a(h,f,d[2],d[3]),t.remain=d[4],c(this);break;case r:o(h,f,d[2],d[3]);break;case s:u(h,d[2]);break;case e:p=!0}if(0===l.length)break}t.remain-=n.currentTimeIncr,p&&(this.ended=!0),t.currentTime+=n.currentTimeIncr};var a=function(t,e,n,i){var r,s,a,o=t.nodes;for(s=0,a=o.length;a>s;++s)r=o[s],r.noteOn?r.noteOn(n,i):r.bang();t._.emit("data","noteOn",{trackNum:e,noteNum:n,velocity:i})},o=function(t,e,n,i){var r,s,a,o=t.nodes;for(s=0,a=o.length;a>s;++s)r=o[s],r.noteOff?r.noteOff(n,i):r.release&&r.release();t._.emit("data","noteOff",{trackNum:e,noteNum:n,velocity:i})},u=function(t,e){t._.emit("data","command",{command:e})},c=function(t){var n,a,o,u,c,h,f,l,p,d,v,m,g,b=t._,y=(b.sequencer,b.commands),_=b.queue,w=b.index,S=b.status,I=b.queueTime,x=b.loopStack;p=[];t:for(;;){if(y.length<=w){if(!(b.segnoIndex>=0))break;w=b.segnoIndex}switch(n=y[w++],n.name){case"@":_.push([I,s,n.val]);break;case"n":if(a=S.t||120,null!==n.len?(u=n.len,c=n.dot||0):(u=S.l,c=n.dot||S.dot),f=60/a*(4/u)*1e3,f*=[1,1.5,1.75,1.875][c]||1,h=S.v<<3,S.tie){for(m=_.length;m--;)if(_[m][2]){_.splice(m,1);break}o=b.prevNote}else o=b.prevNote=n.val+12*(S.o+1),_.push([I,i,o,h,f]);if(u>0){if(l=S.q/8,1>l)for(d=I+f*l,_.push([d,r,o,h]),m=0,g=p.length;g>m;++m)_.push([d,r,p[m],h]);if(p=[],I+=f,!S.tie)break t}else p.push(o);S.tie=!1;break;case"r":a=S.t||120,null!==n.len?(u=n.len,c=n.dot||0):(u=S.l,c=n.dot||S.dot),u>0&&(f=60/a*(4/u)*1e3,f*=[1,1.5,1.75,1.875][c]||1,I+=f);break;case"l":S.l=n.val,S.dot=n.dot;break;case"o":S.o=n.val;break;case"<":S.o<9&&(S.o+=1);break;case">":S.o>0&&(S.o-=1);break;case"v":S.v=n.val;break;case"(":S.v<15&&(S.v+=1);break;case")":S.v>0&&(S.v-=1);break;case"q":S.q=n.val;break;case"&":S.tie=!0;break;case"$":b.segnoIndex=w;break;case"[":x.push([w,null,null]);break;case"|":v=x[x.length-1],v&&1===v[1]&&(x.pop(),w=v[2]);break;case"]":v=x[x.length-1],v&&(null===v[1]&&(v[1]=n.count,v[2]=w),v[1]-=1,0===v[1]?x.pop():w=v[0]);break;case"t":S.t=null===n.val?120:n.val;break;case"EOF":_.push([I,e])}}b.index=w,b.queueTime=I},h=function(t){var e,n,i,r,s,a,o,u,c=new Array(t.length),h=[];for(s=0,a=f.length;a>s;++s)for(e=f[s],n=e.re;i=n.exec(t);){if(!c[i.index]){for(o=0,u=i[0].length;u>o;++o)c[i.index+o]=!0;r=e.func?e.func(i):{name:i[0]},r&&(r.index=i.index,r.origin=i[0],h.push(r))}for(;n.lastIndex<t.length&&c[n.lastIndex];)++n.lastIndex}return h.sort(function(t,e){return t.index-e.index}),h.push({name:"EOF"}),h},f=[{re:/@(\d*)/g,func:function(t){return{name:"@",val:t[1]||null}}},{re:/([cdefgab])([\-+]?)(\d*)(\.*)/g,func:function(t){return{name:"n",val:{c:0,d:2,e:4,f:5,g:7,a:9,b:11}[t[1]]+({"-":-1,"+":1}[t[2]]||0),len:""===t[3]?null:Math.min(0|t[3],64),dot:t[4].length}}},{re:/r(\d*)(\.*)/g,func:function(t){return{name:"r",len:""===t[1]?null:Math.max(1,Math.min(0|t[1],64)),dot:t[2].length}}},{re:/&/g},{re:/l(\d*)(\.*)/g,func:function(t){return{name:"l",val:""===t[1]?4:Math.min(0|t[1],64),dot:t[2].length}}},{re:/o([0-9])/g,func:function(t){return{name:"o",val:""===t[1]?4:0|t[1]}}},{re:/[<>]/g},{re:/v(\d*)/g,func:function(t){return{name:"v",val:""===t[1]?12:Math.min(0|t[1],15)}}},{re:/[()]/g},{re:/q([0-8])/g,func:function(t){return{name:"q",val:""===t[1]?6:Math.min(0|t[1],8)}}},{re:/\[/g},{re:/\|/g},{re:/\](\d*)/g,func:function(t){return{name:"]",count:0|t[1]||2}}},{re:/t(\d*)/g,func:function(t){return{name:"t",val:""===t[1]?null:Math.max(5,Math.min(0|t[1],300))}}},{re:/\$/g}];return t}()}(timbre),function(t){"use strict";function e(e){t.Object.call(this,1,e)}var n=t.fn;n.extend(e),e.prototype.process=function(t){var e=this._;return this.tickID!==t&&(this.tickID=t,e.ar?(n.inputSignalAR(this),n.outputSignalAR(this)):(this.cells[0][0]=n.inputSignalKR(this),n.outputSignalKR(this))),this},n.register("mono",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,2,e)}var n=t.fn;n.extend(e);var i=e.prototype;i.process=function(t){var e=this._;if(this.tickID!==t){this.tickID=t;var i,r,s,a,o,u=this.nodes,c=this.cells[0],h=this.cells[1],f=this.cells[2],l=u.length,p=c.length;if(e.ar){if(u.length>0)for(u[0].process(t),a=u[0].cells[1],o=u[0].cells[2],h.set(a),f.set(o),i=1;l>i;++i)for(u[i].process(t),a=u[i].cells[1],o=u[i].cells[2],r=0;p>r;++r)h[r]*=a[r],f[r]*=o[r];else for(r=0;p>r;++r)h[r]=f[r]=0;n.outputSignalAR(this)}else{if(u.length>0)for(s=u[0].process(t).cells[0][0],i=1;l>i;++i)s*=u[i].process(t).cells[0][0];else s=0;c[0]=s,n.outputSignalKR(this)}}return this},n.register("*",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,1,e);var n=this._;n.defaultValue=0,n.index=0,n.dict={},n.ar=!1}var n=t.fn;n.extend(e);var i=e.prototype;Object.defineProperties(i,{dict:{set:function(t){if("object"==typeof t)this._.dict=t;else if("function"==typeof t){for(var e={},n=0;128>n;++n)e[n]=t(n);this._.dict=e}},get:function(){return this._.dict}},defaultValue:{set:function(t){"number"==typeof t&&(this._.defaultValue=t)},get:function(){return this._.defaultValue}},index:{set:function(t){"number"==typeof t&&(this._.index=t)},get:function(){return this._.index}}}),i.at=function(t){var e=this._;return(e.dict[0|t]||e.defaultValue)*e.mul+e.add},i.clear=function(){return this._.dict={},this},i.process=function(t){var e=this.cells[0],i=this._;if(this.tickID!==t){this.tickID=t;var r,s,a,o=this.nodes.length,u=i.dict,c=i.defaultValue,h=i.mul,f=i.add,l=e.length;if(i.ar&&o){for(n.inputSignalAR(this),a=0;l>a;++a)r=e[a],r=0>r?r-.5|0:r+.5|0,e[a]=(u[r]||c)*h+f;n.outputSignalAR(this)}else for(r=this.nodes.length?n.inputSignalKR(this):i.index,r=0>r?r-.5|0:r+.5|0,s=(u[r]||c)*h+f,a=0;l>a;++a)e[a]=s}return this},n.register("ndict",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,1,e)}var n=t.fn;n.extend(e);var i=e.prototype;i.process=function(t){var e=this.cells[0],n=this._;if(this.tickID!==t){this.tickID=t;var i,r,s,a=n.mul,o=n.add;if(n.ar)for(i=0,r=e.length;r>i;++i)e[i]=(2*Math.random()-1)*a+o;else for(s=(2*Math.random()+1)*a+o,i=0,r=e.length;r>i;++i)e[i]=s}return this},n.register("noise",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,2,e);var i=this._;i.freq=t(440),i.phase=t(0),i.osc=new r(i.samplerate),i.tmp=new n.SignalArray(i.cellsize),i.osc.step=i.cellsize,this.once("init",s)}var n=t.fn,i=t.timevalue,r=t.modules.Oscillator;n.extend(e);var s=function(){var t=this._;this.wave||(this.wave="sin"),t.plotData=t.osc.wave,t.plotLineWidth=2,t.plotCyclic=!0,t.plotBefore=o},a=e.prototype;Object.defineProperties(a,{wave:{set:function(t){this._.osc.setWave(t)},get:function(){return this._.osc.wave}},freq:{set:function(e){"string"==typeof e&&(e=i(e),e=0>=e?0:1e3/e),this._.freq=t(e)},get:function(){return this._.freq}},phase:{set:function(e){this._.phase=t(e),this._.osc.feedback=!1},get:function(){return this._.phase}},fb:{set:function(e){this._.phase=t(e),this._.osc.feedback=!0},get:function(){return this._.phase}}}),a.clone=function(){var t=n.clone(this);return t._.osc=this._.osc.clone(),t._.freq=this._.freq,t._.phase=this._.phase,t},a.bang=function(){return this._.osc.reset(),this._.emit("bang"),this},a.process=function(t){var e=this._;if(this.tickID!==t){this.tickID=t;var i,r=this.cells[1],s=this.cells[2],a=e.cellsize;if(this.nodes.length)n.inputSignalAR(this);else for(i=0;a>i;++i)r[i]=s[i]=1;var o=e.osc,u=e.freq.process(t).cells[0],c=e.phase.process(t).cells[0];if(o.frequency=u[0],o.phase=c[0],e.ar){var h=e.tmp;for(e.freq.isAr?e.phase.isAr?o.processWithFreqAndPhaseArray(h,u,c):o.processWithFreqArray(h,u):e.phase.isAr?o.processWithPhaseArray(h,c):o.process(h),i=0;a>i;++i)r[i]*=h[i],s[i]*=h[i]}else{var f=o.next();for(i=0;a>i;++i)r[i]*=f,s[i]*=f}n.outputSignalAR(this)}return this};var o;"browser"===t.envtype&&(o=function(t,e,n,i,r){var s=(r>>1)+.5;t.strokeStyle="#ccc",t.lineWidth=1,t.beginPath(),t.moveTo(e,s+n),t.lineTo(e+i,s+n),t.stroke()}),n.register("osc",e),n.register("sin",function(t){return new e(t).set("wave","sin")}),n.register("cos",function(t){return new e(t).set("wave","cos")}),n.register("pulse",function(t){return new e(t).set("wave","pulse")}),n.register("tri",function(t){return new e(t).set("wave","tri")}),n.register("saw",function(t){return new e(t).set("wave","saw")}),n.register("fami",function(t){return new e(t).set("wave","fami")}),n.register("konami",function(t){return new e(t).set("wave","konami")}),n.register("+sin",function(t){return new e(t).set("wave","+sin").kr()}),n.register("+pulse",function(t){return new e(t).set("wave","+pulse").kr()}),n.register("+tri",function(t){return new e(t).set("wave","+tri").kr()}),n.register("+saw",function(t){return new e(t).set("wave","+saw").kr()}),n.alias("square","pulse")}(timbre),function(t){"use strict";function e(e){t.Object.call(this,2,e),n.fixAR(this);var i=this._;i.pos=t(0),i.panL=.5,i.panR=.5}var n=t.fn;n.extend(e);var i=e.prototype;Object.defineProperties(i,{pos:{set:function(e){this._.pos=t(e)},get:function(){return this._.pos}}}),i.process=function(t){var e=this._;if(this.tickID!==t){this.tickID=t;var i=e.pos.process(t).cells[0][0];e.prevPos!==i&&(e.panL=1-i,e.panR=e.prevPos=i);var r,s,a,o=this.nodes,u=this.cells[1],c=this.cells[2],h=o.length,f=u.length;if(h){for(a=o[0].process(t).cells[0],s=0;f>s;++s)u[s]=c[s]=a[s];for(r=1;h>r;++r)for(a=o[r].process(t).cells[0],s=0;f>s;++s)u[s]=c[s]+=a[s];var l=e.panL,p=e.panR;for(s=0;f>s;++s)u[s]=u[s]*l,c[s]=c[s]*p}else u.set(n.emptycell),c.set(n.emptycell);n.outputSignalAR(this)}return this},n.register("pan",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,2,e);var n=this._;n.value=0,n.env=new s(n.samplerate),n.env.step=n.cellsize,n.curve="lin",n.counter=0,n.ar=!1,n.onended=a(this),this.on("ar",o)}var n=t.fn,i=t.timevalue,r=t.modules.Envelope,s=t.modules.EnvelopeValue;n.extend(e);var a=function(t,e){return function(){if("number"==typeof e)for(var n=t.cells[0],i=t.cells[1],r=t.cells[2],s=t._.env.value,a=0,o=i.length;o>a;++a)n[0]=i[a]=r[a]=s;t._.emit("ended")}},o=function(t){this._.env.step=t?1:this._.cellsize},u=e.prototype;Object.defineProperties(u,{value:{set:function(t){"number"==typeof t&&(this._.env.value=t)},get:function(){return this._.env.value}}}),u.to=function(t,e,n){var s=this._,a=s.env;if("string"==typeof e?e=i(e):"undefined"==typeof e&&(e=0),"undefined"==typeof n)s.counter=a.setNext(t,e,r.CurveTypeLin),s.curve="lin";else{var o=r.CurveTypeDict[n];s.counter="undefined"==typeof o?a.setNext(t,e,r.CurveTypeCurve,n):a.setNext(t,e,o),s.curve=n}return s.plotFlush=!0,this},u.setAt=function(t,e){var n=this._;return this.to(n.env.value,e,"set"),n.atValue=t,this},u.linTo=function(t,e){return this.to(t,e,"lin")},u.expTo=function(t,e){return this.to(t,e,"exp")},u.sinTo=function(t,e){return this.to(t,e,"sin")},u.welTo=function(t,e){return this.to(t,e,"wel")},u.sqrTo=function(t,e){return this.to(t,e,"sqr")},u.cubTo=function(t,e){return this.to(t,e,"cub")},u.cancel=function(){var t=this._;return t.counter=t.env.setNext(t.env.value,0,r.CurveTypeSet),this},u.process=function(t){var e=this._;if(this.tickID!==t){this.tickID=t;var i,s,a=this.cells[1],o=this.cells[2],u=e.cellsize,c=e.env,h=e.counter;if(this.nodes.length)n.inputSignalAR(this);else for(i=0;u>i;++i)a[i]=o[i]=1;if(0>=h&&("set"===e.curve?c.setNext(e.atValue,0,r.CurveTypeSet):c.setNext(c.value,0,r.CurveTypeSet),n.nextTick(e.onended),e.counter=1/0),e.ar){for(i=0;u>i;++i)s=c.next(),a[i]*=s,o[i]*=s;e.counter-=e.cellsize}else{for(s=c.next(),i=0;u>i;++i)a[i]*=s,o[i]*=s;e.counter-=1}n.outputSignalAR(this),e.value=s}return this};var c=t.Object.prototype.plot;u.plot=function(t){var e=this._;if(e.plotFlush){var n,i,a,o=new s(128),u=new Float32Array(128);if("set"===e.curve)for(i=100,a=u.length;a>i;++i)u[i]=1;else for(n=r.CurveTypeDict[e.curve],"undefined"==typeof n?o.setNext(1,1e3,r.CurveTypeCurve,e.curve):o.setNext(1,1e3,n),i=0,a=u.length;a>i;++i)u[i]=o.next();e.plotData=u,e.plotRange=[0,1],e.plotFlush=null}return c.call(this,t)},n.register("param",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,2,e),n.fixAR(this);var i=this._;i.freq=t("sin",{freq:1,add:1e3,mul:250}).kr(),i.Q=t(1),i.allpass=[],this.steps=2}var n=t.fn,i=t.modules.Biquad;n.extend(e);var r=e.prototype;Object.defineProperties(r,{freq:{set:function(t){this._.freq=t},get:function(){return this._.freq}},Q:{set:function(e){this._.Q=t(e)},get:function(){return this._.Q}},steps:{set:function(t){if("number"==typeof t){if(t|=0,2===t||4===t||8===t||12===t){var e=this._.allpass;if(e.length<t)for(var n=e.length;t>n;++n)e[n]=new i(this._.samplerate),e[n].setType("allpass")}this._.steps=t}},get:function(){return this._.steps}}}),r.process=function(t){var e=this._;if(this.tickID!==t){if(this.tickID=t,n.inputSignalAR(this),!e.bypassed){var i,r=this.cells[1],s=this.cells[2],a=e.freq.process(t).cells[0][0],o=e.Q.process(t).cells[0][0],u=e.steps;for(i=0;u>i;i+=2)e.allpass[i].setParams(a,o,0),e.allpass[i].process(r,s),e.allpass[i+1].setParams(a,o,0),e.allpass[i+1].process(r,s)}n.outputSignalAR(this)}return this},n.register("phaser",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,1,e),i.fixAR(this);for(var n=new Uint8Array(5),r=0;5>r;++r)n[r]=(Math.random()*(1<<30)|0)%25;this._.whites=n,this._.key=0}var n=31,i=t.fn;i.extend(e);var r=e.prototype;r.process=function(t){var e=this.cells[0],i=this._;if(this.tickID!==t){this.tickID=t;var r,s,a,o,u,c,h=i.key,f=i.whites,l=i.mul,p=i.add;for(r=0,s=e.length;s>r;++r){for(o=h++,h>n&&(h=0),c=o^h,a=u=0;5>a;++a)c&1<<a&&(f[a]=(Math.random()*(1<<30)|0)%25),u+=f[a];e[r]=(.01666666*u-1)*l+p}i.key=h}return this},i.register("pink",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,1,e),this._.freq=440,this._.buffer=null,this._.index=0}var n=t.fn;n.extend(e);var i=e.prototype;Object.defineProperties(i,{freq:{set:function(t){"number"==typeof t&&(0>t&&(t=0),this._.freq=t)},get:function(){return this._.freq}}}),i.bang=function(){for(var t=this._,e=t.freq,i=t.samplerate/e+.5|0,r=t.buffer=new n.SignalArray(i),s=0;i>s;++s)r[s]=2*Math.random()-1;return t.index=0,t.emit("bang"),this},i.process=function(t){var e=this.cells[0],n=this._;if(this.tickID!==t){this.tickID=t;var i=n.buffer;if(i){var r,s,a,o=i.length,u=n.index,c=n.mul,h=n.add,f=e.length;for(a=0;f>a;++a)r=u,s=i[u++],u>=o&&(u=0),s=.5*(s+i[u]),i[r]=s,e[a]=s*c+h;n.index=u}}return this},n.register("pluck",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,1,e),n.listener(this),n.fixAR(this);var i=this._;i.timeout=5e3,i.status=r,i.writeIndex=0,i.writeIndexIncr=1,i.currentTime=0,i.currentTimeIncr=1e3/i.samplerate,i.onended=a(this)}var n=t.fn,i=t.timevalue,r=0,s=1;n.extend(e);var a=function(t){return function(){var e=t._,i=new n.SignalArray(e.buffer.subarray(0,0|e.writeIndex));e.status=r,e.writeIndex=0,e.currentTime=0,e.emit("ended",{buffer:i,samplerate:e.samplerate})}},o=e.prototype;Object.defineProperties(o,{timeout:{set:function(t){"string"==typeof t&&(t=i(t)),"number"==typeof t&&t>0&&(this._.timeout=t)},get:function(){return this._.timeout}},samplerate:{set:function(t){"number"==typeof t&&t>0&&t<=this._.samplerate&&(this._.samplerate=t)},get:function(){return this._.samplerate}},currentTime:{get:function(){return this._.currentTime}}}),o.start=function(){var e,i=this._;return i.status===r&&(e=.01*i.timeout*i.samplerate|0,(!i.buffer||i.buffer.length<e)&&(i.buffer=new n.SignalArray(e)),i.writeIndex=0,i.writeIndexIncr=i.samplerate/t.samplerate,i.currentTime=0,i.status=s,i.emit("start"),this.listen()),this},o.stop=function(){var t=this._;return t.status===s&&(t.status=r,t.emit("stop"),n.nextTick(t.onended),this.unlisten()),this},o.bang=function(){return this._.status===r?this.srart():this._.status===s&&this.stop(),this._.emit("bang"),this},o.process=function(t){var e=this._,i=this.cells[0];if(this.tickID!==t){if(this.tickID=t,n.inputSignalAR(this),e.status===s){var r,a=i.length,o=e.buffer,u=e.timeout,c=e.writeIndex,h=e.writeIndexIncr,f=e.currentTime,l=e.currentTimeIncr;for(r=0;a>r;++r)o[0|c]=i[r],c+=h,f+=l,f>=u&&n.nextTick(e.onended);e.writeIndex=c,e.currentTime=f}n.outputSignalAR(this)}return this},n.register("record",e),n.alias("rec","record")}(timbre),function(t){"use strict";function e(e){t.Object.call(this,2,e),n.fixAR(this),this._.reverb=new i(this._.samplerate,this._.cellsize)}var n=t.fn,i=t.modules.Reverb;n.extend(e);var r=e.prototype;Object.defineProperties(r,{room:{set:function(t){"number"==typeof t&&(t=t>1?1:0>t?0:t,this._.reverb.setRoomSize(t))},get:function(){return this._.reverb.roomsize}},damp:{set:function(t){"number"==typeof t&&(t=t>1?1:0>t?0:t,this._.reverb.setDamp(t))},get:function(){return this._.reverb.damp}},mix:{set:function(t){"number"==typeof t&&(t=t>1?1:0>t?0:t,this._.reverb.wet=t)},get:function(){return this._.reverb.wet}}}),r.process=function(t){var e=this._;return this.tickID!==t&&(this.tickID=t,n.inputSignalAR(this),e.bypassed||e.reverb.process(this.cells[1],this.cells[2]),n.outputSignalAR(this)),this},n.register("reverb",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,0,e),n.timer(this),n.fixKR(this);var i=this._;i.queue=[],i.currentTime=0,i.maxRemain=1e3}var n=t.fn,i=t.timevalue;n.extend(e);var r=e.prototype;Object.defineProperties(r,{queue:{get:function(){return this._.queue}},remain:{get:function(){return this._.queue.length}},maxRemain:{set:function(t){"number"==typeof t&&t>0&&(this._.maxRemain=t)},get:function(){return this._.maxRemain}},isEmpty:{get:function(){return 0===this._.queue.length}},currentTime:{get:function(){return this._.currentTime}}}),r.sched=function(t,e,n){return"string"==typeof t&&(t=i(t)),"number"==typeof t&&this.schedAbs(this._.currentTime+t,e,n),this},r.schedAbs=function(e,n,r){if("string"==typeof e&&(e=i(e)),"number"==typeof e){var s=this._,a=s.queue;if(a.length>=s.maxRemain)return this;for(var o=a.length;o--&&!(a[o][0]<e););a.splice(o+1,0,[e,t(n),r])}return this},r.advance=function(t){return"string"==typeof t&&(t=i(t)),"number"==typeof t&&(this._.currentTime+=t),this},r.clear=function(){return this._.queue.splice(0),
this},r.process=function(t){var e=this._;if(this.tickID!==t){this.tickID=t;var i=null,r=e.queue;if(r.length)for(;r[0][0]<e.currentTime;){var s=e.queue.shift();if(s[1].bang(s[2]),i="sched",0===r.length){i="empty";break}}e.currentTime+=n.currentTimeIncr,i&&e.emit(i)}return this},n.register("schedule",e),n.alias("sched","schedule")}(timbre),function(t){"use strict";function e(e){t.Object.call(this,2,e),n.listener(this),n.fixAR(this);var i=this._;i.samples=0,i.writeIndex=0,i.plotFlush=!0,this.once("init",r)}var n=t.fn,i=t.timevalue;n.extend(e);var r=function(){this._.buffer||(this.size=1024),this._.interval||(this.interval=1e3)},s=e.prototype;Object.defineProperties(s,{size:{set:function(t){var e=this._;if(!e.buffer&&"number"==typeof t){var i=64>t?64:t>2048?2048:t;e.buffer=new n.SignalArray(i),e.reservedinterval&&(this.interval=e.reservedinterval,e.reservedinterval=null)}},get:function(){return this._.buffer.length}},interval:{set:function(t){var e=this._;"string"==typeof t&&(t=i(t)),"number"==typeof t&&t>0&&(e.buffer?(e.interval=t,e.samplesIncr=.001*t*e.samplerate/e.buffer.length,e.samplesIncr<1&&(e.samplesIncr=1)):e.reservedinterval=t)},get:function(){return this._.interval}},buffer:{get:function(){return this._.buffer}}}),s.bang=function(){for(var t=this._,e=t.buffer,n=0,i=e.length;i>n;++n)e[n]=0;return t.samples=0,t.writeIndex=0,this._.emit("bang"),this},s.process=function(t){var e=this._;if(this.tickID!==t){this.tickID=t,n.inputSignalAR(this),n.outputSignalAR(this);var i,r=this.cells[0],s=e.cellsize,a=e.samples,o=e.samplesIncr,u=e.buffer,c=e.writeIndex,h=!1,f=u.length;for(i=0;s>i;++i)0>=a&&(u[c++]=r[i],c>=f&&(c=0),h=e.plotFlush=!0,a+=o),--a;e.samples=a,e.writeIndex=c,h&&this._.emit("data")}return this};var a=t.Object.prototype.plot;s.plot=function(t){var e=this._;if(e.plotFlush){for(var n=e.buffer,i=n.length-1,r=new Float32Array(n.length),s=e.writeIndex,o=0,u=n.length;u>o;o++)r[o]=n[++s&i];e.plotData=r,e.plotFlush=null}return a.call(this,t)},n.register("scope",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,2,e),r.fixAR(this);var n=this._;n.numberOfInputs=0,n.numberOfOutputs=0,n.bufferSize=0,n.bufferMask=0,n.duration=0,n.inputBufferL=null,n.inputBufferR=null,n.outputBufferL=null,n.outputBufferR=null,n.onaudioprocess=null,n.index=0,this.once("init",s)}function n(t,e){this.samplerate=t._.samplerate,this.length=t._.bufferSize,this.duration=t._.duration,this.numberOfChannels=e.length,this.getChannelData=function(t){return e[t]}}function i(e){var i=e._;this.node=e,this.playbackTime=t.currentTime,this.inputBuffer=2===i.numberOfInputs?new n(e,[i.inputBufferL,i.inputBufferR]):new n(e,[i.inputBufferL]),this.outputBuffer=2===i.numberOfOutputs?new n(e,[i.outputBufferL,i.outputBufferR]):new n(e,[i.outputBufferL])}var r=t.fn;r.extend(e);var s=function(){var t=this._;0===t.numberOfInputs&&(this.numberOfInputs=1),0===t.numberOfOutputs&&(this.numberOfOutputs=1),0===t.bufferSize&&(this.bufferSize=1024)},a=e.prototype;Object.defineProperties(a,{numberOfInputs:{set:function(t){var e=this._;0===e.numberOfInputs&&(e.numberOfInputs=2===t?2:1)},get:function(){return this._.numberOfInputs}},numberOfOutputs:{set:function(t){var e=this._;0===e.numberOfOutputs&&(e.numberOfOutputs=2===t?2:1)},get:function(){return this._.numberOfOutputs}},bufferSize:{set:function(t){var e=this._;0===e.bufferSize&&-1!==[256,512,1024,2048,4096,8192,16384].indexOf(t)&&(e.bufferSize=t,e.bufferMask=t-1,e.duration=t/e.samplerate,e.inputBufferL=new r.SignalArray(t),e.inputBufferR=new r.SignalArray(t),e.outputBufferL=new r.SignalArray(t),e.outputBufferR=new r.SignalArray(t))},get:function(){return this._.bufferSize}},onaudioprocess:{set:function(t){"function"==typeof t&&(this._.onaudioprocess=t)},get:function(){return this._.onaudioprocess}}}),a.process=function(t){var e=this._;if(this.tickID!==t){this.tickID=t;var n,s=e.cellsize,a=e.bufferMask,o=e.index,u=o+s,c=this.cells[1],h=this.cells[2];if(r.inputSignalAR(this),2===e.numberOfInputs)e.inputBufferL.set(c,o),e.inputBufferR.set(h,o);else{n=e.inputBufferL;for(var f=0;s>f;f++)n[o+f]=.5*(c[f]+h[f])}c.set(e.outputBufferL.subarray(o,u)),h.set(e.outputBufferR.subarray(o,u)),e.index=u&a,0===e.index&&e.onaudioprocess&&(e.onaudioprocess(new i(this)),1===e.numberOfOutputs&&e.outputBufferR.set(e.outputBufferL)),r.outputSignalAR(this)}return this},r.register("script",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,2,e),this._.selected=0,this._.background=!1}var n=t.fn;n.extend(e);var i=e.prototype;Object.defineProperties(i,{selected:{set:function(t){"number"==typeof t&&(this._.selected=t,this.cells[1].set(n.emptycell),this.cells[2].set(n.emptycell))},get:function(){return this._.selected}},background:{set:function(t){this._.background=!!t},get:function(){return this._.background}}}),i.process=function(t){var e=this._;if(this.tickID!==t){this.tickID=t;var i,r=this.nodes,s=r.length;if(e.background)for(i=0;s>i;++i)r[i].process(t);var a=r[e.selected];a&&(e.background||a.process(t),this.cells[1].set(a.cells[1]),this.cells[2].set(a.cells[2])),n.outputSignalAR(this)}return this},n.register("selector",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,2,e),n.listener(this),n.fixAR(this);var i=this._;i.status=s,i.samples=0,i.samplesIncr=0,i.writeIndex=0,i.plotFlush=!0,i.plotRange=[0,32],i.plotBarStyle=!0,this.once("init",o)}var n=t.fn,i=t.timevalue,r=t.modules.FFT,s=0,a=1;n.extend(e);var o=function(){var t=this._;t.fft||(this.size=512),t.interval||(this.interval=500)},u=e.prototype;Object.defineProperties(u,{size:{set:function(t){var e=this._;if(!e.fft&&"number"==typeof t){var i=256>t?256:t>2048?2048:t;e.fft=new r(i),e.buffer=new n.SignalArray(e.fft.length),e.freqs=new n.SignalArray(e.fft.length>>1),e.reservedwindow&&(e.fft.setWindow(e.reservedwindow),e.reservedwindow=null),e.reservedinterval&&(this.interval=e.reservedinterval,e.reservedinterval=null)}},get:function(){return this._.buffer.length}},window:{set:function(t){this._.fft.setWindow(t)},get:function(){return this._.fft.windowName}},interval:{set:function(t){var e=this._;"string"==typeof t&&(t=i(t)),"number"==typeof t&&t>0&&(e.buffer?(e.interval=t,e.samplesIncr=.001*t*e.samplerate,e.samplesIncr<e.buffer.length&&(e.samplesIncr=e.buffer.length,e.interval=1e3*e.samplesIncr/e.samplerate)):e.reservedinterval=t)},get:function(){return this._.interval}},spectrum:{get:function(){return this._.fft.getFrequencyData(this._.freqs)}},real:{get:function(){return this._.fft.real}},imag:{get:function(){return this._.fft.imag}}}),u.bang=function(){return this._.samples=0,this._.writeIndex=0,this._.emit("bang"),this},u.process=function(t){var e=this._;if(this.tickID!==t){this.tickID=t,n.inputSignalAR(this),n.outputSignalAR(this);var i,r,o=this.cells[0],u=o.length,c=e.status,h=e.samples,f=e.samplesIncr,l=e.writeIndex,p=e.buffer,d=p.length;for(i=0;u>i;++i)0>=h&&c===s&&(c=a,l=0,h+=f),c===a&&(p[l++]=o[i],l>=d&&(e.fft.forward(p),r=e.plotFlush=!0,c=s)),--h;e.samples=h,e.status=c,e.writeIndex=l,r&&this._.emit("data")}return this};var c=t.Object.prototype.plot;u.plot=function(t){return this._.plotFlush&&(this._.plotData=this.spectrum,this._.plotFlush=null),c.call(this,t)},n.register("spectrum",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,2,e),this._.ar=!1}var n=t.fn;n.extend(e);var i=e.prototype;i.process=function(t){var e=this._;if(this.tickID!==t){this.tickID=t;var i,r,s,a,o,u=this.nodes,c=this.cells[0],h=this.cells[1],f=this.cells[2],l=u.length,p=c.length;if(e.ar){if(u.length>0)for(u[0].process(t),a=u[0].cells[1],o=u[0].cells[2],h.set(a),f.set(o),i=1;l>i;++i)for(u[i].process(t),a=u[i].cells[1],o=u[i].cells[2],r=0;p>r;++r)h[r]-=a[r],f[r]-=o[r];else for(r=0;p>r;++r)h[r]=f[i]=0;n.outputSignalAR(this)}else{if(u.length>0)for(s=u[0].process(t).cells[0][0],i=1;l>i;++i)s-=u[i].process(t).cells[0][0];else s=0;c[0]=s,n.outputSignalKR(this)}}return this},n.register("-",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,2,e),n.fixAR(this);var i=this._;this.playbackState=n.FINISHED_STATE,i.poly=4,i.genList=[],i.genDict={},i.synthdef=null,i.remGen=s(this),i.onended=n.make_onended(this)}var n=t.fn;n.extend(e);var i=e.prototype;Object.defineProperties(i,{def:{set:function(t){"function"==typeof t&&(this._.synthdef=t)},get:function(){return this._.synthdef}},poly:{set:function(t){"number"==typeof t&&t>0&&64>=t&&(this._.poly=t)},get:function(){return this._.poly}}});var r=function(t,e){return function(){t._.remGen(e.gen)}},s=function(t){return function(e){var n=t._,i=n.genList.indexOf(e);-1!==i&&n.genList.splice(i,1),"undefined"!=typeof e.noteNum&&(n.genDict[e.noteNum]=null)}},a=function(e,i,s,a){s|=0,0>=s?this.noteOff(this,e):s>127&&(s=127);var o=this._,u=o.genList,c=o.genDict,h=c[e];h&&o.remGen(h);var f={freq:i,noteNum:e,velocity:s,mul:.0078125*s};if(a)for(var l in a)f[l]=a[l];f.doneAction=r(this,f),h=o.synthdef.call(this,f),h instanceof t.Object&&(h.noteNum=e,u.push(h),c[e]=f.gen=h,this.playbackState=n.PLAYING_STATE,u.length>o.poly&&o.remGen(u[0]))},o=function(){for(var t=new Float32Array(128),e=0;128>e;++e)t[e]=440*Math.pow(2,1*(e-69)/12);return t}(),u=function(t){return t>0?Math.log(1*t/440)*Math.LOG2E*12+69:0};i.noteOn=function(t,e,n){var i=o[t]||440*Math.pow(2,(t-69)/12);return a.call(this,t+.5|0,i,e,n),this},i.noteOff=function(t){var e=this._.genDict[t];return e&&e.release&&e.release(),this},i.noteOnWithFreq=function(t,e,n){var i=u(t);return a.call(this,i+.5|0,t,e,n),this},i.noteOffWithFreq=function(t){var e=u(t);return this.noteOff(e+.5|0)},i.allNoteOff=function(){for(var t=this._.genList,e=0,n=t.length;n>e;++e)t[e].release&&t[e].release()},i.allSoundOff=function(){for(var t=this._,e=t.genList,n=t.genDict;e.length;)delete n[e.shift().noteNum]},i.synth=function(e){var i,s=this._,a=s.genList,o={};if(e)for(var u in e)o[u]=e[u];return o.doneAction=r(this,o),i=s.synthdef.call(this,o),i instanceof t.Object&&(a.push(i),o.gen=i,this.playbackState=n.PLAYING_STATE,a.length>s.poly&&s.remGen(a[0])),this},i.process=function(t){var e=this.cells[0],i=this._;if(this.tickID!==t){if(this.tickID=t,this.playbackState===n.PLAYING_STATE){var r,s,a,o,u,c,h=i.genList,f=this.cells[1],l=this.cells[2],p=e.length;if(h.length)for(r=h[0],r.process(t),f.set(r.cells[1]),l.set(r.cells[2]),s=1,a=h.length;a>s;++s)for(r=h[s],r.process(t),u=r.cells[1],c=r.cells[2],o=0;p>o;++o)f[o]+=u[o],l[o]+=c[o];else n.nextTick(i.onended)}n.outputSignalAR(this)}return this},n.register("SynthDef",e);var c={set:function(e){n.isDictionary(e)?"string"==typeof e.type&&(this._.env=e):e instanceof t.Object&&(this._.env=e)},get:function(){return this._.env}};n.register("OscGen",function(){var n={set:function(e){e instanceof t.Object&&(this._.osc=e)},get:function(){return this._.osc}},i={set:function(t){"string"==typeof t&&(this._.wave=t)},get:function(){return this._.wave}},r=function(e){var n,i,r,s,a=this._;return i=a.osc||null,r=a.env||{},s=r.type||"perc",i instanceof t.Object&&"function"==typeof i.clone&&(i=i.clone()),i||(i=t("osc",{wave:a.wave})),i.freq=e.freq,i.mul=i.mul*e.velocity/128,n=i,r instanceof t.Object?"function"==typeof r.clone&&(n=r.clone().append(n)):n=t(s,r,n),n.on("ended",e.doneAction).bang(),n};return function(t){var s=new e(t);return s._.wave="sin",Object.defineProperties(s,{env:c,osc:n,wave:i}),s.def=r,s}}()),n.register("PluckGen",function(){var n=function(e){var n,i,r,s=this._;return i=s.env||{},r=i.type||"perc",n=t("pluck",{freq:e.freq,mul:e.velocity/128}).bang(),i instanceof t.Object?"function"==typeof i.clone&&(n=i.clone().append(n)):n=t(r,i,n),n.on("ended",e.doneAction).bang(),n};return function(t){var i=new e(t);return Object.defineProperties(i,{env:c}),i.def=n,i}}())}(timbre),function(t){"use strict";function e(e){t.Object.call(this,2,e),n.fixAR(this);var i=this._;i.isLooped=!1,i.onended=n.make_onended(this,0)}var n=t.fn,i=t.modules.Scissor,r=i.Tape,s=i.TapeStream,a=n.isSignalArray;n.extend(e);var o=e.prototype;Object.defineProperties(o,{tape:{set:function(e){e instanceof r?(this.playbackState=n.PLAYING_STATE,this._.tape=e,this._.tapeStream=new s(e,this._.samplerate),this._.tapeStream.isLooped=this._.isLooped):(e instanceof t.Object&&e.buffer&&(e=e.buffer),"object"==typeof e&&Array.isArray(e.buffer)&&a(e.buffer[0])&&(this.playbackState=n.PLAYING_STATE,this._.tape=new i(e),this._.tapeStream=new s(this._.tape,this._.samplerate),this._.tapeStream.isLooped=this._.isLooped))},get:function(){return this._.tape}},isLooped:{get:function(){return this._.isLooped}},buffer:{get:function(){return this._.tape?this._.tape.getBuffer():void 0}}}),o.loop=function(t){return this._.isLooped=!!t,this._.tapeStream&&(this._.tapeStream.isLooped=this._.isLooped),this},o.bang=function(){return this.playbackState=n.PLAYING_STATE,this._.tapeStream&&this._.tapeStream.reset(),this._.emit("bang"),this},o.getBuffer=function(){return this._.tape?this._.tape.getBuffer():void 0},o.process=function(t){var e=this._;if(this.tickID!==t){this.tickID=t;var i=e.tapeStream;if(i){var r=this.cells[1],s=this.cells[2],a=i.fetch(r.length);r.set(a[0]),s.set(a[1]),this.playbackState===n.PLAYING_STATE&&i.isEnded&&n.nextTick(e.onended)}n.outputSignalAR(this)}return this},n.register("tape",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,1,e),n.timer(this);var i=this._;this.playbackState=n.FINISHED_STATE,i.task=[],i.i=0,i.j=0,i.imax=0,i.jmax=0,i.wait=0,i.count=0,i.args={},i.doNum=1,i.initFunc=n.nop,i.onended=a(this),this.on("start",s)}var n=t.fn,i=t.timevalue,r=t(function(){}).constructor;n.extend(e);var s=function(){var t,e=this._;this.playbackState=n.PLAYING_STATE,e.task=this.nodes.map(function(t){return t instanceof r?t.func:!1}).filter(function(t){return!!t}),e.i=e.j=0,e.imax=e.doNum,e.jmax=e.task.length,t=e.initFunc(),n.isDictionary(t)||(t={param:t}),e.args=t},a=function(t){return function(){t.playbackState=n.FINISHED_STATE;var e=t._,i=t.cells[0],r=t.cells[1],s=t.cells[2],a=e.args;if("number"==typeof a)for(var o=0,u=r.length;u>o;++o)i[0]=r[o]=s[o]=a;e.emit("ended",e.args)}},o=e.prototype;Object.defineProperties(o,{"do":{set:function(t){"number"==typeof t&&t>0&&(this._.doNum=1/0===t?1/0:0|t)},get:function(){return this._.doNum}},init:{set:function(t){"function"==typeof t&&(this._.initFunc=t)},get:function(){return this._.initFunc}}}),o.bang=function(){var t=this._;return t.count=0,t.emit("bang"),this},o.wait=function(t){return"string"==typeof t&&(t=i(t)),"number"==typeof t&&t>0&&(this._.count+=this._.samplerate*t*.001|0),this},o.process=function(t){var e,i=this.cells[0],r=this._;if(this.tickID!==t&&(this.tickID=t,r.i<r.imax)){for(;r.count<=0;){if(r.j>=r.jmax){if(++r.i,r.i>=r.imax){n.nextTick(r.onended);break}r.j=0}e=r.task[r.j++],e&&e.call(this,r.i,r.args)}r.count-=i.length}return this},n.register("task",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,0,e),n.timer(this),n.fixKR(this);var i=this._;this.playbackState=n.FINISHED_STATE,i.currentTime=0,i.samplesMax=0,i.samples=0,i.onended=n.make_onended(this),this.once("init",r),this.on("start",s)}var n=t.fn,i=t.timevalue;n.extend(e);var r=function(){this._.timeout||(this.timeout=1e3)},s=function(){this.playbackState=n.PLAYING_STATE};Object.defineProperty(s,"unremovable",{value:!0,writable:!1});var a=e.prototype;Object.defineProperties(a,{timeout:{set:function(t){var e=this._;"string"==typeof t&&(t=i(t)),"number"==typeof t&&t>=0&&(this.playbackState=n.PLAYING_STATE,e.timeout=t,e.samplesMax=.001*e.samplerate*t|0,e.samples=e.samplesMax)},get:function(){return this._.timeout}},currentTime:{get:function(){return this._.currentTime}}}),a.bang=function(){var t=this._;return this.playbackState=n.PLAYING_STATE,t.samples=t.samplesMax,t.currentTime=0,t.emit("bang"),this},a.process=function(t){var e=this.cells[0],i=this._;if(this.tickID!==t){if(this.tickID=t,i.samples>0&&(i.samples-=e.length),i.samples<=0){for(var r=this.nodes,s=0,a=r.length;a>s;++s)r[s].bang();n.nextTick(i.onended)}i.currentTime+=n.currentTimeIncr}return this},n.register("timeout",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,1,e),n.fixAR(this),this._.curve=null}var n=t.fn;n.extend(e);var i=e.prototype;Object.defineProperties(i,{curve:{set:function(t){n.isSignalArray(t)&&(this._.curve=t)},get:function(){return this._.curve}}}),i.process=function(t){var e=this._;if(this.tickID!==t){if(this.tickID=t,n.inputSignalAR(this),e.curve){var i,r,s=this.cells[0],a=e.curve,o=a.length,u=e.cellsize;for(r=0;u>r;++r)i=.5*(s[r]+1)*o+.5|0,0>i?i=0:i>=o-1&&(i=o-1),s[r]=a[i]}n.outputSignalAR(this)}return this},n.register("waveshaper",e)}(timbre),function(t){"use strict";function e(e){t.Object.call(this,1,e);var n=this._;n.inMin=0,n.inMax=1,n.outMin=0,n.outMax=1,n.ar=!1,this.once("init",i)}var n=t.fn;n.extend(e);var i=function(){this._.warp||(this.warp="linlin")},r=e.prototype;Object.defineProperties(r,{inMin:{set:function(t){"number"==typeof t&&(this._.inMin=t)},get:function(){return this._.inMin}},inMax:{set:function(t){"number"==typeof t&&(this._.inMax=t)},get:function(){return this._.inMax}},outMin:{set:function(t){"number"==typeof t&&(this._.outMin=t)},get:function(){return this._.outMin}},outMax:{set:function(t){"number"==typeof t&&(this._.outMax=t)},get:function(){return this._.outMax}},warp:{set:function(t){if("string"==typeof t){var e=s[t];e&&(this._.warp=e,this._.warpName=t)}},get:function(){return this._.warpName}}}),r.process=function(t){var e=this._,i=this.cells[0];if(this.tickID!==t){this.tickID=t;var r,s=e.inMin,a=e.inMax,o=e.outMin,u=e.outMax,c=e.warp,h=this.nodes.length,f=e.mul,l=e.add,p=i.length;if(e.ar&&h){for(n.inputSignalAR(this),r=0;p>r;++r)i[r]=c(i[r],s,a,o,u)*f+l;n.outputSignalAR(this)}else{var d=this.nodes.length?n.inputSignalKR(this):0,v=c(d,s,a,o,u)*f+l;for(r=0;p>r;++r)i[r]=v}}return this};var s={linlin:function(t,e,n,i,r){return e>t?i:t>n?r:n===e?i:(t-e)/(n-e)*(r-i)+i},linexp:function(t,e,n,i,r){return e>t?i:t>n?r:0===i?0:n===e?r:Math.pow(r/i,(t-e)/(n-e))*i},explin:function(t,e,n,i,r){return e>t?i:t>n?r:0===e?r:Math.log(t/e)/Math.log(n/e)*(r-i)+i},expexp:function(t,e,n,i,r){return e>t?i:t>n?r:0===e||0===i?0:Math.pow(r/i,Math.log(t/e)/Math.log(n/e))*i}};n.register("zmap",e)}(timbre),function(t){"use strict";function e(t){timbre.Object.call(this,2,t.slice(0,t.length-1)),n.fixAR(this);var e=this._,r=t.slice(-1)[0];e.mode="",e.bufferL=new n.SignalArray(i<<2),e.bufferR=new n.SignalArray(i<<2),e.buffermask=e.bufferL.length-1,e.node=null,e.script=r.createScriptProcessor(i,2,2),e.writeIndex=0,e.readIndex=0,e.totalRead=0,e.totalWrite=0,e.context=r}if("webkit"===t.env){var n=t.fn,i=1024;n.extend(e);var r=e.prototype;Object.defineProperties(r,{context:{get:function(){return this._.context}},mode:{get:function(){return this._.mode}}}),r.cancel=function(){for(var t=this._,e=this.cells[0],n=0,i=e.length;i>n;++n)e[n]=0;t.node=null,null!==t.connectIndex&&void 0!==t.connectIndex?t.script.disconnect(t.connectIndex):t.script.disconnect()},function(){function t(t){e.call(this,t);var n=t.slice(-1)[0],r=this._;r.mode="recv",r.script.onaudioprocess=i(this),r.gain=n.createGain(),r.gain.gain.value=0,r.script.connect(r.gain)}n.extend(t,e);var i=function(t){return function(e){var n=t._,i=e.inputBuffer,r=i.getChannelData(0),s=i.getChannelData(1),a=i.length,o=n.writeIndex;n.bufferL.set(r,o),n.bufferR.set(s,o),n.writeIndex=o+a&n.buffermask,n.totalWrite+=a}},r=t.prototype;r.cancel=function(){this._.node&&this._.node.disconnect(),e.prototype.cancel.call(this),this._.gain.disconnect()},r.recv=function(t){var e=this._;try{e.node=t,e.node.connect(e.script),e.gain.connect(e.context.destination)}catch(n){e.node=null}return e.writeIndex=0,e.readIndex=0,e.totalWrite=0,e.totalRead=0,this},r.process=function(t){var e=this._;if(null===e.node)return this;if(this.tickID!==t){this.tickID=t;var i=e.cellsize,r=e.bufferL,s=e.bufferR;if(e.totalWrite>e.totalRead+i){var a=e.readIndex,o=a+i;this.cells[1].set(r.subarray(a,o)),this.cells[2].set(s.subarray(a,o)),e.readIndex=o&e.buffermask,e.totalRead+=i}n.outputSignalAR(this)}return this},n.register("WebAudioAPI:recv",t)}(),function(){function t(t){e.call(this,t),n.listener(this);var r=this._;r.mode="send",r.script.onaudioprocess=i(this),r.connectIndex=null}n.extend(t,e);var i=function(t){return function(e){var n=t._,i=e.outputBuffer,r=i.length;if(n.totalWrite>n.totalRead+r){var s=n.readIndex,a=s+r;i.getChannelData(0).set(n.bufferL.subarray(s,a)),i.getChannelData(1).set(n.bufferR.subarray(s,a)),n.readIndex=a&n.buffermask,n.totalRead+=r}}},r=t.prototype;r.cancel=function(){e.prototype.cancel.call(this),this.unlisten()},r.send=function(t,e){var n=this._;try{n.node=t,"number"==typeof e?(n.script.connect(n.node,e),n.connectIndex=e):(n.script.connect(n.node),n.connectIndex=null),this.listen()}catch(i){n.node=null}return n.writeIndex=0,n.readIndex=0,n.totalWrite=0,n.totalRead=0,this},r.process=function(t){var e=this._;if(null===e.script)return this;if(this.tickID!==t){this.tickID=t;var i=this.cells[1],r=this.cells[2],s=e.cellsize,a=e.writeIndex;n.inputSignalAR(this),e.bufferL.set(i,a),e.bufferR.set(r,a),e.writeIndex=a+s&e.buffermask,e.totalWrite+=s,n.outputSignalAR(this)}return this},n.register("WebAudioAPI:send",t)}()}}(timbre),function(){var t=function(t){var e=[];this.add=function(t){e.push(t)},this.cast=function(n){for(var i=0;i<e.length;i++){var r=e[i],s=r(n);if(s)return s}throw"Can't convert "+n+" to "+t}};TypeCast=function(){var e={};this.register=function(n,i){var r;e[n]||(e[n]=new t(n)),r=e[n],r.add(i)},this.cast=function(t,n){var i=e[t];if(!i)throw"unkown type "+t;return i.cast(n)}}}(),MUSIC={},function(){MUSIC.SoundLib=MUSIC.SoundLib||{},MUSIC.Effects=MUSIC.Effects||{},MUSIC.Types=new TypeCast;MUSIC.playablePipeExtend=function(t){return t.during=function(t){var e=this;return MUSIC.playablePipeExtend({play:function(){var n=!1,i=e.play(),r={stop:function(){n||i.stop(),n=!0}};return setTimeout(r.stop,t),r},duration:function(){return t}})},t.stopDelay=function(t){var e=this;return MUSIC.playablePipeExtend({play:function(n){var i=e.play(n);return{stop:function(){setTimeout(i.stop.bind(i),t)}}}})},t.onStop=function(t){var e=this;return MUSIC.playablePipeExtend({play:function(n){var i=e.play(n);return{stop:function(){i.stop(),t(n)}}}})},t},MUSIC.Types.register("playable",function(t){return t.play?t:void 0}),MUSIC.Types.register("playable",function(t){return"function"==typeof t?{play:t}:void 0}),MUSIC.EffectsPipeline=function(t,e){this._audio=t,this._audioDestination=e};var t=function(t){return t},e=function(t,e){return function(n){return e(t(n))}};MUSIC.EffectsPipeline.prototype={_wrapFcn:t,wrap:function(n){var i=new MUSIC.DummyNode(this);return this._wrapFcn!==t&&(n=e(n,this._wrapFcn)),i._wrapFcn=function(t){var e=n(t);return e._wrapFcn=i._wrapFcn,e},i},sfxBase:function(){var t=[],e=function(t){t.dispose()},n=function(e){if(!e.dispose)return e;var n=function(t){return t!=e},i=e.dispose;return t.push(e),e.dispose=function(){t=t.filter(n),i.call(e)},e},i=function(){t.forEach(e)},r=this.wrap(n);return r.prune=i,r},oscillator:function(t){return this._wrapFcn(new MUSIC.SoundLib.Oscillator(this._audio,this._audioDestination,t))},soundfont:function(t){return this._wrapFcn(new MUSIC.SoundfontInstrument(t,this._audio,this._audioDestination))},sound:function(t){var e=this._audio,n=this._audioDestination,i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer";var r;return i.onerror=function(t){console.error(t)},i.onload=function(t){e.audio.decodeAudioData(i.response,function(t){r=t})},i.send(),MUSIC.playablePipeExtend({play:function(){var t=e.audio.createBufferSource();return t.buffer=r,t.connect(n._destination),t.start(e.audio.currentTime),{stop:function(){t.stop(),t.disconnect(n._destination)}}}})},formulaGenerator:function(t){return this._wrapFcn(new MUSIC.SoundLib.FormulaGenerator(this._audio,this._audioDestination,t))},T:function(){return this._wrapFcn(new MUSIC.T(arguments,this._audio,this._audioDestination))},noise:function(){return this._wrapFcn(new MUSIC.SoundLib.Noise(this._audio,this._audioDestination))}},MUSIC.DummyNode=function(t){MUSIC.EffectsPipeline.apply(this,[t._audio,t._audioDestination])},MUSIC.DummyNode.prototype=Object.create(MUSIC.EffectsPipeline.prototype),MUSIC.T=function(t,e,n){var i=T("WebAudioAPI:recv",e.audio),r=i.context,s=r.createGain(1);i.recv(s),setTimeout(function(){s.connect(n._destination)});for(var a=[],o=0;o<t.length;o++)a.push(t[o]);a.push(i);var u=T.apply(null,a);T("WebAudioAPI:send",u,e.audio).send(n._destination);this.output=function(){return s};var c=!1;this.disconnect=function(){c||(c=!0,s.disconnect(n._destination),i.cancel())},this.dispose=this.disconnect,this._destination=s,this.next=function(){return n},MUSIC.EffectsPipeline.bind(this)(e,this)},MUSIC.T.prototype=Object.create(MUSIC.EffectsPipeline.prototype),MUSIC.Effects.register=function(t,e){MUSIC.EffectsPipeline.prototype[t]=function(t){return this._wrapFcn(e(this._audio,this._audioDestination,t))}};var n=new(window.AudioContext||window.webkitAudioContext);MUSIC.Context=function(t){var e=n,i=this,r=e.createGain();t=t||{},r.gain.value=1,t.nooutput||r.connect(e.destination),this._destination=r,this.audio=e,this.record=function(){var t=new Recorder(r,{workerPath:"lib/recorder/recorderWorker.js"});return t.record(),t},this.audio=e,MUSIC.EffectsPipeline.bind(this)(i,this)},MUSIC.Context.prototype=new MUSIC.EffectsPipeline,MUSIC.SoundLib.FormulaGenerator=function(t,e,n){this.play=function(i){var r=new MUSIC.Effects.Formula(t,e,function(t,e){return n(e)});return{stop:function(){r.disconnect(e._destination)}}},MUSIC.playablePipeExtend(this)},MUSIC.SoundLib.Noise=function(t,e){this.play=function(n){var i=new MUSIC.Effects.Formula(t,e,function(){return Math.random()});return{stop:function(){i.disconnect(e._destination)}}},MUSIC.playablePipeExtend(this)},MUSIC.SoundLib.Wave=function(t,e){var n=new MUSIC.Context({nooutput:!0}),i=n.sound(t),r=Math.floor(e*n.audio.sampleRate/1e3),s=[];setTimeout(function(){var t=n.record();i.play(),setTimeout(function(){t.stop(),t.getBuffer(function(t){for(var e=t[0],n=0;r>n;n++)s.push(e[n])})},e+100)},500),this.f=function(t){if(0>t)return 0;var e=s[Math.floor(t*r)];return e}},MUSIC.SoundLib.Oscillator=function(t,e,n){n=n||{};var i=(n.effects,n.frequency);if(this.freq=function(i){var r={type:n.type,wave:n.wave,f:n.f,frequency:i};return new MUSIC.SoundLib.Oscillator(t,e,r)},n.f)this.play=function(i){var r,s=n.wtPosition||0,a=n.f,o=0,u=n.frequency;r=u.at?u.at.bind(u):function(t){return u};var c,h=0,f=0;if(s.at)var l=new MUSIC.Effects.Formula(t,e,function(t,e){return h=e-f,o+=h*r(e),o%=1,c=o+s.at(e),c%=1,0>c&&c++,f=e,a(c)});else var l=new MUSIC.Effects.Formula(t,e,function(t,e){return h=e-f,o+=h*r(e),o%=1,c=o+s,c%=1,0>c&&c++,f=e,a(c)});return{stop:function(){l.disconnect(e._destination)}}};else if(n.wave){var r=Object.create(n);r.f=n.wave.f,MUSIC.SoundLib.Oscillator.bind(this)(t,e,r)}else this.play=function(r){var s,a,o,u;return s=t.audio.createOscillator(),i.apply?i.apply(t.audio.currentTime,s.frequency):s.frequency.value=i,s.type=n.type,a=e,u=a._destination,o=function(){s.disconnect(u)},s.connect(u),s.start(0),{stop:function(){s.stop(0),o()}}};MUSIC.playablePipeExtend(this)},MUSIC.Loop=function(t,e){var n=t.duration();return{play:function(){var i,r=window.performance.now(),s=0;i=t.play();var a=function(){var a=window.performance.now();a-r>s*n&&(setTimeout(function(){i=t.play()},(s+1)*n-a),s++,s==e-1&&clearInterval(o))},o=setInterval(a,n);return{stop:function(){clearInterval(o),i&&i.stop()}}}}},MUSIC.Silence=function(t){return{play:function(){return{stop:function(){}}},duration:function(){return t}}}}(),MUSIC.Effects=MUSIC.Effects||{};var effectsObject={};MUSIC.Effects.forEach=function(t){for(var e in effectsObject)t(e,effectsObject[e])},MUSIC.Effects.WebAudioNodeWrapper=function(t,e,n){this._destination=e,setTimeout(function(){e.connect(n._destination)}),this.next=function(){return n};var i=!1;this.disconnect=function(){i||(i=!0,e.disconnect(n._destination))},this.dispose=this.disconnect,this.output=function(){return e},this.setParam=function(n,i){i.apply(t.audio.currentTime,e[n])},this.record=function(){var t=new Recorder(e,{workerPath:"lib/recorder/recorderWorker.js"});return t.record(),t},MUSIC.EffectsPipeline.bind(this)(t,this)},MUSIC.Effects.WebAudioNodeWrapper.prototype=Object.create(MUSIC.EffectsPipeline.prototype),MUSIC.Effects.Formula=function(t,e,n){var i=t.audio.createScriptProcessor(1024,1,1),r=0,s=t.audio.sampleRate;i.onaudioprocess=function(t){for(var e=t.inputBuffer,i=t.outputBuffer,a=0;a<i.numberOfChannels;a++)for(var o=e.getChannelData(a),u=i.getChannelData(a),c=0;c<e.length;c++)u[c]=n(o[c],(e.length*r+c)/s);r++},setTimeout(function(){i.connect(e._destination)}),this._destination=i,MUSIC.EffectsPipeline.bind(this)(t,this),this.next=function(){return e};var a=!1;this.disconnect=function(){a||(a=!0,i.disconnect(e._destination))},this.dispose=this.disconnect,this.update=function(t){n=t},this.output=function(){return i}},MUSIC.Effects.Formula.prototype=Object.create(MUSIC.EffectsPipeline.prototype),MUSIC.Effects.register("formula",function(t,e,n){return new MUSIC.Effects.Formula(t,e,n)}),MUSIC.Effects.BiQuad=function(t,e,n){var i=t.audio.createBiquadFilter();this.update=function(e){i.type=e.type,e.frequency.apply?e.frequency.apply(t.audio.currentTime,i.frequency):i.frequency.value=e.frequency,e.Q&&(i.Q.value=e.Q),e.gain&&(i.gain.value=e.gain)},this.update(n),MUSIC.Effects.WebAudioNodeWrapper.bind(this)(t,i,e)},MUSIC.Effects.BiQuad.prototype=Object.create(MUSIC.Effects.WebAudioNodeWrapper.prototype),MUSIC.Effects.register("biquad",MUSIC.Effects.BiQuad),["lowpass","highpass","bandpass","lowshelf","highshelf","peaking","notch","allpass"].forEach(function(t){MUSIC.Effects.register(t,function(e,n,i){return new MUSIC.Effects.BiQuad(e,n,{type:t,frequency:i.frequency})})});var canMutate=function(t,e){return t.update=function(n){return e(n),t},t};MUSIC.Effects.register("gain",function(t,e,n){var i=t.audio.createGain();return canMutate(new MUSIC.Effects.WebAudioNodeWrapper(t,i,e),function(t){i.gain.value=t}).update(n)}),MUSIC.Effects.register("delay",function(t,e,n){var i=t.audio.createDelay(60);return canMutate(new MUSIC.Effects.WebAudioNodeWrapper(t,i,e),function(t){i.delayTime.value=t}).update(n)});var Echo=function(t,e,n){this.update=function(t){i.delayTime.value=t.delay||.02,a.gain.value=t.gain||.2,i.delayTime.value<.01&&(i.delayTime.value=.01),i.delayTime.value>1&&(i.delayTime.value=1),a.gain.value>.99&&(a.gain.value=.99),a.gain.value<0&&(a.gain.value=0)};var i=t.audio.createDelay(60),r=t.audio.createGain(),s=t.audio.createGain();r.gain.value=1,s.gain.value=1;var a=t.audio.createGain();this.update(n),setTimeout(function(){r.connect(s),r.connect(i),i.connect(s),s.connect(e._destination),s.connect(a),a.connect(i)}),this._destination=r,this.next=function(){return e};var o=!1;this.disconnect=function(){o||(o=!0,r.disconnect(s),r.disconnect(i),i.disconnect(s),s.disconnect(e._destination),s.disconnect(a),a.disconnect(i))},this.dispose=this.disconnect,this.output=function(){return audioNode},this.setParam=function(e,n){n.apply(t.audio.currentTime,audioNode[e])},MUSIC.EffectsPipeline.bind(this)(t,this)};Echo.prototype=Object.create(MUSIC.EffectsPipeline.prototype),MUSIC.Effects.register("echo",function(t,e,n){return new Echo(t,e,n)}),MUSIC.Curve=function(t){this.during=during(t)},MUSIC.Curve.concat=function(t,e,n,i,r){var s=e+i;r||(r=Math.floor(100*s)+1);for(var a=function(i){return e>i?t.at(i):n.at(i-e)},o=new Float32Array(r+1),u=0;r+1>u;u++)o[u]=a(s*(u/r));return{apply:function(t,e){e.setValueCurveAtTime(o,t,s)},at:a}};var during=function(t,e){return function(n){e||(e=Math.floor(100*n)+1);for(var i=new Float32Array(e+1),r=0;e+1>r;r++)i[r]=t(r/e);return{apply:function(t,e){e.setValueCurveAtTime(i,t,n)},at:function(e){return t(e/n)}}}};MUSIC.Curve.Formula=function(t,e){this.during=during(t,e)},MUSIC.Curve.Ramp=function(t,e,n){MUSIC.Curve.Formula.bind(this)(function(n){return t+(e-t)*n},n)},MUSIC.Curve.Periodic=function(t,e){var n,i=0,r=0,s=1/e;e.at?this.at=function(s){
return n=s-r,i+=n*e.at(s),i%=1,r=s,t(i)}:this.at=function(e){return i=e%s/s,0>i&&i++,t(i)}},MUSIC.Effects.register("ADSR",function(t,e,n){n=n||{};var i=n.samples||100,r=n.attackTime,s=n.decayTime,a=n.sustainLevel,o=n.releaseTime;void 0===r&&(r=.1),void 0===s&&(s=.1),void 0===a&&(a=.8),void 0===o&&(o=.1);var u=n.node,c=new MUSIC.Curve.Ramp(0,1,i).during(r),h=new MUSIC.Curve.Ramp(1,a,i).during(s),f=MUSIC.Curve.concat(c,r,h,s),l=e.gain(a);return l.setParam("gain",f),u(l).onStop(function(){l.dispose()}).stopDelay(1e3*o).onStop(function(){var t=l._destination.gain.value,e=new MUSIC.Curve.Ramp(t,0,i).during(o);l.setParam("gain",e)})}),MUSIC.Effects.register("stopCurve",function(t,e,n){n=n||{};var i=n.samples||100,r=n.duration||.4,s=n.node,a=new MUSIC.Curve.Ramp(1,0,i).during(r),o=e.gain(1);return s(o).onStop(function(){o.dispose()}).stopDelay(1e3*r).onStop(function(){o.setParam("gain",a)})}),function(){var t=function(t){return 16.35*Math.pow(2,t/12)},e={C:0,D:2,E:4,F:5,G:7,A:9,B:11},n=function(t){var e=function(t,e){return{stop:function(){setTimeout(t.stop.bind(t),e)}}},i=function(t,n){return{play:function(i){var r=t.play(i);return e(r,n)}}};return t.stopDelay=function(e){return n({note:function(n){return i(t.note(n),e)}})},t.perNoteWrap=function(e){return n({note:function(n){return e(t.note(n))}})},t.mapNote=function(e){return n({note:function(n){return t.note(e(n))}})},t};MUSIC.noteToNoteNum=function(t){var n;return n=e[t.charAt(0)],void 0!==n?("#"===t.charAt(1)&&n++,"b"===t.charAt(1)&&n--,""!==t.charAt(2)&&(n+=12*parseInt(t.charAt(2))),n):void 0},MUSIC.Instrument=function(e){this.note=function(n){if(void 0!==n){var i=t(n);return MUSIC.playablePipeExtend({play:function(t){var n=e.freq(i).play(t);return{stop:function(){n.stop()}}}})}},n(this)},MUSIC.instrumentExtend=n,MUSIC.Instrument.frequency=t,MUSIC.MultiInstrument=function(t){var e=function(t){return t.play()},i=function(t){return t.stop()},r=function(t){this.play=function(){var n=t.map(e);return{stop:function(){n.forEach(i)}}}};this.note=function(e){return MUSIC.playablePipeExtend(new r(t.map(function(t){return t.note(e)})))},n(this)};var i=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],r=function(t){var e=i[t%12],n=Math.floor(t/12+1);return e+n};MUSIC.PatchInstrument=function(t){var e,i=[];for(var r in t){var s=MUSIC.Types.cast("playable",t[r]);e=MUSIC.noteToNoteNum(r),i[e]=s}this.note=function(t){var e=i[t];return e?MUSIC.playablePipeExtend({play:e.play}):e},n(this)},MUSIC.SoundfontInstrument=function(t,e,i){function s(t){for(var e=window.atob(t),n=e.length,i=new Uint8Array(n),r=0;n>r;r++){var s=e.charCodeAt(r);i[r]=s}return i.buffer}var a=[];e=e.audio;for(var o=0;72>o;o++)!function(){var n=o,i=(new XMLHttpRequest,r(o)),u=t[i],c=u.split(",")[1];e.decodeAudioData(s(c),function(t){a[n]=t},function(t){console.error("error "+t+" loading "+n)})}();this.note=function(t){e.createBufferSource();return MUSIC.playablePipeExtend({play:function(){var n=e.createBufferSource();return n.buffer=a[t],n.connect(i._destination),n.start(0),{stop:function(){n.stop(0),n.disconnect(i._destination)}}}})},n(this)},MUSIC.Types.register("instrument",function(t){return t.note?t:void 0}),MUSIC.Types.register("instrument",function(t){return t.freq?new MUSIC.Instrument(t):void 0}),MUSIC.Types.register("instrument",function(t){return t.play?{note:function(){return t}}:void 0});var s={play:function(){return{stop:function(){}}}};MUSIC.Types.register("instrument",function(t){return"function"==typeof t?{note:function(e){return t(e)||s}}:void 0}),MUSIC.Types.register("instrument",function(t){return t instanceof Array?new MUSIC.MultiInstrument(t):void 0}),MUSIC.Types.register("instrument",function(t){return"object"==typeof t&&t.constructor===Object?new MUSIC.PatchInstrument(t):void 0}),MUSIC.StopEvent=function(){return function(t){return MUSIC.playablePipeExtend({play:function(){var e={onplay:function(){},onstop:function(){}},n=t.play(e);return e.onplay(),{stop:function(){e.onstop(),n.stop()}}}})}}}(),MUSIC.Effects=MUSIC.Effects||{};var LemonadePlayable=function(t,e,n,i){this._destination=e,this._music=t,this._ops=i,this._output=n};LemonadePlayable.prototype.play=function(){for(var t=this._destination,e=this._ops,n=e.length,i=[],r=[],s=0;n>s;s++)i[s]=0,r[s]=0,e[s].wave=MUSIC.Types.cast("function",e[s].wave);var a=0,o=this._output,u=new MUSIC.Effects.Formula(this._music,t,function(t,s){for(var u=s-a,c=0;n>c;c++){a=s,r[c]=r[c]+u*e[c].frequency.apply(null,i);var h=r[c]%1;0>h&&h++,i[c]=e[c].wave(h)}return o.apply(null,i)});return{stop:function(){u.disconnect(t._destination)}}},MUSIC.playablePipeExtend(LemonadePlayable.prototype),MUSIC.Effects.register("lemonade",function(t,e,n){return new LemonadePlayable(t,e._audioDestination,n.output,n.ops)}),function(){MUSIC.NoteSequence=function(t){var e;t||(e=MUSIC.Utils.Clock(window.performance.now.bind(window.performance),setInterval,clearInterval,500),t=MUSIC.Utils.FunctionSeq(e,setTimeout,clearTimeout)),this._funseq=t,this._totalduration=0,this._noteid=0},MUSIC.NoteSequence.Playable=function(t,e,n){this._noteseq=t,this._context=e,this._duration=n},MUSIC.NoteSequence.Playable.prototype.loop=function(t){return MUSIC.Loop(this,t)},MUSIC.NoteSequence.Playable.prototype.duration=function(){return this._duration},MUSIC.NoteSequence.Playable.prototype.play=function(){return this._runningFunSeq=this._noteseq._funseq.start(this._context),new MUSIC.NoteSequence.Playing(this._runningFunSeq,this._context)},MUSIC.NoteSequence.Playing=function(t,e){this._runningFunSeq=t,this._context=e},MUSIC.NoteSequence.Playing.prototype.stop=function(){this._context.playing&&this._context.playing.stop(),this._runningFunSeq.stop(),this._context.stop()},MUSIC.NoteSequence.prototype.push=function(t){var e=t[0],n=t[1],i=t[2];this._noteid++;var r=this._noteid;this._funseq.push({t:n,f:function(t){var n;n=t.instrument.note(e),t.setPlaying(r,n)}}),this._funseq.push({t:n+i,f:function(t){t.unsetPlaying(r)}}),n+i>this._totalduration&&(this._totalduration=n+i)},MUSIC.NoteSequence.prototype.makePlayable=function(t){return new MUSIC.NoteSequence.Playable(this,MUSIC.NoteSequence.context(t),this._totalduration)},MUSIC.NoteSequence.context=function(t){var e=[],n=function(t,n){e[t]=n.play()},i=function(t){var n=e[t];n&&(n.stop(),e[t]=void 0)},r=function(){for(var t=0;t<e.length;t++)e[t]&&e[t].stop()};return{setPlaying:n,unsetPlaying:i,instrument:t,stop:r}}}(),function(){var t=function(t){return t.play()},e=function(t){t.stop()};MUSIC.MultiPlayable=function(t){this._playableArray=t,MUSIC.playablePipeExtend(this)},MUSIC.MultiPlayable.prototype.play=function(){var n=this._playableArray.map(t);return{stop:function(){n.forEach(e)}}};var n=function(t,e){return t>e?t:e},i=function(t){return t.duration()};MUSIC.MultiPlayable.prototype.duration=function(){return this._playableArray.map(i).reduce(n,0)},MUSIC.ChangeTimeWrapper=function(t,e){this._noteseq=t,this._extensionTime=e},MUSIC.ChangeTimeWrapper.prototype.push=function(t){this._noteseq.push([t[0],t[1]*this._extensionTime,t[2]*this._extensionTime])},MUSIC.Pattern=function(t,e){var n=[];return e=e||{},e.pulseTime=e.pulseTime||50,n=t.map(function(t){var n=t[0],i=MUSIC.Types.cast("instrument",t[1]),r=new MUSIC.NoteSequence;return MUSIC.SequenceParser.parse(n,new MUSIC.ChangeTimeWrapper(r,e.pulseTime)),r.makePlayable(i)}),new MUSIC.MultiPlayable(n)}}(),function(){MUSIC.SequenceParser={};var t={Cb:-1,C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,"E#":5,Fb:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11,"B#":12},e=function(t){return-1!=="CDEFGAB".indexOf(t)},n=function(t){for(var n=[],i="",r=0;r<t.length;r++)e(t[r])&&(""!==i&&n.push(i),i=""),(" "===t[r]||"."===t[r])&&(""!==i&&n.push(i),i=""),i+=t[r];return""!==i&&n.push(i),n},i=new RegExp("\\|","g");MUSIC.SequenceParser.parse=function(e,r){var s;if(""!==e){e=e.replace(i,"");for(var a=n(e),o=0,u=0;u<a.length;u++){var c=a[u],h=c.length,f=c.indexOf("=");-1!=f&&(c=c.slice(0,f));var l=c.slice(-1),p=parseInt(l);isNaN(p)?p=0:c=c.slice(0,c.length-1);var s=t[c];void 0!==s&&r.push([s+12*p,o,h]),o+=h}}}}(),function(){var t=function(t){this._context={playing:[]},this._funseqHandler=t.start(this._context)};t.prototype.stop=function(){this._context.playing.forEach(function(t){t.stop()}),this._funseqHandler.stop()};var e=function(t){return function(e){return t[e]}};MUSIC.Song=function(t,n,i){i=i||{};var r,s=i.measure||500;if(!r){var a=MUSIC.Utils.Clock(window.performance.now.bind(window.performance),setInterval,clearInterval,500);r=MUSIC.Utils.FunctionSeq(a,setTimeout,clearTimeout)}var o=t[0].length,u=e(n);this._funseq=r,this._duration=o*s;for(var c=0;o>c;c++)!function(){for(var e=[],n=0;n<t.length;n++)e.push(t[n][c]);var i,a=e.map(u),o=new MUSIC.MultiPlayable(a);r.push({t:c*s,f:function(t){i=o.play(),t.playing.push(i)}}),r.push({t:(c+1)*s,f:function(t){i.stop(),t.playing=t.playing.filter(function(t){return t!=i})}})}()},MUSIC.Song.prototype.duration=function(){return this._duration},MUSIC.Song.prototype.play=function(){return new t(this._funseq)}}(),function(){MUSIC.Utils=MUSIC.Utils||{},MUSIC.Utils.Scale=function(t){var e,n;e={},n=[0,2,5,7,9];for(var i=0;i<n.length;i++)e[(t+n[i])%12]=!0;return{add:function(t,n){for(var i=t;n>0;)i+=e[i%12]?2:1,n--;return i}}},MUSIC.Utils.Clock=function(t,e,n,i){var r=function(r){var s=t();r(0);var a=e(function(){var e=t();r(e-s)},i);return{stop:function(){n(a)}}};return{start:r}},MUSIC.Utils.FunctionSeq=function(t,e,n){var i=[],r=function(t){return function(e){return t!=e}},s=function(s){var a=i.slice(0),o=[],u=a.length,c=t.start(function(t){for(var n,i=function(e){return e.t-t<1e3&&e.t-t>=0},h=function(n){var i=e(function(){o=o.filter(r(i)),n.f(s),u--,0===u&&c.stop()},n.t-t);o.push(i)};;){if(!(a.length>0))break;if(n=a[0],!i(n))break;h(n),a.shift()}});return{stop:function(){for(var t=0;t<o.length;t++)n(o[t]);c.stop()}}},a=i.push.bind(i);return{start:s,push:a}},MUSIC.Utils.FunctionSeq.preciseTimeout=function(t,e){var n;clock=MUSIC.Utils.Clock(window.performance.now.bind(window.performance),setInterval,clearInterval,500),n=MUSIC.Utils.FunctionSeq(clock,setTimeout,clearTimeout);var i;n.push({f:function(){i&&i.stop(),t()},t:e}),i=n.start()}}(),function(){MUSIC=MUSIC||{},MUSIC.Types.register("function",function(t){return"function"==typeof t.at?t.at.bind(t):void 0}),MUSIC.Types.register("function",function(t){return"function"==typeof t?t:void 0}),MUSIC.Types.register("wave",function(t){return"function"==typeof t?new MUSIC.Wave.FunctionWave(t):void 0}),MUSIC.Types.register("wave",function(t){return"function"==typeof t.at?t:void 0});var t=2*Math.PI;MUSIC.Wave={};var e=function(t){return function(){var e=this;return{at:function(n){e.at(t(n))}}}},n={reverse:e(function(t){return t-1}),scale:function(t){var e=this;return new MUSIC.Wave.FunctionWave(function(n){return e.at(n*t)})},translate:function(t){var e=this;return new MUSIC.Wave.FunctionWave(function(n){return e.at(n+t)})},table:function(t){return new MUSIC.Wave.Table(this,t)},combine:function(t,e){var n=this;e=e||.5;var i=1-e;return t=MUSIC.Types.cast("wave",t),new MUSIC.Wave.FunctionWave(function(r){return t.at(r)*e+n.at(r)*i})}},i=function(t){t.length;return function(e){var n=Math.floor(e*t.length);return t[n]}};MUSIC.Wave.Table=function(t,e){e=e||{};for(var n=e.samples||100,r=e.interpolation||i,s=[],a=0;n>a;a++)s[a]=t.at(a/n);this.at=r(s)},MUSIC.Wave.Table.prototype=n,MUSIC.Wave.FunctionWave=function(t){this.at=t},MUSIC.Wave.FunctionWave.prototype=n,MUSIC.Wave.sine=function(){return new MUSIC.Wave.FunctionWave(function(e){return Math.sin(t*e)})},MUSIC.Wave.square=function(t){t=t||{};var e=t.dutyCycle||.5,n=t.dutyLevel||1,i=t.offLevel||-1;return new MUSIC.Wave.FunctionWave(function(t){return e>t?n:i})},MUSIC.Wave.triangle=function(){return new MUSIC.Wave.FunctionWave(function(t){var e=t-.25;return 0>e&&e++,.5>e?1-4*e:-1+4*(e-.5)})},MUSIC.Wave.sawtooth=function(){return new MUSIC.Wave.FunctionWave(function(t){return 2*t-1})}}();
//# sourceMappingURL=music.min.js.map
