<head>
<script src="src/music.js" ></script>
<script src="src/music/instruments.js" ></script>
<script src="src/music/effects.js" ></script>
<script src="src/soundfont/accordion-ogg.js" ></script>
<script src="src/soundfont/acoustic_grand_piano-ogg.js" ></script>

<p> Use ZXCVBNM keys for keyboard </p>
<script>
(function() {

    var music = new MUSIC.Context();


    var snd = {
        freq: function(frequency) {
            return music
                    .lowpass(frequency)
                    .noise();
        }
    };
    var oscInstrument = 
       new MUSIC.Instrument(snd);


    var sfInstrument = music
                        .attenuator(function(){ return 5.0; })
                        .soundfont(MIDI.Soundfont.acoustic_grand_piano)
                        .mapNote(function(x){return x;});

    instrument = new MUSIC.MultiInstrument([
            oscInstrument,
            sfInstrument
            ]);
    instrument = sfInstrument;
/*    var player = MUSIC.InstrumentSequence(instrument, 200);
    var playe2 = MUSIC.InstrumentSequence(instrument2, 200);
*/

    /*var seq = MUSIC
        .Sequence()
        .n(
            [
                player('A-------').measure(1600),
                playe2('A-------').measure(1600)
             ]);

    window.seq = seq;
    window.playing = seq.play();
    window.instrument = instrument;
*/
    var notes = {};
    var keyCodeToNote = {90: 'C', 88: 'D',  67: 'E', 86: 'F', 66: 'G', 78: 'A', 77: 'B'};

    window.onkeydown = function(e) {
        var n = notes[e.keyCode];
        if (n) return;

        var note = instrument.note(MUSIC.noteToNoteNum(keyCodeToNote[e.keyCode])+36);
        if (note == undefined) return;
        notes[e.keyCode] = note.play();
    };
    window.onkeyup = function(e) {
        var n = notes[e.keyCode];
        if (!n) return;
        notes[e.keyCode] = undefined;
        n.stop();
    };


})();

</script>
</head>
